/*!
  * Bowser - a browser detector
  * https://github.com/ded/bowser
  * MIT License | (c) Dustin Diaz 2014
  */
!function(name,definition){if(typeof module!='undefined'&&module.exports)module.exports=definition()
else if(typeof define=='function'&&define.amd)define(definition)
else this[name]=definition()}('bowser',function(){var t=true
function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return(match&&match.length>1&&match[1])||'';}
function getSecondMatch(regex){var match=ua.match(regex);return(match&&match.length>1&&match[2])||'';}
var iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),likeAndroid=/like android/i.test(ua),android=!likeAndroid&&/android/i.test(ua),chromeos=/CrOS/.test(ua),silk=/silk/i.test(ua),sailfish=/sailfish/i.test(ua),tizen=/tizen/i.test(ua),webos=/(web|hpw)os/i.test(ua),windowsphone=/windows phone/i.test(ua),windows=!windowsphone&&/windows/i.test(ua),mac=!iosdevice&&!silk&&/macintosh/i.test(ua),linux=!android&&!sailfish&&!tizen&&!webos&&/linux/i.test(ua),edgeVersion=getFirstMatch(/edge\/(\d+(\.\d+)?)/i),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),result
if(/opera|opr/i.test(ua)){result={name:'Opera',opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}}
else if(/yabrowser/i.test(ua)){result={name:'Yandex Browser',yandexbrowser:t,version:versionIdentifier||getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}}
else if(windowsphone){result={name:'Windows Phone',windowsphone:t}
if(edgeVersion){result.msedge=t
result.version=edgeVersion}
else{result.msie=t
result.version=getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i)}}
else if(/msie|trident/i.test(ua)){result={name:'Internet Explorer',msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)}}else if(chromeos){result={name:'Chrome',chromeos:t,chromeBook:t,chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(/chrome.+? edge/i.test(ua)){result={name:'Microsoft Edge',msedge:t,version:edgeVersion}}
else if(/chrome|crios|crmo/i.test(ua)){result={name:'Chrome',chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}
else if(iosdevice){result={name:iosdevice=='iphone'?'iPhone':iosdevice=='ipad'?'iPad':'iPod'}
if(versionIdentifier){result.version=versionIdentifier}}
else if(sailfish){result={name:'Sailfish',sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}}
else if(/seamonkey\//i.test(ua)){result={name:'SeaMonkey',seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}}
else if(/firefox|iceweasel/i.test(ua)){result={name:'Firefox',firefox:t,version:getFirstMatch(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)}
if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)){result.firefoxos=t}}
else if(silk){result={name:'Amazon Silk',silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)}}
else if(android){result={name:'Android',version:versionIdentifier}}
else if(/phantom/i.test(ua)){result={name:'PhantomJS',phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)}}
else if(/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)){result={name:'BlackBerry',blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}}
else if(webos){result={name:'WebOS',webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(ua)&&(result.touchpad=t)}
else if(/bada/i.test(ua)){result={name:'Bada',bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)};}
else if(tizen){result={name:'Tizen',tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier};}
else if(/safari/i.test(ua)){result={name:'Safari',safari:t,version:versionIdentifier}}
else{result={name:getFirstMatch(/^(.*)\/(.*) /),version:getSecondMatch(/^(.*)\/(.*) /)};}
if(!result.msedge&&/(apple)?webkit/i.test(ua)){result.name=result.name||"Webkit"
result.webkit=t
if(!result.version&&versionIdentifier){result.version=versionIdentifier}}else if(!result.opera&&/gecko\//i.test(ua)){result.name=result.name||"Gecko"
result.gecko=t
result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i)}
if(!result.msedge&&(android||result.silk)){result.android=t}else if(iosdevice){result[iosdevice]=t
result.ios=t}else if(windows){result.windows=t}else if(mac){result.mac=t}else if(linux){result.linux=t}
var osVersion='';if(result.windowsphone){osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i);}else if(iosdevice){osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i);osVersion=osVersion.replace(/[_\s]/g,'.');}else if(android){osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i);}else if(result.webos){osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i);}else if(result.blackberry){osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i);}else if(result.bada){osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i);}else if(result.tizen){osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i);}
if(osVersion){result.osversion=osVersion;}
var osMajorVersion=osVersion.split('.')[0];if(tablet||iosdevice=='ipad'||(android&&(osMajorVersion==3||(osMajorVersion==4&&!mobile)))||result.silk){result.tablet=t}else if(mobile||iosdevice=='iphone'||iosdevice=='ipod'||android||result.blackberry||result.webos||result.bada){result.mobile=t}
if(result.msedge||(result.msie&&result.version>=10)||(result.yandexbrowser&&result.version>=15)||(result.chrome&&result.version>=20)||(result.firefox&&result.version>=20.0)||(result.safari&&result.version>=6)||(result.opera&&result.version>=10.0)||(result.ios&&result.osversion&&result.osversion.split(".")[0]>=6)||(result.blackberry&&result.version>=10.1)){result.a=t;}
else if((result.msie&&result.version<10)||(result.chrome&&result.version<20)||(result.firefox&&result.version<20.0)||(result.safari&&result.version<6)||(result.opera&&result.version<10.0)||(result.ios&&result.osversion&&result.osversion.split(".")[0]<6)){result.c=t}else result.x=t
return result}
var bowser=detect(typeof navigator!=='undefined'?navigator.userAgent:'')
bowser.test=function(browserList){for(var i=0;i<browserList.length;++i){var browserItem=browserList[i];if(typeof browserItem==='string'){if(browserItem in bowser){return true;}}}
return false;}
bowser._detect=detect;return bowser});
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.6.0-rc.1"};if(typeof exports!=='undefined'){exports.fabric=fabric;}
if(typeof document!=='undefined'&&typeof window!=='undefined'){fabric.document=document;fabric.window=window;window.fabric=fabric;}
else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");if(fabric.document.createWindow){fabric.window=fabric.document.createWindow();}else{fabric.window=fabric.document.parentWindow;}}
fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=='undefined'&&typeof window==='undefined';fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"];fabric.DPI=96;fabric.reNum='(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)';fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;if(typeof(eventjs)==="undefined")var eventjs={};(function(root){"use strict";root.modifyEventListener=false;root.modifySelectors=false;root.configure=function(conf){if(isFinite(conf.modifyEventListener))root.modifyEventListener=conf.modifyEventListener;if(isFinite(conf.modifySelectors))root.modifySelectors=conf.modifySelectors;if(eventListenersAgumented===false&&root.modifyEventListener){augmentEventListeners();}
if(selectorsAugmented===false&&root.modifySelectors){augmentSelectors();}};root.add=function(target,type,listener,configure){return eventManager(target,type,listener,configure,"add");};root.remove=function(target,type,listener,configure){return eventManager(target,type,listener,configure,"remove");};root.returnFalse=function(event){return false;};root.stop=function(event){if(!event)return;if(event.stopPropagation)event.stopPropagation();event.cancelBubble=true;event.cancelBubbleCount=0;};root.prevent=function(event){if(!event)return;if(event.preventDefault){event.preventDefault();}else if(event.preventManipulation){event.preventManipulation();}else{event.returnValue=false;}};root.cancel=function(event){root.stop(event);root.prevent(event);};root.blur=function(){var node=document.activeElement;if(!node)return;var nodeName=document.activeElement.nodeName;if(nodeName==="INPUT"||nodeName==="TEXTAREA"||node.contentEditable==="true"){if(node.blur)node.blur();}};root.getEventSupport=function(target,type){if(typeof(target)==="string"){type=target;target=window;}
type="on"+type;if(type in target)return true;if(!target.setAttribute)target=document.createElement("div");if(target.setAttribute&&target.removeAttribute){target.setAttribute(type,"");var isSupported=typeof target[type]==="function";if(typeof target[type]!=="undefined")target[type]=null;target.removeAttribute(type);return isSupported;}};var clone=function(obj){if(!obj||typeof(obj)!=='object')return obj;var temp=new obj.constructor();for(var key in obj){if(!obj[key]||typeof(obj[key])!=='object'){temp[key]=obj[key];}else{temp[key]=clone(obj[key]);}}
return temp;};var eventManager=function(target,type,listener,configure,trigger,fromOverwrite){configure=configure||{};if(String(target)==="[object Object]"){var data=target;target=data.target;delete data.target;if(data.type&&data.listener){type=data.type;delete data.type;listener=data.listener;delete data.listener;for(var key in data){configure[key]=data[key];}}else{for(var param in data){var value=data[param];if(typeof(value)==="function")continue;configure[param]=value;}
var ret={};for(var key in data){var param=key.split(",");var o=data[key];var conf={};for(var k in configure){conf[k]=configure[k];}
if(typeof(o)==="function"){var listener=o;}else if(typeof(o.listener)==="function"){var listener=o.listener;for(var k in o){if(typeof(o[k])==="function")continue;conf[k]=o[k];}}else{continue;}
for(var n=0;n<param.length;n++){ret[key]=eventjs.add(target,param[n],listener,conf,trigger);}}
return ret;}}
if(!target||!type||!listener)return;if(typeof(target)==="string"&&type==="ready"){if(window.eventjs_stallOnReady){type="load";target=window;}else{var time=(new Date()).getTime();var timeout=configure.timeout;var ms=configure.interval||1000/60;var interval=window.setInterval(function(){if((new Date()).getTime()-time>timeout){window.clearInterval(interval);}
if(document.querySelector(target)){window.clearInterval(interval);setTimeout(listener,1);}},ms);return;}}
if(typeof(target)==="string"){target=document.querySelectorAll(target);if(target.length===0)return createError("Missing target on listener!",arguments);if(target.length===1){target=target[0];}}
var event;var events={};if(target.length>0&&target!==window){for(var n0=0,length0=target.length;n0<length0;n0++){event=eventManager(target[n0],type,listener,clone(configure),trigger);if(event)events[n0]=event;}
return createBatchCommands(events);}
if(typeof(type)==="string"){type=type.toLowerCase();if(type.indexOf(" ")!==-1){type=type.split(" ");}else if(type.indexOf(",")!==-1){type=type.split(",");}}
if(typeof(type)!=="string"){if(typeof(type.length)==="number"){for(var n1=0,length1=type.length;n1<length1;n1++){event=eventManager(target,type[n1],listener,clone(configure),trigger);if(event)events[type[n1]]=event;}}else{for(var key in type){if(typeof(type[key])==="function"){event=eventManager(target,key,type[key],clone(configure),trigger);}else{event=eventManager(target,key,type[key].listener,clone(type[key]),trigger);}
if(event)events[key]=event;}}
return createBatchCommands(events);}else if(type.indexOf("on")===0){type=type.substr(2);}
if(typeof(target)!=="object")return createError("Target is not defined!",arguments);if(typeof(listener)!=="function")return createError("Listener is not a function!",arguments);var useCapture=configure.useCapture||false;var id=getID(target)+"."+getID(listener)+"."+(useCapture?1:0);if(root.Gesture&&root.Gesture._gestureHandlers[type]){id=type+id;if(trigger==="remove"){if(!wrappers[id])return;wrappers[id].remove();delete wrappers[id];}else if(trigger==="add"){if(wrappers[id]){wrappers[id].add();return wrappers[id];}
if(configure.useCall&&!root.modifyEventListener){var tmp=listener;listener=function(event,self){for(var key in self)event[key]=self[key];return tmp.call(target,event);};}
configure.gesture=type;configure.target=target;configure.listener=listener;configure.fromOverwrite=fromOverwrite;wrappers[id]=root.proxy[type](configure);}
return wrappers[id];}else{var eventList=getEventList(type);for(var n=0,eventId;n<eventList.length;n++){type=eventList[n];eventId=type+"."+id;if(trigger==="remove"){if(!wrappers[eventId])continue;target[remove](type,listener,useCapture);delete wrappers[eventId];}else if(trigger==="add"){if(wrappers[eventId])return wrappers[eventId];target[add](type,listener,useCapture);wrappers[eventId]={id:eventId,type:type,target:target,listener:listener,remove:function(){for(var n=0;n<eventList.length;n++){root.remove(target,eventList[n],listener,configure);}}};}}
return wrappers[eventId];}};var createBatchCommands=function(events){return{remove:function(){for(var key in events){events[key].remove();}},add:function(){for(var key in events){events[key].add();}}};};var createError=function(message,data){if(typeof(console)==="undefined")return;if(typeof(console.error)==="undefined")return;console.error(message,data);};var pointerDefs={"msPointer":["MSPointerDown","MSPointerMove","MSPointerUp"],"touch":["touchstart","touchmove","touchend"],"mouse":["mousedown","mousemove","mouseup"]};var pointerDetect={"MSPointerDown":0,"MSPointerMove":1,"MSPointerUp":2,"touchstart":0,"touchmove":1,"touchend":2,"mousedown":0,"mousemove":1,"mouseup":2};var getEventSupport=(function(){root.supports={};if(window.navigator.msPointerEnabled){root.supports.msPointer=true;}
if(root.getEventSupport("touchstart")){root.supports.touch=true;}
if(root.getEventSupport("mousedown")){root.supports.mouse=true;}})();var getEventList=(function(){return function(type){var prefix=document.addEventListener?"":"on";var idx=pointerDetect[type];if(isFinite(idx)){var types=[];for(var key in root.supports){types.push(prefix+pointerDefs[key][idx]);}
return types;}else{return[prefix+type];}};})();var wrappers={};var counter=0;var getID=function(object){if(object===window)return"#window";if(object===document)return"#document";if(!object.uniqueID)object.uniqueID="e"+counter++;return object.uniqueID;};var add=document.addEventListener?"addEventListener":"attachEvent";var remove=document.removeEventListener?"removeEventListener":"detachEvent";root.createPointerEvent=function(event,self,preventRecord){var eventName=self.gesture;var target=self.target;var pts=event.changedTouches||root.proxy.getCoords(event);if(pts.length){var pt=pts[0];self.pointers=preventRecord?[]:pts;self.pageX=pt.pageX;self.pageY=pt.pageY;self.x=self.pageX;self.y=self.pageY;}
var newEvent=document.createEvent("Event");newEvent.initEvent(eventName,true,true);newEvent.originalEvent=event;for(var k in self){if(k==="target")continue;newEvent[k]=self[k];}
var type=newEvent.type;if(root.Gesture&&root.Gesture._gestureHandlers[type]){self.oldListener.call(target,newEvent,self,false);}};var eventListenersAgumented=false;var augmentEventListeners=function(){if(!window.HTMLElement)return;var augmentEventListener=function(proto){var recall=function(trigger){var handle=trigger+"EventListener";var handler=proto[handle];proto[handle]=function(type,listener,useCapture){if(root.Gesture&&root.Gesture._gestureHandlers[type]){var configure=useCapture;if(typeof(useCapture)==="object"){configure.useCall=true;}else{configure={useCall:true,useCapture:useCapture};}
eventManager(this,type,listener,configure,trigger,true);}else{var types=getEventList(type);for(var n=0;n<types.length;n++){handler.call(this,types[n],listener,useCapture);}}};};recall("add");recall("remove");};if(navigator.userAgent.match(/Firefox/)){augmentEventListener(HTMLDivElement.prototype);augmentEventListener(HTMLCanvasElement.prototype);}else{augmentEventListener(HTMLElement.prototype);}
augmentEventListener(document);augmentEventListener(window);};var selectorsAugmented=false;var augmentSelectors=function(){var proto=NodeList.prototype;proto.removeEventListener=function(type,listener,useCapture){for(var n=0,length=this.length;n<length;n++){this[n].removeEventListener(type,listener,useCapture);}};proto.addEventListener=function(type,listener,useCapture){for(var n=0,length=this.length;n<length;n++){this[n].addEventListener(type,listener,useCapture);}};};return root;})(eventjs);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.pointerSetup=function(conf,self){conf.target=conf.target||window;conf.doc=conf.target.ownerDocument||conf.target;conf.minFingers=conf.minFingers||conf.fingers||1;conf.maxFingers=conf.maxFingers||conf.fingers||Infinity;conf.position=conf.position||"relative";delete conf.fingers;self=self||{};self.enabled=true;self.gesture=conf.gesture;self.target=conf.target;self.env=conf.env;if(eventjs.modifyEventListener&&conf.fromOverwrite){conf.oldListener=conf.listener;conf.listener=eventjs.createPointerEvent;}
var fingers=0;var type=self.gesture.indexOf("pointer")===0&&eventjs.modifyEventListener?"pointer":"mouse";if(conf.oldListener)self.oldListener=conf.oldListener;self.listener=conf.listener;self.proxy=function(listener){self.defaultListener=conf.listener;conf.listener=listener;listener(conf.event,self);};self.add=function(){if(self.enabled===true)return;if(conf.onPointerDown)eventjs.add(conf.target,type+"down",conf.onPointerDown);if(conf.onPointerMove)eventjs.add(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp)eventjs.add(conf.doc,type+"up",conf.onPointerUp);self.enabled=true;};self.remove=function(){if(self.enabled===false)return;if(conf.onPointerDown)eventjs.remove(conf.target,type+"down",conf.onPointerDown);if(conf.onPointerMove)eventjs.remove(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp)eventjs.remove(conf.doc,type+"up",conf.onPointerUp);self.reset();self.enabled=false;};self.pause=function(opt){if(conf.onPointerMove&&(!opt||opt.move))eventjs.remove(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp&&(!opt||opt.up))eventjs.remove(conf.doc,type+"up",conf.onPointerUp);fingers=conf.fingers;conf.fingers=0;};self.resume=function(opt){if(conf.onPointerMove&&(!opt||opt.move))eventjs.add(conf.doc,type+"move",conf.onPointerMove);if(conf.onPointerUp&&(!opt||opt.up))eventjs.add(conf.doc,type+"up",conf.onPointerUp);conf.fingers=fingers;};self.reset=function(){conf.tracker={};conf.fingers=0;};return self;};var sp=eventjs.supports;eventjs.isMouse=!!sp.mouse;eventjs.isMSPointer=!!sp.touch;eventjs.isTouch=!!sp.msPointer;root.pointerStart=function(event,self,conf){var type=(event.type||"mousedown").toUpperCase();if(type.indexOf("MOUSE")===0){eventjs.isMouse=true;eventjs.isTouch=false;eventjs.isMSPointer=false;}else if(type.indexOf("TOUCH")===0){eventjs.isMouse=false;eventjs.isTouch=true;eventjs.isMSPointer=false;}else if(type.indexOf("MSPOINTER")===0){eventjs.isMouse=false;eventjs.isTouch=false;eventjs.isMSPointer=true;}
var addTouchStart=function(touch,sid){var bbox=conf.bbox;var pt=track[sid]={};switch(conf.position){case"absolute":pt.offsetX=0;pt.offsetY=0;break;case"differenceFromLast":pt.offsetX=touch.pageX;pt.offsetY=touch.pageY;break;case"difference":pt.offsetX=touch.pageX;pt.offsetY=touch.pageY;break;case"move":pt.offsetX=touch.pageX-bbox.x1;pt.offsetY=touch.pageY-bbox.y1;break;default:pt.offsetX=bbox.x1-bbox.scrollLeft;pt.offsetY=bbox.y1-bbox.scrollTop;break;}
var x=touch.pageX-pt.offsetX;var y=touch.pageY-pt.offsetY;pt.rotation=0;pt.scale=1;pt.startTime=pt.moveTime=(new Date()).getTime();pt.move={x:x,y:y};pt.start={x:x,y:y};conf.fingers++;};conf.event=event;if(self.defaultListener){conf.listener=self.defaultListener;delete self.defaultListener;}
var isTouchStart=!conf.fingers;var track=conf.tracker;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier||Infinity;if(conf.fingers){if(conf.fingers>=conf.maxFingers){var ids=[];for(var sid in conf.tracker)ids.push(sid);self.identifier=ids.join(",");return isTouchStart;}
var fingers=0;for(var rid in track){if(track[rid].up){delete track[rid];addTouchStart(touch,sid);conf.cancel=true;break;}
fingers++;}
if(track[sid])continue;addTouchStart(touch,sid);}else{track=conf.tracker={};self.bbox=conf.bbox=root.getBoundingBox(conf.target);conf.fingers=0;conf.cancel=false;addTouchStart(touch,sid);}}
var ids=[];for(var sid in conf.tracker)ids.push(sid);self.identifier=ids.join(",");return isTouchStart;};root.pointerEnd=function(event,self,conf,onPointerUp){var touches=event.touches||[];var length=touches.length;var exists={};for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier;exists[sid||Infinity]=true;}
for(var sid in conf.tracker){var track=conf.tracker[sid];if(exists[sid]||track.up)continue;if(onPointerUp){onPointerUp({pageX:track.pageX,pageY:track.pageY,changedTouches:[{pageX:track.pageX,pageY:track.pageY,identifier:sid==="Infinity"?Infinity:sid}]},"up");}
track.up=true;conf.fingers--;}
if(conf.fingers!==0)return false;var ids=[];conf.gestureFingers=0;for(var sid in conf.tracker){conf.gestureFingers++;ids.push(sid);}
self.identifier=ids.join(",");return true;};root.getCoords=function(event){if(typeof(event.pageX)!=="undefined"){root.getCoords=function(event){return Array({type:"mouse",x:event.pageX,y:event.pageY,pageX:event.pageX,pageY:event.pageY,identifier:event.pointerId||Infinity});};}else{root.getCoords=function(event){var doc=document.documentElement;event=event||window.event;return Array({type:"mouse",x:event.clientX+doc.scrollLeft,y:event.clientY+doc.scrollTop,pageX:event.clientX+doc.scrollLeft,pageY:event.clientY+doc.scrollTop,identifier:Infinity});};}
return root.getCoords(event);};root.getCoord=function(event){if("ontouchstart"in window){var pX=0;var pY=0;root.getCoord=function(event){var touches=event.changedTouches;if(touches&&touches.length){return{x:pX=touches[0].pageX,y:pY=touches[0].pageY};}else{return{x:pX,y:pY};}};}else if(typeof(event.pageX)!=="undefined"&&typeof(event.pageY)!=="undefined"){root.getCoord=function(event){return{x:event.pageX,y:event.pageY};};}else{root.getCoord=function(event){var doc=document.documentElement;event=event||window.event;return{x:event.clientX+doc.scrollLeft,y:event.clientY+doc.scrollTop};};}
return root.getCoord(event);};var getPropertyAsFloat=function(o,type){var n=parseFloat(o.getPropertyValue(type),10);return isFinite(n)?n:0;};root.getBoundingBox=function(o){if(o===window||o===document)o=document.body;var bbox={};var bcr=o.getBoundingClientRect();bbox.width=bcr.width;bbox.height=bcr.height;bbox.x1=bcr.left;bbox.y1=bcr.top;bbox.scaleX=bcr.width/o.offsetWidth||1;bbox.scaleY=bcr.height/o.offsetHeight||1;bbox.scrollLeft=0;bbox.scrollTop=0;var style=window.getComputedStyle(o);var borderBox=style.getPropertyValue("box-sizing")==="border-box";if(borderBox===false){var left=getPropertyAsFloat(style,"border-left-width");var right=getPropertyAsFloat(style,"border-right-width");var bottom=getPropertyAsFloat(style,"border-bottom-width");var top=getPropertyAsFloat(style,"border-top-width");bbox.border=[left,right,top,bottom];bbox.x1+=left;bbox.y1+=top;bbox.width-=right+left;bbox.height-=bottom+top;}
bbox.x2=bbox.x1+bbox.width;bbox.y2=bbox.y1+bbox.height;var position=style.getPropertyValue("position");var tmp=position==="fixed"?o:o.parentNode;while(tmp!==null){if(tmp===document.body)break;if(tmp.scrollTop===undefined)break;var style=window.getComputedStyle(tmp);var position=style.getPropertyValue("position");if(position==="absolute"){}else if(position==="fixed"){bbox.scrollTop-=tmp.parentNode.scrollTop;bbox.scrollLeft-=tmp.parentNode.scrollLeft;break;}else{bbox.scrollLeft+=tmp.scrollLeft;bbox.scrollTop+=tmp.scrollTop;}
tmp=tmp.parentNode;};bbox.scrollBodyLeft=(window.pageXOffset!==undefined)?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;bbox.scrollBodyTop=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;bbox.scrollLeft-=bbox.scrollBodyLeft;bbox.scrollTop-=bbox.scrollBodyTop;return bbox;};(function(){var agent=navigator.userAgent.toLowerCase();var mac=agent.indexOf("macintosh")!==-1;var metaKeys;if(mac&&agent.indexOf("khtml")!==-1){metaKeys={91:true,93:true};}else if(mac&&agent.indexOf("firefox")!==-1){metaKeys={224:true};}else{metaKeys={17:true};}
(root.metaTrackerReset=function(){eventjs.fnKey=root.fnKey=false;eventjs.metaKey=root.metaKey=false;eventjs.escKey=root.escKey=false;eventjs.ctrlKey=root.ctrlKey=false;eventjs.shiftKey=root.shiftKey=false;eventjs.altKey=root.altKey=false;})();root.metaTracker=function(event){var isKeyDown=event.type==="keydown";if(event.keyCode===27)eventjs.escKey=root.escKey=isKeyDown;if(metaKeys[event.keyCode])eventjs.metaKey=root.metaKey=isKeyDown;eventjs.ctrlKey=root.ctrlKey=event.ctrlKey;eventjs.shiftKey=root.shiftKey=event.shiftKey;eventjs.altKey=root.altKey=event.altKey;};})();return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};eventjs.MutationObserver=(function(){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var DOMAttrModifiedSupported=!MutationObserver&&(function(){var p=document.createElement("p");var flag=false;var fn=function(){flag=true};if(p.addEventListener){p.addEventListener("DOMAttrModified",fn,false);}else if(p.attachEvent){p.attachEvent("onDOMAttrModified",fn);}else{return false;}
p.setAttribute("id","target");return flag;})();return function(container,callback){if(MutationObserver){var options={subtree:false,attributes:true};var observer=new MutationObserver(function(mutations){mutations.forEach(function(e){callback.call(e.target,e.attributeName);});});observer.observe(container,options)}else if(DOMAttrModifiedSupported){eventjs.add(container,"DOMAttrModified",function(e){callback.call(container,e.attrName);});}else if("onpropertychange"in document.body){eventjs.add(container,"propertychange",function(e){callback.call(container,window.event.propertyName);});}}})();if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.click=function(conf){conf.gesture=conf.gesture||"click";conf.maxFingers=conf.maxFingers||conf.fingers||1;conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){eventjs.add(conf.target,"mouseup",conf.onPointerUp);}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){eventjs.remove(conf.target,"mouseup",conf.onPointerUp);var pointers=event.changedTouches||root.getCoords(event);var pointer=pointers[0];var bbox=conf.bbox;var newbbox=root.getBoundingBox(conf.target);var y=pointer.pageY-newbbox.scrollBodyTop;var x=pointer.pageX-newbbox.scrollBodyLeft;if(x>bbox.x1&&y>bbox.y1&&x<bbox.x2&&y<bbox.y2&&bbox.scrollTop===newbbox.scrollTop){for(var key in conf.tracker)break;var point=conf.tracker[key];self.x=point.start.x;self.y=point.start.y;conf.listener(event,self);}}};var self=root.pointerSetup(conf);self.state="click";eventjs.add(conf.target,"mousedown",conf.onPointerDown);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.click=root.click;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.dbltap=root.dblclick=function(conf){conf.gesture=conf.gesture||"dbltap";conf.maxFingers=conf.maxFingers||conf.fingers||1;var delay=700;var time0,time1,timeout;var pointer0,pointer1;conf.onPointerDown=function(event){var pointers=event.changedTouches||root.getCoords(event);if(time0&&!time1){pointer1=pointers[0];time1=(new Date()).getTime()-time0;}else{pointer0=pointers[0];time0=(new Date()).getTime();time1=0;clearTimeout(timeout);timeout=setTimeout(function(){time0=0;},delay);}
if(root.pointerStart(event,self,conf)){eventjs.add(conf.target,"mousemove",conf.onPointerMove).listener(event);eventjs.add(conf.target,"mouseup",conf.onPointerUp);}};conf.onPointerMove=function(event){if(time0&&!time1){var pointers=event.changedTouches||root.getCoords(event);pointer1=pointers[0];}
var bbox=conf.bbox;var ax=(pointer1.pageX-bbox.x1);var ay=(pointer1.pageY-bbox.y1);if(!(ax>0&&ax<bbox.width&&ay>0&&ay<bbox.height&&Math.abs(pointer1.pageX-pointer0.pageX)<=25&&Math.abs(pointer1.pageY-pointer0.pageY)<=25)){eventjs.remove(conf.target,"mousemove",conf.onPointerMove);clearTimeout(timeout);time0=time1=0;}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){eventjs.remove(conf.target,"mousemove",conf.onPointerMove);eventjs.remove(conf.target,"mouseup",conf.onPointerUp);}
if(time0&&time1){if(time1<=delay){self.state=conf.gesture;for(var key in conf.tracker)break;var point=conf.tracker[key];self.x=point.start.x;self.y=point.start.y;conf.listener(event,self);}
clearTimeout(timeout);time0=time1=0;}};var self=root.pointerSetup(conf);self.state="dblclick";eventjs.add(conf.target,"mousedown",conf.onPointerDown);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.dbltap=root.dbltap;eventjs.Gesture._gestureHandlers.dblclick=root.dblclick;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.dragElement=function(that,event){root.drag({event:event,target:that,position:"move",listener:function(event,self){that.style.left=self.x+"px";that.style.top=self.y+"px";eventjs.prevent(event);}});};root.drag=function(conf){conf.gesture="drag";conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){if(!conf.monitor){eventjs.add(conf.doc,"mousemove",conf.onPointerMove);eventjs.add(conf.doc,"mouseup",conf.onPointerUp);}}
conf.onPointerMove(event,"down");};conf.onPointerMove=function(event,state){if(!conf.tracker)return conf.onPointerDown(event);var bbox=conf.bbox;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var identifier=touch.identifier||Infinity;var pt=conf.tracker[identifier];if(!pt)continue;pt.pageX=touch.pageX;pt.pageY=touch.pageY;self.state=state||"move";self.identifier=identifier;self.start=pt.start;self.fingers=conf.fingers;if(conf.position==="differenceFromLast"){self.x=(pt.pageX-pt.offsetX);self.y=(pt.pageY-pt.offsetY);pt.offsetX=pt.pageX;pt.offsetY=pt.pageY;}else{self.x=(pt.pageX-pt.offsetX);self.y=(pt.pageY-pt.offsetY);}
conf.listener(event,self);}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf,conf.onPointerMove)){if(!conf.monitor){eventjs.remove(conf.doc,"mousemove",conf.onPointerMove);eventjs.remove(conf.doc,"mouseup",conf.onPointerUp);}}};var self=root.pointerSetup(conf);if(conf.event){conf.onPointerDown(conf.event);}else{eventjs.add(conf.target,"mousedown",conf.onPointerDown);if(conf.monitor){eventjs.add(conf.doc,"mousemove",conf.onPointerMove);eventjs.add(conf.doc,"mouseup",conf.onPointerUp);}}
return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.drag=root.drag;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";var RAD_DEG=Math.PI/180;var getCentroid=function(self,points){var centroidx=0;var centroidy=0;var length=0;for(var sid in points){var touch=points[sid];if(touch.up)continue;centroidx+=touch.move.x;centroidy+=touch.move.y;length++;}
self.x=centroidx/=length;self.y=centroidy/=length;return self;};root.gesture=function(conf){conf.gesture=conf.gesture||"gesture";conf.minFingers=conf.minFingers||conf.fingers||2;conf.onPointerDown=function(event){var fingers=conf.fingers;if(root.pointerStart(event,self,conf)){eventjs.add(conf.doc,"mousemove",conf.onPointerMove);eventjs.add(conf.doc,"mouseup",conf.onPointerUp);}
if(conf.fingers===conf.minFingers&&fingers!==conf.fingers){self.fingers=conf.minFingers;self.scale=1;self.rotation=0;self.state="start";var sids="";for(var key in conf.tracker)sids+=key;self.identifier=parseInt(sids);getCentroid(self,conf.tracker);conf.listener(event,self);}};conf.onPointerMove=function(event,state){var bbox=conf.bbox;var points=conf.tracker;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier||Infinity;var pt=points[sid];if(!pt)continue;pt.move.x=(touch.pageX-bbox.x1);pt.move.y=(touch.pageY-bbox.y1);}
if(conf.fingers<conf.minFingers)return;var touches=[];var scale=0;var rotation=0;getCentroid(self,points);for(var sid in points){var touch=points[sid];if(touch.up)continue;var start=touch.start;if(!start.distance){var dx=start.x-self.x;var dy=start.y-self.y;start.distance=Math.sqrt(dx*dx+dy*dy);start.angle=Math.atan2(dx,dy)/RAD_DEG;}
var dx=touch.move.x-self.x;var dy=touch.move.y-self.y;var distance=Math.sqrt(dx*dx+dy*dy);scale+=distance/start.distance;var angle=Math.atan2(dx,dy)/RAD_DEG;var rotate=(start.angle-angle+360)%360-180;touch.DEG2=touch.DEG1;touch.DEG1=rotate>0?rotate:-rotate;if(typeof(touch.DEG2)!=="undefined"){if(rotate>0){touch.rotation+=touch.DEG1-touch.DEG2;}else{touch.rotation-=touch.DEG1-touch.DEG2;}
rotation+=touch.rotation;}
touches.push(touch.move);}
self.touches=touches;self.fingers=conf.fingers;self.scale=scale/conf.fingers;self.rotation=rotation/conf.fingers;self.state="change";conf.listener(event,self);};conf.onPointerUp=function(event){var fingers=conf.fingers;if(root.pointerEnd(event,self,conf)){eventjs.remove(conf.doc,"mousemove",conf.onPointerMove);eventjs.remove(conf.doc,"mouseup",conf.onPointerUp);}
if(fingers===conf.minFingers&&conf.fingers<conf.minFingers){self.fingers=conf.fingers;self.state="end";conf.listener(event,self);}};var self=root.pointerSetup(conf);eventjs.add(conf.target,"mousedown",conf.onPointerDown);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.gesture=root.gesture;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.pointerdown=root.pointermove=root.pointerup=function(conf){conf.gesture=conf.gesture||"pointer";if(conf.target.isPointerEmitter)return;var isDown=true;conf.onPointerDown=function(event){isDown=false;self.gesture="pointerdown";conf.listener(event,self);};conf.onPointerMove=function(event){self.gesture="pointermove";conf.listener(event,self,isDown);};conf.onPointerUp=function(event){isDown=true;self.gesture="pointerup";conf.listener(event,self,true);};var self=root.pointerSetup(conf);eventjs.add(conf.target,"mousedown",conf.onPointerDown);eventjs.add(conf.target,"mousemove",conf.onPointerMove);eventjs.add(conf.doc,"mouseup",conf.onPointerUp);conf.target.isPointerEmitter=true;return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.pointerdown=root.pointerdown;eventjs.Gesture._gestureHandlers.pointermove=root.pointermove;eventjs.Gesture._gestureHandlers.pointerup=root.pointerup;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.shake=function(conf){var self={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:conf.target,listener:conf.listener,remove:function(){window.removeEventListener('devicemotion',onDeviceMotion,false);}};var threshold=4;var timeout=1000;var timeframe=200;var shakes=3;var lastShake=(new Date()).getTime();var gravity={x:0,y:0,z:0};var delta={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}};var onDeviceMotion=function(e){var alpha=0.8;var o=e.accelerationIncludingGravity;gravity.x=alpha*gravity.x+(1-alpha)*o.x;gravity.y=alpha*gravity.y+(1-alpha)*o.y;gravity.z=alpha*gravity.z+(1-alpha)*o.z;self.accelerationIncludingGravity=gravity;self.acceleration.x=o.x-gravity.x;self.acceleration.y=o.y-gravity.y;self.acceleration.z=o.z-gravity.z;if(conf.gesture==="devicemotion"){conf.listener(e,self);return;}
var data="xyz";var now=(new Date()).getTime();for(var n=0,length=data.length;n<length;n++){var letter=data[n];var ACCELERATION=self.acceleration[letter];var DELTA=delta[letter];var abs=Math.abs(ACCELERATION);if(now-lastShake<timeout)continue;if(abs>threshold){var idx=now*ACCELERATION/abs;var span=Math.abs(idx+DELTA.value);if(DELTA.value&&span<timeframe){DELTA.value=idx;DELTA.count++;if(DELTA.count===shakes){conf.listener(e,self);lastShake=now;DELTA.value=0;DELTA.count=0;}}else{DELTA.value=idx;DELTA.count=1;}}}};if(!window.addEventListener)return;window.addEventListener('devicemotion',onDeviceMotion,false);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.shake=root.shake;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";var RAD_DEG=Math.PI/180;root.swipe=function(conf){conf.snap=conf.snap||90;conf.threshold=conf.threshold||1;conf.gesture=conf.gesture||"swipe";conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){eventjs.add(conf.doc,"mousemove",conf.onPointerMove).listener(event);eventjs.add(conf.doc,"mouseup",conf.onPointerUp);}};conf.onPointerMove=function(event){var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var sid=touch.identifier||Infinity;var o=conf.tracker[sid];if(!o)continue;o.move.x=touch.pageX;o.move.y=touch.pageY;o.moveTime=(new Date()).getTime();}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){eventjs.remove(conf.doc,"mousemove",conf.onPointerMove);eventjs.remove(conf.doc,"mouseup",conf.onPointerUp);var velocity1;var velocity2
var degree1;var degree2;var start={x:0,y:0};var endx=0;var endy=0;var length=0;for(var sid in conf.tracker){var touch=conf.tracker[sid];var xdist=touch.move.x-touch.start.x;var ydist=touch.move.y-touch.start.y;endx+=touch.move.x;endy+=touch.move.y;start.x+=touch.start.x;start.y+=touch.start.y;length++;var distance=Math.sqrt(xdist*xdist+ydist*ydist);var ms=touch.moveTime-touch.startTime;var degree2=Math.atan2(xdist,ydist)/RAD_DEG+180;var velocity2=ms?distance/ms:0;if(typeof(degree1)==="undefined"){degree1=degree2;velocity1=velocity2;}else if(Math.abs(degree2-degree1)<=20){degree1=(degree1+degree2)/2;velocity1=(velocity1+velocity2)/2;}else{return;}}
var fingers=conf.gestureFingers;if(conf.minFingers<=fingers&&conf.maxFingers>=fingers){if(velocity1>conf.threshold){start.x/=length;start.y/=length;self.start=start;self.x=endx/length;self.y=endy/length;self.angle=-((((degree1/conf.snap+0.5)>>0)*conf.snap||360)-360);self.velocity=velocity1;self.fingers=fingers;self.state="swipe";conf.listener(event,self);}}}};var self=root.pointerSetup(conf);eventjs.add(conf.target,"mousedown",conf.onPointerDown);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.swipe=root.swipe;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.longpress=function(conf){conf.gesture="longpress";return root.tap(conf);};root.tap=function(conf){conf.delay=conf.delay||500;conf.timeout=conf.timeout||250;conf.driftDeviance=conf.driftDeviance||10;conf.gesture=conf.gesture||"tap";var timestamp,timeout;conf.onPointerDown=function(event){if(root.pointerStart(event,self,conf)){timestamp=(new Date()).getTime();eventjs.add(conf.doc,"mousemove",conf.onPointerMove).listener(event);eventjs.add(conf.doc,"mouseup",conf.onPointerUp);if(conf.gesture!=="longpress")return;timeout=setTimeout(function(){if(event.cancelBubble&&++event.cancelBubbleCount>1)return;var fingers=0;for(var key in conf.tracker){var point=conf.tracker[key];if(point.end===true)return;if(conf.cancel)return;fingers++;}
if(conf.minFingers<=fingers&&conf.maxFingers>=fingers){self.state="start";self.fingers=fingers;self.x=point.start.x;self.y=point.start.y;conf.listener(event,self);}},conf.delay);}};conf.onPointerMove=function(event){var bbox=conf.bbox;var touches=event.changedTouches||root.getCoords(event);var length=touches.length;for(var i=0;i<length;i++){var touch=touches[i];var identifier=touch.identifier||Infinity;var pt=conf.tracker[identifier];if(!pt)continue;var x=(touch.pageX-bbox.x1);var y=(touch.pageY-bbox.y1);var dx=x-pt.start.x;var dy=y-pt.start.y;var distance=Math.sqrt(dx*dx+dy*dy);if(!(x>0&&x<bbox.width&&y>0&&y<bbox.height&&distance<=conf.driftDeviance)){eventjs.remove(conf.doc,"mousemove",conf.onPointerMove);conf.cancel=true;return;}}};conf.onPointerUp=function(event){if(root.pointerEnd(event,self,conf)){clearTimeout(timeout);eventjs.remove(conf.doc,"mousemove",conf.onPointerMove);eventjs.remove(conf.doc,"mouseup",conf.onPointerUp);if(event.cancelBubble&&++event.cancelBubbleCount>1)return;if(conf.gesture==="longpress"){if(self.state==="start"){self.state="end";conf.listener(event,self);}
return;}
if(conf.cancel)return;if((new Date()).getTime()-timestamp>conf.timeout)return;var fingers=conf.gestureFingers;if(conf.minFingers<=fingers&&conf.maxFingers>=fingers){self.state="tap";self.fingers=conf.gestureFingers;conf.listener(event,self);}}};var self=root.pointerSetup(conf);eventjs.add(conf.target,"mousedown",conf.onPointerDown);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.tap=root.tap;eventjs.Gesture._gestureHandlers.longpress=root.longpress;return root;})(eventjs.proxy);if(typeof(eventjs)==="undefined")var eventjs={};if(typeof(eventjs.proxy)==="undefined")eventjs.proxy={};eventjs.proxy=(function(root){"use strict";root.wheelPreventElasticBounce=function(el){if(!el)return;if(typeof(el)==="string")el=document.querySelector(el);eventjs.add(el,"wheel",function(event,self){self.preventElasticBounce();eventjs.stop(event);});};root.wheel=function(conf){var interval;var timeout=conf.timeout||150;var count=0;var self={gesture:"wheel",state:"start",wheelDelta:0,target:conf.target,listener:conf.listener,preventElasticBounce:function(event){var target=this.target;var scrollTop=target.scrollTop;var top=scrollTop+target.offsetHeight;var height=target.scrollHeight;if(top===height&&this.wheelDelta<=0)eventjs.cancel(event);else if(scrollTop===0&&this.wheelDelta>=0)eventjs.cancel(event);eventjs.stop(event);},add:function(){conf.target[add](type,onMouseWheel,false);},remove:function(){conf.target[remove](type,onMouseWheel,false);}};var onMouseWheel=function(event){event=event||window.event;self.state=count++?"change":"start";self.wheelDelta=event.detail?event.detail*-20:event.wheelDelta;conf.listener(event,self);clearTimeout(interval);interval=setTimeout(function(){count=0;self.state="end";self.wheelDelta=0;conf.listener(event,self);},timeout);};var add=document.addEventListener?"addEventListener":"attachEvent";var remove=document.removeEventListener?"removeEventListener":"detachEvent";var type=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";conf.target[add](type,onMouseWheel,false);return self;};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.wheel=root.wheel;return root;})(eventjs.proxy);if(typeof(Event)==="undefined")var Event={};if(typeof(Event.proxy)==="undefined")Event.proxy={};Event.proxy=(function(root){"use strict";root.orientation=function(conf){var self={gesture:"orientationchange",previous:null,current:window.orientation,target:conf.target,listener:conf.listener,remove:function(){window.removeEventListener('orientationchange',onOrientationChange,false);}};var onOrientationChange=function(e){self.previous=self.current;self.current=window.orientation;if(self.previous!==null&&self.previous!=self.current){conf.listener(e,self);return;}};if(window.DeviceOrientationEvent){window.addEventListener("orientationchange",onOrientationChange,false);}
return self;};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=root.orientation;return root;})(Event.proxy);function initAligningGuidelines(canvas){var ctx=canvas.getSelectionContext(),aligningLineOffset=5,aligningLineMargin=4,aligningLineWidth=2,aligningLineColor='rgba(63,188,231,1)',viewportTransform;function drawVerticalLine(coords){drawLine(coords.x+0.5,coords.y1>coords.y2?coords.y2:coords.y1,coords.x+0.5,coords.y2>coords.y1?coords.y2:coords.y1);}
function drawHorizontalLine(coords){drawLine(coords.x1>coords.x2?coords.x2:coords.x1,coords.y+0.5,coords.x2>coords.x1?coords.x2:coords.x1,coords.y+0.5);}
function drawLine(x1,y1,x2,y2){ctx.save();ctx.lineWidth=aligningLineWidth;ctx.strokeStyle=aligningLineColor;ctx.beginPath();ctx.moveTo(x1*viewportTransform[0],y1*viewportTransform[3]);ctx.lineTo(x2*viewportTransform[0],y2*viewportTransform[3]);ctx.stroke();ctx.restore();}
function isInRange(value1,value2){value1=Math.round(value1);value2=Math.round(value2);for(var i=value1-aligningLineMargin,len=value1+aligningLineMargin;i<=len;i++){if(i===value2){return true;}}
return false;}
var verticalLines=[],horizontalLines=[];canvas.on('mouse:down',function(){viewportTransform=canvas.viewportTransform;});canvas.on('object:moving',function(e){if(canvas.areAlignmentGuidesEnabled){var activeObject=e.target,canvasObjects=canvas.getObjects(),activeObjectCenter=activeObject.getCenterPoint(),activeObjectLeft=activeObjectCenter.x,activeObjectTop=activeObjectCenter.y,activeObjectHeight=activeObject.getBoundingRectHeight()/viewportTransform[3],activeObjectWidth=activeObject.getBoundingRectWidth()/viewportTransform[0],horizontalInTheRange=false,verticalInTheRange=false,transform=canvas._currentTransform;if(!transform||(activeObject.lockMovementX&&activeObject.lockMovementY&&activeObject.lockScalingX&&activeObject.lockScalingY&&activeObject.lockRotation))return;for(var i=canvasObjects.length;i--;){if(canvasObjects[i]===activeObject)continue;var objectCenter=canvasObjects[i].getCenterPoint(),objectLeft=objectCenter.x,objectTop=objectCenter.y,objectHeight=canvasObjects[i].getBoundingRectHeight()/viewportTransform[3],objectWidth=canvasObjects[i].getBoundingRectWidth()/viewportTransform[0];if(isInRange(objectLeft,activeObjectLeft)){verticalInTheRange=true;verticalLines.push({x:objectLeft,y1:(objectTop<activeObjectTop)?(objectTop-objectHeight/2-aligningLineOffset):(objectTop+objectHeight/2+aligningLineOffset),y2:(activeObjectTop>objectTop)?(activeObjectTop+activeObjectHeight/2+aligningLineOffset):(activeObjectTop-activeObjectHeight/2-aligningLineOffset)});activeObject.setPositionByOrigin(new fabric.Point(objectLeft,activeObjectTop),'center','center');}
if(isInRange(objectLeft-objectWidth/2,activeObjectLeft-activeObjectWidth/2)){verticalInTheRange=true;verticalLines.push({x:objectLeft-objectWidth/2,y1:(objectTop<activeObjectTop)?(objectTop-objectHeight/2-aligningLineOffset):(objectTop+objectHeight/2+aligningLineOffset),y2:(activeObjectTop>objectTop)?(activeObjectTop+activeObjectHeight/2+aligningLineOffset):(activeObjectTop-activeObjectHeight/2-aligningLineOffset)});activeObject.setPositionByOrigin(new fabric.Point(objectLeft-objectWidth/2+activeObjectWidth/2,activeObjectTop),'center','center');}
if(isInRange(objectLeft+objectWidth/2,activeObjectLeft+activeObjectWidth/2)){verticalInTheRange=true;verticalLines.push({x:objectLeft+objectWidth/2,y1:(objectTop<activeObjectTop)?(objectTop-objectHeight/2-aligningLineOffset):(objectTop+objectHeight/2+aligningLineOffset),y2:(activeObjectTop>objectTop)?(activeObjectTop+activeObjectHeight/2+aligningLineOffset):(activeObjectTop-activeObjectHeight/2-aligningLineOffset)});activeObject.setPositionByOrigin(new fabric.Point(objectLeft+objectWidth/2-activeObjectWidth/2,activeObjectTop),'center','center');}
if(isInRange(objectTop,activeObjectTop)){horizontalInTheRange=true;horizontalLines.push({y:objectTop,x1:(objectLeft<activeObjectLeft)?(objectLeft-objectWidth/2-aligningLineOffset):(objectLeft+objectWidth/2+aligningLineOffset),x2:(activeObjectLeft>objectLeft)?(activeObjectLeft+activeObjectWidth/2+aligningLineOffset):(activeObjectLeft-activeObjectWidth/2-aligningLineOffset)});activeObject.setPositionByOrigin(new fabric.Point(activeObjectLeft,objectTop),'center','center');}
if(isInRange(objectTop-objectHeight/2,activeObjectTop-activeObjectHeight/2)){horizontalInTheRange=true;horizontalLines.push({y:objectTop-objectHeight/2,x1:(objectLeft<activeObjectLeft)?(objectLeft-objectWidth/2-aligningLineOffset):(objectLeft+objectWidth/2+aligningLineOffset),x2:(activeObjectLeft>objectLeft)?(activeObjectLeft+activeObjectWidth/2+aligningLineOffset):(activeObjectLeft-activeObjectWidth/2-aligningLineOffset)});activeObject.setPositionByOrigin(new fabric.Point(activeObjectLeft,objectTop-objectHeight/2+activeObjectHeight/2),'center','center');}
if(isInRange(objectTop+objectHeight/2,activeObjectTop+activeObjectHeight/2)){horizontalInTheRange=true;horizontalLines.push({y:objectTop+objectHeight/2,x1:(objectLeft<activeObjectLeft)?(objectLeft-objectWidth/2-aligningLineOffset):(objectLeft+objectWidth/2+aligningLineOffset),x2:(activeObjectLeft>objectLeft)?(activeObjectLeft+activeObjectWidth/2+aligningLineOffset):(activeObjectLeft-activeObjectWidth/2-aligningLineOffset)});activeObject.setPositionByOrigin(new fabric.Point(activeObjectLeft,objectTop+objectHeight/2-activeObjectHeight/2),'center','center');}}
if(!horizontalInTheRange){horizontalLines.length=0;}
if(!verticalInTheRange){verticalLines.length=0;}}});canvas.on('before:render',function(){canvas.clearContext(canvas.contextTop);});canvas.on('after:render',function(){for(var i=verticalLines.length;i--;){drawVerticalLine(verticalLines[i]);}
for(var i=horizontalLines.length;i--;){drawHorizontalLine(horizontalLines[i]);}
verticalLines.length=horizontalLines.length=0;});canvas.on('mouse:up',function(){verticalLines.length=horizontalLines.length=0;canvas.renderAll();});}
(function(){function _removeEventListener(eventName,handler){if(!this.__eventListeners[eventName]){return;}
if(handler){fabric.util.removeFromArray(this.__eventListeners[eventName],handler);}
else{this.__eventListeners[eventName].length=0;}}
function observe(eventName,handler){if(!this.__eventListeners){this.__eventListeners={};}
if(arguments.length===1){for(var prop in eventName){this.on(prop,eventName[prop]);}}
else{if(!this.__eventListeners[eventName]){this.__eventListeners[eventName]=[];}
this.__eventListeners[eventName].push(handler);}
return this;}
function stopObserving(eventName,handler){if(!this.__eventListeners){return;}
if(arguments.length===0){this.__eventListeners={};}
else if(arguments.length===1&&typeof arguments[0]==='object'){for(var prop in eventName){_removeEventListener.call(this,prop,eventName[prop]);}}
else{_removeEventListener.call(this,eventName,handler);}
return this;}
function fire(eventName,options){if(!this.__eventListeners){return;}
var listenersForEvent=this.__eventListeners[eventName];if(!listenersForEvent){return;}
for(var i=0,len=listenersForEvent.length;i<len;i++){listenersForEvent[i].call(this,options||{});}
return this;}
fabric.Observable={observe:observe,stopObserving:stopObserving,fire:fire,on:observe,off:stopObserving,trigger:fire};})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var i=0,length=arguments.length;i<length;i++){this._onObjectAdded(arguments[i]);}
this.renderOnAddRemove&&this.renderAll();return this;},insertAt:function(object,index,nonSplicing){var objects=this.getObjects();if(nonSplicing){objects[index]=object;}
else{objects.splice(index,0,object);}
this._onObjectAdded(object);this.renderOnAddRemove&&this.renderAll();return this;},remove:function(){var objects=this.getObjects(),index;for(var i=0,length=arguments.length;i<length;i++){index=objects.indexOf(arguments[i]);if(index!==-1){objects.splice(index,1);this._onObjectRemoved(arguments[i]);}}
this.renderOnAddRemove&&this.renderAll();return this;},forEachObject:function(callback,context){var objects=this.getObjects(),i=objects.length;while(i--){callback.call(context,objects[i],i,objects);}
return this;},getObjects:function(type){if(typeof type==='undefined'){return this._objects;}
return this._objects.filter(function(o){return o.type===type;});},item:function(index){return this.getObjects()[index];},isEmpty:function(){return this.getObjects().length===0;},size:function(){return this.getObjects().length;},contains:function(object){return this.getObjects().indexOf(object)>-1;},complexity:function(){return this.getObjects().reduce(function(memo,current){memo+=current.complexity?current.complexity():0;return memo;},0);}};(function(global){var sqrt=Math.sqrt,atan2=Math.atan2,atan=Math.atan,pow=Math.pow,PiBy180=Math.PI/180;fabric.util={removeFromArray:function(array,value){var idx=array.indexOf(value);if(idx!==-1){array.splice(idx,1);}
return array;},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},degreesToRadians:function(degrees){return degrees*PiBy180;},radiansToDegrees:function(radians){return radians/PiBy180;},rotatePoint:function(point,origin,radians){point.subtractEquals(origin);var sin=Math.sin(radians),cos=Math.cos(radians),rx=point.x*cos-point.y*sin,ry=point.x*sin+point.y*cos;return new fabric.Point(rx,ry).addEquals(origin);},transformPoint:function(p,t,ignoreOffset){if(ignoreOffset){return new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y);}
return new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5]);},makeBoundingBoxFromPoints:function(points){var xPoints=[points[0].x,points[1].x,points[2].x,points[3].x],minX=fabric.util.array.min(xPoints),maxX=fabric.util.array.max(xPoints),width=Math.abs(minX-maxX),yPoints=[points[0].y,points[1].y,points[2].y,points[3].y],minY=fabric.util.array.min(yPoints),maxY=fabric.util.array.max(yPoints),height=Math.abs(minY-maxY);return{left:minX,top:minY,width:width,height:height};},invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),r=[a*t[3],-a*t[1],-a*t[2],a*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},r,true);r[4]=-o.x;r[5]=-o.y;return r;},toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits));},parseUnit:function(value,fontSize){var unit=/\D{0,2}$/.exec(value),number=parseFloat(value);if(!fontSize){fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}
switch(unit[0]){case'mm':return number*fabric.DPI/25.4;case'cm':return number*fabric.DPI/2.54;case'in':return number*fabric.DPI;case'pt':return number*fabric.DPI/72;case'pc':return number*fabric.DPI/72*12;case'em':return number*fontSize;default:return number;}},falseFunction:function(){return false;},getKlass:function(type,namespace){type=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1));return fabric.util.resolveNamespace(namespace)[type];},resolveNamespace:function(namespace){if(!namespace){return fabric;}
var parts=namespace.split('.'),len=parts.length,obj=global||fabric.window;for(var i=0;i<len;++i){obj=obj[parts[i]];}
return obj;},loadImage:function(url,callback,context,crossOrigin){if(!url){callback&&callback.call(context,url);return;}
var img=fabric.util.createImage();img.onload=function(){callback&&callback.call(context,img);img=img.onload=img.onerror=null;};img.onerror=function(){fabric.log('Error loading '+img.src);callback&&callback.call(context,null,true);img=img.onload=img.onerror=null;};if(url.indexOf('data')!==0&&typeof crossOrigin!=='undefined'){img.crossOrigin=crossOrigin;}
img.src=url;},enlivenObjects:function(objects,callback,namespace,reviver){objects=objects||[];function onLoaded(){if(++numLoadedObjects===numTotalObjects){callback&&callback(enlivenedObjects);}}
var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;if(!numTotalObjects){callback&&callback(enlivenedObjects);return;}
objects.forEach(function(o,index){if(!o||!o.type){onLoaded();return;}
var klass=fabric.util.getKlass(o.type,namespace);if(klass.async){klass.fromObject(o,function(obj,error){if(!error){enlivenedObjects[index]=obj;reviver&&reviver(o,enlivenedObjects[index]);}
onLoaded();});}
else{enlivenedObjects[index]=klass.fromObject(o);reviver&&reviver(o,enlivenedObjects[index]);onLoaded();}});},groupSVGElements:function(elements,options,path){var object;object=new fabric.PathGroup(elements,options);if(typeof path!=='undefined'){object.setSourcePath(path);}
return object;},populateWithProperties:function(source,destination,properties){if(properties&&Object.prototype.toString.call(properties)==='[object Array]'){for(var i=0,len=properties.length;i<len;i++){if(properties[i]in source){destination[properties[i]]=source[properties[i]];}}}},drawDashedLine:function(ctx,x,y,x2,y2,da){var dx=x2-x,dy=y2-y,len=sqrt(dx*dx+dy*dy),rot=atan2(dy,dx),dc=da.length,di=0,draw=true;ctx.save();ctx.translate(x,y);ctx.moveTo(0,0);ctx.rotate(rot);x=0;while(len>x){x+=da[di++%dc];if(x>len){x=len;}
ctx[draw?'lineTo':'moveTo'](x,0);draw=!draw;}
ctx.restore();},createCanvasElement:function(canvasEl){canvasEl||(canvasEl=fabric.document.createElement('canvas'));if(!canvasEl.getContext&&typeof G_vmlCanvasManager!=='undefined'){G_vmlCanvasManager.initElement(canvasEl);}
return canvasEl;},createImage:function(){return fabric.isLikelyNode?new(require('canvas').Image)():fabric.document.createElement('img');},createAccessors:function(klass){var proto=klass.prototype;for(var i=proto.stateProperties.length;i--;){var propName=proto.stateProperties[i],capitalizedPropName=propName.charAt(0).toUpperCase()+propName.slice(1),setterName='set'+capitalizedPropName,getterName='get'+capitalizedPropName;if(!proto[getterName]){proto[getterName]=(function(property){return new Function('return this.get("'+property+'")');})(propName);}
if(!proto[setterName]){proto[setterName]=(function(property){return new Function('value','return this.set("'+property+'", value)');})(propName);}}},clipContext:function(receiver,ctx){ctx.save();ctx.beginPath();receiver.clipTo(ctx);ctx.clip();},multiplyTransformMatrices:function(a,b,is2x2){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],is2x2?0:a[0]*b[4]+a[2]*b[5]+a[4],is2x2?0:a[1]*b[4]+a[3]*b[5]+a[5]];},qrDecompose:function(a){var angle=atan(a[0]/a[1]),denom=pow(a[0])+pow(a[1]),scaleX=sqrt(denom),scaleY=(a[0]*a[3]-a[2]*a[1])/scaleX,skewX=atan((a[0]*a[2]+a[1]*a[3])/denom);return{angle:angle/PiBy180,scaleX:scaleX,scaleY:scaleY,skewX:skewX/PiBy180,skewY:0};},getFunctionBody:function(fn){return(String(fn).match(/function[^{]*\{([\s\S]*)\}/)||{})[1];},isTransparent:function(ctx,x,y,tolerance){if(tolerance>0){if(x>tolerance){x-=tolerance;}
else{x=0;}
if(y>tolerance){y-=tolerance;}
else{y=0;}}
var _isTransparent=true,imageData=ctx.getImageData(x,y,(tolerance*2)||1,(tolerance*2)||1);for(var i=3,l=imageData.data.length;i<l;i+=4){var temp=imageData.data[i];_isTransparent=temp<=0;if(_isTransparent===false){break;}}
imageData=null;return _isTransparent;},parsePreserveAspectRatioAttribute:function(attribute){var meetOrSlice='meet',alignX='Mid',alignY='Mid',aspectRatioAttrs=attribute.split(' '),align;if(aspectRatioAttrs&&aspectRatioAttrs.length){meetOrSlice=aspectRatioAttrs.pop();if(meetOrSlice!=='meet'&&meetOrSlice!=='slice'){align=meetOrSlice;meetOrSlice='meet';}
else if(aspectRatioAttrs.length){align=aspectRatioAttrs.pop();}}
alignX=align!=='none'?align.slice(1,4):'none';alignY=align!=='none'?align.slice(5,8):'none';return{meetOrSlice:meetOrSlice,alignX:alignX,alignY:alignY};}};})(typeof exports!=='undefined'?exports:this);(function(){var arcToSegmentsCache={},segmentToBezierCache={},boundsOfCurveCache={},_join=Array.prototype.join;function arcToSegments(toX,toY,rx,ry,large,sweep,rotateX){var argsString=_join.call(arguments);if(arcToSegmentsCache[argsString]){return arcToSegmentsCache[argsString];}
var PI=Math.PI,th=rotateX*PI/180,sinTh=Math.sin(th),cosTh=Math.cos(th),fromX=0,fromY=0;rx=Math.abs(rx);ry=Math.abs(ry);var px=-cosTh*toX*0.5-sinTh*toY*0.5,py=-cosTh*toY*0.5+sinTh*toX*0.5,rx2=rx*rx,ry2=ry*ry,py2=py*py,px2=px*px,pl=rx2*ry2-rx2*py2-ry2*px2,root=0;if(pl<0){var s=Math.sqrt(1-pl/(rx2*ry2));rx*=s;ry*=s;}
else{root=(large===sweep?-1.0:1.0)*Math.sqrt(pl/(rx2*py2+ry2*px2));}
var cx=root*rx*py/ry,cy=-root*ry*px/rx,cx1=cosTh*cx-sinTh*cy+toX*0.5,cy1=sinTh*cx+cosTh*cy+toY*0.5,mTheta=calcVectorAngle(1,0,(px-cx)/rx,(py-cy)/ry),dtheta=calcVectorAngle((px-cx)/rx,(py-cy)/ry,(-px-cx)/rx,(-py-cy)/ry);if(sweep===0&&dtheta>0){dtheta-=2*PI;}
else if(sweep===1&&dtheta<0){dtheta+=2*PI;}
var segments=Math.ceil(Math.abs(dtheta/PI*2)),result=[],mDelta=dtheta/segments,mT=8/3*Math.sin(mDelta/4)*Math.sin(mDelta/4)/Math.sin(mDelta/2),th3=mTheta+mDelta;for(var i=0;i<segments;i++){result[i]=segmentToBezier(mTheta,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY);fromX=result[i][4];fromY=result[i][5];mTheta=th3;th3+=mDelta;}
arcToSegmentsCache[argsString]=result;return result;}
function segmentToBezier(th2,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY){var argsString2=_join.call(arguments);if(segmentToBezierCache[argsString2]){return segmentToBezierCache[argsString2];}
var costh2=Math.cos(th2),sinth2=Math.sin(th2),costh3=Math.cos(th3),sinth3=Math.sin(th3),toX=cosTh*rx*costh3-sinTh*ry*sinth3+cx1,toY=sinTh*rx*costh3+cosTh*ry*sinth3+cy1,cp1X=fromX+mT*(-cosTh*rx*sinth2-sinTh*ry*costh2),cp1Y=fromY+mT*(-sinTh*rx*sinth2+cosTh*ry*costh2),cp2X=toX+mT*(cosTh*rx*sinth3+sinTh*ry*costh3),cp2Y=toY+mT*(sinTh*rx*sinth3-cosTh*ry*costh3);segmentToBezierCache[argsString2]=[cp1X,cp1Y,cp2X,cp2Y,toX,toY];return segmentToBezierCache[argsString2];}
function calcVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux),tb=Math.atan2(vy,vx);if(tb>=ta){return tb-ta;}
else{return 2*Math.PI-(ta-tb);}}
fabric.util.drawArc=function(ctx,fx,fy,coords){var rx=coords[0],ry=coords[1],rot=coords[2],large=coords[3],sweep=coords[4],tx=coords[5],ty=coords[6],segs=[[],[],[],[]],segsNorm=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segsNorm.length;i<len;i++){segs[i][0]=segsNorm[i][0]+fx;segs[i][1]=segsNorm[i][1]+fy;segs[i][2]=segsNorm[i][2]+fx;segs[i][3]=segsNorm[i][3]+fy;segs[i][4]=segsNorm[i][4]+fx;segs[i][5]=segsNorm[i][5]+fy;ctx.bezierCurveTo.apply(ctx,segs[i]);}};fabric.util.getBoundsOfArc=function(fx,fy,rx,ry,rot,large,sweep,tx,ty){var fromX=0,fromY=0,bound=[],bounds=[],segs=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot),boundCopy=[[],[]];for(var i=0,len=segs.length;i<len;i++){bound=getBoundsOfCurve(fromX,fromY,segs[i][0],segs[i][1],segs[i][2],segs[i][3],segs[i][4],segs[i][5]);boundCopy[0].x=bound[0].x+fx;boundCopy[0].y=bound[0].y+fy;boundCopy[1].x=bound[1].x+fx;boundCopy[1].y=bound[1].y+fy;bounds.push(boundCopy[0]);bounds.push(boundCopy[1]);fromX=segs[i][4];fromY=segs[i][5];}
return bounds;};function getBoundsOfCurve(x0,y0,x1,y1,x2,y2,x3,y3){var argsString=_join.call(arguments);if(boundsOfCurveCache[argsString]){return boundsOfCurveCache[argsString];}
var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,tvalues=[],bounds=[[],[]],a,b,c,t,t1,t2,b2ac,sqrtb2ac;b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0;for(var i=0;i<2;++i){if(i>0){b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0;}
if(abs(a)<1e-12){if(abs(b)<1e-12){continue;}
t=-c/b;if(0<t&&t<1){tvalues.push(t);}
continue;}
b2ac=b*b-4*c*a;if(b2ac<0){continue;}
sqrtb2ac=sqrt(b2ac);t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1);}
t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2);}}
var x,y,j=tvalues.length,jlen=j,mt;while(j--){t=tvalues[j];mt=1-t;x=(mt*mt*mt*x0)+(3*mt*mt*t*x1)+(3*mt*t*t*x2)+(t*t*t*x3);bounds[0][j]=x;y=(mt*mt*mt*y0)+(3*mt*mt*t*y1)+(3*mt*t*t*y2)+(t*t*t*y3);bounds[1][j]=y;}
bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;var result=[{x:min.apply(null,bounds[0]),y:min.apply(null,bounds[1])},{x:max.apply(null,bounds[0]),y:max.apply(null,bounds[1])}];boundsOfCurveCache[argsString]=result;return result;}
fabric.util.getBoundsOfCurve=getBoundsOfCurve;})();(function(){var slice=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this===void 0||this===null){throw new TypeError();}
var t=Object(this),len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0;}
else if(n!==0&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;};}
if(!Array.prototype.forEach){Array.prototype.forEach=function(fn,context){for(var i=0,len=this.length>>>0;i<len;i++){if(i in this){fn.call(context,this[i],i,this);}}};}
if(!Array.prototype.map){Array.prototype.map=function(fn,context){var result=[];for(var i=0,len=this.length>>>0;i<len;i++){if(i in this){result[i]=fn.call(context,this[i],i,this);}}
return result;};}
if(!Array.prototype.every){Array.prototype.every=function(fn,context){for(var i=0,len=this.length>>>0;i<len;i++){if(i in this&&!fn.call(context,this[i],i,this)){return false;}}
return true;};}
if(!Array.prototype.some){Array.prototype.some=function(fn,context){for(var i=0,len=this.length>>>0;i<len;i++){if(i in this&&fn.call(context,this[i],i,this)){return true;}}
return false;};}
if(!Array.prototype.filter){Array.prototype.filter=function(fn,context){var result=[],val;for(var i=0,len=this.length>>>0;i<len;i++){if(i in this){val=this[i];if(fn.call(context,val,i,this)){result.push(val);}}}
return result;};}
if(!Array.prototype.reduce){Array.prototype.reduce=function(fn){var len=this.length>>>0,i=0,rv;if(arguments.length>1){rv=arguments[1];}
else{do{if(i in this){rv=this[i++];break;}
if(++i>=len){throw new TypeError();}}
while(true);}
for(;i<len;i++){if(i in this){rv=fn.call(null,rv,this[i],i,this);}}
return rv;};}
function invoke(array,method){var args=slice.call(arguments,2),result=[];for(var i=0,len=array.length;i<len;i++){result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i]);}
return result;}
function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1>=value2;});}
function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value1<value2;});}
function find(array,byProperty,condition){if(!array||array.length===0){return;}
var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty){while(i--){if(condition(array[i][byProperty],result)){result=array[i][byProperty];}}}
else{while(i--){if(condition(array[i],result)){result=array[i];}}}
return result;}
fabric.util.array={invoke:invoke,min:min,max:max};})();(function(){function extend(destination,source){for(var property in source){destination[property]=source[property];}
return destination;}
function clone(object){return extend({},object);}
fabric.util.object={extend:extend,clone:clone};})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,'').replace(/[\s\xA0]+$/,'');};}
function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():'';});}
function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+
(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase());}
function escapeXml(string){return string.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&apos;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml};}());(function(){var slice=Array.prototype.slice,apply=Function.prototype.apply,Dummy=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(thisArg){var _this=this,args=slice.call(arguments,1),bound;if(args.length){bound=function(){return apply.call(_this,this instanceof Dummy?this:thisArg,args.concat(slice.call(arguments)));};}
else{bound=function(){return apply.call(_this,this instanceof Dummy?this:thisArg,arguments);};}
Dummy.prototype=this.prototype;bound.prototype=new Dummy();return bound;};}})();(function(){var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=(function(){for(var p in{toString:1}){if(p==='toString'){return false;}}
return true;})(),addMethods=function(klass,source,parent){for(var property in source){if(property in klass.prototype&&typeof klass.prototype[property]==='function'&&(source[property]+'').indexOf('callSuper')>-1){klass.prototype[property]=(function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);this.constructor.superclass=superclass;if(property!=='initialize'){return returnValue;}};})(property);}
else{klass.prototype[property]=source[property];}
if(IS_DONTENUM_BUGGY){if(source.toString!==Object.prototype.toString){klass.prototype.toString=source.toString;}
if(source.valueOf!==Object.prototype.valueOf){klass.prototype.valueOf=source.valueOf;}}}};function Subclass(){}
function callSuper(methodName){var fn=this.constructor.superclass.prototype[methodName];return(arguments.length>1)?fn.apply(this,slice.call(arguments,1)):fn.call(this);}
function createClass(){var parent=null,properties=slice.call(arguments,0);if(typeof properties[0]==='function'){parent=properties.shift();}
function klass(){this.initialize.apply(this,arguments);}
klass.superclass=parent;klass.subclasses=[];if(parent){Subclass.prototype=parent.prototype;klass.prototype=new Subclass();parent.subclasses.push(klass);}
for(var i=0,length=properties.length;i<length;i++){addMethods(klass,properties[i],parent);}
if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction;}
klass.prototype.constructor=klass;klass.prototype.callSuper=callSuper;return klass;}
fabric.util.createClass=createClass;})();(function(){var unknown='unknown';function areHostMethods(object){var methodNames=Array.prototype.slice.call(arguments,1),t,i,len=methodNames.length;for(i=0;i<len;i++){t=typeof object[methodNames[i]];if(!(/^(?:function|object|unknown)$/).test(t)){return false;}}
return true;}
var getElement,setElement,getUniqueId=(function(){var uid=0;return function(element){return element.__uniqueID||(element.__uniqueID='uniqueID__'+uid++);};})();(function(){var elements={};getElement=function(uid){return elements[uid];};setElement=function(uid,element){elements[uid]=element;};})();function createListener(uid,handler){return{handler:handler,wrappedHandler:createWrappedHandler(uid,handler)};}
function createWrappedHandler(uid,handler){return function(e){handler.call(getElement(uid),e||fabric.window.event);};}
function createDispatcher(uid,eventName){return function(e){if(handlers[uid]&&handlers[uid][eventName]){var handlersForEvent=handlers[uid][eventName];for(var i=0,len=handlersForEvent.length;i<len;i++){handlersForEvent[i].call(this,e||fabric.window.event);}}};}
var shouldUseAddListenerRemoveListener=(areHostMethods(fabric.document.documentElement,'addEventListener','removeEventListener')&&areHostMethods(fabric.window,'addEventListener','removeEventListener')),shouldUseAttachEventDetachEvent=(areHostMethods(fabric.document.documentElement,'attachEvent','detachEvent')&&areHostMethods(fabric.window,'attachEvent','detachEvent')),listeners={},handlers={},addListener,removeListener;if(shouldUseAddListenerRemoveListener){addListener=function(element,eventName,handler){element.addEventListener(eventName,handler,false);};removeListener=function(element,eventName,handler){element.removeEventListener(eventName,handler,false);};}
else if(shouldUseAttachEventDetachEvent){addListener=function(element,eventName,handler){var uid=getUniqueId(element);setElement(uid,element);if(!listeners[uid]){listeners[uid]={};}
if(!listeners[uid][eventName]){listeners[uid][eventName]=[];}
var listener=createListener(uid,handler);listeners[uid][eventName].push(listener);element.attachEvent('on'+eventName,listener.wrappedHandler);};removeListener=function(element,eventName,handler){var uid=getUniqueId(element),listener;if(listeners[uid]&&listeners[uid][eventName]){for(var i=0,len=listeners[uid][eventName].length;i<len;i++){listener=listeners[uid][eventName][i];if(listener&&listener.handler===handler){element.detachEvent('on'+eventName,listener.wrappedHandler);listeners[uid][eventName][i]=null;}}}};}
else{addListener=function(element,eventName,handler){var uid=getUniqueId(element);if(!handlers[uid]){handlers[uid]={};}
if(!handlers[uid][eventName]){handlers[uid][eventName]=[];var existingHandler=element['on'+eventName];if(existingHandler){handlers[uid][eventName].push(existingHandler);}
element['on'+eventName]=createDispatcher(uid,eventName);}
handlers[uid][eventName].push(handler);};removeListener=function(element,eventName,handler){var uid=getUniqueId(element);if(handlers[uid]&&handlers[uid][eventName]){var handlersForEvent=handlers[uid][eventName];for(var i=0,len=handlersForEvent.length;i<len;i++){if(handlersForEvent[i]===handler){handlersForEvent.splice(i,1);}}}};}
fabric.util.addListener=addListener;fabric.util.removeListener=removeListener;function getPointer(event){event||(event=fabric.window.event);var element=event.target||(typeof event.srcElement!==unknown?event.srcElement:null),scroll=fabric.util.getScrollLeftTop(element);return{x:pointerX(event)+scroll.left,y:pointerY(event)+scroll.top};}
var pointerX=function(event){return(typeof event.clientX!==unknown?event.clientX:0);},pointerY=function(event){return(typeof event.clientY!==unknown?event.clientY:0);};function _getPointer(event,pageProp,clientProp){var touchProp=event.type==='touchend'?'changedTouches':'touches';return(event[touchProp]&&event[touchProp][0]?(event[touchProp][0][pageProp]-(event[touchProp][0][pageProp]-event[touchProp][0][clientProp]))||event[clientProp]:event[clientProp]);}
if(fabric.isTouchSupported){pointerX=function(event){return _getPointer(event,'pageX','clientX');};pointerY=function(event){return _getPointer(event,'pageY','clientY');};}
fabric.util.getPointer=getPointer;fabric.util.object.extend(fabric.util,fabric.Observable);})();(function(){function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle){return element;}
if(typeof styles==='string'){element.style.cssText+=';'+styles;return styles.indexOf('opacity')>-1?setOpacity(element,styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles){if(property==='opacity'){setOpacity(element,styles[property]);}
else{var normalizedProperty=(property==='float'||property==='cssFloat')?(typeof elementStyle.styleFloat==='undefined'?'cssFloat':'styleFloat'):property;elementStyle[normalizedProperty]=styles[property];}}
return element;}
var parseEl=fabric.document.createElement('div'),supportsOpacity=typeof parseEl.style.opacity==='string',supportsFilters=typeof parseEl.style.filter==='string',reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element;};if(supportsOpacity){setOpacity=function(element,value){element.style.opacity=value;return element;};}
else if(supportsFilters){setOpacity=function(element,value){var es=element.style;if(element.currentStyle&&!element.currentStyle.hasLayout){es.zoom=1;}
if(reOpacity.test(es.filter)){value=value>=0.9999?'':('alpha(opacity='+(value*100)+')');es.filter=es.filter.replace(reOpacity,value);}
else{es.filter+=' alpha(opacity='+(value*100)+')';}
return element;};}
fabric.util.setStyle=setStyle;})();(function(){var _slice=Array.prototype.slice;function getById(id){return typeof id==='string'?fabric.document.getElementById(id):id;}
var sliceCanConvertNodelists,toArray=function(arrayLike){return _slice.call(arrayLike,0);};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array;}
catch(err){}
if(!sliceCanConvertNodelists){toArray=function(arrayLike){var arr=new Array(arrayLike.length),i=arrayLike.length;while(i--){arr[i]=arrayLike[i];}
return arr;};}
function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes){if(prop==='class'){el.className=attributes[prop];}
else if(prop==='for'){el.htmlFor=attributes[prop];}
else{el.setAttribute(prop,attributes[prop]);}}
return el;}
function addClass(element,className){if(element&&(' '+element.className+' ').indexOf(' '+className+' ')===-1){element.className+=(element.className?' ':'')+className;}}
function wrapElement(element,wrapper,attributes){if(typeof wrapper==='string'){wrapper=makeElement(wrapper,attributes);}
if(element.parentNode){element.parentNode.replaceChild(wrapper,element);}
wrapper.appendChild(element);return wrapper;}
function getScrollLeftTop(element){var left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};while(element&&(element.parentNode||element.host)){element=element.parentNode||element.host;if(element===fabric.document){left=body.scrollLeft||docElement.scrollLeft||0;top=body.scrollTop||docElement.scrollTop||0;}
else{left+=element.scrollLeft||0;top+=element.scrollTop||0;}
if(element.nodeType===1&&fabric.util.getElementStyle(element,'position')==='fixed'){break;}}
return{left:left,top:top};}
function getElementOffset(element){var docElem,doc=element&&element.ownerDocument,box={left:0,top:0},offset={left:0,top:0},scrollLeftTop,offsetAttributes={borderLeftWidth:'left',borderTopWidth:'top',paddingLeft:'left',paddingTop:'top'};if(!doc){return offset;}
for(var attr in offsetAttributes){offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0;}
docElem=doc.documentElement;if(typeof element.getBoundingClientRect!=='undefined'){box=element.getBoundingClientRect();}
scrollLeftTop=getScrollLeftTop(element);return{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top};}
var getElementStyle;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){getElementStyle=function(element,attr){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[attr]:undefined;};}
else{getElementStyle=function(element,attr){var value=element.style[attr];if(!value&&element.currentStyle){value=element.currentStyle[attr];}
return value;};}
(function(){var style=fabric.document.documentElement.style,selectProp='userSelect'in style?'userSelect':'MozUserSelect'in style?'MozUserSelect':'WebkitUserSelect'in style?'WebkitUserSelect':'KhtmlUserSelect'in style?'KhtmlUserSelect':'';function makeElementUnselectable(element){if(typeof element.onselectstart!=='undefined'){element.onselectstart=fabric.util.falseFunction;}
if(selectProp){element.style[selectProp]='none';}
else if(typeof element.unselectable==='string'){element.unselectable='on';}
return element;}
function makeElementSelectable(element){if(typeof element.onselectstart!=='undefined'){element.onselectstart=null;}
if(selectProp){element.style[selectProp]='';}
else if(typeof element.unselectable==='string'){element.unselectable='';}
return element;}
fabric.util.makeElementUnselectable=makeElementUnselectable;fabric.util.makeElementSelectable=makeElementSelectable;})();(function(){function getScript(url,callback){var headEl=fabric.document.getElementsByTagName('head')[0],scriptEl=fabric.document.createElement('script'),loading=true;scriptEl.onload=scriptEl.onreadystatechange=function(e){if(loading){if(typeof this.readyState==='string'&&this.readyState!=='loaded'&&this.readyState!=='complete'){return;}
loading=false;callback(e||fabric.window.event);scriptEl=scriptEl.onload=scriptEl.onreadystatechange=null;}};scriptEl.src=url;headEl.appendChild(scriptEl);}
fabric.util.getScript=getScript;})();fabric.util.getById=getById;fabric.util.toArray=toArray;fabric.util.makeElement=makeElement;fabric.util.addClass=addClass;fabric.util.wrapElement=wrapElement;fabric.util.getScrollLeftTop=getScrollLeftTop;fabric.util.getElementOffset=getElementOffset;fabric.util.getElementStyle=getElementStyle;})();(function(){function addParamToUrl(url,param){return url+(/\?/.test(url)?'&':'?')+param;}
var makeXHR=(function(){var factories=[function(){return new ActiveXObject('Microsoft.XMLHTTP');},function(){return new ActiveXObject('Msxml2.XMLHTTP');},function(){return new ActiveXObject('Msxml2.XMLHTTP.3.0');},function(){return new XMLHttpRequest();}];for(var i=factories.length;i--;){try{var req=factories[i]();if(req){return factories[i];}}
catch(err){}}})();function emptyFn(){}
function request(url,options){options||(options={});var method=options.method?options.method.toUpperCase():'GET',onComplete=options.onComplete||function(){},xhr=makeXHR(),body;xhr.onreadystatechange=function(){if(xhr.readyState===4){onComplete(xhr);xhr.onreadystatechange=emptyFn;}};if(method==='GET'){body=null;if(typeof options.parameters==='string'){url=addParamToUrl(url,options.parameters);}}
xhr.open(method,url,true);if(method==='POST'||method==='PUT'){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
xhr.send(body);return xhr;}
fabric.util.request=request;})();fabric.log=function(){};fabric.warn=function(){};if(typeof console!=='undefined'){['log','warn'].forEach(function(methodName){if(typeof console[methodName]!=='undefined'&&typeof console[methodName].apply==='function'){fabric[methodName]=function(){return console[methodName].apply(console,arguments);};}});}
(function(){function animate(options){requestAnimFrame(function(timestamp){options||(options={});var start=timestamp||+new Date(),duration=options.duration||500,finish=start+duration,time,onChange=options.onChange||function(){},abort=options.abort||function(){return false;},easing=options.easing||function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},startValue='startValue'in options?options.startValue:0,endValue='endValue'in options?options.endValue:100,byValue=options.byValue||endValue-startValue;options.onStart&&options.onStart();(function tick(ticktime){time=ticktime||+new Date();var currentTime=time>finish?duration:(time-start);if(abort()){options.onComplete&&options.onComplete();return;}
onChange(easing(currentTime,startValue,byValue,duration));if(time>finish){options.onComplete&&options.onComplete();return;}
requestAnimFrame(tick);})(start);});}
var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){fabric.window.setTimeout(callback,1000/60);};function requestAnimFrame(){return _requestAnimFrame.apply(fabric.window,arguments);}
fabric.util.animate=animate;fabric.util.requestAnimFrame=requestAnimFrame;})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,capitalize=fabric.util.string.capitalize,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,parseUnit=fabric.util.parseUnit,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,reAllowedSVGTagNames=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,reViewBoxTagNames=/^(symbol|image|marker|pattern|view|svg)$/i,reNotAllowedAncestors=/^(?:pattern|defs|symbol|metadata)$/i,reAllowedParents=/^(symbol|g|a|svg)$/i,attributesMap={cx:'left',x:'left',r:'radius',cy:'top',y:'top',display:'visible',visibility:'visible',transform:'transformMatrix','fill-opacity':'fillOpacity','fill-rule':'fillRule','font-family':'fontFamily','font-size':'fontSize','font-style':'fontStyle','font-weight':'fontWeight','stroke-dasharray':'strokeDashArray','stroke-linecap':'strokeLineCap','stroke-linejoin':'strokeLineJoin','stroke-miterlimit':'strokeMiterLimit','stroke-opacity':'strokeOpacity','stroke-width':'strokeWidth','text-decoration':'textDecoration','text-anchor':'originX'},colorAttributes={stroke:'strokeOpacity',fill:'fillOpacity'};fabric.cssRules={};fabric.gradientDefs={};function normalizeAttr(attr){if(attr in attributesMap){return attributesMap[attr];}
return attr;}
function normalizeValue(attr,value,parentAttributes,fontSize){var isArray=Object.prototype.toString.call(value)==='[object Array]',parsed;if((attr==='fill'||attr==='stroke')&&value==='none'){value='';}
else if(attr==='strokeDashArray'){value=value.replace(/,/g,' ').split(/\s+/).map(function(n){return parseFloat(n);});}
else if(attr==='transformMatrix'){if(parentAttributes&&parentAttributes.transformMatrix){value=multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value));}
else{value=fabric.parseTransformAttribute(value);}}
else if(attr==='visible'){value=(value==='none'||value==='hidden')?false:true;if(parentAttributes&&parentAttributes.visible===false){value=false;}}
else if(attr==='originX'){value=value==='start'?'left':value==='end'?'right':'center';}
else{parsed=isArray?value.map(parseUnit):parseUnit(value,fontSize);}
return(!isArray&&isNaN(parsed)?value:parsed);}
function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes){if(!attributes[attr]||typeof attributes[colorAttributes[attr]]==='undefined'){continue;}
if(attributes[attr].indexOf('url(')===0){continue;}
var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba();}
return attributes;}
fabric.parseTransformAttribute=(function(){function rotateMatrix(matrix,args){var angle=args[0];matrix[0]=Math.cos(angle);matrix[1]=Math.sin(angle);matrix[2]=-Math.sin(angle);matrix[3]=Math.cos(angle);}
function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=(args.length===2)?args[1]:args[0];matrix[0]=multiplierX;matrix[3]=multiplierY;}
function skewXMatrix(matrix,args){matrix[2]=Math.tan(fabric.util.degreesToRadians(args[0]));}
function skewYMatrix(matrix,args){matrix[1]=Math.tan(fabric.util.degreesToRadians(args[0]));}
function translateMatrix(matrix,args){matrix[4]=args[0];if(args.length===2){matrix[5]=args[1];}}
var iMatrix=[1,0,0,1,0,0],number=fabric.reNum,commaWsp='(?:\\s+,?\\s*|,\\s*)',skewX='(?:(skewX)\\s*\\(\\s*('+number+')\\s*\\))',skewY='(?:(skewY)\\s*\\(\\s*('+number+')\\s*\\))',rotate='(?:(rotate)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+')'+
commaWsp+'('+number+'))?\\s*\\))',scale='(?:(scale)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+'))?\\s*\\))',translate='(?:(translate)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+'))?\\s*\\))',matrix='(?:(matrix)\\s*\\(\\s*'+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+'\\s*\\))',transform='(?:'+
matrix+'|'+
translate+'|'+
scale+'|'+
rotate+'|'+
skewX+'|'+
skewY+')',transforms='(?:'+transform+'(?:'+commaWsp+transform+')*'+')',transformList='^\\s*(?:'+transforms+'?)\\s*$',reTransformList=new RegExp(transformList),reTransform=new RegExp(transform,'g');return function(attributeValue){var matrix=iMatrix.concat(),matrices=[];if(!attributeValue||(attributeValue&&!reTransformList.test(attributeValue))){return matrix;}
attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){return(match!==''&&match!=null);}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case'translate':translateMatrix(matrix,args);break;case'rotate':args[0]=fabric.util.degreesToRadians(args[0]);rotateMatrix(matrix,args);break;case'scale':scaleMatrix(matrix,args);break;case'skewX':skewXMatrix(matrix,args);break;case'skewY':skewYMatrix(matrix,args);break;case'matrix':matrix=args;break;}
matrices.push(matrix.concat());matrix=iMatrix.concat();});var combinedMatrix=matrices[0];while(matrices.length>1){matrices.shift();combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0]);}
return combinedMatrix;};})();function parseStyleString(style,oStyle){var attr,value;style.replace(/;\s*$/,'').split(';').forEach(function(chunk){var pair=chunk.split(':');attr=normalizeAttr(pair[0].trim().toLowerCase());value=normalizeValue(attr,pair[1].trim());oStyle[attr]=value;});}
function parseStyleObject(style,oStyle){var attr,value;for(var prop in style){if(typeof style[prop]==='undefined'){continue;}
attr=normalizeAttr(prop.toLowerCase());value=normalizeValue(attr,style[prop]);oStyle[attr]=value;}}
function getGlobalStylesForElement(element,svgUid){var styles={};for(var rule in fabric.cssRules[svgUid]){if(elementMatchesRule(element,rule.split(' '))){for(var property in fabric.cssRules[svgUid][rule]){styles[property]=fabric.cssRules[svgUid][rule][property];}}}
return styles;}
function elementMatchesRule(element,selectors){var firstMatching,parentMatching=true;firstMatching=selectorMatches(element,selectors.pop());if(firstMatching&&selectors.length){parentMatching=doesSomeParentMatch(element,selectors);}
return firstMatching&&parentMatching&&(selectors.length===0);}
function doesSomeParentMatch(element,selectors){var selector,parentMatching=true;while(element.parentNode&&element.parentNode.nodeType===1&&selectors.length){if(parentMatching){selector=selectors.pop();}
element=element.parentNode;parentMatching=selectorMatches(element,selector);}
return selectors.length===0;}
function selectorMatches(element,selector){var nodeName=element.nodeName,classNames=element.getAttribute('class'),id=element.getAttribute('id'),matcher;matcher=new RegExp('^'+nodeName,'i');selector=selector.replace(matcher,'');if(id&&selector.length){matcher=new RegExp('#'+id+'(?![a-zA-Z\\-]+)','i');selector=selector.replace(matcher,'');}
if(classNames&&selector.length){classNames=classNames.split(' ');for(var i=classNames.length;i--;){matcher=new RegExp('\\.'+classNames[i]+'(?![a-zA-Z\\-]+)','i');selector=selector.replace(matcher,'');}}
return selector.length===0;}
function elementById(doc,id){var el;doc.getElementById&&(el=doc.getElementById(id));if(el){return el;}
var node,i,nodelist=doc.getElementsByTagName('*');for(i=0;i<nodelist.length;i++){node=nodelist[i];if(id===node.getAttribute('id')){return node;}}}
function parseUseDirectives(doc){var nodelist=doc.getElementsByTagName('use'),i=0;while(nodelist.length&&i<nodelist.length){var el=nodelist[i],xlink=el.getAttribute('xlink:href').substr(1),x=el.getAttribute('x')||0,y=el.getAttribute('y')||0,el2=elementById(doc,xlink).cloneNode(true),currentTrans=(el2.getAttribute('transform')||'')+' translate('+x+', '+y+')',parentNode,oldLength=nodelist.length,attr,j,attrs,l;applyViewboxTransform(el2);if(/^svg$/i.test(el2.nodeName)){var el3=el2.ownerDocument.createElement('g');for(j=0,attrs=el2.attributes,l=attrs.length;j<l;j++){attr=attrs.item(j);el3.setAttribute(attr.nodeName,attr.nodeValue);}
while(el2.firstChild!=null){el3.appendChild(el2.firstChild);}
el2=el3;}
for(j=0,attrs=el.attributes,l=attrs.length;j<l;j++){attr=attrs.item(j);if(attr.nodeName==='x'||attr.nodeName==='y'||attr.nodeName==='xlink:href'){continue;}
if(attr.nodeName==='transform'){currentTrans=attr.nodeValue+' '+currentTrans;}
else{el2.setAttribute(attr.nodeName,attr.nodeValue);}}
el2.setAttribute('transform',currentTrans);el2.setAttribute('instantiated_by_use','1');el2.removeAttribute('id');parentNode=el.parentNode;parentNode.replaceChild(el2,el);if(nodelist.length===oldLength){i++;}}}
var reViewBoxAttrValue=new RegExp('^'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*'+'$');function applyViewboxTransform(element){var viewBoxAttr=element.getAttribute('viewBox'),scaleX=1,scaleY=1,minX=0,minY=0,viewBoxWidth,viewBoxHeight,matrix,el,widthAttr=element.getAttribute('width'),heightAttr=element.getAttribute('height'),x=element.getAttribute('x')||0,y=element.getAttribute('y')||0,preserveAspectRatio=element.getAttribute('preserveAspectRatio')||'',missingViewBox=(!viewBoxAttr||!reViewBoxTagNames.test(element.tagName)||!(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue))),missingDimAttr=(!widthAttr||!heightAttr||widthAttr==='100%'||heightAttr==='100%'),toBeParsed=missingViewBox&&missingDimAttr,parsedDim={},translateMatrix='';parsedDim.width=0;parsedDim.height=0;parsedDim.toBeParsed=toBeParsed;if(toBeParsed){return parsedDim;}
if(missingViewBox){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);return parsedDim;}
minX=-parseFloat(viewBoxAttr[1]),minY=-parseFloat(viewBoxAttr[2]),viewBoxWidth=parseFloat(viewBoxAttr[3]),viewBoxHeight=parseFloat(viewBoxAttr[4]);if(!missingDimAttr){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);scaleX=parsedDim.width/viewBoxWidth;scaleY=parsedDim.height/viewBoxHeight;}
else{parsedDim.width=viewBoxWidth;parsedDim.height=viewBoxHeight;}
preserveAspectRatio=fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);if(preserveAspectRatio.alignX!=='none'){scaleY=scaleX=(scaleX>scaleY?scaleY:scaleX);}
if(scaleX===1&&scaleY===1&&minX===0&&minY===0&&x===0&&y===0){return parsedDim;}
if(x||y){translateMatrix=' translate('+parseUnit(x)+' '+parseUnit(y)+') ';}
matrix=translateMatrix+' matrix('+scaleX+' 0'+' 0 '+
scaleY+' '+
(minX*scaleX)+' '+
(minY*scaleY)+') ';if(element.tagName==='svg'){el=element.ownerDocument.createElement('g');while(element.firstChild!=null){el.appendChild(element.firstChild);}
element.appendChild(el);}
else{el=element;matrix=el.getAttribute('transform')+matrix;}
el.setAttribute('transform',matrix);return parsedDim;}
fabric.parseSVGDocument=(function(){function hasAncestorWithNodeName(element,nodeName){while(element&&(element=element.parentNode)){if(nodeName.test(element.nodeName)&&!element.getAttribute('instantiated_by_use')){return true;}}
return false;}
return function(doc,callback,reviver){if(!doc){return;}
parseUseDirectives(doc);var startTime=new Date(),svgUid=fabric.Object.__uid++,options=applyViewboxTransform(doc),descendants=fabric.util.toArray(doc.getElementsByTagName('*'));options.svgUid=svgUid;if(descendants.length===0&&fabric.isLikelyNode){descendants=doc.selectNodes('//*[name(.)!="svg"]');var arr=[];for(var i=0,len=descendants.length;i<len;i++){arr[i]=descendants[i];}
descendants=arr;}
var elements=descendants.filter(function(el){applyViewboxTransform(el);return reAllowedSVGTagNames.test(el.tagName)&&!hasAncestorWithNodeName(el,reNotAllowedAncestors);});if(!elements||(elements&&!elements.length)){callback&&callback([],{});return;}
fabric.gradientDefs[svgUid]=fabric.getGradientDefs(doc);fabric.cssRules[svgUid]=fabric.getCSSRules(doc);fabric.parseElements(elements,function(instances){fabric.documentParsingTime=new Date()-startTime;if(callback){callback(instances,options);}},clone(options),reviver);};})();var svgCache={has:function(name,callback){callback(false);},get:function(){},set:function(){}};function _enlivenCachedObject(cachedObject){var objects=cachedObject.objects,options=cachedObject.options;objects=objects.map(function(o){return fabric[capitalize(o.type)].fromObject(o);});return({objects:objects,options:options});}
function _createSVGPattern(markup,canvas,property){if(canvas[property]&&canvas[property].toSVG){markup.push('\t<pattern x="0" y="0" id="',property,'Pattern" ','width="',canvas[property].source.width,'" height="',canvas[property].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',canvas[property].source.width,'" height="',canvas[property].source.height,'" xlink:href="',canvas[property].source.src,'"></image>\n\t</pattern>\n');}}
var reFontDeclaration=new RegExp('(normal|italic)?\\s*(normal|small-caps)?\\s*'+'(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*('+
fabric.reNum+'(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|'+fabric.reNum+'))?\\s+(.*)');extend(fabric,{parseFontDeclaration:function(value,oStyle){var match=value.match(reFontDeclaration);if(!match){return;}
var fontStyle=match[1],fontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];if(fontStyle){oStyle.fontStyle=fontStyle;}
if(fontWeight){oStyle.fontWeight=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight);}
if(fontSize){oStyle.fontSize=parseUnit(fontSize);}
if(fontFamily){oStyle.fontFamily=fontFamily;}
if(lineHeight){oStyle.lineHeight=lineHeight==='normal'?1:lineHeight;}},getGradientDefs:function(doc){var linearGradientEls=doc.getElementsByTagName('linearGradient'),radialGradientEls=doc.getElementsByTagName('radialGradient'),el,i,j=0,id,xlink,elList=[],gradientDefs={},idsToXlinkMap={};elList.length=linearGradientEls.length+radialGradientEls.length;i=linearGradientEls.length;while(i--){elList[j++]=linearGradientEls[i];}
i=radialGradientEls.length;while(i--){elList[j++]=radialGradientEls[i];}
while(j--){el=elList[j];xlink=el.getAttribute('xlink:href');id=el.getAttribute('id');if(xlink){idsToXlinkMap[id]=xlink.substr(1);}
gradientDefs[id]=el;}
for(id in idsToXlinkMap){var el2=gradientDefs[idsToXlinkMap[id]].cloneNode(true);el=gradientDefs[id];while(el2.firstChild){el.appendChild(el2.firstChild);}}
return gradientDefs;},parseAttributes:function(element,attributes,svgUid){if(!element){return;}
var value,parentAttributes={},fontSize;if(typeof svgUid==='undefined'){svgUid=element.getAttribute('svgUid');}
if(element.parentNode&&reAllowedParents.test(element.parentNode.nodeName)){parentAttributes=fabric.parseAttributes(element.parentNode,attributes,svgUid);}
fontSize=(parentAttributes&&parentAttributes.fontSize)||element.getAttribute('font-size')||fabric.Text.DEFAULT_SVG_FONT_SIZE;var ownAttributes=attributes.reduce(function(memo,attr){value=element.getAttribute(attr);if(value){attr=normalizeAttr(attr);value=normalizeValue(attr,value,parentAttributes,fontSize);memo[attr]=value;}
return memo;},{});ownAttributes=extend(ownAttributes,extend(getGlobalStylesForElement(element,svgUid),fabric.parseStyleAttribute(element)));if(ownAttributes.font){fabric.parseFontDeclaration(ownAttributes.font,ownAttributes);}
return _setStrokeFillOpacity(extend(parentAttributes,ownAttributes));},parseElements:function(elements,callback,options,reviver){new fabric.ElementsParser(elements,callback,options,reviver).parse();},parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute('style');if(!style){return oStyle;}
if(typeof style==='string'){parseStyleString(style,oStyle);}
else{parseStyleObject(style,oStyle);}
return oStyle;},parsePointsAttribute:function(points){if(!points){return null;}
points=points.replace(/,/g,' ').trim();points=points.split(/\s+/);var parsedPoints=[],i,len;i=0;len=points.length;for(;i<len;i+=2){parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])});}
return parsedPoints;},getCSSRules:function(doc){var styles=doc.getElementsByTagName('style'),allRules={},rules;for(var i=0,len=styles.length;i<len;i++){var styleContents=styles[i].textContent;styleContents=styleContents.replace(/\/\*[\s\S]*?\*\//g,'');if(styleContents.trim()===''){continue;}
rules=styleContents.match(/[^{]*\{[\s\S]*?\}/g);rules=rules.map(function(rule){return rule.trim();});rules.forEach(function(rule){var match=rule.match(/([\s\S]*?)\s*\{([^}]*)\}/),ruleObj={},declaration=match[2].trim(),propertyValuePairs=declaration.replace(/;$/,'').split(/\s*;\s*/);for(var i=0,len=propertyValuePairs.length;i<len;i++){var pair=propertyValuePairs[i].split(/\s*:\s*/),property=normalizeAttr(pair[0]),value=normalizeValue(property,pair[1],pair[0]);ruleObj[property]=value;}
rule=match[1];rule.split(',').forEach(function(_rule){_rule=_rule.replace(/^svg/i,'').trim();if(_rule===''){return;}
allRules[_rule]=fabric.util.object.clone(ruleObj);});});}
return allRules;},loadSVGFromURL:function(url,callback,reviver){url=url.replace(/^\n\s*/,'').trim();svgCache.has(url,function(hasUrl){if(hasUrl){svgCache.get(url,function(value){var enlivedRecord=_enlivenCachedObject(value);callback(enlivedRecord.objects,enlivedRecord.options);});}
else{new fabric.util.request(url,{method:'get',onComplete:onComplete});}});function onComplete(r){var xml=r.responseXML;if(xml&&!xml.documentElement&&fabric.window.ActiveXObject&&r.responseText){xml=new ActiveXObject('Microsoft.XMLDOM');xml.async='false';xml.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,''));}
if(!xml||!xml.documentElement){return;}
fabric.parseSVGDocument(xml.documentElement,function(results,options){svgCache.set(url,{objects:fabric.util.array.invoke(results,'toObject'),options:options});callback(results,options);},reviver);}},loadSVGFromString:function(string,callback,reviver){string=string.trim();var doc;if(typeof DOMParser!=='undefined'){var parser=new DOMParser();if(parser&&parser.parseFromString){doc=parser.parseFromString(string,'text/xml');}}
else if(fabric.window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(string.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,''));}
fabric.parseSVGDocument(doc.documentElement,function(results,options){callback(results,options);},reviver);},createSVGFontFacesMarkup:function(objects){var markup='';for(var i=0,len=objects.length;i<len;i++){if(objects[i].type!=='text'||!objects[i].path){continue;}
markup+=['@font-face {','font-family: ',objects[i].fontFamily,'; ','src: url(\'',objects[i].path,'\')','}\n'].join('');}
if(markup){markup=['\t<style type="text/css">','<![CDATA[',markup,']]>','</style>\n'].join('');}
return markup;},createSVGRefElementsMarkup:function(canvas){var markup=[];_createSVGPattern(markup,canvas,'backgroundColor');_createSVGPattern(markup,canvas,'overlayColor');return markup.join('');}});})(typeof exports!=='undefined'?exports:this);fabric.ElementsParser=function(elements,callback,options,reviver){this.elements=elements;this.callback=callback;this.options=options;this.reviver=reviver;this.svgUid=(options&&options.svgUid)||0;};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects();};fabric.ElementsParser.prototype.createObjects=function(){for(var i=0,len=this.elements.length;i<len;i++){this.elements[i].setAttribute('svgUid',this.svgUid);(function(_this,i){setTimeout(function(){_this.createObject(_this.elements[i],i);},0);})(this,i);}};fabric.ElementsParser.prototype.createObject=function(el,index){var klass=fabric[fabric.util.string.capitalize(el.tagName)];if(klass&&klass.fromElement){try{this._createObject(klass,el,index);}
catch(err){fabric.log(err);}}
else{this.checkIfDone();}};fabric.ElementsParser.prototype._createObject=function(klass,el,index){if(klass.async){klass.fromElement(el,this.createCallback(index,el),this.options);}
else{var obj=klass.fromElement(el,this.options);this.resolveGradient(obj,'fill');this.resolveGradient(obj,'stroke');this.reviver&&this.reviver(el,obj);this.instances[index]=obj;this.checkIfDone();}};fabric.ElementsParser.prototype.createCallback=function(index,el){var _this=this;return function(obj){_this.resolveGradient(obj,'fill');_this.resolveGradient(obj,'stroke');_this.reviver&&_this.reviver(el,obj);_this.instances[index]=obj;_this.checkIfDone();};};fabric.ElementsParser.prototype.resolveGradient=function(obj,property){var instanceFillValue=obj.get(property);if(!(/^url\(/).test(instanceFillValue)){return;}
var gradientId=instanceFillValue.slice(5,instanceFillValue.length-1);if(fabric.gradientDefs[this.svgUid][gradientId]){obj.set(property,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][gradientId],obj));}};fabric.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(el){return el!=null;});this.callback(this.instances);}};(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Point){fabric.warn('fabric.Point is already defined');return;}
fabric.Point=Point;function Point(x,y){this.x=x;this.y=y;}
Point.prototype={constructor:Point,add:function(that){return new Point(this.x+that.x,this.y+that.y);},addEquals:function(that){this.x+=that.x;this.y+=that.y;return this;},scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar);},scalarAddEquals:function(scalar){this.x+=scalar;this.y+=scalar;return this;},subtract:function(that){return new Point(this.x-that.x,this.y-that.y);},subtractEquals:function(that){this.x-=that.x;this.y-=that.y;return this;},scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar);},scalarSubtractEquals:function(scalar){this.x-=scalar;this.y-=scalar;return this;},multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar);},multiplyEquals:function(scalar){this.x*=scalar;this.y*=scalar;return this;},divide:function(scalar){return new Point(this.x/scalar,this.y/scalar);},divideEquals:function(scalar){this.x/=scalar;this.y/=scalar;return this;},eq:function(that){return(this.x===that.x&&this.y===that.y);},lt:function(that){return(this.x<that.x&&this.y<that.y);},lte:function(that){return(this.x<=that.x&&this.y<=that.y);},gt:function(that){return(this.x>that.x&&this.y>that.y);},gte:function(that){return(this.x>=that.x&&this.y>=that.y);},lerp:function(that,t){return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t);},distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy);},midPointFrom:function(that){return new Point(this.x+(that.x-this.x)/2,this.y+(that.y-this.y)/2);},min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y));},max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y));},toString:function(){return this.x+','+this.y;},setXY:function(x,y){this.x=x;this.y=y;},setFromPoint:function(that){this.x=that.x;this.y=that.y;},swap:function(that){var x=this.x,y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y;}};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Intersection){fabric.warn('fabric.Intersection is already defined');return;}
function Intersection(status){this.status=status;this.points=[];}
fabric.Intersection=Intersection;fabric.Intersection.prototype={appendPoint:function(point){this.points.push(point);},appendPoints:function(points){this.points=this.points.concat(points);}};fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,uaT=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ubT=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),uB=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(uB!==0){var ua=uaT/uB,ub=ubT/uB;if(0<=ua&&ua<=1&&0<=ub&&ub<=1){result=new Intersection('Intersection');result.points.push(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}
else{result=new Intersection();}}
else{if(uaT===0||ubT===0){result=new Intersection('Coincident');}
else{result=new Intersection('Parallel');}}
return result;};fabric.Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection(),length=points.length;for(var i=0;i<length;i++){var b1=points[i],b2=points[(i+1)%length],inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points);}
if(result.points.length>0){result.status='Intersection';}
return result;};fabric.Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection(),length=points1.length;for(var i=0;i<length;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points);}
if(result.points.length>0){result.status='Intersection';}
return result;};fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection();result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0){result.status='Intersection';}
return result;};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Color){fabric.warn('fabric.Color is already defined.');return;}
function Color(color){if(!color){this.setSource([0,0,0,1]);}
else{this._tryParsingColor(color);}}
fabric.Color=Color;fabric.Color.prototype={_tryParsingColor:function(color){var source;if(color in Color.colorNameMap){color=Color.colorNameMap[color];}
if(color==='transparent'){this.setSource([255,255,255,0]);return;}
source=Color.sourceFromHex(color);if(!source){source=Color.sourceFromRgb(color);}
if(!source){source=Color.sourceFromHsl(color);}
if(source){this.setSource(source);}},_rgbToHsl:function(r,g,b){r/=255,g/=255,b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);l=(max+min)/2;if(max===min){h=s=0;}
else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return[Math.round(h*360),Math.round(s*100),Math.round(l*100)];},getSource:function(){return this._source;},setSource:function(source){this._source=source;},toRgb:function(){var source=this.getSource();return'rgb('+source[0]+','+source[1]+','+source[2]+')';},toRgba:function(){var source=this.getSource();return'rgba('+source[0]+','+source[1]+','+source[2]+','+source[3]+')';},toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return'hsl('+hsl[0]+','+hsl[1]+'%,'+hsl[2]+'%)';},toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return'hsla('+hsl[0]+','+hsl[1]+'%,'+hsl[2]+'%,'+source[3]+')';},toHex:function(){var source=this.getSource(),r,g,b;r=source[0].toString(16);r=(r.length===1)?('0'+r):r;g=source[1].toString(16);g=(g.length===1)?('0'+g):g;b=source[2].toString(16);b=(b.length===1)?('0'+b):b;return r.toUpperCase()+g.toUpperCase()+b.toUpperCase();},getAlpha:function(){return this.getSource()[3];},setAlpha:function(alpha){var source=this.getSource();source[3]=alpha;this.setSource(source);return this;},toGrayscale:function(){var source=this.getSource(),average=parseInt((source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),10),currentAlpha=source[3];this.setSource([average,average,average,currentAlpha]);return this;},toBlackWhite:function(threshold){var source=this.getSource(),average=(source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),currentAlpha=source[3];threshold=threshold||127;average=(Number(average)<Number(threshold))?0:255;this.setSource([average,average,average,currentAlpha]);return this;},overlayWith:function(otherColor){if(!(otherColor instanceof Color)){otherColor=new Color(otherColor);}
var result=[],alpha=this.getAlpha(),otherAlpha=0.5,source=this.getSource(),otherSource=otherColor.getSource();for(var i=0;i<3;i++){result.push(Math.round((source[i]*(1-otherAlpha))+(otherSource[i]*otherAlpha)));}
result[3]=alpha;this.setSource(result);return this;}};fabric.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;fabric.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;fabric.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;fabric.Color.colorNameMap={aqua:'#00FFFF',black:'#000000',blue:'#0000FF',fuchsia:'#FF00FF',gray:'#808080',green:'#008000',lime:'#00FF00',maroon:'#800000',navy:'#000080',olive:'#808000',orange:'#FFA500',purple:'#800080',red:'#FF0000',silver:'#C0C0C0',teal:'#008080',white:'#FFFFFF',yellow:'#FFFF00'};function hue2rgb(p,q,t){if(t<0){t+=1;}
if(t>1){t-=1;}
if(t<1/6){return p+(q-p)*6*t;}
if(t<1/2){return q;}
if(t<2/3){return p+(q-p)*(2/3-t)*6;}
return p;}
fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color));};fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1];}};fabric.Color.fromRgba=Color.fromRgb;fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color));};fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(!match){return;}
var h=(((parseFloat(match[1])%360)+360)%360)/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1),r,g,b;if(s===0){r=g=b=l;}
else{var q=l<=0.5?l*(s+1):l+s-l*s,p=l*2-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}
return[Math.round(r*255),Math.round(g*255),Math.round(b*255),match[4]?parseFloat(match[4]):1];};fabric.Color.fromHsla=Color.fromHsl;fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color));};fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf('#')+1),isShortNotation=(value.length===3),r=isShortNotation?(value.charAt(0)+value.charAt(0)):value.substring(0,2),g=isShortNotation?(value.charAt(1)+value.charAt(1)):value.substring(2,4),b=isShortNotation?(value.charAt(2)+value.charAt(2)):value.substring(4,6);return[parseInt(r,16),parseInt(g,16),parseInt(b,16),1];}};fabric.Color.fromSource=function(source){var oColor=new Color();oColor.setSource(source);return oColor;};})(typeof exports!=='undefined'?exports:this);(function(){function getColorStop(el){var style=el.getAttribute('style'),offset=el.getAttribute('offset')||0,color,colorAlpha,opacity;offset=parseFloat(offset)/(/%$/.test(offset)?100:1);offset=offset<0?0:offset>1?1:offset;if(style){var keyValuePairs=style.split(/\s*;\s*/);if(keyValuePairs[keyValuePairs.length-1]===''){keyValuePairs.pop();}
for(var i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\s*:\s*/),key=split[0].trim(),value=split[1].trim();if(key==='stop-color'){color=value;}
else if(key==='stop-opacity'){opacity=value;}}}
if(!color){color=el.getAttribute('stop-color')||'rgb(0,0,0)';}
if(!opacity){opacity=el.getAttribute('stop-opacity');}
color=new fabric.Color(color);colorAlpha=color.getAlpha();opacity=isNaN(parseFloat(opacity))?1:parseFloat(opacity);opacity*=colorAlpha;return{offset:offset,color:color.toRgb(),opacity:opacity};}
function getLinearCoords(el){return{x1:el.getAttribute('x1')||0,y1:el.getAttribute('y1')||0,x2:el.getAttribute('x2')||'100%',y2:el.getAttribute('y2')||0};}
function getRadialCoords(el){return{x1:el.getAttribute('fx')||el.getAttribute('cx')||'50%',y1:el.getAttribute('fy')||el.getAttribute('cy')||'50%',r1:0,x2:el.getAttribute('cx')||'50%',y2:el.getAttribute('cy')||'50%',r2:el.getAttribute('r')||'50%'};}
fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(options){options||(options={});var coords={};this.id=fabric.Object.__uid++;this.type=options.type||'linear';coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0};if(this.type==='radial'){coords.r1=options.coords.r1||0;coords.r2=options.coords.r2||0;}
this.coords=coords;this.colorStops=options.colorStops.slice();if(options.gradientTransform){this.gradientTransform=options.gradientTransform;}
this.offsetX=options.offsetX||this.offsetX;this.offsetY=options.offsetY||this.offsetY;},addColorStop:function(colorStop){for(var position in colorStop){var color=new fabric.Color(colorStop[position]);this.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()});}
return this;},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};},toSVG:function(object){var coords=fabric.util.object.clone(this.coords),markup,commonAttributes;this.colorStops.sort(function(a,b){return a.offset-b.offset;});if(!(object.group&&object.group.type==='path-group')){for(var prop in coords){if(prop==='x1'||prop==='x2'||prop==='r2'){coords[prop]+=this.offsetX-object.width/2;}
else if(prop==='y1'||prop==='y2'){coords[prop]+=this.offsetY-object.height/2;}}}
commonAttributes='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';if(this.gradientTransform){commonAttributes+=' gradientTransform="matrix('+this.gradientTransform.join(' ')+')" ';}
if(this.type==='linear'){markup=['<linearGradient ',commonAttributes,' x1="',coords.x1,'" y1="',coords.y1,'" x2="',coords.x2,'" y2="',coords.y2,'">\n'];}
else if(this.type==='radial'){markup=['<radialGradient ',commonAttributes,' cx="',coords.x2,'" cy="',coords.y2,'" r="',coords.r2,'" fx="',coords.x1,'" fy="',coords.y1,'">\n'];}
for(var i=0;i<this.colorStops.length;i++){markup.push('<stop ','offset="',(this.colorStops[i].offset*100)+'%','" style="stop-color:',this.colorStops[i].color,(this.colorStops[i].opacity!=null?';stop-opacity: '+this.colorStops[i].opacity:';'),'"/>\n');}
markup.push((this.type==='linear'?'</linearGradient>\n':'</radialGradient>\n'));return markup.join('');},toLive:function(ctx,object){var gradient,prop,coords=fabric.util.object.clone(this.coords);if(!this.type){return;}
if(object.group&&object.group.type==='path-group'){for(prop in coords){if(prop==='x1'||prop==='x2'){coords[prop]+=-this.offsetX+object.width/2;}
else if(prop==='y1'||prop==='y2'){coords[prop]+=-this.offsetY+object.height/2;}}}
if(this.type==='linear'){gradient=ctx.createLinearGradient(coords.x1,coords.y1,coords.x2,coords.y2);}
else if(this.type==='radial'){gradient=ctx.createRadialGradient(coords.x1,coords.y1,coords.r1,coords.x2,coords.y2,coords.r2);}
for(var i=0,len=this.colorStops.length;i<len;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;if(typeof opacity!=='undefined'){color=new fabric.Color(color).setAlpha(opacity).toRgba();}
gradient.addColorStop(parseFloat(offset),color);}
return gradient;}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(el,instance){var colorStopEls=el.getElementsByTagName('stop'),type=(el.nodeName==='linearGradient'?'linear':'radial'),gradientUnits=el.getAttribute('gradientUnits')||'objectBoundingBox',gradientTransform=el.getAttribute('gradientTransform'),colorStops=[],coords={},ellipseMatrix;if(type==='linear'){coords=getLinearCoords(el);}
else if(type==='radial'){coords=getRadialCoords(el);}
for(var i=colorStopEls.length;i--;){colorStops.push(getColorStop(colorStopEls[i]));}
ellipseMatrix=_convertPercentUnitsToValues(instance,coords,gradientUnits);var gradient=new fabric.Gradient({type:type,coords:coords,colorStops:colorStops,offsetX:-instance.left,offsetY:-instance.top});if(gradientTransform||ellipseMatrix!==''){gradient.gradientTransform=fabric.parseTransformAttribute((gradientTransform||'')+ellipseMatrix);}
return gradient;},forObject:function(obj,options){options||(options={});_convertPercentUnitsToValues(obj,options.coords,'userSpaceOnUse');return new fabric.Gradient(options);}});function _convertPercentUnitsToValues(object,options,gradientUnits){var propValue,addFactor=0,multFactor=1,ellipseMatrix='';for(var prop in options){propValue=parseFloat(options[prop],10);if(typeof options[prop]==='string'&&/^\d+%$/.test(options[prop])){multFactor=0.01;}
else{multFactor=1;}
if(prop==='x1'||prop==='x2'||prop==='r2'){multFactor*=gradientUnits==='objectBoundingBox'?object.width:1;addFactor=gradientUnits==='objectBoundingBox'?object.left||0:0;}
else if(prop==='y1'||prop==='y2'){multFactor*=gradientUnits==='objectBoundingBox'?object.height:1;addFactor=gradientUnits==='objectBoundingBox'?object.top||0:0;}
options[prop]=propValue*multFactor+addFactor;}
if(object.type==='ellipse'&&options.r2!==null&&gradientUnits==='objectBoundingBox'&&object.rx!==object.ry){var scaleFactor=object.ry/object.rx;ellipseMatrix=' scale(1, '+scaleFactor+')';if(options.y1){options.y1/=scaleFactor;}
if(options.y2){options.y2/=scaleFactor;}}
return ellipseMatrix;}})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;if(fabric.Shadow){fabric.warn('fabric.Shadow is already defined.');return;}
fabric.Shadow=fabric.util.createClass({color:'rgb(0,0,0)',blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,initialize:function(options){if(typeof options==='string'){options=this._parseShadow(options);}
for(var prop in options){this[prop]=options[prop];}
this.id=fabric.Object.__uid++;},_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,'')||'rgb(0,0,0)';return{color:color.trim(),offsetX:parseInt(offsetsAndBlur[1],10)||0,offsetY:parseInt(offsetsAndBlur[2],10)||0,blur:parseInt(offsetsAndBlur[3],10)||0};},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join('px ');},toSVG:function(object){var fBoxX=40,fBoxY=40;if(object.width&&object.height){fBoxX=toFixed((Math.abs(this.offsetX)+this.blur)/object.width,2)*100+20;fBoxY=toFixed((Math.abs(this.offsetY)+this.blur)/object.height,2)*100+20;}
return('<filter id="SVGID_'+this.id+'" y="-'+fBoxY+'%" height="'+(100+2*fBoxY)+'%" '+'x="-'+fBoxX+'%" width="'+(100+2*fBoxX)+'%" '+'>\n'+'\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+
toFixed(this.blur?this.blur/2:0,3)+'"></feGaussianBlur>\n'+'\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'" result="oBlur" ></feOffset>\n'+'\t<feFlood flood-color="'+this.color+'"/>\n'+'\t<feComposite in2="oBlur" operator="in" />\n'+'\t<feMerge>\n'+'\t\t<feMergeNode></feMergeNode>\n'+'\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n'+'\t</feMerge>\n'+'</filter>\n');},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};}
var obj={},proto=fabric.Shadow.prototype;if(this.color!==proto.color){obj.color=this.color;}
if(this.blur!==proto.blur){obj.blur=this.blur;}
if(this.offsetX!==proto.offsetX){obj.offsetX=this.offsetX;}
if(this.offsetY!==proto.offsetY){obj.offsetY=this.offsetY;}
return obj;}});fabric.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/;})(typeof exports!=='undefined'?exports:this);(function(){'use strict';if(fabric.StaticCanvas){fabric.warn('fabric.StaticCanvas is already defined.');return;}
var extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,CANVAS_INIT_ERROR=new Error('Could not initialize `canvas` element');fabric.StaticCanvas=fabric.util.createClass({initialize:function(el,options){options||(options={});this._initStatic(el,options);fabric.StaticCanvas.activeInstance=this;},backgroundColor:'',backgroundImage:null,overlayColor:'',overlayImage:null,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,preserveObjectStacking:false,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:true,_initStatic:function(el,options){this._objects=[];this._createLowerCanvas(el);this._initOptions(options);this._setImageSmoothing();if(!this.interactive){this._initRetinaScaling();}
if(options.overlayImage){this.setOverlayImage(options.overlayImage,this.renderAll.bind(this));}
if(options.backgroundImage){this.setBackgroundImage(options.backgroundImage,this.renderAll.bind(this));}
if(options.backgroundColor){this.setBackgroundColor(options.backgroundColor,this.renderAll.bind(this));}
if(options.overlayColor){this.setOverlayColor(options.overlayColor,this.renderAll.bind(this));}
this.calcOffset();},_initRetinaScaling:function(){if(fabric.devicePixelRatio===1||!this.enableRetinaScaling){return;}
this.lowerCanvasEl.setAttribute('width',this.width*fabric.devicePixelRatio);this.lowerCanvasEl.setAttribute('height',this.height*fabric.devicePixelRatio);this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio);},calcOffset:function(){this._offset=getElementOffset(this.lowerCanvasEl);return this;},setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage('overlayImage',image,callback,options);},setBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage('backgroundImage',image,callback,options);},setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor('overlayColor',overlayColor,callback);},setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor('backgroundColor',backgroundColor,callback);},_setImageSmoothing:function(){var ctx=this.getContext();if(typeof ctx.imageSmoothingEnabled!=='undefined'){ctx.imageSmoothingEnabled=this.imageSmoothingEnabled;return;}
ctx.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;ctx.mozImageSmoothingEnabled=this.imageSmoothingEnabled;ctx.msImageSmoothingEnabled=this.imageSmoothingEnabled;ctx.oImageSmoothingEnabled=this.imageSmoothingEnabled;},__setBgOverlayImage:function(property,image,callback,options){if(typeof image==='string'){fabric.util.loadImage(image,function(img){this[property]=new fabric.Image(img,options);callback&&callback();},this,options&&options.crossOrigin);}
else{options&&image.setOptions(options);this[property]=image;callback&&callback();}
return this;},__setBgOverlayColor:function(property,color,callback){if(color&&color.source){var _this=this;fabric.util.loadImage(color.source,function(img){_this[property]=new fabric.Pattern({source:img,repeat:color.repeat,offsetX:color.offsetX,offsetY:color.offsetY});callback&&callback();});}
else{this[property]=color;callback&&callback();}
return this;},_createCanvasElement:function(){var element=fabric.document.createElement('canvas');if(!element.style){element.style={};}
if(!element){throw CANVAS_INIT_ERROR;}
this._initCanvasElement(element);return element;},_initCanvasElement:function(element){fabric.util.createCanvasElement(element);if(typeof element.getContext==='undefined'){throw CANVAS_INIT_ERROR;}},_initOptions:function(options){for(var prop in options){this[prop]=options[prop];}
this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return;}
this.lowerCanvasEl.width=this.width;this.lowerCanvasEl.height=this.height;this.lowerCanvasEl.style.width=this.width+'px';this.lowerCanvasEl.style.height=this.height+'px';this.viewportTransform=this.viewportTransform.slice();},_createLowerCanvas:function(canvasEl){this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,'lower-canvas');if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl);}
this.contextContainer=this.lowerCanvasEl.getContext('2d');},getWidth:function(){return this.width;},getHeight:function(){return this.height;},setWidth:function(value,options){return this.setDimensions({width:value},options);},setHeight:function(value,options){return this.setDimensions({height:value},options);},setDimensions:function(dimensions,options){var cssValue;options=options||{};for(var prop in dimensions){cssValue=dimensions[prop];if(!options.cssOnly){this._setBackstoreDimension(prop,dimensions[prop]);cssValue+='px';}
if(!options.backstoreOnly){this._setCssDimension(prop,cssValue);}}
this._setImageSmoothing();this.calcOffset();if(!options.cssOnly){this.renderAll();}
return this;},_setBackstoreDimension:function(prop,value){this.lowerCanvasEl[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl[prop]=value;}
if(this.cacheCanvasEl){this.cacheCanvasEl[prop]=value;}
this[prop]=value;return this;},_setCssDimension:function(prop,value){this.lowerCanvasEl.style[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl.style[prop]=value;}
if(this.wrapperEl){this.wrapperEl.style[prop]=value;}
return this;},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3]);},setViewportTransform:function(vpt){var activeGroup=this.getActiveGroup();this.viewportTransform=vpt;this.renderAll();for(var i=0,len=this._objects.length;i<len;i++){this._objects[i].setCoords();}
if(activeGroup){activeGroup.setCoords();}
return this;},zoomToPoint:function(point,value){var before=point;point=fabric.util.transformPoint(point,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=value;this.viewportTransform[3]=value;var after=fabric.util.transformPoint(point,this.viewportTransform);this.viewportTransform[4]+=before.x-after.x;this.viewportTransform[5]+=before.y-after.y;this.renderAll();for(var i=0,len=this._objects.length;i<len;i++){this._objects[i].setCoords();}
return this;},setZoom:function(value){this.zoomToPoint(new fabric.Point(0,0),value);return this;},absolutePan:function(point){this.viewportTransform[4]=-point.x;this.viewportTransform[5]=-point.y;this.renderAll();for(var i=0,len=this._objects.length;i<len;i++){this._objects[i].setCoords();}
return this;},relativePan:function(point){return this.absolutePan(new fabric.Point(-point.x-this.viewportTransform[4],-point.y-this.viewportTransform[5]));},getElement:function(){return this.lowerCanvasEl;},getActiveObject:function(){return null;},getActiveGroup:function(){return null;},_draw:function(ctx,object){if(!object){return;}
ctx.save();var v=this.viewportTransform;ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);if(this._shouldRenderObject(object)){object.render(ctx);}
ctx.restore();if(!this.controlsAboveOverlay){object._renderControls(ctx);}},_shouldRenderObject:function(object){if(!object){return false;}
return(object!==this.getActiveGroup()||!this.preserveObjectStacking);},_onObjectAdded:function(obj){this.stateful&&obj.setupState();obj._set('canvas',this);obj.setCoords();this.fire('object:added',{target:obj});obj.fire('added');},_onObjectRemoved:function(obj){if(this.getActiveObject()===obj){this.fire('before:selection:cleared',{target:obj});this._discardActiveObject();this.fire('selection:cleared');}
this.fire('object:removed',{target:obj});obj.fire('removed');},clearContext:function(ctx){ctx.clearRect(0,0,this.width,this.height);return this;},getContext:function(){return this.contextContainer;},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup();}
if(this.discardActiveObject){this.discardActiveObject();}
this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop);}
this.fire('canvas:cleared');this.renderAll();return this;},renderAll:function(){var canvasToDrawOn=this.contextContainer,activeGroup=this.getActiveGroup();if(this.contextTop&&this.selection&&!this._groupSelector){this.clearContext(this.contextTop);}
this.clearContext(canvasToDrawOn);this.fire('before:render');if(this.clipTo){fabric.util.clipContext(this,canvasToDrawOn);}
this._renderBackground(canvasToDrawOn);this._renderObjects(canvasToDrawOn,activeGroup);this._renderActiveGroup(canvasToDrawOn,activeGroup);if(this.clipTo){canvasToDrawOn.restore();}
this._renderOverlay(canvasToDrawOn);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(canvasToDrawOn);}
this.fire('after:render');return this;},_renderObjects:function(ctx,activeGroup){var i,length;if(!activeGroup||this.preserveObjectStacking){for(i=0,length=this._objects.length;i<length;++i){this._draw(ctx,this._objects[i]);}}
else{for(i=0,length=this._objects.length;i<length;++i){if(this._objects[i]&&!activeGroup.contains(this._objects[i])){this._draw(ctx,this._objects[i]);}}}},_renderActiveGroup:function(ctx,activeGroup){if(activeGroup){var sortedObjects=[];this.forEachObject(function(object){if(activeGroup.contains(object)){sortedObjects.push(object);}});activeGroup._set('_objects',sortedObjects.reverse());this._draw(ctx,activeGroup);}},_renderBackground:function(ctx){if(this.backgroundColor){ctx.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(ctx):this.backgroundColor;ctx.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height);}
if(this.backgroundImage){this._draw(ctx,this.backgroundImage);}},_renderOverlay:function(ctx){if(this.overlayColor){ctx.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(ctx):this.overlayColor;ctx.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height);}
if(this.overlayImage){this._draw(ctx,this.overlayImage);}},renderTop:function(){var ctx=this.contextTop||this.contextContainer;this.clearContext(ctx);if(this.selection&&this._groupSelector){this._drawSelection();}
this.fire('after:render');return this;},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2};},centerObjectH:function(object){this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y));this.renderAll();return this;},centerObjectV:function(object){this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top));this.renderAll();return this;},centerObject:function(object){var center=this.getCenter();this._centerObject(object,new fabric.Point(center.left,center.top));this.renderAll();return this;},_centerObject:function(object,center){object.setPositionByOrigin(center,'center','center');return this;},toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude);},toObject:function(propertiesToInclude){return this._toObjectMethod('toObject',propertiesToInclude);},toDatalessObject:function(propertiesToInclude){return this._toObjectMethod('toDatalessObject',propertiesToInclude);},_toObjectMethod:function(methodName,propertiesToInclude){var data={objects:this._toObjects(methodName,propertiesToInclude)};extend(data,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,data,propertiesToInclude);return data;},_toObjects:function(methodName,propertiesToInclude){return this.getObjects().map(function(instance){return this._toObject(instance,methodName,propertiesToInclude);},this);},_toObject:function(instance,methodName,propertiesToInclude){var originalValue;if(!this.includeDefaultValues){originalValue=instance.includeDefaultValues;instance.includeDefaultValues=false;}
var originalProperties=this._realizeGroupTransformOnObject(instance),object=instance[methodName](propertiesToInclude);if(!this.includeDefaultValues){instance.includeDefaultValues=originalValue;}
this._unwindGroupTransformOnObject(instance,originalProperties);return object;},_realizeGroupTransformOnObject:function(instance){var layoutProps=['angle','flipX','flipY','height','left','scaleX','scaleY','top','width'];if(instance.group&&instance.group===this.getActiveGroup()){var originalValues={};layoutProps.forEach(function(prop){originalValues[prop]=instance[prop];});this.getActiveGroup().realizeTransform(instance);return originalValues;}
else{return null;}},_unwindGroupTransformOnObject:function(instance,originalValues){if(originalValues){instance.set(originalValues);}},__serializeBgOverlay:function(){var data={background:(this.backgroundColor&&this.backgroundColor.toObject)?this.backgroundColor.toObject():this.backgroundColor};if(this.overlayColor){data.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor;}
if(this.backgroundImage){data.backgroundImage=this.backgroundImage.toObject();}
if(this.overlayImage){data.overlayImage=this.overlayImage.toObject();}
return data;},svgViewportTransformation:true,toSVG:function(options,reviver){options||(options={});var markup=[];this._setSVGPreamble(markup,options);this._setSVGHeader(markup,options);this._setSVGBgOverlayColor(markup,'backgroundColor');this._setSVGBgOverlayImage(markup,'backgroundImage');this._setSVGObjects(markup,reviver);this._setSVGBgOverlayColor(markup,'overlayColor');this._setSVGBgOverlayImage(markup,'overlayImage');markup.push('</svg>');return markup.join('');},_setSVGPreamble:function(markup,options){if(!options.suppressPreamble){markup.push('<?xml version="1.0" encoding="',(options.encoding||'UTF-8'),'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n');}},_setSVGHeader:function(markup,options){var width,height,vpt;if(options.viewBox){width=options.viewBox.width;height=options.viewBox.height;}
else{width=this.width;height=this.height;if(!this.svgViewportTransformation){vpt=this.viewportTransform;width/=vpt[0];height/=vpt[3];}}
markup.push('<svg ','xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',width,'" ','height="',height,'" ',(this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null),(options.viewBox?'viewBox="'+
options.viewBox.x+' '+
options.viewBox.y+' '+
options.viewBox.width+' '+
options.viewBox.height+'" ':null),'xml:space="preserve">\n','<desc>Created with Fabric.js ',fabric.version,'</desc>\n','<defs>',fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),'</defs>\n');},_setSVGObjects:function(markup,reviver){for(var i=0,objects=this.getObjects(),len=objects.length;i<len;i++){var instance=objects[i],originalProperties=this._realizeGroupTransformOnObject(instance);markup.push(instance.toSVG(reviver));this._unwindGroupTransformOnObject(instance,originalProperties);}},_setSVGBgOverlayImage:function(markup,property){if(this[property]&&this[property].toSVG){markup.push(this[property].toSVG());}},_setSVGBgOverlayColor:function(markup,property){if(this[property]&&this[property].source){markup.push('<rect x="',this[property].offsetX,'" y="',this[property].offsetY,'" ','width="',(this[property].repeat==='repeat-y'||this[property].repeat==='no-repeat'?this[property].source.width:this.width),'" height="',(this[property].repeat==='repeat-x'||this[property].repeat==='no-repeat'?this[property].source.height:this.height),'" fill="url(#'+property+'Pattern)"','></rect>\n');}
else if(this[property]&&property==='overlayColor'){markup.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[property],'"','></rect>\n');}},sendToBack:function(object){removeFromArray(this._objects,object);this._objects.unshift(object);return this.renderAll&&this.renderAll();},bringToFront:function(object){removeFromArray(this._objects,object);this._objects.push(object);return this.renderAll&&this.renderAll();},sendBackwards:function(object,intersecting){var idx=this._objects.indexOf(object);if(idx!==0){var newIdx=this._findNewLowerIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);this.renderAll&&this.renderAll();}
return this;},_findNewLowerIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx-1;i>=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}
else{newIdx=idx-1;}
return newIdx;},bringForward:function(object,intersecting){var idx=this._objects.indexOf(object);if(idx!==this._objects.length-1){var newIdx=this._findNewUpperIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);this.renderAll&&this.renderAll();}
return this;},_findNewUpperIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx+1;i<this._objects.length;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}
else{newIdx=idx+1;}
return newIdx;},moveTo:function(object,index){removeFromArray(this._objects,object);this._objects.splice(index,0,object);return this.renderAll&&this.renderAll();},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this;},toString:function(){return'#<fabric.Canvas ('+this.complexity()+'): '+'{ objects: '+this.getObjects().length+' }>';}});extend(fabric.StaticCanvas.prototype,fabric.Observable);extend(fabric.StaticCanvas.prototype,fabric.Collection);extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter);extend(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(methodName){var el=fabric.util.createCanvasElement();if(!el||!el.getContext){return null;}
var ctx=el.getContext('2d');if(!ctx){return null;}
switch(methodName){case'getImageData':return typeof ctx.getImageData!=='undefined';case'setLineDash':return typeof ctx.setLineDash!=='undefined';case'toDataURL':return typeof el.toDataURL!=='undefined';case'toDataURLWithQuality':try{el.toDataURL('image/jpeg',0);return true;}
catch(e){}
return false;default:return null;}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;})();(function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,radiansToDegrees=fabric.util.radiansToDegrees,atan2=Math.atan2,abs=Math.abs,STROKE_OFFSET=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(el,options){options||(options={});this._initStatic(el,options);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this;},uniScaleTransform:false,centeredScaling:false,centeredRotation:false,interactive:true,selection:true,selectionColor:'rgba(100, 100, 255, 0.3)',selectionDashArray:[],selectionBorderColor:'rgba(255, 255, 255, 0.3)',selectionLineWidth:1,hoverCursor:'move',moveCursor:'move',defaultCursor:'default',freeDrawingCursor:'crosshair',rotationCursor:'crosshair',containerClass:'canvas-container',perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,areAlignmentGuidesEnabled:true,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset();},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top});if(this._shouldCenterTransform(t.target)){if(t.action==='rotate'){this._setOriginToCenter(t.target);}
else{if(t.originX!=='center'){if(t.originX==='right'){t.mouseXSign=-1;}
else{t.mouseXSign=1;}}
if(t.originY!=='center'){if(t.originY==='bottom'){t.mouseYSign=-1;}
else{t.mouseYSign=1;}}
t.originX='center';t.originY='center';}}
else{t.originX=t.original.originX;t.originY=t.original.originY;}},containsPoint:function(e,target){var pointer=this.getPointer(e,true),xy=this._normalizePointer(target,pointer);return(target.containsPoint(xy)||target._findTargetCorner(pointer));},_normalizePointer:function(object,pointer){var activeGroup=this.getActiveGroup(),x=pointer.x,y=pointer.y,isObjectInGroup=(activeGroup&&object.type!=='group'&&activeGroup.contains(object)),lt;if(isObjectInGroup){lt=fabric.util.transformPoint(activeGroup.getCenterPoint(),this.viewportTransform,true);x-=lt.x;y-=lt.y;x/=activeGroup.scaleX;y/=activeGroup.scaleY;}
return{x:x,y:y};},isTargetTransparent:function(target,x,y){var hasBorders=target.hasBorders,transparentCorners=target.transparentCorners;target.hasBorders=target.transparentCorners=false;this._draw(this.contextCache,target);target.hasBorders=hasBorders;target.transparentCorners=transparentCorners;var isTransparent=fabric.util.isTransparent(this.contextCache,x,y,this.targetFindTolerance);this.clearContext(this.contextCache);return isTransparent;},_shouldClearSelection:function(e,target){var activeGroup=this.getActiveGroup(),activeObject=this.getActiveObject();return(!target||(target&&activeGroup&&!activeGroup.contains(target)&&activeGroup!==target&&!e.shiftKey)||(target&&!target.evented)||(target&&!target.selectable&&activeObject&&activeObject!==target));},_shouldCenterTransform:function(target){if(!target){return;}
var t=this._currentTransform,centerTransform;if(t.action==='scale'||t.action==='scaleX'||t.action==='scaleY'){centerTransform=this.centeredScaling||target.centeredScaling;}
else if(t.action==='rotate'){centerTransform=this.centeredRotation||target.centeredRotation;}
return centerTransform?!t.altKey:t.altKey;},_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};if(corner==='ml'||corner==='tl'||corner==='bl'){origin.x='right';}
else if(corner==='mr'||corner==='tr'||corner==='br'){origin.x='left';}
if(corner==='tl'||corner==='mt'||corner==='tr'){origin.y='bottom';}
else if(corner==='bl'||corner==='mb'||corner==='br'){origin.y='top';}
return origin;},_getActionFromCorner:function(target,corner,e){if(!corner){return'drag';}
switch(corner){case'mtr':return'rotate';case'ml':case'mr':return e.shiftKey?'skewY':'scaleX';case'mt':case'mb':return e.shiftKey?'skewX':'scaleY';default:return'scale';}},_setupCurrentTransform:function(e,target){if(!target){return;}
var pointer=this.getPointer(e),corner=target._findTargetCorner(this.getPointer(e,true)),action=this._getActionFromCorner(target,corner,e),origin=this._getOriginFromCorner(target,corner);this._currentTransform={target:target,action:action,corner:corner,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,offsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,lastX:pointer.x,lastY:pointer.y,left:target.left,top:target.top,theta:degreesToRadians(target.angle),width:target.width*target.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e.altKey};this._currentTransform.original={left:target.left,top:target.top,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,originX:origin.x,originY:origin.y};this._resetCurrentTransform();},_translateObject:function(x,y){var target=this._currentTransform.target;if(!target.get('lockMovementX')){target.set('left',x-this._currentTransform.offsetX);}
if(!target.get('lockMovementY')){target.set('top',y-this._currentTransform.offsetY);}},_changeSkewTransformOrigin:function(mouseMove,t,by){var property='originX',origins={0:'center'},skew=t.target.skewX,originA='left',originB='right',corner=t.corner==='mt'||t.corner==='ml'?1:-1,flipSign=1;mouseMove=mouseMove>0?1:-1;if(by==='y'){skew=t.target.skewY;originA='top';originB='bottom';property='originY';}
origins[-1]=originA;origins[1]=originB;t.target.flipX&&(flipSign*=-1);t.target.flipY&&(flipSign*=-1);if(skew===0){t.skewSign=-corner*mouseMove*flipSign;t[property]=origins[-mouseMove];}
else{skew=skew>0?1:-1;t.skewSign=skew;t[property]=origins[skew*corner*flipSign];}},_skewObject:function(x,y,by){var t=this._currentTransform,target=t.target,lockSkewingX=target.get('lockSkewingX'),lockSkewingY=target.get('lockSkewingY');if((lockSkewingX&&by==='x')||(lockSkewingY&&by==='y')){return;}
var center=target.getCenterPoint(),actualMouseByCenter=target.toLocalPoint(new fabric.Point(x,y),'center','center')[by],lastMouseByCenter=target.toLocalPoint(new fabric.Point(t.lastX,t.lastY),'center','center')[by],actualMouseByOrigin,constraintPosition,dim=target._getTransformedDimensions();this._changeSkewTransformOrigin(actualMouseByCenter-lastMouseByCenter,t,by);actualMouseByOrigin=target.toLocalPoint(new fabric.Point(x,y),t.originX,t.originY)[by],constraintPosition=target.translateToOriginPoint(center,t.originX,t.originY);this._setObjectSkew(actualMouseByOrigin,t,by,dim);t.lastX=x;t.lastY=y;target.setPositionByOrigin(constraintPosition,t.originX,t.originY);},_setObjectSkew:function(localMouse,transform,by,_dim){var target=transform.target,newValue,skewSign=transform.skewSign,newDim,dimNoSkew,otherBy,_otherBy,_by,newDimMouse,skewX,skewY;if(by==='x'){otherBy='y';_otherBy='Y';_by='X';skewX=0;skewY=target.skewY;}
else{otherBy='x';_otherBy='X';_by='Y';skewX=target.skewX;skewY=0;}
dimNoSkew=target._getTransformedDimensions(skewX,skewY);newDimMouse=2*Math.abs(localMouse)-dimNoSkew[by];if(newDimMouse<=2){newValue=0;}
else{newValue=skewSign*Math.atan((newDimMouse/target['scale'+_by])/(dimNoSkew[otherBy]/target['scale'+_otherBy]));newValue=fabric.util.radiansToDegrees(newValue);}
target.set('skew'+_by,newValue);if(target['skew'+_otherBy]!==0){newDim=target._getTransformedDimensions();newValue=(_dim[otherBy]/newDim[otherBy])*target['scale'+_otherBy];target.set('scale'+_otherBy,newValue);}},_scaleObject:function(x,y,by){var t=this._currentTransform,target=t.target,lockScalingX=target.get('lockScalingX'),lockScalingY=target.get('lockScalingY'),lockScalingFlip=target.get('lockScalingFlip');if(lockScalingX&&lockScalingY){return;}
var constraintPosition=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY),localMouse=target.toLocalPoint(new fabric.Point(x,y),t.originX,t.originY),dim=target._getTransformedDimensions();this._setLocalMouse(localMouse,t);this._setObjectScale(localMouse,t,lockScalingX,lockScalingY,by,lockScalingFlip,dim);target.setPositionByOrigin(constraintPosition,t.originX,t.originY);},_setObjectScale:function(localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim){var target=transform.target,forbidScalingX=false,forbidScalingY=false;transform.newScaleX=localMouse.x*target.scaleX/_dim.x;transform.newScaleY=localMouse.y*target.scaleY/_dim.y;if(lockScalingFlip&&transform.newScaleX<=0&&transform.newScaleX<target.scaleX){forbidScalingX=true;}
if(lockScalingFlip&&transform.newScaleY<=0&&transform.newScaleY<target.scaleY){forbidScalingY=true;}
if(by==='equally'&&!lockScalingX&&!lockScalingY){forbidScalingX||forbidScalingY||this._scaleObjectEqually(localMouse,target,transform,_dim);}
else if(!by){forbidScalingX||lockScalingX||target.set('scaleX',transform.newScaleX);forbidScalingY||lockScalingY||target.set('scaleY',transform.newScaleY);}
else if(by==='x'&&!target.get('lockUniScaling')){forbidScalingX||lockScalingX||target.set('scaleX',transform.newScaleX);}
else if(by==='y'&&!target.get('lockUniScaling')){forbidScalingY||lockScalingY||target.set('scaleY',transform.newScaleY);}
forbidScalingX||forbidScalingY||this._flipObject(transform,by);},_scaleObjectEqually:function(localMouse,target,transform,_dim){var dist=localMouse.y+localMouse.x,lastDist=_dim.y*transform.original.scaleY/target.scaleY+
_dim.x*transform.original.scaleX/target.scaleX;transform.newScaleX=transform.original.scaleX*dist/lastDist;transform.newScaleY=transform.original.scaleY*dist/lastDist;target.set('scaleX',transform.newScaleX);target.set('scaleY',transform.newScaleY);},_flipObject:function(transform,by){if(transform.newScaleX<0&&by!=='y'){if(transform.originX==='left'){transform.originX='right';}
else if(transform.originX==='right'){transform.originX='left';}}
if(transform.newScaleY<0&&by!=='x'){if(transform.originY==='top'){transform.originY='bottom';}
else if(transform.originY==='bottom'){transform.originY='top';}}},_setLocalMouse:function(localMouse,t){var target=t.target;if(t.originX==='right'){localMouse.x*=-1;}
else if(t.originX==='center'){localMouse.x*=t.mouseXSign*2;if(localMouse.x<0){t.mouseXSign=-t.mouseXSign;}}
if(t.originY==='bottom'){localMouse.y*=-1;}
else if(t.originY==='center'){localMouse.y*=t.mouseYSign*2;if(localMouse.y<0){t.mouseYSign=-t.mouseYSign;}}
if(abs(localMouse.x)>target.padding){if(localMouse.x<0){localMouse.x+=target.padding;}
else{localMouse.x-=target.padding;}}
else{localMouse.x=0;}
if(abs(localMouse.y)>target.padding){if(localMouse.y<0){localMouse.y+=target.padding;}
else{localMouse.y-=target.padding;}}
else{localMouse.y=0;}},_rotateObject:function(x,y){var t=this._currentTransform;if(t.target.get('lockRotation')){return;}
var lastAngle=atan2(t.ey-t.top,t.ex-t.left),curAngle=atan2(y-t.top,x-t.left),angle=radiansToDegrees(curAngle-lastAngle+t.theta);if(angle<0){angle=360+angle;}
var snap=angle%90;if(snap>85||snap<5){angle=(Math.round(angle/10)*10);}
t.target.angle=angle%360;},setCursor:function(value){this.upperCanvasEl.style.cursor=value;},_resetObjectTransform:function(target){target.scaleX=1;target.scaleY=1;target.skewX=0;target.skewY=0;target.setAngle(0);},_drawSelection:function(){var ctx=this.contextTop,groupSelector=this._groupSelector,left=groupSelector.left,top=groupSelector.top,aleft=abs(left),atop=abs(top);ctx.fillStyle=this.selectionColor;ctx.fillRect(groupSelector.ex-((left>0)?0:-left),groupSelector.ey-((top>0)?0:-top),aleft,atop);ctx.lineWidth=this.selectionLineWidth;ctx.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var px=groupSelector.ex+STROKE_OFFSET-((left>0)?0:aleft),py=groupSelector.ey+STROKE_OFFSET-((top>0)?0:atop);ctx.beginPath();fabric.util.drawDashedLine(ctx,px,py,px+aleft,py,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px,py+atop-1,px+aleft,py+atop-1,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px,py,px,py+atop,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px+aleft-1,py,px+aleft-1,py+atop,this.selectionDashArray);ctx.closePath();ctx.stroke();}
else{ctx.strokeRect(groupSelector.ex+STROKE_OFFSET-((left>0)?0:aleft),groupSelector.ey+STROKE_OFFSET-((top>0)?0:atop),aleft,atop);}},_isLastRenderedObject:function(e){return(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(e,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(e,true)));},findTarget:function(e,skipGroup){if(this.skipTargetFind){return;}
if(this._isLastRenderedObject(e)){return this.lastRenderedObjectWithControlsAboveOverlay;}
var activeGroup=this.getActiveGroup();if(activeGroup&&!skipGroup&&this.containsPoint(e,activeGroup)){return activeGroup;}
var target=this._searchPossibleTargets(e,skipGroup);this._fireOverOutEvents(target,e);return target;},_fireOverOutEvents:function(target,e){if(target){if(this._hoveredTarget!==target){if(this._hoveredTarget){this.fire('mouse:out',{target:this._hoveredTarget,e:e});this._hoveredTarget.fire('mouseout');}
this.fire('mouse:over',{target:target,e:e});target.fire('mouseover');this._hoveredTarget=target;}}
else if(this._hoveredTarget){this.fire('mouse:out',{target:this._hoveredTarget,e:e});this._hoveredTarget.fire('mouseout');this._hoveredTarget=null;}},_checkTarget:function(e,obj,pointer){if(obj&&obj.visible&&obj.evented&&this.containsPoint(e,obj)){if((this.perPixelTargetFind||obj.perPixelTargetFind)&&!obj.isEditing){var isTransparent=this.isTargetTransparent(obj,pointer.x,pointer.y);if(!isTransparent){return true;}}
else{return true;}}},_searchPossibleTargets:function(e,skipGroup){var target,pointer=this.getPointer(e,true),i=this._objects.length;while(i--){if((!this._objects[i].group||skipGroup)&&this._checkTarget(e,this._objects[i],pointer)){this.relatedTarget=this._objects[i];target=this._objects[i];break;}}
return target;},getPointer:function(e,ignoreZoom,upperCanvasEl){if(!upperCanvasEl){upperCanvasEl=this.upperCanvasEl;}
var pointer=getPointer(e),bounds=upperCanvasEl.getBoundingClientRect(),boundsWidth=bounds.width||0,boundsHeight=bounds.height||0,cssScale;if(!boundsWidth||!boundsHeight){if('top'in bounds&&'bottom'in bounds){boundsHeight=Math.abs(bounds.top-bounds.bottom);}
if('right'in bounds&&'left'in bounds){boundsWidth=Math.abs(bounds.right-bounds.left);}}
this.calcOffset();pointer.x=pointer.x-this._offset.left;pointer.y=pointer.y-this._offset.top;if(!ignoreZoom){pointer=fabric.util.transformPoint(pointer,fabric.util.invertTransform(this.viewportTransform));}
if(boundsWidth===0||boundsHeight===0){cssScale={width:1,height:1};}
else{cssScale={width:upperCanvasEl.width/boundsWidth,height:upperCanvasEl.height/boundsHeight};}
return{x:pointer.x*cssScale.width,y:pointer.y*cssScale.height};},_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,'');this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,'upper-canvas '+lowerCanvasClass);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext('2d');},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute('width',this.width);this.cacheCanvasEl.setAttribute('height',this.height);this.contextCache=this.cacheCanvasEl.getContext('2d');},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,'div',{'class':this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+'px',height:this.getHeight()+'px',position:'relative'});fabric.util.makeElementUnselectable(this.wrapperEl);},_applyCanvasStyle:function(element){var width=this.getWidth()||element.width,height=this.getHeight()||element.height;fabric.util.setStyle(element,{position:'absolute',width:width+'px',height:height+'px',left:0,top:0});element.width=width;element.height=height;fabric.util.makeElementUnselectable(element);},_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText;},getSelectionContext:function(){return this.contextTop;},getSelectionElement:function(){return this.upperCanvasEl;},_setActiveObject:function(object){if(this._activeObject){this._activeObject.set('active',false);}
this._activeObject=object;object.set('active',true);},setActiveObject:function(object,e){this._setActiveObject(object);this.renderAll();this.fire('object:selected',{target:object,e:e});object.fire('selected',{e:e});return this;},getActiveObject:function(){return this._activeObject;},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set('active',false);}
this._activeObject=null;},discardActiveObject:function(e){this._discardActiveObject();this.renderAll();this.fire('selection:cleared',{e:e});return this;},_setActiveGroup:function(group){this._activeGroup=group;if(group){group.set('active',true);}},setActiveGroup:function(group,e){this._setActiveGroup(group);if(group){this.fire('object:selected',{target:group,e:e});group.fire('selected',{e:e});}
return this;},setObjectsAsActiveGroup:function(objects,e){this.deactivateAll();this._groupObjects(e,objects);this._setCoordsOfActiveGroup();},getActiveGroup:function(){return this._activeGroup;},_discardActiveGroup:function(){var g=this.getActiveGroup();if(g){g.destroy();}
this.setActiveGroup(null);},discardActiveGroup:function(e){this.fire('before:selection:cleared',{target:e});this._discardActiveGroup();this.fire('selection:cleared',{e:e});return this;},deactivateAll:function(){var allObjects=this.getObjects(),i=0,len=allObjects.length;for(;i<len;i++){allObjects[i].set('active',false);}
this._discardActiveGroup();this._discardActiveObject();return this;},deactivateAllWithDispatch:function(e){var activeObject=this.getActiveGroup()||this.getActiveObject();if(activeObject){this.fire('before:selection:cleared',{target:activeObject,e:e});}
this.deactivateAll();if(activeObject){this.fire('selection:cleared',{e:e});}
return this;},drawControls:function(ctx){var activeGroup=this.getActiveGroup();if(activeGroup){this._drawGroupControls(ctx,activeGroup);}
else{this._drawObjectsControls(ctx);}},_drawGroupControls:function(ctx,activeGroup){activeGroup._renderControls(ctx);},_drawObjectsControls:function(ctx){for(var i=0,len=this._objects.length;i<len;++i){if(!this._objects[i]||!this._objects[i].active){continue;}
this._objects[i]._renderControls(ctx);this.lastRenderedObjectWithControlsAboveOverlay=this._objects[i];}}});for(var prop in fabric.StaticCanvas){if(prop!=='prototype'){fabric.Canvas[prop]=fabric.StaticCanvas[prop];}}
if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){};}
fabric.Element=fabric.Canvas;})();(function(){var cursorOffset={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},addListener=fabric.util.addListener,removeListener=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:['n-resize','ne-resize','e-resize','se-resize','s-resize','sw-resize','w-resize','nw-resize'],_initEventListeners:function(){this._bindEvents();addListener(fabric.window,'resize',this._onResize);addListener(this.upperCanvasEl,'mousedown',this._onMouseDown);addListener(this.upperCanvasEl,'mousemove',this._onMouseMove);addListener(this.upperCanvasEl,'mousewheel',this._onMouseWheel);addListener(this.upperCanvasEl,'touchstart',this._onMouseDown);addListener(this.upperCanvasEl,'touchmove',this._onMouseMove);if(typeof eventjs!=='undefined'&&'add'in eventjs){eventjs.add(this.upperCanvasEl,'gesture',this._onGesture);eventjs.add(this.upperCanvasEl,'drag',this._onDrag);eventjs.add(this.upperCanvasEl,'orientation',this._onOrientationChange);eventjs.add(this.upperCanvasEl,'shake',this._onShake);eventjs.add(this.upperCanvasEl,'longpress',this._onLongPress);eventjs.add(this.upperCanvasEl,'dbltap',this._onDoubleTap);}},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onDoubleTap=this._onDoubleTap.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);},removeListeners:function(){removeListener(fabric.window,'resize',this._onResize);removeListener(this.upperCanvasEl,'mousedown',this._onMouseDown);removeListener(this.upperCanvasEl,'mousemove',this._onMouseMove);removeListener(this.upperCanvasEl,'mousewheel',this._onMouseWheel);removeListener(this.upperCanvasEl,'touchstart',this._onMouseDown);removeListener(this.upperCanvasEl,'touchmove',this._onMouseMove);if(typeof eventjs!=='undefined'&&'remove'in eventjs){eventjs.remove(this.upperCanvasEl,'gesture',this._onGesture);eventjs.remove(this.upperCanvasEl,'drag',this._onDrag);eventjs.remove(this.upperCanvasEl,'orientation',this._onOrientationChange);eventjs.remove(this.upperCanvasEl,'shake',this._onShake);eventjs.remove(this.upperCanvasEl,'longpress',this._onLongPress);eventjs.remove(this.upperCanvasEl,'dbltap',this._onDoubleTap);}},_onGesture:function(e,self){this.__onTransformGesture&&this.__onTransformGesture(e,self);},_onDrag:function(e,self){this.__onDrag&&this.__onDrag(e,self);},_onMouseWheel:function(e,self){this.__onMouseWheel&&this.__onMouseWheel(e,self);},_onOrientationChange:function(e,self){this.__onOrientationChange&&this.__onOrientationChange(e,self);},_onShake:function(e,self){this.__onShake&&this.__onShake(e,self);},_onLongPress:function(e,self){this.__onLongPress&&this.__onLongPress(e,self);},_onDoubleTap:function(e,self){this.__onDoubleTap&&this.__onDoubleTap(e,self);},_onMouseDown:function(e){this.__onMouseDown(e);addListener(fabric.document,'touchend',this._onMouseUp);addListener(fabric.document,'touchmove',this._onMouseMove);removeListener(this.upperCanvasEl,'mousemove',this._onMouseMove);removeListener(this.upperCanvasEl,'touchmove',this._onMouseMove);if(e.type==='touchstart'){removeListener(this.upperCanvasEl,'mousedown',this._onMouseDown);}
else{addListener(fabric.document,'mouseup',this._onMouseUp);addListener(fabric.document,'mousemove',this._onMouseMove);}},_onMouseUp:function(e){this.__onMouseUp(e);removeListener(fabric.document,'mouseup',this._onMouseUp);removeListener(fabric.document,'touchend',this._onMouseUp);removeListener(fabric.document,'mousemove',this._onMouseMove);removeListener(fabric.document,'touchmove',this._onMouseMove);addListener(this.upperCanvasEl,'mousemove',this._onMouseMove);addListener(this.upperCanvasEl,'touchmove',this._onMouseMove);if(e.type==='touchend'){var _this=this;setTimeout(function(){addListener(_this.upperCanvasEl,'mousedown',_this._onMouseDown);},400);}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault();this.__onMouseMove(e);},_onResize:function(){this.calcOffset();},_shouldRender:function(target,pointer){var activeObject=this.getActiveGroup()||this.getActiveObject();return!!((target&&(target.isMoving||target!==activeObject))||(!target&&!!activeObject)||(!target&&!activeObject&&!this._groupSelector)||(pointer&&this._previousPointer&&this.selection&&(pointer.x!==this._previousPointer.x||pointer.y!==this._previousPointer.y)));},__onMouseUp:function(e){var target;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return;}
if(this._currentTransform){this._finalizeCurrentTransform();target=this._currentTransform.target;}
else{target=this.findTarget(e,true);}
var shouldRender=this._shouldRender(target,this.getPointer(e));this._maybeGroupObjects(e);if(target){target.isMoving=false;}
shouldRender&&this.renderAll();this._handleCursorAndEvent(e,target);},_handleCursorAndEvent:function(e,target){this._setCursorFromEvent(e,target);var _this=this;setTimeout(function(){_this._setCursorFromEvent(e,target);},50);this.fire('mouse:up',{target:target,e:e});target&&target.fire('mouseup',{e:e});},_finalizeCurrentTransform:function(){var transform=this._currentTransform,target=transform.target;if(target._scaling){target._scaling=false;}
target.setCoords();this._restoreOriginXY(target);if(this.stateful&&target.hasStateChanged()){if(transform.corner=='pmwBtnMr'||transform.corner=='pmwBtnMl'){target.fire('widthModified');}
else{this.fire('object:modified',{target:target});target.fire('modified');}}},_restoreOriginXY:function(target){if(this._previousOriginX&&this._previousOriginY){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX;target.originY=this._previousOriginY;target.left=originPoint.x;target.top=originPoint.y;this._previousOriginX=null;this._previousOriginY=null;}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=true;this.discardActiveObject(e).renderAll();if(this.clipTo){fabric.util.clipContext(this,this.contextTop);}
var ivt=fabric.util.invertTransform(this.viewportTransform),pointer=fabric.util.transformPoint(this.getPointer(e,true),ivt);this.freeDrawingBrush.onMouseDown(pointer);this.fire('mouse:down',{e:e});var target=this.findTarget(e);if(typeof target!=='undefined'){target.fire('mousedown',{e:e,target:target});}},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var ivt=fabric.util.invertTransform(this.viewportTransform),pointer=fabric.util.transformPoint(this.getPointer(e,true),ivt);this.freeDrawingBrush.onMouseMove(pointer);}
this.setCursor(this.freeDrawingCursor);this.fire('mouse:move',{e:e});var target=this.findTarget(e);if(typeof target!=='undefined'){target.fire('mousemove',{e:e,target:target});}},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=false;if(this.clipTo){this.contextTop.restore();}
this.freeDrawingBrush.onMouseUp();this.fire('mouse:up',{e:e});var target=this.findTarget(e);if(typeof target!=='undefined'){target.fire('mouseup',{e:e,target:target});}},__onMouseDown:function(e){var isLeftClick='which'in e?e.which===1:e.button===0;if(!isLeftClick&&!fabric.isTouchSupported){return;}
if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return;}
if(this._currentTransform){return;}
var target=this.findTarget(e),pointer=this.getPointer(e,true);this._previousPointer=pointer;var shouldRender=this._shouldRender(target,pointer),shouldGroup=this._shouldGroup(e,target);if(this._shouldClearSelection(e,target)){this._clearSelection(e,target,pointer);}
else if(shouldGroup){this._handleGrouping(e,target);target=this.getActiveGroup();}
if(target&&target.selectable&&(target.__corner||!shouldGroup)){this._beforeTransform(e,target);this._setupCurrentTransform(e,target);}
shouldRender&&this.renderAll();this.fire('mouse:down',{target:target,e:e});target&&target.fire('mousedown',{e:e});},_beforeTransform:function(e,target){this.stateful&&target.saveState();var c=target._findTargetCorner(this.getPointer(e,true));if(c){this.onBeforeScaleRotate(target);}
if(c==='btn'){target.fire('btn:clicked',{target:target,e:e});}
if(target!==this.getActiveGroup()&&target!==this.getActiveObject()){this.deactivateAll();this.setActiveObject(target,e);}},_clearSelection:function(e,target,pointer){this.deactivateAllWithDispatch(e);if(target&&target.selectable){this.setActiveObject(target,e);}
else if(this.selection){this._groupSelector={ex:pointer.x,ey:pointer.y,top:0,left:0};}},_setOriginToCenter:function(target){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var center=target.getCenterPoint();target.originX='center';target.originY='center';target.left=center.x;target.top=center.y;this._currentTransform.left=target.left;this._currentTransform.top=target.top;},_setCenterToOrigin:function(target){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX;target.originY=this._previousOriginY;target.left=originPoint.x;target.top=originPoint.y;this._previousOriginX=null;this._previousOriginY=null;},__onMouseMove:function(e){var target,pointer;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return;}
if(typeof e.touches!=='undefined'&&e.touches.length>1){return;}
var groupSelector=this._groupSelector;if(groupSelector){pointer=this.getPointer(e,true);groupSelector.left=pointer.x-groupSelector.ex;groupSelector.top=pointer.y-groupSelector.ey;this.renderTop();}
else if(!this._currentTransform){target=this.findTarget(e);if(!target||target&&!target.selectable){this.setCursor(this.defaultCursor);}
else{this._setCursorFromEvent(e,target);}}
else{this._transformObject(e);}
this.fire('mouse:move',{target:target,e:e});target&&target.fire('mousemove',{e:e});},_transformObject:function(e){var pointer=this.getPointer(e),transform=this._currentTransform;transform.reset=false,transform.target.isMoving=true;this._beforeScaleTransform(e,transform);this._performTransformAction(e,transform,pointer);this.renderAll();transform.target._renderTransformDetail(transform);},_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,target=transform.target,action=transform.action;if(action==='rotate'){this._rotateObject(x,y);this._fire('rotating',target,e);}
else if(action==='scale'&&transform.corner==='pmwBtnMr'){this._fire('pmwBtnMr:modifyingWidth',target,e);}
else if(action==='scale'&&transform.corner==='pmwBtnMl'){this._fire('pmwBtnMl:modifyingWidth',target,e);}
else if(action==='scale'){this._onScale(e,transform,x,y);this._fire('scaling',target,e);}
else if(action==='scaleX'){this._scaleObject(x,y,'x');this._fire('scaling',target,e);}
else if(action==='scaleY'){this._scaleObject(x,y,'y');this._fire('scaling',target,e);}
else if(action==='skewX'){this._skewObject(x,y,'x');this._fire('skewing',target,e);}
else if(action==='skewY'){this._skewObject(x,y,'y');this._fire('skewing',target,e);}
else{this._translateObject(x,y);this._fire('moving',target,e);this.setCursor(this.moveCursor);}},_fire:function(eventName,target,e){this.fire('object:'+eventName,{target:target,e:e});target.fire(eventName,{e:e});},_beforeScaleTransform:function(e,transform){if(transform.action==='scale'||transform.action==='scaleX'||transform.action==='scaleY'){var centerTransform=this._shouldCenterTransform(transform.target);if((centerTransform&&(transform.originX!=='center'||transform.originY!=='center'))||(!centerTransform&&transform.originX==='center'&&transform.originY==='center')){this._resetCurrentTransform();transform.reset=true;}}},_onScale:function(e,transform,x,y){if((e.shiftKey||this.uniScaleTransform)&&!transform.target.get('lockUniScaling')){transform.currentAction='scale';this._scaleObject(x,y);}
else{if(!transform.reset&&transform.currentAction==='scale'){this._resetCurrentTransform();}
transform.currentAction='scaleEqually';this._scaleObject(x,y,'equally');}},_setCursorFromEvent:function(e,target){if(!target||!target.selectable){this.setCursor(this.defaultCursor);return false;}
else{var activeGroup=this.getActiveGroup(),corner=target._findTargetCorner&&(!activeGroup||!activeGroup.contains(target))&&target._findTargetCorner(this.getPointer(e,true));if(!corner){this.setCursor(target.hoverCursor||this.hoverCursor);}
else{this._setCornerCursor(corner,target,e);}}
return true;},_setCornerCursor:function(corner,target,e){if(corner in cursorOffset){this.setCursor(this._getRotatedCornerCursor(corner,target,e));}
else if(corner==='mtr'&&target.hasRotatingPoint){this.setCursor(this.rotationCursor);}
else if(corner==='btn'){this.setCursor('pointer');}
else if(corner==='pmwBtnMr'){this.setCursor('e-resize');}
else if(corner==='pmwBtnMl'){this.setCursor('w-resize');}
else{this.setCursor(this.defaultCursor);return false;}},_getRotatedCornerCursor:function(corner,target,e){var n=Math.round((target.getAngle()%360)/45);if(n<0){n+=8;}
n+=cursorOffset[corner];if(e.shiftKey&&cursorOffset[corner]%2===0){n+=2;}
n%=8;return this.cursorMap[n];}});})();(function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,target){var activeObject=this.getActiveObject();return e.shiftKey&&target&&target.selectable&&(this.getActiveGroup()||(activeObject&&activeObject!==target))&&this.selection;},_handleGrouping:function(e,target){if(target===this.getActiveGroup()){target=this.findTarget(e,true);if(!target||target.isType('group')){return;}}
if(this.getActiveGroup()){this._updateActiveGroup(target,e);}
else{this._createActiveGroup(target,e);}
if(this._activeGroup){this._activeGroup.saveCoords();}},_updateActiveGroup:function(target,e){var activeGroup=this.getActiveGroup();if(activeGroup.contains(target)){activeGroup.removeWithUpdate(target);this._resetObjectTransform(activeGroup);target.set('active',false);if(activeGroup.size()===1){this.discardActiveGroup(e);this.setActiveObject(activeGroup.item(0));return;}}
else{activeGroup.addWithUpdate(target);this._resetObjectTransform(activeGroup);}
this.fire('selection:created',{target:activeGroup,e:e});activeGroup.set('active',true);},_createActiveGroup:function(target,e){if(this._activeObject&&target!==this._activeObject){var group=this._createGroup(target);group.addWithUpdate();this.setActiveGroup(group);this._activeObject=null;this.fire('selection:created',{target:group,e:e});}
target.set('active',true);},_createGroup:function(target){var objects=this.getObjects(),isActiveLower=objects.indexOf(this._activeObject)<objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];return new fabric.Group(groupObjects,{canvas:this});},_groupObjects:function(e,objects){if(objects.length===1){this.setActiveObject(objects[0],e);}
else if(objects.length>1){var group=new fabric.Group(objects.reverse(),{canvas:this});group.addWithUpdate();this.setActiveGroup(group,e);group.saveCoords();this.fire('selection:created',{target:group});this.renderAll();}},_collectObjects:function(){var group=[],currentObject,x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),isClick=x1===x2&&y1===y2;for(var i=this._objects.length;i--;){currentObject=this._objects[i];if(!currentObject||!currentObject.selectable||!currentObject.visible){continue;}
if((currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2)||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2)||currentObject.containsPoint(selectionX1Y1)||currentObject.containsPoint(selectionX2Y2))&&!(currentObject.lockMovementX&&currentObject.lockMovementY&&currentObject.lockScalingX&&currentObject.lockScalingY&&currentObject.lockRotation)){currentObject.set('active',true);group.push(currentObject);if(isClick){break;}}}
return group;},_setCoordsOfActiveGroup:function(){var activeGroup=this.getActiveGroup();if(activeGroup){activeGroup.setObjectsCoords().setCoords();activeGroup.isMoving=false;this.setCursor(this.defaultCursor);}
this._groupSelector=null;this._currentTransform=null;},_maybeGroupObjects:function(e){if(this.selection&&this._groupSelector){var objects=this._collectObjects();this._groupObjects(e,objects);}
this._setCoordsOfActiveGroup();}});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(options){options||(options={});var format=options.format||'png',quality=options.quality||1,multiplier=options.multiplier||1,clear=options.clear||false,cropping={left:options.left,top:options.top,width:options.width,height:options.height};if(multiplier!==1){return this.__toDataURLWithMultiplier(format,quality,cropping,multiplier,clear,options.scaleShadow);}
else{return this.__toDataURL(format,quality,cropping);}},__toDataURL:function(format,quality,cropping){this.renderAll();var canvasEl=this.lowerCanvasEl,croppedCanvasEl=this.__getCroppedCanvas(canvasEl,cropping);if(format==='jpg'){format='jpeg';}
var data=(fabric.StaticCanvas.supports('toDataURLWithQuality'))?(croppedCanvasEl||canvasEl).toDataURL('image/'+format,quality):(croppedCanvasEl||canvasEl).toDataURL('image/'+format);if(croppedCanvasEl){croppedCanvasEl=null;}
return data;},__getCroppedCanvas:function(canvasEl,cropping){var croppedCanvasEl,croppedCtx,shouldCrop='left'in cropping||'top'in cropping||'width'in cropping||'height'in cropping;if(shouldCrop){croppedCanvasEl=fabric.util.createCanvasElement();croppedCtx=croppedCanvasEl.getContext('2d');croppedCanvasEl.width=cropping.width||this.width;croppedCanvasEl.height=cropping.height||this.height;croppedCtx.drawImage(canvasEl,-cropping.left||0,-cropping.top||0);}
return croppedCanvasEl;},__toDataURLWithMultiplier:function(format,quality,cropping,multiplier,clear,scaleShadow){var origWidth=this.getWidth(),origHeight=this.getHeight(),scaledWidth=origWidth*multiplier,scaledHeight=origHeight*multiplier,activeObject=this.getActiveObject(),activeGroup=this.getActiveGroup(),ctx=this.contextContainer;if(multiplier>1){this.setWidth(scaledWidth).setHeight(scaledHeight);}
if(clear){ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,scaledWidth,scaledHeight);ctx.restore();}
if(scaleShadow){ctx.__multiplier=multiplier;}
ctx.scale(multiplier,multiplier);if(cropping.left){cropping.left*=multiplier;}
if(cropping.top){cropping.top*=multiplier;}
if(cropping.width){cropping.width*=multiplier;}
else if(multiplier<1){cropping.width=scaledWidth;}
if(cropping.height){cropping.height*=multiplier;}
else if(multiplier<1){cropping.height=scaledHeight;}
if(activeGroup){this._tempRemoveBordersControlsFromGroup(activeGroup);}
else if(activeObject&&this.deactivateAll){this.deactivateAll();}
var data=this.__toDataURL(format,quality,cropping);this.width=origWidth;this.height=origHeight;if(scaleShadow){ctx.__multiplier=null;}
ctx.scale(1/multiplier,1/multiplier);this.setWidth(origWidth).setHeight(origHeight);if(activeGroup){this._restoreBordersControlsOnGroup(activeGroup);}
else if(activeObject&&this.setActiveObject){this.setActiveObject(activeObject);}
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return data;},toDataURLWithMultiplier:function(format,multiplier,quality){return this.toDataURL({format:format,multiplier:multiplier,quality:quality});},_tempRemoveBordersControlsFromGroup:function(group){group.origHasControls=group.hasControls;group.origBorderColor=group.borderColor;group.hasControls=false;group.borderColor='rgba(0,0,0,0)';group.forEachObject(function(o){o.origBorderColor=o.borderColor;o.borderColor='rgba(0,0,0,0)';});},_restoreBordersControlsOnGroup:function(group){group.hideControls=group.origHideControls;group.borderColor=group.origBorderColor;group.hasControls=true;group.forEachObject(function(o){o.borderColor=o.origBorderColor;delete o.origBorderColor;});}});(function(){var degreesToRadians=fabric.util.degreesToRadians,radiansToDegrees=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(e,self){},__gesturesParams:null,__gesturesRenderer:function(){if(this.__gesturesParams===null||this._currentTransform===null){return;}
var self=this.__gesturesParams.self,t=this._currentTransform,e=this.__gesturesParams.e;t.action='scale';t.originX=t.originY='center';this._setOriginToCenter(t.target);this._scaleObjectBy(self.scale,e);if(self.rotation!==0){t.action='rotate';this._rotateObjectByAngle(self.rotation,e);}
this._setCenterToOrigin(t.target);this.renderAll();t.action='drag';},__onDrag:function(e,self){this.fire('touch:drag',{e:e,self:self});},__onOrientationChange:function(e,self){this.fire('touch:orientation',{e:e,self:self});},__onShake:function(e,self){this.fire('touch:shake',{e:e,self:self});},__onLongPress:function(e,self){this.fire('touch:longpress',{e:e,self:self});},__onDoubleTap:function(e,self){this.fire('touch:dbltap',{e:e,self:self});},_scaleObjectBy:function(s,e){var t=this._currentTransform,target=t.target,lockScalingX=target.get('lockScalingX'),lockScalingY=target.get('lockScalingY');if(lockScalingX&&lockScalingY){return;}
target._scaling=true;var constraintPosition=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY),dim=target._getNonTransformedDimensions();this._setObjectScale(new fabric.Point(t.scaleX*s*dim.x,t.scaleY*s*dim.y),t,lockScalingX,lockScalingY,null,target.get('lockScalingFlip'));target.setPositionByOrigin(constraintPosition,t.originX,t.originY);this._fire('scaling',target,e);},_rotateObjectByAngle:function(curAngle,e){var t=this._currentTransform;if(t.target.get('lockRotation')){return;}
t.target.angle=radiansToDegrees(degreesToRadians(curAngle)+t.theta);this._fire('rotating',t.target,e);}});})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,supportsLineDash=fabric.StaticCanvas.supports('setLineDash');if(fabric.Object){return;}
fabric.Object=fabric.util.createClass({type:'object',originX:'left',originY:'top',top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:22,transformDetailOffset:30,showTransformDetails:true,transparentCorners:false,hoverCursor:null,padding:11,borderColor:'rgba(63,188,231,1)',cornerColor:'rgba(255,255,255,1)',hasButton:false,hasMiddleButtons:false,buttonWidth:92,buttonText:'replace image',centeredScaling:false,centeredRotation:true,fill:'rgb(0,0,0)',fillRule:'nonzero',globalCompositeOperation:'source-over',backgroundColor:'',stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:'butt',strokeLineJoin:'miter',strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:1,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:true,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:true,stateProperties:('top left width height scaleX scaleY flipX flipY originX originY transformMatrix '+'stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit '+'angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor '+'alignX alignY meetOrSlice skewX skewY').split(' '),initialize:function(options){if(options){this.setOptions(options);}},_initGradient:function(options){if(options.fill&&options.fill.colorStops&&!(options.fill instanceof fabric.Gradient)){this.set('fill',new fabric.Gradient(options.fill));}
if(options.stroke&&options.stroke.colorStops&&!(options.stroke instanceof fabric.Gradient)){this.set('stroke',new fabric.Gradient(options.stroke));}},_initPattern:function(options){if(options.fill&&options.fill.source&&!(options.fill instanceof fabric.Pattern)){this.set('fill',new fabric.Pattern(options.fill));}
if(options.stroke&&options.stroke.source&&!(options.stroke instanceof fabric.Pattern)){this.set('stroke',new fabric.Pattern(options.stroke));}},_initClipping:function(options){if(!options.clipTo||typeof options.clipTo!=='string'){return;}
var functionBody=fabric.util.getFunctionBody(options.clipTo);if(typeof functionBody!=='undefined'){this.clipTo=new Function('ctx',functionBody);}},setOptions:function(options){for(var prop in options){this.set(prop,options[prop]);}
this._initGradient(options);this._initPattern(options);this._initClipping(options);},transform:function(ctx,fromLeft){if(this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup){this.group.transform(ctx);}
var center=fromLeft?this._getLeftTopCoords():this.getCenterPoint();ctx.translate(center.x,center.y);ctx.rotate(degreesToRadians(this.angle));ctx.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));ctx.transform(1,0,Math.tan(degreesToRadians(this.skewX)),1,0,0);ctx.transform(1,Math.tan(degreesToRadians(this.skewY)),0,1,0,0);},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.getAngle(),NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:toFixed(this.skewX,NUM_FRACTION_DIGITS),skewY:toFixed(this.skewY,NUM_FRACTION_DIGITS)};if(!this.includeDefaultValues){object=this._removeDefaultValues(object);}
fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},toDatalessObject:function(propertiesToInclude){return this.toObject(propertiesToInclude);},_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;stateProperties.forEach(function(prop){if(object[prop]===prototype[prop]){delete object[prop];}
var isArray=Object.prototype.toString.call(object[prop])==='[object Array]'&&Object.prototype.toString.call(prototype[prop])==='[object Array]';if(isArray&&object[prop].length===0&&prototype[prop].length===0){delete object[prop];}});return object;},toString:function(){return'#<fabric.'+capitalize(this.type)+'>';},get:function(property){return this[property];},_setObject:function(obj){for(var prop in obj){this._set(prop,obj[prop]);}},set:function(key,value){if(typeof key==='object'){this._setObject(key);}
else{if(typeof value==='function'&&key!=='clipTo'){this._set(key,value(this.get(key)));}
else{this._set(key,value);}}
return this;},_set:function(key,value){var shouldConstrainValue=(key==='scaleX'||key==='scaleY');if(shouldConstrainValue){value=this._constrainScale(value);}
if(key==='scaleX'&&value<0){this.flipX=!this.flipX;value*=-1;}
else if(key==='scaleY'&&value<0){this.flipY=!this.flipY;value*=-1;}
else if(key==='width'||key==='height'){this.minScaleLimit=toFixed(Math.min(0.1,1/Math.max(this.width,this.height)),2);}
else if(key==='shadow'&&value&&!(value instanceof fabric.Shadow)){value=new fabric.Shadow(value);}
this[key]=value;return this;},setOnGroup:function(){},toggle:function(property){var value=this.get(property);if(typeof value==='boolean'){this.set(property,!value);}
return this;},setSourcePath:function(value){this.sourcePath=value;return this;},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform;}
return[1,0,0,1,0,0];},render:function(ctx,noTransform){if((this.width===0&&this.height===0)||!this.visible){return;}
ctx.save();this._setupCompositeOperation(ctx);if(!noTransform){this.transform(ctx);}
if(this.type!=='path'){this._setStrokeStyles(ctx);}
this._setFillStyles(ctx);if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix);}
this._setOpacity(ctx);this._setShadow(ctx);this.clipTo&&fabric.util.clipContext(this,ctx);this._render(ctx,noTransform);this.clipTo&&ctx.restore();ctx.restore();},_setOpacity:function(ctx){if(this.group){this.group._setOpacity(ctx);}
ctx.globalAlpha*=this.opacity;},_setStrokeStyles:function(ctx){if(this.stroke){ctx.lineWidth=this.strokeWidth;ctx.lineCap=this.strokeLineCap;ctx.lineJoin=this.strokeLineJoin;ctx.miterLimit=this.strokeMiterLimit;ctx.strokeStyle=this.stroke.toLive?this.stroke.toLive(ctx,this):this.stroke;}},_setFillStyles:function(ctx){if(this.fill){ctx.fillStyle=this.fill.toLive?this.fill.toLive(ctx,this):this.fill;}},_renderControls:function(ctx,noTransform){if(!this.active||noTransform){return;}
var vpt=this.getViewportTransform();ctx.save();var center;if(this.group){center=fabric.util.transformPoint(this.group.getCenterPoint(),vpt);ctx.translate(center.x,center.y);ctx.rotate(degreesToRadians(this.group.angle));}
center=fabric.util.transformPoint(this.getCenterPoint(),vpt,null!=this.group);if(this.group){center.x*=this.group.scaleX;center.y*=this.group.scaleY;}
ctx.translate(center.x,center.y);ctx.rotate(degreesToRadians(this.angle));this.drawBorders(ctx);this.drawControls(ctx);ctx.restore();},_renderTransformDetail:function(transform){if(!this.showTransformDetails){return;}
this.setCoords();var text=this._getTextForTransform(transform.action),ctx=this.canvas.contextContainer;ctx.font="10px Arial";var textWidth=ctx.measureText(text).width,coords=this._getCoordinatesToRenderTransformDetail(transform.corner,textWidth),padding=1.5,textHeight=8;ctx.save();ctx.fillStyle='#ffffff';ctx.globalAlpha=0.3;ctx.fillRect(coords.x-padding,coords.y-textHeight-padding,textWidth+2*padding,textHeight+2*padding+1);ctx.restore();ctx.save();ctx.fillStyle="#000000";ctx.fillText(text,Math.round(coords.x),Math.round(coords.y));ctx.restore();},_getTextForTransform:function(action){var text='';switch(action){case'drag':var x,y,angle=this.angle,corners=this.getCornerPoints(this.getCenterPoint());if(angle>45&&angle<135){x=corners.bl.x;y=corners.bl.y}
else if(angle>135&&angle<225){x=corners.br.x;y=corners.br.y}
else if(angle>225&&angle<315){x=corners.tr.x;y=corners.tr.y}
else{x=corners.tl.x;y=corners.tl.y}
text=Math.round(x)+", "+Math.round(y);break;case'rotate':text=Math.round(this.angle)+"°";break;case'scaleX':case'scaleY':case'scale':text=Math.round(this.width*this.scaleX)+" x "+Math.round(this.height*this.scaleY);break;}
return text;},_getCoordinatesToRenderTransformDetail:function(corner,textWidth){var dx,dy,angle=this.angle,theta=fabric.util.degreesToRadians(angle),textWidthOffset=textWidth/2,textHeight=8,textHeightOffset=textHeight/2;switch(corner){case'tl':dx=(this.oCoords.tl.x)+(this.transformDetailOffset*Math.sin(theta-Math.PI/4));dy=(this.oCoords.tl.y)-(this.transformDetailOffset*Math.cos(theta-Math.PI/4));if(angle>=0&&angle<45||angle>225){dx-=textWidth;}
break;case'tr':dx=(this.oCoords.tr.x)+(this.transformDetailOffset*Math.sin(theta+Math.PI/4));dy=(this.oCoords.tr.y)-(this.transformDetailOffset*Math.cos(theta+Math.PI/4));if(angle>135&&angle<315){dx-=textWidth;}
break;case'bl':dx=(this.oCoords.bl.x)-(this.transformDetailOffset*Math.sin(theta+Math.PI/4));dy=(this.oCoords.bl.y)+(this.transformDetailOffset*Math.cos(theta+Math.PI/4));if(angle>=0&&angle<135||angle>315){dx-=textWidth;}
break;case'br':dx=(this.oCoords.br.x)+(this.transformDetailOffset*Math.cos(theta+Math.PI/4));dy=(this.oCoords.br.y)+(this.transformDetailOffset*Math.sin(theta+Math.PI/4));if(angle>45&&angle<225){dx-=textWidth;}
break;case'mt':dx=(this.oCoords.mtr.x)-textWidthOffset+((this.transformDetailOffset+textWidthOffset)*Math.sin(theta));dy=(this.oCoords.mtr.y)+textHeightOffset-(this.transformDetailOffset*Math.cos(theta));break;case'mr':dx=(this.oCoords.mr.x)-textWidthOffset+((this.transformDetailOffset+textWidthOffset)*Math.cos(theta));dy=(this.oCoords.mr.y)+textHeightOffset+(this.transformDetailOffset*Math.sin(theta));break;case'mb':dx=(this.oCoords.mb.x)-textWidthOffset-((this.transformDetailOffset+textWidthOffset)*Math.sin(theta));dy=(this.oCoords.mb.y)+textHeightOffset+(this.transformDetailOffset*Math.cos(theta));break;case'ml':dx=(this.oCoords.ml.x)-textWidthOffset-((this.transformDetailOffset+textWidthOffset)*Math.cos(theta));dy=(this.oCoords.ml.y)+textHeightOffset-(this.transformDetailOffset*Math.sin(theta));break;case'mtr':dx=(this.oCoords.mtr.x)-textWidthOffset+((this.transformDetailOffset+textWidthOffset)*Math.sin(theta));dy=(this.oCoords.mtr.y)+textHeightOffset-(this.transformDetailOffset*Math.cos(theta));break;default:if(angle>45&&angle<135){dx=(this.oCoords.bl.x)-(this.transformDetailOffset*Math.sin(theta+Math.PI/4))-textWidth;dy=(this.oCoords.bl.y)+(this.transformDetailOffset*Math.cos(theta+Math.PI/4));}
else if(angle>135&&angle<225){dx=(this.oCoords.br.x)+(this.transformDetailOffset*Math.cos(theta+Math.PI/4))-textWidth;dy=(this.oCoords.br.y)+(this.transformDetailOffset*Math.sin(theta+Math.PI/4));}
else if(angle>225&&angle<315){dx=(this.oCoords.tr.x)+(this.transformDetailOffset*Math.sin(theta+Math.PI/4))-textWidth;dy=(this.oCoords.tr.y)-(this.transformDetailOffset*Math.cos(theta+Math.PI/4));}
else{dx=(this.oCoords.tl.x)+(this.transformDetailOffset*Math.sin(theta-Math.PI/4))-textWidth;dy=(this.oCoords.tl.y)-(this.transformDetailOffset*Math.cos(theta-Math.PI/4));}}
var cw=this.canvas.width,ch=this.canvas.height,padding=3;if(dx<0){dx-=(dx-padding)}
else if(dx+textWidth>cw){dx-=(dx-cw+textWidth+padding)}
if((dy-textHeight)<0){dy-=(dy-textHeight-padding)}
else if(dy>ch){dy-=(dy-ch+padding)}
return new fabric.Point(dx,dy)},_setShadow:function(ctx){if(!this.shadow){return;}
var multX=(this.canvas&&this.canvas.viewportTransform[0])||1,multY=(this.canvas&&this.canvas.viewportTransform[3])||1;if(typeof ctx.__multiplier=='number'){multX*=ctx.__multiplier;multY*=ctx.__multiplier;}
ctx.shadowColor=this.shadow.color;ctx.shadowBlur=this.shadow.blur*(multX+multY)*(this.scaleX+this.scaleY)/4;ctx.shadowOffsetX=this.shadow.offsetX*multX*this.scaleX;ctx.shadowOffsetY=this.shadow.offsetY*multY*this.scaleY;},_removeShadow:function(ctx){if(!this.shadow){return;}
ctx.shadowColor='';ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;},_renderFill:function(ctx){if(!this.fill){return;}
ctx.save();if(this.fill.gradientTransform){var g=this.fill.gradientTransform;ctx.transform.apply(ctx,g);}
if(this.fill.toLive){ctx.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0);}
if(this.fillRule==='evenodd'){ctx.fill('evenodd');}
else{ctx.fill();}
ctx.restore();},_renderStroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}
if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}
ctx.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);}
if(supportsLineDash){ctx.setLineDash(this.strokeDashArray);this._stroke&&this._stroke(ctx);}
else{this._renderDashedStroke&&this._renderDashedStroke(ctx);}
ctx.stroke();}
else{if(this.stroke.gradientTransform){var g=this.stroke.gradientTransform;ctx.transform.apply(ctx,g);}
this._stroke?this._stroke(ctx):ctx.stroke();}
ctx.restore();},clone:function(callback,propertiesToInclude){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(propertiesToInclude),callback);}
return new fabric.Object(this.toObject(propertiesToInclude));},cloneAsImage:function(callback){var dataUrl=this.toDataURL();fabric.util.loadImage(dataUrl,function(img){if(callback){callback(new fabric.Image(img));}});return this;},toDataURL:function(options){options||(options={});var el=fabric.util.createCanvasElement(),boundingRect=this.getBoundingRect();el.width=boundingRect.width;el.height=boundingRect.height;fabric.util.wrapElement(el,'div');var canvas=new fabric.StaticCanvas(el);if(options.format==='jpg'){options.format='jpeg';}
if(options.format==='jpeg'){canvas.backgroundColor='#fff';}
var origParams={active:this.get('active'),left:this.getLeft(),top:this.getTop()};this.set('active',false);this.setPositionByOrigin(new fabric.Point(el.width/2,el.height/2),'center','center');var originalCanvas=this.canvas;canvas.add(this);var data=canvas.toDataURL(options);this.set(origParams).setCoords();this.canvas=originalCanvas;canvas.dispose();canvas=null;return data;},isType:function(type){return this.type===type;},complexity:function(){return 0;},toJSON:function(propertiesToInclude){return this.toObject(propertiesToInclude);},setGradient:function(property,options){options||(options={});var gradient={colorStops:[]};gradient.type=options.type||(options.r1||options.r2?'radial':'linear');gradient.coords={x1:options.x1,y1:options.y1,x2:options.x2,y2:options.y2};if(options.r1||options.r2){gradient.coords.r1=options.r1;gradient.coords.r2=options.r2;}
options.gradientTransform&&(gradient.gradientTransform=options.gradientTransform);for(var position in options.colorStops){var color=new fabric.Color(options.colorStops[position]);gradient.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()});}
return this.set(property,fabric.Gradient.forObject(this,gradient));},setPatternFill:function(options){return this.set('fill',new fabric.Pattern(options));},setShadow:function(options){return this.set('shadow',options?new fabric.Shadow(options):null);},setColor:function(color){this.set('fill',color);return this;},setAngle:function(angle){var shouldCenterOrigin=(this.originX!=='center'||this.originY!=='center')&&this.centeredRotation;if(shouldCenterOrigin){this._setOriginToCenter();}
this.set('angle',angle);if(shouldCenterOrigin){this._resetOrigin();}
return this;},centerH:function(){this.canvas.centerObjectH(this);return this;},centerV:function(){this.canvas.centerObjectV(this);return this;},center:function(){this.canvas.centerObject(this);return this;},remove:function(){this.canvas.remove(this);return this;},getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var pClicked=new fabric.Point(pointer.x,pointer.y),objectLeftTop=this._getLeftTopCoords();if(this.angle){pClicked=fabric.util.rotatePoint(pClicked,objectLeftTop,fabric.util.degreesToRadians(-this.angle));}
return{x:pClicked.x-objectLeftTop.x,y:pClicked.y-objectLeftTop.y};},getCornerPoints:function(center){var angle=this.angle,width=this.width*this.scaleX,height=this.height*this.scaleY,tl,tr,bl,br,x=center.x,y=center.y,theta=fabric.util.degreesToRadians(angle);if(width<0){width=Math.abs(width);}
var sinTh=Math.sin(theta),cosTh=Math.cos(theta),_angle=width>0?Math.atan(height/width):0,_hypotenuse=(width/Math.cos(_angle))/2,offsetX=Math.cos(_angle+theta)*_hypotenuse,offsetY=Math.sin(_angle+theta)*_hypotenuse;tl={x:x-offsetX,y:y-offsetY};tr={x:(x-offsetX)+(width*cosTh),y:(y-offsetY)+(width*sinTh)};br={x:x+offsetX,y:y+offsetY};bl={x:(x-offsetX)-(height*sinTh),y:(y-offsetY)+(height*cosTh)};return{tl:tl,tr:tr,bl:bl,br:br};},_setupCompositeOperation:function(ctx){if(this.globalCompositeOperation){ctx.globalCompositeOperation=this.globalCompositeOperation;}}});fabric.util.createAccessors(fabric.Object);fabric.Object.prototype.rotate=fabric.Object.prototype.setAngle;extend(fabric.Object.prototype,fabric.Observable);fabric.Object.NUM_FRACTION_DIGITS=2;fabric.Object.__uid=0;})(typeof exports!=='undefined'?exports:this);(function(){var degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-0.5,center:0,right:0.5},originYOffset={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(point,fromOriginX,fromOriginY,toOriginX,toOriginY){var x=point.x,y=point.y,offsetX=originXOffset[toOriginX]-originXOffset[fromOriginX],offsetY=originYOffset[toOriginY]-originYOffset[fromOriginY],dim;if(offsetX||offsetY){dim=this._getTransformedDimensions();x=point.x+offsetX*dim.x;y=point.y+offsetY*dim.y;}
return new fabric.Point(x,y);},translateToCenterPoint:function(point,originX,originY){var p=this.translateToGivenOrigin(point,originX,originY,'center','center');if(this.angle){return fabric.util.rotatePoint(p,point,degreesToRadians(this.angle));}
return p;},translateToOriginPoint:function(center,originX,originY){var p=this.translateToGivenOrigin(center,'center','center',originX,originY);if(this.angle){return fabric.util.rotatePoint(p,center,degreesToRadians(this.angle));}
return p;},getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY);},getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY);},toLocalPoint:function(point,originX,originY){var center=this.getCenterPoint(),p,p2;if(originX&&originY){p=this.translateToGivenOrigin(center,'center','center',originX,originY);}
else{p=new fabric.Point(this.left,this.top);}
p2=new fabric.Point(point.x,point.y);if(this.angle){p2=fabric.util.rotatePoint(p2,center,-degreesToRadians(this.angle));}
return p2.subtractEquals(p);},setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set('left',position.x);this.set('top',position.y);},adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotFull=this.getWidth(),xFull=Math.cos(angle)*hypotFull,yFull=Math.sin(angle)*hypotFull;this.left+=xFull*(originXOffset[to]-originXOffset[this.originX]);this.top+=yFull*(originXOffset[to]-originXOffset[this.originX]);this.setCoords();this.originX=to;},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var center=this.getCenterPoint();this.originX='center';this.originY='center';this.left=center.x;this.top=center.y;},_resetOrigin:function(){var originPoint=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=originPoint.x;this.top=originPoint.y;this._originalOriginX=null;this._originalOriginY=null;},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),'left','top');}});})();(function(){function getCoords(oCoords){return[new fabric.Point(oCoords.tl.x,oCoords.tl.y),new fabric.Point(oCoords.tr.x,oCoords.tr.y),new fabric.Point(oCoords.br.x,oCoords.br.y),new fabric.Point(oCoords.bl.x,oCoords.bl.y)];}
var degreesToRadians=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(pointTL,pointBR){var oCoords=getCoords(this.oCoords),intersection=fabric.Intersection.intersectPolygonRectangle(oCoords,pointTL,pointBR);return intersection.status==='Intersection';},intersectsWithObject:function(other){var intersection=fabric.Intersection.intersectPolygonPolygon(getCoords(this.oCoords),getCoords(other.oCoords));return intersection.status==='Intersection';},isContainedWithinObject:function(other){var boundingRect=other.getBoundingRect(),point1=new fabric.Point(boundingRect.left,boundingRect.top),point2=new fabric.Point(boundingRect.left+boundingRect.width,boundingRect.top+boundingRect.height);return this.isContainedWithinRect(point1,point2);},isContainedWithinRect:function(pointTL,pointBR){var boundingRect=this.getBoundingRect();return(boundingRect.left>=pointTL.x&&boundingRect.left+boundingRect.width<=pointBR.x&&boundingRect.top>=pointTL.y&&boundingRect.top+boundingRect.height<=pointBR.y);},containsPoint:function(point){var lines=this._getImageLines(this.oCoords),xPoints=this._findCrossPoints(point,lines);return(xPoints!==0&&xPoints%2===1);},_getImageLines:function(oCoords){return{topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}};},_findCrossPoints:function(point,oCoords){var b1,b2,a1,a2,xi,yi,xcount=0,iLine;for(var lineKey in oCoords){iLine=oCoords[lineKey];if((iLine.o.y<point.y)&&(iLine.d.y<point.y)){continue;}
if((iLine.o.y>=point.y)&&(iLine.d.y>=point.y)){continue;}
if((iLine.o.x===iLine.d.x)&&(iLine.o.x>=point.x)){xi=iLine.o.x;yi=point.y;}
else{b1=0;b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x);a1=point.y-b1*point.x;a2=iLine.o.y-b2*iLine.o.x;xi=-(a1-a2)/(b1-b2);yi=a1+b1*xi;}
if(xi>=point.x){xcount+=1;}
if(xcount===2){break;}}
return xcount;},getBoundingRectWidth:function(){return this.getBoundingRect().width;},getBoundingRectHeight:function(){return this.getBoundingRect().height;},getBoundingRect:function(){this.oCoords||this.setCoords();return fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl]);},getWidth:function(){return this._getTransformedDimensions().x;},getHeight:function(){return this._getTransformedDimensions().y;},_constrainScale:function(value){if(Math.abs(value)<this.minScaleLimit){if(value<0){return-this.minScaleLimit;}
else{return this.minScaleLimit;}}
return value;},scale:function(value){value=this._constrainScale(value);if(value<0){this.flipX=!this.flipX;this.flipY=!this.flipY;value*=-1;}
this.scaleX=value;this.scaleY=value;this.setCoords();return this;},scaleToWidth:function(value){var boundingRectFactor=this.getBoundingRect().width/this.getWidth();return this.scale(value/this.width/boundingRectFactor);},scaleToHeight:function(value){var boundingRectFactor=this.getBoundingRect().height/this.getHeight();return this.scale(value/this.height/boundingRectFactor);},setCoords:function(){var theta=degreesToRadians(this.angle),vpt=this.getViewportTransform(),dim=this._calculateCurrentDimensions(),currentWidth=dim.x,currentHeight=dim.y;if(currentWidth<0){currentWidth=Math.abs(currentWidth);}
var sinTh=Math.sin(theta),cosTh=Math.cos(theta),_angle=currentWidth>0?Math.atan(currentHeight/currentWidth):0,_hypotenuse=(currentWidth/Math.cos(_angle))/2,offsetX=Math.cos(_angle+theta)*_hypotenuse,offsetY=Math.sin(_angle+theta)*_hypotenuse,coords=fabric.util.transformPoint(this.getCenterPoint(),vpt),tl=new fabric.Point(coords.x-offsetX,coords.y-offsetY),tr=new fabric.Point(tl.x+(currentWidth*cosTh),tl.y+(currentWidth*sinTh)),bl=new fabric.Point(tl.x-(currentHeight*sinTh),tl.y+(currentHeight*cosTh)),br=new fabric.Point(coords.x+offsetX,coords.y+offsetY),ml=new fabric.Point((tl.x+bl.x)/2,(tl.y+bl.y)/2),mt=new fabric.Point((tr.x+tl.x)/2,(tr.y+tl.y)/2),mr=new fabric.Point((br.x+tr.x)/2,(br.y+tr.y)/2),mb=new fabric.Point((br.x+bl.x)/2,(br.y+bl.y)/2),mtr=new fabric.Point(mt.x+sinTh*this.rotatingPointOffset,mt.y-cosTh*this.rotatingPointOffset);this.oCoords={tl:tl,tr:tr,br:br,bl:bl,ml:ml,mt:mt,mr:mr,mb:mb,mtr:mtr};if(this.hasButton){if((this.width*this.scaleX)<(this.buttonWidth+2*this.cornerSize)){currentHeight=currentHeight+50;}
this.oCoords.btn=new fabric.Point(coords.x-(sinTh*((currentHeight)/2)),coords.y+(cosTh*((currentHeight)/2)));}
if(this.hasMiddleButtons){this.oCoords.pmwBtnMr=mr;this.oCoords.pmwBtnMl=ml;}
this._setCornerCoords&&this._setCornerCoords();return this;},_calcDimensionsTransformMatrix:function(skewX,skewY){var skewMatrixX=[1,0,Math.tan(degreesToRadians(skewX)),1,0,0],skewMatrixY=[1,Math.tan(degreesToRadians(skewY)),0,1,0,0],scaleMatrix=[this.scaleX,0,0,this.scaleY,0,0],m=fabric.util.multiplyTransformMatrices(scaleMatrix,skewMatrixX,true);return fabric.util.multiplyTransformMatrices(m,skewMatrixY,true);}});})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this);}
else{this.canvas.sendToBack(this);}
return this;},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this);}
else{this.canvas.bringToFront(this);}
return this;},sendBackwards:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting);}
else{this.canvas.sendBackwards(this,intersecting);}
return this;},bringForward:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting);}
else{this.canvas.bringForward(this,intersecting);}
return this;},moveTo:function(index){if(this.group){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index);}
else{this.canvas.moveTo(this,index);}
return this;}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var fill=this.fill?(this.fill.toLive?'url(#SVGID_'+this.fill.id+')':this.fill):'none',fillRule=this.fillRule,stroke=this.stroke?(this.stroke.toLive?'url(#SVGID_'+this.stroke.id+')':this.stroke):'none',strokeWidth=this.strokeWidth?this.strokeWidth:'0',strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(' '):'none',strokeLineCap=this.strokeLineCap?this.strokeLineCap:'butt',strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:'miter',strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:'4',opacity=typeof this.opacity!=='undefined'?this.opacity:'1',visibility=this.visible?'':' visibility: hidden;',filter=this.getSvgFilter();return['stroke: ',stroke,'; ','stroke-width: ',strokeWidth,'; ','stroke-dasharray: ',strokeDashArray,'; ','stroke-linecap: ',strokeLineCap,'; ','stroke-linejoin: ',strokeLineJoin,'; ','stroke-miterlimit: ',strokeMiterLimit,'; ','fill: ',fill,'; ','fill-rule: ',fillRule,'; ','opacity: ',opacity,';',filter,visibility].join('');},getSvgFilter:function(){return this.shadow?'filter: url(#SVGID_'+this.shadow.id+');':'';},getSvgTransform:function(){if(this.group&&this.group.type==='path-group'){return'';}
var toFixed=fabric.util.toFixed,angle=this.getAngle(),skewX=(this.getSkewX()%360),skewY=(this.getSkewY()%360),vpt=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],center=fabric.util.transformPoint(this.getCenterPoint(),vpt),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,translatePart=this.type==='path-group'?'':'translate('+
toFixed(center.x,NUM_FRACTION_DIGITS)+' '+
toFixed(center.y,NUM_FRACTION_DIGITS)+')',anglePart=angle!==0?(' rotate('+toFixed(angle,NUM_FRACTION_DIGITS)+')'):'',scalePart=(this.scaleX===1&&this.scaleY===1&&vpt[0]===1&&vpt[3]===1)?'':(' scale('+
toFixed(this.scaleX*vpt[0],NUM_FRACTION_DIGITS)+' '+
toFixed(this.scaleY*vpt[3],NUM_FRACTION_DIGITS)+')'),skewXPart=skewX!==0?' skewX('+toFixed(skewX,NUM_FRACTION_DIGITS)+')':'',skewYPart=skewY!==0?' skewY('+toFixed(skewY,NUM_FRACTION_DIGITS)+')':'',addTranslateX=this.type==='path-group'?this.width*vpt[0]:0,flipXPart=this.flipX?' matrix(-1 0 0 1 '+addTranslateX+' 0) ':'',addTranslateY=this.type==='path-group'?this.height*vpt[3]:0,flipYPart=this.flipY?' matrix(1 0 0 -1 0 '+addTranslateY+')':'';return[translatePart,anglePart,scalePart,flipXPart,flipYPart,skewXPart,skewYPart].join('');},getSvgTransformMatrix:function(){return this.transformMatrix?' matrix('+this.transformMatrix.join(' ')+') ':'';},_createBaseSVGMarkup:function(){var markup=[];if(this.fill&&this.fill.toLive){markup.push(this.fill.toSVG(this,false));}
if(this.stroke&&this.stroke.toLive){markup.push(this.stroke.toSVG(this,false));}
if(this.shadow){markup.push(this.shadow.toSVG(this));}
return markup;}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(prop){return this.get(prop)!==this.originalState[prop];},this);},saveState:function(options){this.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop);},this);if(options&&options.stateProperties){options.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop);},this);}
return this;},setupState:function(){this.originalState={};this.saveState();return this;}});(function(){var degreesToRadians=fabric.util.degreesToRadians,isVML=function(){return typeof G_vmlCanvasManager!=='undefined';};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(pointer){if(!this.hasControls||!this.active){return false;}
var ex=pointer.x,ey=pointer.y,xPoints,lines;this.__corner=0;for(var i in this.oCoords){if(!this.isControlVisible(i)){continue;}
if(i==='mtr'&&!this.hasRotatingPoint){continue;}
if(this.get('lockUniScaling')&&(i==='mt'||i==='mr'||i==='mb'||i==='ml')){continue;}
lines=this._getImageLines(this.oCoords[i].corner);xPoints=this._findCrossPoints({x:ex,y:ey},lines);if(xPoints!==0&&xPoints%2===1){this.__corner=i;return i;}}
return false;},_setCornerCoords:function(){var coords=this.oCoords,newTheta=degreesToRadians(45-this.angle),cornerHypotenuse=this.cornerSize*0.707106,cosHalfOffset=cornerHypotenuse*Math.cos(newTheta),sinHalfOffset=cornerHypotenuse*Math.sin(newTheta),x,y;for(var point in coords){x=coords[point].x;y=coords[point].y;if(point==='btn'){var bw=this.buttonWidth,bh=this.cornerSize,theta=degreesToRadians(this.angle);if(bw<0){bw=Math.abs(bw);}
var sinTh=Math.sin(theta),cosTh=Math.cos(theta),_angle=bw>0?Math.atan(bh/bw):0,_hypotenuse=(bw/Math.cos(_angle))/2,offsetX=Math.cos(_angle+theta)*_hypotenuse,offsetY=Math.sin(_angle+theta)*_hypotenuse;coords[point].corner={tl:{x:x-offsetX,y:y-offsetY},tr:{x:(x-offsetX)+(bw*cosTh),y:(y-offsetY)+(bw*sinTh)},bl:{x:(x-offsetX)-(bh*sinTh),y:(y-offsetY)+(bh*cosTh)},br:{x:x+offsetX,y:y+offsetY}};}
else{coords[point].corner={tl:{x:x-sinHalfOffset,y:y-cosHalfOffset},tr:{x:x+cosHalfOffset,y:y-sinHalfOffset},bl:{x:x-cosHalfOffset,y:y+sinHalfOffset},br:{x:x+sinHalfOffset,y:y+cosHalfOffset}};}}},_getNonTransformedDimensions:function(){var strokeWidth=this.strokeWidth,w=this.width,h=this.height,addStrokeToW=true,addStrokeToH=true;if(this.type==='line'&&this.strokeLineCap==='butt'){addStrokeToH=w;addStrokeToW=h;}
if(addStrokeToH){h+=h<0?-strokeWidth:strokeWidth;}
if(addStrokeToW){w+=w<0?-strokeWidth:strokeWidth;}
return{x:w,y:h};},_getTransformedDimensions:function(skewX,skewY){if(typeof skewX==='undefined'){skewX=this.skewX;}
if(typeof skewY==='undefined'){skewY=this.skewY;}
var dimensions=this._getNonTransformedDimensions(),dimX=dimensions.x/2,dimY=dimensions.y/2,points=[{x:-dimX,y:-dimY},{x:dimX,y:-dimY},{x:-dimX,y:dimY},{x:dimX,y:dimY}],i,transformMatrix=this._calcDimensionsTransformMatrix(skewX,skewY),bbox;for(i=0;i<points.length;i++){points[i]=fabric.util.transformPoint(points[i],transformMatrix);}
bbox=fabric.util.makeBoundingBoxFromPoints(points);return{x:bbox.width,y:bbox.height};},_calculateCurrentDimensions:function(){var vpt=this.getViewportTransform(),dim=this._getTransformedDimensions(),w=dim.x,h=dim.y;w+=2*this.padding;h+=2*this.padding;return fabric.util.transformPoint(new fabric.Point(w,h),vpt,true);},drawBorders:function(ctx){if(!this.hasBorders){return this;}
ctx.save();ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;ctx.strokeStyle=this.borderColor;ctx.lineWidth=2/this.borderScaleFactor;var wh=this._calculateCurrentDimensions(),width=wh.x,height=wh.y;if(this.group){width=width*this.group.scaleX;height=height*this.group.scaleY;}
ctx.strokeRect(~~(-(width/2))-0.5,~~(-(height/2))-0.5,~~(width)+1,~~(height)+1);if(this.hasRotatingPoint&&this.isControlVisible('mtr')&&!this.get('lockRotation')&&this.hasControls){var rotateHeight=-height/2;ctx.beginPath();ctx.moveTo(0,rotateHeight);ctx.lineTo(0,rotateHeight-this.rotatingPointOffset);ctx.closePath();ctx.stroke();}
ctx.restore();return this;},drawControls:function(ctx){if(!this.hasControls){return this;}
var wh=this._calculateCurrentDimensions(),width=wh.x,height=wh.y,scaleOffset=this.cornerSize/2,left=-(width/2)-scaleOffset,top=-(height/2)-scaleOffset,methodName=this.transparentCorners?'strokeRect':'fillRect';ctx.save();ctx.lineWidth=2;ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;ctx.strokeStyle=ctx.fillStyle=this.cornerColor;ctx.strokeStyle=this.borderColor;ctx.shadowColor='rgba(0,0,0,0.1)';ctx.shadowBlur=3;ctx.shadowOffsetX=0;ctx.shadowOffsetY=2;if(this.hasButton){this._drawControl('btn',ctx,methodName,left+width/2,top+height);}
if(this.hasMiddleButtons){this._drawControl('pmwBtnMr',ctx,methodName,left+width,top+height/2);this._drawControl('pmwBtnMl',ctx,methodName,left,top+height/2);}
this._drawControl('tl',ctx,methodName,left,top);this._drawControl('tr',ctx,methodName,left+width,top);this._drawControl('bl',ctx,methodName,left,top+height);this._drawControl('br',ctx,methodName,left+width,top+height);if(!this.get('lockUniScaling')){this._drawControl('mt',ctx,methodName,left+width/2,top);this._drawControl('mb',ctx,methodName,left+width/2,top+height);this._drawControl('mr',ctx,methodName,left+width,top+height/2);this._drawControl('ml',ctx,methodName,left,top+height/2);}
if(this.hasRotatingPoint){this._drawControl('mtr',ctx,methodName,left+width/2,top-this.rotatingPointOffset);}
ctx.restore();return this;},_drawControl:function(control,ctx,methodName,left,top){if(!this.isControlVisible(control)){return;}
var size=this.cornerSize;if(control==='mtr'){ctx.beginPath();ctx.arc(left+11,top+11,(size/2)+5,0,2*Math.PI);ctx.fill();ctx.save();ctx.lineWidth=1;ctx.shadowColor="transparent";ctx.translate(left+1,top-(2*this.rotatingPointOffset)+2);ctx.lineCap='butt';ctx.lineJoin='miter';ctx.miterLimit=4;ctx.beginPath();ctx.moveTo(10.5,79);ctx.bezierCurveTo(6.8935664,79,3.5763253,80.838639,1.6541928,83.84594);ctx.lineTo(1.0462049,80.85812);ctx.lineTo(0.30184339,81.010181);ctx.lineTo(1.2116748,85.477108);ctx.lineTo(5.6001688,84.245446);ctx.lineTo(5.395482,83.513735);ctx.lineTo(2.1941205,84.41294);ctx.bezierCurveTo(3.9611567,81.529362,7.0911688,79.759036,10.5,79.759036);ctx.bezierCurveTo(15.871193,79.759036,20.240963999999998,84.128807,20.240963999999998,89.5);ctx.bezierCurveTo(20.240963999999998,94.871193,15.871192999999998,99.240964,10.499999999999998,99.240964);ctx.bezierCurveTo(5.128807299999998,99.240964,0.7590361499999982,94.871193,0.7590361499999982,89.5);ctx.lineTo(0,89.5);ctx.bezierCurveTo(0,95.289675,4.7103253,100,10.5,100);ctx.bezierCurveTo(16.289674,100,21,95.289675,21,89.5);ctx.bezierCurveTo(21,83.710325,16.289674,79,10.5,79);ctx.closePath();ctx.fill();ctx.stroke();ctx.restore();}
else if(control==='btn'){var bLeft=left-36,bTop=top;if((this.width*this.scaleX)<(this.buttonWidth+2*this.cornerSize)){bTop+=this.cornerSize+4;}
ctx[methodName](bLeft,bTop,this.buttonWidth,size);ctx['strokeRect'](bLeft,bTop,this.buttonWidth,size);ctx.save();ctx.font='13px sans-serif';ctx.fillStyle=this.borderColor;ctx.fillText(this.buttonText,bLeft+(this.buttonWidth-ctx.measureText(this.buttonText).width)/2,bTop+15);ctx.restore();}
else if(control=='pmwBtnMr'||control=='pmwBtnMl'){ctx[methodName](left,top,size,size);ctx['strokeRect'](left,top,size,size);}
else{isVML()||this.transparentCorners||ctx.clearRect(left,top,size,size);ctx[methodName](left,top,size,size);ctx['strokeRect'](left,top,size,size);}},isControlVisible:function(controlName){return this._getControlsVisibility()[controlName];},setControlVisible:function(controlName,visible){this._getControlsVisibility()[controlName]=visible;return this;},setControlsVisibility:function(options){options||(options={});for(var p in options){this.setControlVisible(p,options[p]);}
return this;},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true,btn:true,pmwBtnMr:true,pmwBtnMl:true};}
return this._controlsVisibility;}});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.get('left'),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set('left',value);_this.renderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});return this;},fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.get('top'),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set('top',value);_this.renderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});return this;},fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.get('opacity'),endValue:0,duration:this.FX_DURATION,onStart:function(){object.set('active',false);},onChange:function(value){object.set('opacity',value);_this.renderAll();onChange();},onComplete:function(){_this.remove(object);onComplete();}});return this;}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==='object'){var propsToAnimate=[],prop,skipCallbacks;for(prop in arguments[0]){propsToAnimate.push(prop);}
for(var i=0,len=propsToAnimate.length;i<len;i++){prop=propsToAnimate[i];skipCallbacks=i!==len-1;this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks);}}
else{this._animate.apply(this,arguments);}
return this;},_animate:function(property,to,options,skipCallbacks){var _this=this,propPair;to=to.toString();if(!options){options={};}
else{options=fabric.util.object.clone(options);}
if(~property.indexOf('.')){propPair=property.split('.');}
var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);if(!('from'in options)){options.from=currentValue;}
if(~to.indexOf('=')){to=currentValue+parseFloat(to.replace('=',''));}
else{to=parseFloat(to);}
fabric.util.animate({startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&&function(){return options.abort.call(_this);},onChange:function(value){if(propPair){_this[propPair[0]][propPair[1]]=value;}
else{_this.set(property,value);}
if(skipCallbacks){return;}
options.onChange&&options.onChange();},onComplete:function(){if(skipCallbacks){return;}
_this.setCoords();options.onComplete&&options.onComplete();}});}});(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,coordProps={x1:1,x2:1,y1:1,y2:1},supportsLineDash=fabric.StaticCanvas.supports('setLineDash');if(fabric.Line){fabric.warn('fabric.Line is already defined');return;}
fabric.Line=fabric.util.createClass(fabric.Object,{type:'line',x1:0,y1:0,x2:0,y2:0,initialize:function(points,options){options=options||{};if(!points){points=[0,0,0,0];}
this.callSuper('initialize',options);this.set('x1',points[0]);this.set('y1',points[1]);this.set('x2',points[2]);this.set('y2',points[3]);this._setWidthHeight(options);},_setWidthHeight:function(options){options||(options={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left='left'in options?options.left:this._getLeftToOriginX();this.top='top'in options?options.top:this._getTopToOriginY();},_set:function(key,value){this.callSuper('_set',key,value);if(typeof coordProps[key]!=='undefined'){this._setWidthHeight();}
return this;},_getLeftToOriginX:makeEdgeToOriginGetter({origin:'originX',axis1:'x1',axis2:'x2',dimension:'width'},{nearest:'left',center:'center',farthest:'right'}),_getTopToOriginY:makeEdgeToOriginGetter({origin:'originY',axis1:'y1',axis2:'y2',dimension:'height'},{nearest:'top',center:'center',farthest:'bottom'}),_render:function(ctx,noTransform){ctx.beginPath();if(noTransform){var cp=this.getCenterPoint();ctx.translate(cp.x-this.strokeWidth/2,cp.y-this.strokeWidth/2);}
if(!this.strokeDashArray||this.strokeDashArray&&supportsLineDash){var p=this.calcLinePoints();ctx.moveTo(p.x1,p.y1);ctx.lineTo(p.x2,p.y2);}
ctx.lineWidth=this.strokeWidth;var origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle;this.stroke&&this._renderStroke(ctx);ctx.strokeStyle=origStrokeStyle;},_renderDashedStroke:function(ctx){var p=this.calcLinePoints();ctx.beginPath();fabric.util.drawDashedLine(ctx,p.x1,p.y1,p.x2,p.y2,this.strokeDashArray);ctx.closePath();},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),this.calcLinePoints());},calcLinePoints:function(){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1,x1=(xMult*this.width*0.5),y1=(yMult*this.height*0.5),x2=(xMult*this.width*-0.5),y2=(yMult*this.height*-0.5);return{x1:x1,x2:x2,y1:y1,y2:y2};},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),p={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(!(this.group&&this.group.type==='path-group')){p=this.calcLinePoints();}
markup.push('<line ','x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return reviver?reviver(markup.join('')):markup.join('');},complexity:function(){return 1;}});fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));fabric.Line.fromElement=function(element,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];return new fabric.Line(points,extend(parsedAttributes,options));};fabric.Line.fromObject=function(object){var points=[object.x1,object.y1,object.x2,object.y2];return new fabric.Line(points,object);};function makeEdgeToOriginGetter(propertyNames,originValues){var origin=propertyNames.origin,axis1=propertyNames.axis1,axis2=propertyNames.axis2,dimension=propertyNames.dimension,nearest=originValues.nearest,center=originValues.center,farthest=originValues.farthest;return function(){switch(this.get(origin)){case nearest:return Math.min(this.get(axis1),this.get(axis2));case center:return Math.min(this.get(axis1),this.get(axis2))+(0.5*this.get(dimension));case farthest:return Math.max(this.get(axis1),this.get(axis2));}};}})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),pi=Math.PI,extend=fabric.util.object.extend;if(fabric.Circle){fabric.warn('fabric.Circle is already defined.');return;}
fabric.Circle=fabric.util.createClass(fabric.Object,{type:'circle',radius:0,startAngle:0,endAngle:pi*2,initialize:function(options){options=options||{};this.callSuper('initialize',options);this.set('radius',options.radius||0);this.startAngle=options.startAngle||this.startAngle;this.endAngle=options.endAngle||this.endAngle;},_set:function(key,value){this.callSuper('_set',key,value);if(key==='radius'){this.setRadius(value);}
return this;},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{radius:this.get('radius'),startAngle:this.startAngle,endAngle:this.endAngle});},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=0,y=0,angle=(this.endAngle-this.startAngle)%(2*pi);if(angle===0){if(this.group&&this.group.type==='path-group'){x=this.left+this.radius;y=this.top+this.radius;}
markup.push('<circle ','cx="'+x+'" cy="'+y+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),' ',this.getSvgTransformMatrix(),'"/>\n');}
else{var startX=Math.cos(this.startAngle)*this.radius,startY=Math.sin(this.startAngle)*this.radius,endX=Math.cos(this.endAngle)*this.radius,endY=Math.sin(this.endAngle)*this.radius,largeFlag=angle>pi?'1':'0';markup.push('<path d="M '+startX+' '+startY,' A '+this.radius+' '+this.radius,' 0 ',+largeFlag+' 1',' '+endX+' '+endY,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),' ',this.getSvgTransformMatrix(),'"/>\n');}
return reviver?reviver(markup.join('')):markup.join('');},_render:function(ctx,noTransform){ctx.beginPath();ctx.arc(noTransform?this.left+this.radius:0,noTransform?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,false);this._renderFill(ctx);this._renderStroke(ctx);},getRadiusX:function(){return this.get('radius')*this.get('scaleX');},getRadiusY:function(){return this.get('radius')*this.get('scaleY');},setRadius:function(value){this.radius=value;return this.set('width',value*2).set('height',value*2);},complexity:function(){return 1;}});fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));fabric.Circle.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes)){throw new Error('value of `r` attribute is required and can not be negative');}
parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;var obj=new fabric.Circle(extend(parsedAttributes,options));obj.left-=obj.radius;obj.top-=obj.radius;return obj;};function isValidRadius(attributes){return(('radius'in attributes)&&(attributes.radius>=0));}
fabric.Circle.fromObject=function(object){return new fabric.Circle(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Triangle){fabric.warn('fabric.Triangle is already defined');return;}
fabric.Triangle=fabric.util.createClass(fabric.Object,{type:'triangle',initialize:function(options){options=options||{};this.callSuper('initialize',options);this.set('width',options.width||100).set('height',options.height||100);},_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();ctx.moveTo(-widthBy2,heightBy2);ctx.lineTo(0,-heightBy2);ctx.lineTo(widthBy2,heightBy2);ctx.closePath();this._renderFill(ctx);this._renderStroke(ctx);},_renderDashedStroke:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();fabric.util.drawDashedLine(ctx,-widthBy2,heightBy2,0,-heightBy2,this.strokeDashArray);fabric.util.drawDashedLine(ctx,0,-heightBy2,widthBy2,heightBy2,this.strokeDashArray);fabric.util.drawDashedLine(ctx,widthBy2,heightBy2,-widthBy2,heightBy2,this.strokeDashArray);ctx.closePath();},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+' '+heightBy2,'0 '+-heightBy2,widthBy2+' '+heightBy2].join(',');markup.push('<polygon ','points="',points,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return reviver?reviver(markup.join('')):markup.join('');},complexity:function(){return 1;}});fabric.Triangle.fromObject=function(object){return new fabric.Triangle(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),piBy2=Math.PI*2,extend=fabric.util.object.extend;if(fabric.Ellipse){fabric.warn('fabric.Ellipse is already defined.');return;}
fabric.Ellipse=fabric.util.createClass(fabric.Object,{type:'ellipse',rx:0,ry:0,initialize:function(options){options=options||{};this.callSuper('initialize',options);this.set('rx',options.rx||0);this.set('ry',options.ry||0);},_set:function(key,value){this.callSuper('_set',key,value);switch(key){case'rx':this.rx=value;this.set('width',value*2);break;case'ry':this.ry=value;this.set('height',value*2);break;}
return this;},getRx:function(){return this.get('rx')*this.get('scaleX');},getRy:function(){return this.get('ry')*this.get('scaleY');},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{rx:this.get('rx'),ry:this.get('ry')});},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=0,y=0;if(this.group&&this.group.type==='path-group'){x=this.left+this.rx;y=this.top+this.ry;}
markup.push('<ellipse ','cx="',x,'" cy="',y,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return reviver?reviver(markup.join('')):markup.join('');},_render:function(ctx,noTransform){ctx.beginPath();ctx.save();ctx.transform(1,0,0,this.ry/this.rx,0,0);ctx.arc(noTransform?this.left+this.rx:0,noTransform?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,piBy2,false);ctx.restore();this._renderFill(ctx);this._renderStroke(ctx);},complexity:function(){return 1;}});fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));fabric.Ellipse.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;var ellipse=new fabric.Ellipse(extend(parsedAttributes,options));ellipse.top-=ellipse.ry;ellipse.left-=ellipse.rx;return ellipse;};fabric.Ellipse.fromObject=function(object){return new fabric.Ellipse(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect){fabric.warn('fabric.Rect is already defined');return;}
var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push('rx','ry','x','y');fabric.Rect=fabric.util.createClass(fabric.Object,{stateProperties:stateProperties,type:'rect',rx:0,ry:0,strokeDashArray:null,initialize:function(options){options=options||{};this.callSuper('initialize',options);this._initRxRy();},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx;}
else if(this.ry&&!this.rx){this.rx=this.ry;}},_render:function(ctx,noTransform){if(this.width===1&&this.height===1){ctx.fillRect(0,0,1,1);return;}
var rx=this.rx?Math.min(this.rx,this.width/2):0,ry=this.ry?Math.min(this.ry,this.height/2):0,w=this.width,h=this.height,x=noTransform?this.left:-this.width/2,y=noTransform?this.top:-this.height/2,isRounded=rx!==0||ry!==0,k=1-0.5522847498;ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+w-rx,y);isRounded&&ctx.bezierCurveTo(x+w-k*rx,y,x+w,y+k*ry,x+w,y+ry);ctx.lineTo(x+w,y+h-ry);isRounded&&ctx.bezierCurveTo(x+w,y+h-k*ry,x+w-k*rx,y+h,x+w-rx,y+h);ctx.lineTo(x+rx,y+h);isRounded&&ctx.bezierCurveTo(x+k*rx,y+h,x,y+h-k*ry,x,y+h-ry);ctx.lineTo(x,y+ry);isRounded&&ctx.bezierCurveTo(x,y+k*ry,x+k*rx,y,x+rx,y);ctx.closePath();this._renderFill(ctx);this._renderStroke(ctx);},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.beginPath();fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray);ctx.closePath();},toObject:function(propertiesToInclude){var object=extend(this.callSuper('toObject',propertiesToInclude),{rx:this.get('rx')||0,ry:this.get('ry')||0});if(!this.includeDefaultValues){this._removeDefaultValues(object);}
return object;},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=this.left,y=this.top;if(!(this.group&&this.group.type==='path-group')){x=-this.width/2;y=-this.height/2;}
markup.push('<rect ','x="',x,'" y="',y,'" rx="',this.get('rx'),'" ry="',this.get('ry'),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return reviver?reviver(markup.join('')):markup.join('');},complexity:function(){return 1;}});fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));fabric.Rect.fromElement=function(element,options){if(!element){return null;}
options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;var rect=new fabric.Rect(extend((options?fabric.util.object.clone(options):{}),parsedAttributes));rect.visible=rect.width>0&&rect.height>0;return rect;};fabric.Rect.fromObject=function(object){return new fabric.Rect(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Polyline){fabric.warn('fabric.Polyline is already defined');return;}
fabric.Polyline=fabric.util.createClass(fabric.Object,{type:'polyline',points:null,minX:0,minY:0,initialize:function(points,options){return fabric.Polygon.prototype.initialize.call(this,points,options);},_calcDimensions:function(){return fabric.Polygon.prototype._calcDimensions.call(this);},_applyPointOffset:function(){return fabric.Polygon.prototype._applyPointOffset.call(this);},toObject:function(propertiesToInclude){return fabric.Polygon.prototype.toObject.call(this,propertiesToInclude);},toSVG:function(reviver){return fabric.Polygon.prototype.toSVG.call(this,reviver);},_render:function(ctx){if(!fabric.Polygon.prototype.commonRender.call(this,ctx)){return;}
this._renderFill(ctx);this._renderStroke(ctx);},_renderDashedStroke:function(ctx){var p1,p2;ctx.beginPath();for(var i=0,len=this.points.length;i<len;i++){p1=this.points[i];p2=this.points[i+1]||p1;fabric.util.drawDashedLine(ctx,p1.x,p1.y,p2.x,p2.y,this.strokeDashArray);}},complexity:function(){return this.get('points').length;}});fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polyline.fromElement=function(element,options){if(!element){return null;}
options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute('points')),parsedAttributes=fabric.parseAttributes(element,fabric.Polyline.ATTRIBUTE_NAMES);return new fabric.Polyline(points,fabric.util.object.extend(parsedAttributes,options));};fabric.Polyline.fromObject=function(object){var points=object.points;return new fabric.Polyline(points,object,true);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed;if(fabric.Polygon){fabric.warn('fabric.Polygon is already defined');return;}
fabric.Polygon=fabric.util.createClass(fabric.Object,{type:'polygon',points:null,minX:0,minY:0,initialize:function(points,options){options=options||{};this.points=points||[];this.callSuper('initialize',options);this._calcDimensions();if(!('top'in options)){this.top=this.minY;}
if(!('left'in options)){this.left=this.minX;}},_calcDimensions:function(){var points=this.points,minX=min(points,'x'),minY=min(points,'y'),maxX=max(points,'x'),maxY=max(points,'y');this.width=(maxX-minX)||0;this.height=(maxY-minY)||0;this.minX=minX||0,this.minY=minY||0;},_applyPointOffset:function(){this.points.forEach(function(p){p.x-=(this.minX+this.width/2);p.y-=(this.minY+this.height/2);},this);},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{points:this.points.concat()});},toSVG:function(reviver){var points=[],markup=this._createBaseSVGMarkup();for(var i=0,len=this.points.length;i<len;i++){points.push(toFixed(this.points[i].x,2),',',toFixed(this.points[i].y,2),' ');}
markup.push('<',this.type,' ','points="',points.join(''),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),' ',this.getSvgTransformMatrix(),'"/>\n');return reviver?reviver(markup.join('')):markup.join('');},_render:function(ctx){if(!this.commonRender(ctx)){return;}
this._renderFill(ctx);if(this.stroke||this.strokeDashArray){ctx.closePath();this._renderStroke(ctx);}},commonRender:function(ctx){var point,len=this.points.length;if(!len||isNaN(this.points[len-1].y)){return false;}
ctx.beginPath();if(this._applyPointOffset){if(!(this.group&&this.group.type==='path-group')){this._applyPointOffset();}
this._applyPointOffset=null;}
ctx.moveTo(this.points[0].x,this.points[0].y);for(var i=0;i<len;i++){point=this.points[i];ctx.lineTo(point.x,point.y);}
return true;},_renderDashedStroke:function(ctx){fabric.Polyline.prototype._renderDashedStroke.call(this,ctx);ctx.closePath();},complexity:function(){return this.points.length;}});fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polygon.fromElement=function(element,options){if(!element){return null;}
options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute('points')),parsedAttributes=fabric.parseAttributes(element,fabric.Polygon.ATTRIBUTE_NAMES);return new fabric.Polygon(points,extend(parsedAttributes,options));};fabric.Polygon.fromObject=function(object){return new fabric.Polygon(object.points,object,true);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,_toString=Object.prototype.toString,drawArc=fabric.util.drawArc,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},repeatedCommands={m:'l',M:'L'};if(fabric.Path){fabric.warn('fabric.Path is already defined');return;}
fabric.Path=fabric.util.createClass(fabric.Object,{type:'path',path:null,minX:0,minY:0,initialize:function(path,options){options=options||{};this.setOptions(options);if(!path){path=[];}
var fromArray=_toString.call(path)==='[object Array]';this.path=fromArray?path:path.match&&path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return;}
if(!fromArray){this.path=this._parsePath();}
this._setPositionDimensions(options);if(options.sourcePath){this.setSourcePath(options.sourcePath);}},_setPositionDimensions:function(options){var calcDim=this._parseDimensions();this.minX=calcDim.left;this.minY=calcDim.top;this.width=calcDim.width;this.height=calcDim.height;if(typeof options.left==='undefined'){this.left=calcDim.left+(this.originX==='center'?this.width/2:this.originX==='right'?this.width:0);}
if(typeof options.top==='undefined'){this.top=calcDim.top+(this.originY==='center'?this.height/2:this.originY==='bottom'?this.height:0);}
this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2};},_render:function(ctx){var current,previous=null,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,tempX,tempY,l=-this.pathOffset.x,t=-this.pathOffset.y;if(this.group&&this.group.type==='path-group'){l=0;t=0;}
ctx.beginPath();for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]){case'l':x+=current[1];y+=current[2];ctx.lineTo(x+l,y+t);break;case'L':x=current[1];y=current[2];ctx.lineTo(x+l,y+t);break;case'h':x+=current[1];ctx.lineTo(x+l,y+t);break;case'H':x=current[1];ctx.lineTo(x+l,y+t);break;case'v':y+=current[1];ctx.lineTo(x+l,y+t);break;case'V':y=current[1];ctx.lineTo(x+l,y+t);break;case'm':x+=current[1];y+=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case'M':x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case'c':tempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];ctx.bezierCurveTo(x+current[1]+l,y+current[2]+t,controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case'C':x=current[5];y=current[6];controlX=current[3];controlY=current[4];ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case's':tempX=x+current[3];tempY=y+current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
ctx.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t);controlX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case'S':tempX=current[3];tempY=current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
ctx.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case'q':tempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case'Q':tempX=current[3];tempY=current[4];ctx.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case't':tempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case'T':tempX=current[1];tempY=current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case'a':drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]);x+=current[6];y+=current[7];break;case'A':drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]);x=current[6];y=current[7];break;case'z':case'Z':x=subpathStartX;y=subpathStartY;ctx.closePath();break;}
previous=current;}
this._renderFill(ctx);ctx.restore();this._setStrokeStyles(ctx);this._renderStroke(ctx);ctx.save();},toString:function(){return'#<fabric.Path ('+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+' }>';},toObject:function(propertiesToInclude){var o=extend(this.callSuper('toObject',propertiesToInclude),{path:this.path.map(function(item){return item.slice()}),pathOffset:this.pathOffset});if(this.sourcePath){o.sourcePath=this.sourcePath;}
if(this.transformMatrix){o.transformMatrix=this.transformMatrix;}
return o;},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);if(this.sourcePath){o.path=this.sourcePath;}
delete o.sourcePath;return o;},toSVG:function(reviver){var chunks=[],markup=this._createBaseSVGMarkup(),addTransform='';for(var i=0,len=this.path.length;i<len;i++){chunks.push(this.path[i].join(' '));}
var path=chunks.join(' ');if(!(this.group&&this.group.type==='path-group')){addTransform=' translate('+(-this.pathOffset.x)+', '+(-this.pathOffset.y)+') ';}
markup.push('<path ','d="',path,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),addTransform,this.getSvgTransformMatrix(),'" stroke-linecap="round" ','/>\n');return reviver?reviver(markup.join('')):markup.join('');},complexity:function(){return this.path.length;},_parsePath:function(){var result=[],coords=[],currentPath,parsed,re=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,match,coordsStr;for(var i=0,coordsParsed,len=this.path.length;i<len;i++){currentPath=this.path[i];coordsStr=currentPath.slice(1).trim();coords.length=0;while((match=re.exec(coordsStr))){coords.push(match[0]);}
coordsParsed=[currentPath.charAt(0)];for(var j=0,jlen=coords.length;j<jlen;j++){parsed=parseFloat(coords[j]);if(!isNaN(parsed)){coordsParsed.push(parsed);}}
var command=coordsParsed[0],commandLength=commandLengths[command.toLowerCase()],repeatedCommand=repeatedCommands[command]||command;if(coordsParsed.length-1>commandLength){for(var k=1,klen=coordsParsed.length;k<klen;k+=commandLength){result.push([command].concat(coordsParsed.slice(k,k+commandLength)));command=repeatedCommand;}}
else{result.push(coordsParsed);}}
return result;},_parseDimensions:function(){var aX=[],aY=[],current,previous=null,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,tempX,tempY,bounds;for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]){case'l':x+=current[1];y+=current[2];bounds=[];break;case'L':x=current[1];y=current[2];bounds=[];break;case'h':x+=current[1];bounds=[];break;case'H':x=current[1];bounds=[];break;case'v':y+=current[1];bounds=[];break;case'V':y=current[1];bounds=[];break;case'm':x+=current[1];y+=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case'M':x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case'c':tempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];bounds=fabric.util.getBoundsOfCurve(x,y,x+current[1],y+current[2],controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case'C':x=current[5];y=current[6];controlX=current[3];controlY=current[4];bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],controlX,controlY,x,y);break;case's':tempX=x+current[3];tempY=y+current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,x+current[1],y+current[2],tempX,tempY);controlX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case'S':tempX=current[3];tempY=current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,current[1],current[2],tempX,tempY);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case'q':tempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case'Q':controlX=current[1];controlY=current[2];bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,current[3],current[4]);x=current[3];y=current[4];break;case't':tempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case'T':tempX=current[1];tempY=current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y;}
else{controlX=2*x-controlX;controlY=2*y-controlY;}
bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case'a':bounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6]+x,current[7]+y);x+=current[6];y+=current[7];break;case'A':bounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6],current[7]);x=current[6];y=current[7];break;case'z':case'Z':x=subpathStartX;y=subpathStartY;break;}
previous=current;bounds.forEach(function(point){aX.push(point.x);aY.push(point.y);});aX.push(x);aY.push(y);}
var minX=min(aX)||0,minY=min(aY)||0,maxX=max(aX)||0,maxY=max(aY)||0,deltaX=maxX-minX,deltaY=maxY-minY,o={left:minX,top:minY,width:deltaX,height:deltaY};return o;}});fabric.Path.fromObject=function(object,callback){if(typeof object.path==='string'){fabric.loadSVGFromURL(object.path,function(elements){var path=elements[0],pathUrl=object.path;delete object.path;fabric.util.object.extend(path,object);path.setSourcePath(pathUrl);callback(path);});}
else{callback(new fabric.Path(object.path,object));}};fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(['d']);fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);callback&&callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)));};fabric.Path.async=true;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,invoke=fabric.util.array.invoke,parentToObject=fabric.Object.prototype.toObject;if(fabric.PathGroup){fabric.warn('fabric.PathGroup is already defined');return;}
fabric.PathGroup=fabric.util.createClass(fabric.Path,{type:'path-group',fill:'',initialize:function(paths,options){options=options||{};this.paths=paths||[];for(var i=this.paths.length;i--;){this.paths[i].group=this;}
if(options.toBeParsed){this.parseDimensionsFromPaths(options);delete options.toBeParsed;}
this.setOptions(options);this.setCoords();if(options.sourcePath){this.setSourcePath(options.sourcePath);}},parseDimensionsFromPaths:function(options){var points,p,xC=[],yC=[],path,height,width,m;for(var j=this.paths.length;j--;){path=this.paths[j];height=path.height+path.strokeWidth;width=path.width+path.strokeWidth;points=[{x:path.left,y:path.top},{x:path.left+width,y:path.top},{x:path.left,y:path.top+height},{x:path.left+width,y:path.top+height}];m=this.paths[j].transformMatrix;for(var i=0;i<points.length;i++){p=points[i];if(m){p=fabric.util.transformPoint(p,m,false);}
xC.push(p.x);yC.push(p.y);}}
options.width=Math.max.apply(null,xC);options.height=Math.max.apply(null,yC);},render:function(ctx){if(!this.visible){return;}
ctx.save();if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix);}
this.transform(ctx);this._setShadow(ctx);this.clipTo&&fabric.util.clipContext(this,ctx);ctx.translate(-this.width/2,-this.height/2);for(var i=0,l=this.paths.length;i<l;++i){this.paths[i].render(ctx,true);}
this.clipTo&&ctx.restore();ctx.restore();},_set:function(prop,value){if(prop==='fill'&&value&&this.isSameColor()){var i=this.paths.length;while(i--){this.paths[i]._set(prop,value);}}
return this.callSuper('_set',prop,value);},toObject:function(propertiesToInclude){var o=extend(parentToObject.call(this,propertiesToInclude),{paths:invoke(this.getObjects(),'toObject',propertiesToInclude)});if(this.sourcePath){o.sourcePath=this.sourcePath;}
return o;},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);if(this.sourcePath){o.paths=this.sourcePath;}
return o;},toSVG:function(reviver){var objects=this.getObjects(),p=this.getPointByOrigin('left','top'),translatePart='translate('+p.x+' '+p.y+')',markup=this._createBaseSVGMarkup();markup.push('<g ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),translatePart,this.getSvgTransform(),'" ','>\n');for(var i=0,len=objects.length;i<len;i++){markup.push('\t',objects[i].toSVG(reviver));}
markup.push('</g>\n');return reviver?reviver(markup.join('')):markup.join('');},toString:function(){return'#<fabric.PathGroup ('+this.complexity()+'): { top: '+this.top+', left: '+this.left+' }>';},isSameColor:function(){var firstPathFill=this.getObjects()[0].get('fill')||'';if(typeof firstPathFill!=='string'){return false;}
firstPathFill=firstPathFill.toLowerCase();return this.getObjects().every(function(path){var pathFill=path.get('fill')||'';return typeof pathFill==='string'&&(pathFill).toLowerCase()===firstPathFill;});},complexity:function(){return this.paths.reduce(function(total,path){return total+((path&&path.complexity)?path.complexity():0);},0);},getObjects:function(){return this.paths;}});fabric.PathGroup.fromObject=function(object,callback){if(typeof object.paths==='string'){fabric.loadSVGFromURL(object.paths,function(elements){var pathUrl=object.paths;delete object.paths;var pathGroup=fabric.util.groupSVGElements(elements,object,pathUrl);callback(pathGroup);});}
else{fabric.util.enlivenObjects(object.paths,function(enlivenedObjects){delete object.paths;callback(new fabric.PathGroup(enlivenedObjects,object));});}};fabric.PathGroup.async=true;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,invoke=fabric.util.array.invoke;if(fabric.Group){return;}
var _lockProperties={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,{type:'group',strokeWidth:0,leanBackground:false,leanBackgroundOffset:0,initialize:function(objects,options,isAlreadyGrouped){options=options||{};this._objects=[];isAlreadyGrouped&&this.callSuper('initialize',options);this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}
this.originalState={};if(options.originX){this.originX=options.originX;}
if(options.originY){this.originY=options.originY;}
if(isAlreadyGrouped){this._updateObjectsCoords(true);}
else{this._calcBounds();this._updateObjectsCoords();this.callSuper('initialize',options);}
this.setCoords();this.saveCoords();},_updateObjectsCoords:function(skipCoordsChange){for(var i=this._objects.length;i--;){this._updateObjectCoords(this._objects[i],skipCoordsChange);}},_updateObjectCoords:function(object,skipCoordsChange){object.__origHasControls=object.hasControls;object.hasControls=false;if(skipCoordsChange){return;}
var objectLeft=object.getLeft(),objectTop=object.getTop(),center=this.getCenterPoint();object.set({originalLeft:objectLeft,originalTop:objectTop,left:objectLeft-center.x,top:objectTop-center.y});object.setCoords();},toString:function(){return'#<fabric.Group: ('+this.complexity()+')>';},addWithUpdate:function(object){this._restoreObjectsState();if(object){this._objects.push(object);object.group=this;object._set('canvas',this.canvas);}
this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this;},_setObjectActive:function(object){object.set('active',true);object.group=this;},removeWithUpdate:function(object){this._moveFlippedObject(object);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(object);this._calcBounds();this._updateObjectsCoords();return this;},_onObjectAdded:function(object){object.group=this;object._set('canvas',this.canvas);},_onObjectRemoved:function(object){delete object.group;object.set('active',false);},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,letterSpacing:true,text:true,textDecoration:true,textAlign:true},_set:function(key,value){var i=this._objects.length;if(this.delegatedProperties[key]||key==='canvas'){while(i--){this._objects[i].set(key,value);}}
else{while(i--){this._objects[i].setOnGroup(key,value);}}
this.callSuper('_set',key,value);},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{objects:invoke(this._objects,'toObject',propertiesToInclude)});},render:function(ctx){if(!this.visible){return;}
ctx.save();if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix);}
this.transform(ctx);this._setShadow(ctx);if(this instanceof fabric.Table){this.renderTableCustomBackground(ctx);this.renderTableBorders(ctx);}
else{this.renderGroupBackground(ctx);}
this.clipTo&&fabric.util.clipContext(this,ctx);for(var i=0,len=this._objects.length;i<len;i++){this._renderObject(this._objects[i],ctx);}
this.clipTo&&ctx.restore();ctx.restore();},renderGroupBackground:function(ctx){if(!this.backgroundColor){return;}
if(this.leanBackground){ctx.save();ctx.fillStyle=this.backgroundColor;ctx.beginPath();var offset=this.leanBackgroundOffset/4,slant=this.leanBackgroundOffset/2,yFix=this.leanBackgroundOffset/10;ctx.moveTo(-this.width/2+offset,-this.height/2-yFix);ctx.lineTo(-this.width/2+this.width+offset,-this.height/2-yFix);ctx.lineTo(-this.width/2+this.width-slant+offset,-this.height/2+this.height-yFix);ctx.lineTo(-this.width/2-slant+offset,-this.height/2+this.height-yFix);ctx.closePath();ctx.fill();ctx.restore();}
else{ctx.save();ctx.fillStyle=this.backgroundColor;ctx.fillRect(-this.width/2,-this.height/2,this.width,this.height);ctx.restore();}},_renderControls:function(ctx,noTransform){this.callSuper('_renderControls',ctx,noTransform);for(var i=0,len=this._objects.length;i<len;i++){this._objects[i]._renderControls(ctx);}},_renderObject:function(object,ctx){if(!object.visible){return;}
var originalHasRotatingPoint=object.hasRotatingPoint;object.hasRotatingPoint=false;object.render(ctx);object.hasRotatingPoint=originalHasRotatingPoint;},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this;},realizeTransform:function(object){this._moveFlippedObject(object);this._setObjectPosition(object);return object;},_moveFlippedObject:function(object){var oldOriginX=object.get('originX'),oldOriginY=object.get('originY'),center=object.getCenterPoint();object.set({originX:'center',originY:'center',left:center.x,top:center.y});this._toggleFlipping(object);var newOrigin=object.getPointByOrigin(oldOriginX,oldOriginY);object.set({originX:oldOriginX,originY:oldOriginY,left:newOrigin.x,top:newOrigin.y});return this;},_toggleFlipping:function(object){if(this.flipX){object.toggle('flipX');object.set('left',-object.get('left'));object.setAngle(-object.getAngle());}
if(this.flipY){object.toggle('flipY');object.set('top',-object.get('top'));object.setAngle(-object.getAngle());}},_restoreObjectState:function(object){this._setObjectPosition(object);object.setCoords();object.hasControls=object.__origHasControls;delete object.__origHasControls;object.set('active',false);object.setCoords();delete object.group;return this;},_setObjectPosition:function(object){var center=this.getCenterPoint(),rotated=this._getRotatedLeftTop(object);object.set({angle:object.getAngle()+this.getAngle(),left:center.x+rotated.left,top:center.y+rotated.top,scaleX:object.get('scaleX')*this.get('scaleX'),scaleY:object.get('scaleY')*this.get('scaleY')});},_getRotatedLeftTop:function(object){var groupAngle=this.getAngle()*(Math.PI/180);return{left:(-Math.sin(groupAngle)*object.getTop()*this.get('scaleY')+
Math.cos(groupAngle)*object.getLeft()*this.get('scaleX')),top:(Math.cos(groupAngle)*object.getTop()*this.get('scaleY')+
Math.sin(groupAngle)*object.getLeft()*this.get('scaleX'))};},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState();},saveCoords:function(){this._originalLeft=this.get('left');this._originalTop=this.get('top');return this;},hasMoved:function(){return this._originalLeft!==this.get('left')||this._originalTop!==this.get('top');},setObjectsCoords:function(){this.forEachObject(function(object){object.setCoords();});return this;},horizontalAlignment:function(type){var groupWidth=this.width,objects=this._objects,i=0,padding=this.padding,corners,tl,offsetX;switch(type){case'left':for(i=0;i<objects.length;i++){corners=objects[i].getCornerPoints(objects[i].getCenterPoint());tl=corners.tl.x;var minX=Math.min(tl,corners.tr.x,corners.bl.x,corners.br.x);offsetX=(minX<tl)?(tl-minX):0;objects[i].set('left',-groupWidth/2+padding+offsetX);}
break;case'right':for(i=0;i<objects.length;i++){corners=objects[i].getCornerPoints(objects[i].getCenterPoint());tl=corners.tl.x;var maxX=Math.max(tl,corners.tr.x,corners.bl.x,corners.br.x);offsetX=(maxX>tl)?(maxX-tl):0;objects[i].set('left',(groupWidth/2-offsetX-padding));}
break;case'center':for(i=0;i<objects.length;i++){corners=objects[i].getCornerPoints({x:0,y:objects[i].top});objects[i].set('left',corners.tl.x);}
break;default:return}
this.canvas.fire('object:modified',{target:this});},verticalAlignment:function(type){var groupHeight=this.height,objects=this._objects,i=0,padding=this.padding,corners,tl,offsetY;switch(type){case'top':for(i=0;i<objects.length;i++){corners=objects[i].getCornerPoints(objects[i].getCenterPoint());tl=corners.tl.y;var minY=Math.min(tl,corners.tr.y,corners.bl.y,corners.br.y);offsetY=(minY<tl)?(tl-minY):0;objects[i].set('top',-groupHeight/2+padding+offsetY);}
break;case'bottom':for(i=0;i<objects.length;i++){corners=objects[i].getCornerPoints(objects[i].getCenterPoint());tl=corners.tl.y;var maxY=Math.max(tl,corners.tr.y,corners.bl.y,corners.br.y);offsetY=(maxY>tl)?(maxY-tl):0;objects[i].set('top',(groupHeight/2-padding-offsetY));}
break;case'center':for(i=0;i<objects.length;i++){corners=objects[i].getCornerPoints({x:objects[i].left,y:0});objects[i].set('top',corners.tl.y);}
break;default:return}
this.canvas.fire('object:modified',{target:this});},_calcBounds:function(onlyWidthHeight){var aX=[],aY=[],o,prop,props=['tr','br','bl','tl'],i=0,iLen=this._objects.length,j,jLen=props.length;for(;i<iLen;++i){o=this._objects[i];o.setCoords();for(j=0;j<jLen;j++){prop=props[j];aX.push(o.oCoords[prop].x);aY.push(o.oCoords[prop].y);}}
this.set(this._getBounds(aX,aY,onlyWidthHeight));},_getBounds:function(aX,aY,onlyWidthHeight){var ivt=fabric.util.invertTransform(this.getViewportTransform()),minXY=fabric.util.transformPoint(new fabric.Point(min(aX),min(aY)),ivt),maxXY=fabric.util.transformPoint(new fabric.Point(max(aX),max(aY)),ivt),obj={width:(maxXY.x-minXY.x)||0,height:(maxXY.y-minXY.y)||0};if(!onlyWidthHeight){obj.left=minXY.x||0;obj.top=minXY.y||0;if(this.originX==='center'){obj.left+=obj.width/2;}
if(this.originX==='right'){obj.left+=obj.width;}
if(this.originY==='center'){obj.top+=obj.height/2;}
if(this.originY==='bottom'){obj.top+=obj.height;}}
return obj;},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();markup.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,len=this._objects.length;i<len;i++){markup.push('\t',this._objects[i].toSVG(reviver));}
markup.push('</g>\n');return reviver?reviver(markup.join('')):markup.join('');},get:function(prop){if(prop in _lockProperties){if(this[prop]){return this[prop];}
else{for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i][prop]){return true;}}
return false;}}
else{if(prop in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(prop);}
return this[prop];}}});fabric.Group.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects;callback&&callback(new fabric.Group(enlivenedObjects,object,true));});};fabric.Group.async=true;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var extend=fabric.util.object.extend;if(!global.fabric){global.fabric={};}
if(global.fabric.Image){fabric.warn('fabric.Image is already defined.');return;}
fabric.Image=fabric.util.createClass(fabric.Object,{type:'image',crossOrigin:'',alignX:'none',alignY:'none',meetOrSlice:'meet',_lastScaleX:1,_lastScaleY:1,initialize:function(element,options){options||(options={});this.filters=[];this.resizeFilters=[];this.callSuper('initialize',options);this._initElement(element,options);},getElement:function(){return this._element;},setElement:function(element,callback,options){this._element=element;this._originalElement=element;this._initConfig(options);if(this.filters.length!==0){this.applyFilters(callback);}
else if(callback){callback();}
return this;},setCrossOrigin:function(value){this.crossOrigin=value;this._element.crossOrigin=value;return this;},getOriginalSize:function(){var element=this.getElement();return{width:element.width,height:element.height};},_stroke:function(ctx){ctx.save();this._setStrokeStyles(ctx);ctx.beginPath();ctx.strokeRect(-this.width/2,-this.height/2,this.width,this.height);ctx.closePath();ctx.restore();},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.save();this._setStrokeStyles(ctx);ctx.beginPath();fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray);ctx.closePath();ctx.restore();},toObject:function(propertiesToInclude){var filters=[];this.filters.forEach(function(filterObj){if(filterObj){filters.push(filterObj.toObject());}});var object=extend(this.callSuper('toObject',propertiesToInclude),{src:this._originalElement.src||this._originalElement._src,filters:filters,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});if(this.resizeFilters.length>0){object.resizeFilters=this.resizeFilters.map(function(filterObj){return filterObj&&filterObj.toObject();});}
if(!this.includeDefaultValues){this._removeDefaultValues(object);}
return object;},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=-this.width/2,y=-this.height/2,preserveAspectRatio='none';if(this.group&&this.group.type==='path-group'){x=this.left;y=this.top;}
if(this.alignX!=='none'&&this.alignY!=='none'){preserveAspectRatio='x'+this.alignX+'Y'+this.alignY+' '+this.meetOrSlice;}
markup.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',x,'" y="',y,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',preserveAspectRatio,'"','></image>\n');if(this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null;markup.push('<rect ','x="',x,'" y="',y,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n');this.fill=origFill;}
markup.push('</g>\n');return reviver?reviver(markup.join('')):markup.join('');},getSrc:function(){if(this.getElement()){return this.getElement().src||this.getElement()._src;}},setSrc:function(src,callback,options){fabric.util.loadImage(src,function(img){return this.setElement(img,callback,options);},this,options&&options.crossOrigin);},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>';},clone:function(callback,propertiesToInclude){this.constructor.fromObject(this.toObject(propertiesToInclude),callback);},applyFilters:function(callback,filters,imgElement,forResizing){filters=filters||this.filters;imgElement=imgElement||this._originalElement;if(!imgElement){return;}
var imgEl=imgElement,canvasEl=fabric.util.createCanvasElement(),replacement=fabric.util.createImage(),_this=this;canvasEl.width=imgEl.width;canvasEl.height=imgEl.height;canvasEl.getContext('2d').drawImage(imgEl,0,0,imgEl.width,imgEl.height);if(filters.length===0){this._element=imgElement;callback&&callback();return canvasEl;}
filters.forEach(function(filter){filter&&filter.applyTo(canvasEl,filter.scaleX||_this.scaleX,filter.scaleY||_this.scaleY);if(!forResizing&&filter&&filter.type==='Resize'){_this.width*=filter.scaleX;_this.height*=filter.scaleY;}});replacement.width=canvasEl.width;replacement.height=canvasEl.height;if(fabric.isLikelyNode){replacement.src=canvasEl.toBuffer(undefined,fabric.Image.pngCompression);_this._element=replacement;!forResizing&&(_this._filteredEl=replacement);callback&&callback();}
else{replacement.onload=function(){_this._element=replacement;!forResizing&&(_this._filteredEl=replacement);callback&&callback();replacement.onload=canvasEl=imgEl=null;};replacement.src=canvasEl.toDataURL('image/png');}
return canvasEl;},_render:function(ctx,noTransform){var x,y,imageMargins=this._findMargins(),elementToDraw;x=(noTransform?this.left:-this.width/2);y=(noTransform?this.top:-this.height/2);if(this.meetOrSlice==='slice'){ctx.beginPath();ctx.rect(x,y,this.width,this.height);ctx.clip();}
if(this.isMoving===false&&this.resizeFilters.length&&this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;elementToDraw=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,true);}
else{elementToDraw=this._element;}
elementToDraw&&ctx.drawImage(elementToDraw,x+imageMargins.marginX,y+imageMargins.marginY,imageMargins.width,imageMargins.height);this._renderStroke(ctx);},_needsResize:function(){return(this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY);},_findMargins:function(){var width=this.width,height=this.height,scales,scale,marginX=0,marginY=0;if(this.alignX!=='none'||this.alignY!=='none'){scales=[this.width/this._element.width,this.height/this._element.height];scale=this.meetOrSlice==='meet'?Math.min.apply(null,scales):Math.max.apply(null,scales);width=this._element.width*scale;height=this._element.height*scale;if(this.alignX==='Mid'){marginX=(this.width-width)/2;}
if(this.alignX==='Max'){marginX=this.width-width;}
if(this.alignY==='Mid'){marginY=(this.height-height)/2;}
if(this.alignY==='Max'){marginY=this.height-height;}}
return{width:width,height:height,marginX:marginX,marginY:marginY};},_resetWidthHeight:function(){var element=this.getElement();this.set('width',element.width);this.set('height',element.height);},_initElement:function(element,options){this.setElement(fabric.util.getById(element),null,options);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS);},_initConfig:function(options){options||(options={});this.setOptions(options);this._setWidthHeight(options);if(this._element&&this.crossOrigin){this._element.crossOrigin=this.crossOrigin;}},_initFilters:function(filters,callback){if(filters&&filters.length){fabric.util.enlivenObjects(filters,function(enlivenedObjects){callback&&callback(enlivenedObjects);},'fabric.Image.filters');}
else{callback&&callback();}},_setWidthHeight:function(options){this.width='width'in options?options.width:(this.getElement()?this.getElement().width||0:0);this.height='height'in options?options.height:(this.getElement()?this.getElement().height||0:0);},complexity:function(){return 1;}});fabric.Image.CSS_CANVAS='canvas-img';fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){fabric.Image.prototype._initFilters.call(object,object.filters,function(filters){object.filters=filters||[];fabric.Image.prototype._initFilters.call(object,object.resizeFilters,function(resizeFilters){object.resizeFilters=resizeFilters||[];var instance=new fabric.Image(img,object);callback&&callback(instance);});});},null,object.crossOrigin);};fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img){callback&&callback(new fabric.Image(img,imgOptions));},null,imgOptions&&imgOptions.crossOrigin);};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href'.split(' '));fabric.Image.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES),preserveAR;if(parsedAttributes.preserveAspectRatio){preserveAR=fabric.util.parsePreserveAspectRatioAttribute(parsedAttributes.preserveAspectRatio);extend(parsedAttributes,preserveAR);}
fabric.Image.fromURL(parsedAttributes['xlink:href'],callback,extend((options?fabric.util.object.clone(options):{}),parsedAttributes));};fabric.Image.async=true;fabric.Image.pngCompression=1;})(typeof exports!=='undefined'?exports:this);fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:'BaseFilter',initialize:function(options){if(options){this.setOptions(options);}},setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},toObject:function(){return{type:this.type};},toJSON:function(){return this.toObject();}});(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Brightness=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Brightness',initialize:function(options){options=options||{};this.brightness=options.brightness||0;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,brightness=this.brightness;for(var i=0,len=data.length;i<len;i+=4){data[i]+=brightness;data[i+1]+=brightness;data[i+2]+=brightness;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{brightness:this.brightness});}});fabric.Image.filters.Brightness.fromObject=function(object){return new fabric.Image.filters.Brightness(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Convolute=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Convolute',initialize:function(options){options=options||{};this.opaque=options.opaque;this.matrix=options.matrix||[0,0,0,0,1,0,0,0,0];var canvasEl=fabric.util.createCanvasElement();this.tmpCtx=canvasEl.getContext('2d');},_createImageData:function(w,h){return this.tmpCtx.createImageData(w,h);},applyTo:function(canvasEl){var weights=this.matrix,context=canvasEl.getContext('2d'),pixels=context.getImageData(0,0,canvasEl.width,canvasEl.height),side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),src=pixels.data,sw=pixels.width,sh=pixels.height,w=sw,h=sh,output=this._createImageData(w,h),dst=output.data,alphaFac=this.opaque?1:0;for(var y=0;y<h;y++){for(var x=0;x<w;x++){var sy=y,sx=x,dstOff=(y*w+x)*4,r=0,g=0,b=0,a=0;for(var cy=0;cy<side;cy++){for(var cx=0;cx<side;cx++){var scy=sy+cy-halfSide,scx=sx+cx-halfSide;if(scy<0||scy>sh||scx<0||scx>sw){continue;}
var srcOff=(scy*sw+scx)*4,wt=weights[cy*side+cx];r+=src[srcOff]*wt;g+=src[srcOff+1]*wt;b+=src[srcOff+2]*wt;a+=src[srcOff+3]*wt;}}
dst[dstOff]=r;dst[dstOff+1]=g;dst[dstOff+2]=b;dst[dstOff+3]=a+alphaFac*(255-a);}}
context.putImageData(output,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{opaque:this.opaque,matrix:this.matrix});}});fabric.Image.filters.Convolute.fromObject=function(object){return new fabric.Image.filters.Convolute(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.GradientTransparency=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'GradientTransparency',initialize:function(options){options=options||{};this.threshold=options.threshold||100;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,total=data.length;for(var i=0,len=data.length;i<len;i+=4){data[i+3]=threshold+255*(total-i)/total;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{threshold:this.threshold});}});fabric.Image.filters.GradientTransparency.fromObject=function(object){return new fabric.Image.filters.GradientTransparency(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Grayscale=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Grayscale',applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,len=imageData.width*imageData.height*4,index=0,average;while(index<len){average=(data[index]+data[index+1]+data[index+2])/3;data[index]=average;data[index+1]=average;data[index+2]=average;index+=4;}
context.putImageData(imageData,0,0);}});fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale();};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Invert=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Invert',applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i;for(i=0;i<iLen;i+=4){data[i]=255-data[i];data[i+1]=255-data[i+1];data[i+2]=255-data[i+2];}
context.putImageData(imageData,0,0);}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert();};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Mask=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Mask',initialize:function(options){options=options||{};this.mask=options.mask;this.channel=[0,1,2,3].indexOf(options.channel)>-1?options.channel:0;},applyTo:function(canvasEl){if(!this.mask){return;}
var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,maskEl=this.mask.getElement(),maskCanvasEl=fabric.util.createCanvasElement(),channel=this.channel,i,iLen=imageData.width*imageData.height*4;maskCanvasEl.width=maskEl.width;maskCanvasEl.height=maskEl.height;maskCanvasEl.getContext('2d').drawImage(maskEl,0,0,maskEl.width,maskEl.height);var maskImageData=maskCanvasEl.getContext('2d').getImageData(0,0,maskEl.width,maskEl.height),maskData=maskImageData.data;for(i=0;i<iLen;i+=4){data[i+3]=maskData[i+channel];}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{mask:this.mask.toObject(),channel:this.channel});}});fabric.Image.filters.Mask.fromObject=function(object,callback){fabric.util.loadImage(object.mask.src,function(img){object.mask=new fabric.Image(img,object.mask);callback&&callback(new fabric.Image.filters.Mask(object));});};fabric.Image.filters.Mask.async=true;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Noise=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Noise',initialize:function(options){options=options||{};this.noise=options.noise||0;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,noise=this.noise,rand;for(var i=0,len=data.length;i<len;i+=4){rand=(0.5-Math.random())*noise;data[i]+=rand;data[i+1]+=rand;data[i+2]+=rand;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{noise:this.noise});}});fabric.Image.filters.Noise.fromObject=function(object){return new fabric.Image.filters.Noise(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Pixelate=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Pixelate',initialize:function(options){options=options||{};this.blocksize=options.blocksize||4;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=imageData.height,jLen=imageData.width,index,i,j,r,g,b,a;for(i=0;i<iLen;i+=this.blocksize){for(j=0;j<jLen;j+=this.blocksize){index=(i*4)*jLen+(j*4);r=data[index];g=data[index+1];b=data[index+2];a=data[index+3];for(var _i=i,_ilen=i+this.blocksize;_i<_ilen;_i++){for(var _j=j,_jlen=j+this.blocksize;_j<_jlen;_j++){index=(_i*4)*jLen+(_j*4);data[index]=r;data[index+1]=g;data[index+2]=b;data[index+3]=a;}}}}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{blocksize:this.blocksize});}});fabric.Image.filters.Pixelate.fromObject=function(object){return new fabric.Image.filters.Pixelate(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.RemoveWhite=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'RemoveWhite',initialize:function(options){options=options||{};this.threshold=options.threshold||30;this.distance=options.distance||20;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,distance=this.distance,limit=255-threshold,abs=Math.abs,r,g,b;for(var i=0,len=data.length;i<len;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(r>limit&&g>limit&&b>limit&&abs(r-g)<distance&&abs(r-b)<distance&&abs(g-b)<distance){data[i+3]=1;}}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{threshold:this.threshold,distance:this.distance});}});fabric.Image.filters.RemoveWhite.fromObject=function(object){return new fabric.Image.filters.RemoveWhite(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Sepia',applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,avg;for(i=0;i<iLen;i+=4){avg=0.3*data[i]+0.59*data[i+1]+0.11*data[i+2];data[i]=avg+100;data[i+1]=avg+50;data[i+2]=avg+255;}
context.putImageData(imageData,0,0);}});fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia();};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia2=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Sepia2',applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,r,g,b;for(i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];data[i]=Math.min((r*0.393+g*0.769+b*0.189),255);data[i+1]=Math.min((r*0.349+g*0.686+b*0.168),255);data[i+2]=Math.min((r*0.272+g*0.534+b*0.131),255);}
context.putImageData(imageData,0,0);}});fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2();};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Tint=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Tint',initialize:function(options){options=options||{};this.color=options.color||'#000000';this.opacity=typeof options.opacity!=='undefined'?options.opacity:new fabric.Color(this.color).getAlpha();},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,tintR,tintG,tintB,r,g,b,alpha1,source;source=new fabric.Color(this.color).getSource();tintR=source[0]*this.opacity;tintG=source[1]*this.opacity;tintB=source[2]*this.opacity;alpha1=1-this.opacity;for(i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];data[i]=tintR+r*alpha1;data[i+1]=tintG+g*alpha1;data[i+2]=tintB+b*alpha1;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{color:this.color,opacity:this.opacity});}});fabric.Image.filters.Tint.fromObject=function(object){return new fabric.Image.filters.Tint(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Multiply=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Multiply',initialize:function(options){options=options||{};this.color=options.color||'#000000';},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,source;source=new fabric.Color(this.color).getSource();for(i=0;i<iLen;i+=4){data[i]*=source[0]/255;data[i+1]*=source[1]/255;data[i+2]*=source[2]/255;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{color:this.color});}});fabric.Image.filters.Multiply.fromObject=function(object){return new fabric.Image.filters.Multiply(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric;fabric.Image.filters.Blend=fabric.util.createClass({type:'Blend',initialize:function(options){options=options||{};this.color=options.color||'#000';this.image=options.image||false;this.mode=options.mode||'multiply';this.alpha=options.alpha||1;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,tr,tg,tb,r,g,b,_r,_g,_b,source,isImage=false;if(this.image){isImage=true;var _el=fabric.util.createCanvasElement();_el.width=this.image.width;_el.height=this.image.height;var tmpCanvas=new fabric.StaticCanvas(_el);tmpCanvas.add(this.image);var context2=tmpCanvas.getContext('2d');source=context2.getImageData(0,0,tmpCanvas.width,tmpCanvas.height).data;}
else{source=new fabric.Color(this.color).getSource();tr=source[0]*this.alpha;tg=source[1]*this.alpha;tb=source[2]*this.alpha;}
for(var i=0,len=data.length;i<len;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(isImage){tr=source[i]*this.alpha;tg=source[i+1]*this.alpha;tb=source[i+2]*this.alpha;}
switch(this.mode){case'multiply':data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;break;case'screen':data[i]=1-(1-r)*(1-tr);data[i+1]=1-(1-g)*(1-tg);data[i+2]=1-(1-b)*(1-tb);break;case'add':data[i]=Math.min(255,r+tr);data[i+1]=Math.min(255,g+tg);data[i+2]=Math.min(255,b+tb);break;case'diff':case'difference':data[i]=Math.abs(r-tr);data[i+1]=Math.abs(g-tg);data[i+2]=Math.abs(b-tb);break;case'subtract':_r=r-tr;_g=g-tg;_b=b-tb;data[i]=(_r<0)?0:_r;data[i+1]=(_g<0)?0:_g;data[i+2]=(_b<0)?0:_b;break;case'darken':data[i]=Math.min(r,tr);data[i+1]=Math.min(g,tg);data[i+2]=Math.min(b,tb);break;case'lighten':data[i]=Math.max(r,tr);data[i+1]=Math.max(g,tg);data[i+2]=Math.max(b,tb);break;}}
context.putImageData(imageData,0,0);},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha};}});fabric.Image.filters.Blend.fromObject=function(object){return new fabric.Image.filters.Blend(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),pow=Math.pow,floor=Math.floor,sqrt=Math.sqrt,abs=Math.abs,max=Math.max,round=Math.round,sin=Math.sin,ceil=Math.ceil;fabric.Image.filters.Resize=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:'Resize',resizeType:'hermite',scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(canvasEl,scaleX,scaleY){this.rcpScaleX=1/scaleX;this.rcpScaleY=1/scaleY;var oW=canvasEl.width,oH=canvasEl.height,dW=round(oW*scaleX),dH=round(oH*scaleY),imageData;if(this.resizeType==='sliceHack'){imageData=this.sliceByTwo(canvasEl,oW,oH,dW,dH);}
if(this.resizeType==='hermite'){imageData=this.hermiteFastResize(canvasEl,oW,oH,dW,dH);}
if(this.resizeType==='bilinear'){imageData=this.bilinearFiltering(canvasEl,oW,oH,dW,dH);}
if(this.resizeType==='lanczos'){imageData=this.lanczosResize(canvasEl,oW,oH,dW,dH);}
canvasEl.width=dW;canvasEl.height=dH;canvasEl.getContext('2d').putImageData(imageData,0,0);},sliceByTwo:function(canvasEl,width,height,newWidth,newHeight){var context=canvasEl.getContext('2d'),imageData,multW=0.5,multH=0.5,signW=1,signH=1,doneW=false,doneH=false,stepW=width,stepH=height,tmpCanvas=fabric.util.createCanvasElement(),tmpCtx=tmpCanvas.getContext('2d');newWidth=floor(newWidth);newHeight=floor(newHeight);tmpCanvas.width=max(newWidth,width);tmpCanvas.height=max(newHeight,height);if(newWidth>width){multW=2;signW=-1;}
if(newHeight>height){multH=2;signH=-1;}
imageData=context.getImageData(0,0,width,height);canvasEl.width=max(newWidth,width);canvasEl.height=max(newHeight,height);context.putImageData(imageData,0,0);while(!doneW||!doneH){width=stepW;height=stepH;if(newWidth*signW<floor(stepW*multW*signW)){stepW=floor(stepW*multW);}
else{stepW=newWidth;doneW=true;}
if(newHeight*signH<floor(stepH*multH*signH)){stepH=floor(stepH*multH);}
else{stepH=newHeight;doneH=true;}
imageData=context.getImageData(0,0,width,height);tmpCtx.putImageData(imageData,0,0);context.clearRect(0,0,stepW,stepH);context.drawImage(tmpCanvas,0,0,width,height,0,0,stepW,stepH);}
return context.getImageData(0,0,newWidth,newHeight);},lanczosResize:function(canvasEl,oW,oH,dW,dH){function lanczosCreate(lobes){return function(x){if(x>lobes){return 0;}
x*=Math.PI;if(abs(x)<1e-16){return 1;}
var xx=x/lobes;return sin(x)*sin(xx)/x/xx;};}
function process(u){var v,i,weight,idx,a,red,green,blue,alpha,fX,fY;center.x=(u+0.5)*ratioX;icenter.x=floor(center.x);for(v=0;v<dH;v++){center.y=(v+0.5)*ratioY;icenter.y=floor(center.y);a=0,red=0,green=0,blue=0,alpha=0;for(i=icenter.x-range2X;i<=icenter.x+range2X;i++){if(i<0||i>=oW){continue;}
fX=floor(1000*abs(i-center.x));if(!cacheLanc[fX]){cacheLanc[fX]={};}
for(var j=icenter.y-range2Y;j<=icenter.y+range2Y;j++){if(j<0||j>=oH){continue;}
fY=floor(1000*abs(j-center.y));if(!cacheLanc[fX][fY]){cacheLanc[fX][fY]=lanczos(sqrt(pow(fX*rcpRatioX,2)+pow(fY*rcpRatioY,2))/1000);}
weight=cacheLanc[fX][fY];if(weight>0){idx=(j*oW+i)*4;a+=weight;red+=weight*srcData[idx];green+=weight*srcData[idx+1];blue+=weight*srcData[idx+2];alpha+=weight*srcData[idx+3];}}}
idx=(v*dW+u)*4;destData[idx]=red/a;destData[idx+1]=green/a;destData[idx+2]=blue/a;destData[idx+3]=alpha/a;}
if(++u<dW){return process(u);}
else{return destImg;}}
var context=canvasEl.getContext('2d'),srcImg=context.getImageData(0,0,oW,oH),destImg=context.getImageData(0,0,dW,dH),srcData=srcImg.data,destData=destImg.data,lanczos=lanczosCreate(this.lanczosLobes),ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,rcpRatioX=2/this.rcpScaleX,rcpRatioY=2/this.rcpScaleY,range2X=ceil(ratioX*this.lanczosLobes/2),range2Y=ceil(ratioY*this.lanczosLobes/2),cacheLanc={},center={},icenter={};return process(0);},bilinearFiltering:function(canvasEl,w,h,w2,h2){var a,b,c,d,x,y,i,j,xDiff,yDiff,chnl,color,offset=0,origPix,ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,context=canvasEl.getContext('2d'),w4=4*(w-1),img=context.getImageData(0,0,w,h),pixels=img.data,destImage=context.getImageData(0,0,w2,h2),destPixels=destImage.data;for(i=0;i<h2;i++){for(j=0;j<w2;j++){x=floor(ratioX*j);y=floor(ratioY*i);xDiff=ratioX*j-x;yDiff=ratioY*i-y;origPix=4*(y*w+x);for(chnl=0;chnl<4;chnl++){a=pixels[origPix+chnl];b=pixels[origPix+4+chnl];c=pixels[origPix+w4+chnl];d=pixels[origPix+w4+4+chnl];color=a*(1-xDiff)*(1-yDiff)+b*xDiff*(1-yDiff)+
c*yDiff*(1-xDiff)+d*xDiff*yDiff;destPixels[offset++]=color;}}}
return destImage;},hermiteFastResize:function(canvasEl,oW,oH,dW,dH){var ratioW=this.rcpScaleX,ratioH=this.rcpScaleY,ratioWHalf=ceil(ratioW/2),ratioHHalf=ceil(ratioH/2),context=canvasEl.getContext('2d'),img=context.getImageData(0,0,oW,oH),data=img.data,img2=context.getImageData(0,0,dW,dH),data2=img2.data;for(var j=0;j<dH;j++){for(var i=0;i<dW;i++){var x2=(i+j*dW)*4,weight=0,weights=0,weightsAlpha=0,gxR=0,gxG=0,gxB=0,gxA=0,centerY=(j+0.5)*ratioH;for(var yy=floor(j*ratioH);yy<(j+1)*ratioH;yy++){var dy=abs(centerY-(yy+0.5))/ratioHHalf,centerX=(i+0.5)*ratioW,w0=dy*dy;for(var xx=floor(i*ratioW);xx<(i+1)*ratioW;xx++){var dx=abs(centerX-(xx+0.5))/ratioWHalf,w=sqrt(w0+dx*dx);if(w>1&&w<-1){continue;}
weight=2*w*w*w-3*w*w+1;if(weight>0){dx=4*(xx+yy*oW);gxA+=weight*data[dx+3];weightsAlpha+=weight;if(data[dx+3]<255){weight=weight*data[dx+3]/250;}
gxR+=weight*data[dx];gxG+=weight*data[dx+1];gxB+=weight*data[dx+2];weights+=weight;}}}
data2[x2]=gxR/weights;data2[x2+1]=gxG/weights;data2[x2+2]=gxB/weights;data2[x2+3]=gxA/weightsAlpha;}}
return img2;},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes};}});fabric.Image.filters.Resize.fromObject=function(object){return new fabric.Image.filters.Resize(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Contrast=createClass(filters.BaseFilter,{type:'Contrast',initialize:function(options){options=options||{};this.contrast=options.contrast||0;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,contrastF=259*(this.contrast+255)/(255*(259-this.contrast));for(var i=0,len=data.length;i<len;i+=4){data[i]=contrastF*(data[i]-128)+128;data[i+1]=contrastF*(data[i+1]-128)+128;data[i+2]=contrastF*(data[i+2]-128)+128;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{contrast:this.contrast});}});fabric.Image.filters.Contrast.fromObject=function(object){return new fabric.Image.filters.Contrast(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Saturate=createClass(filters.BaseFilter,{type:'Saturate',initialize:function(options){options=options||{};this.saturate=options.saturate||0;},applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,max,adjust=-this.saturate*0.01;for(var i=0,len=data.length;i<len;i+=4){max=Math.max(data[i],data[i+1],data[i+2]);data[i]+=max!==data[i]?(max-data[i])*adjust:0;data[i+1]+=max!==data[i+1]?(max-data[i+1])*adjust:0;data[i+2]+=max!==data[i+2]?(max-data[i+2])*adjust:0;}
context.putImageData(imageData,0,0);},toObject:function(){return extend(this.callSuper('toObject'),{saturate:this.saturate});}});fabric.Image.filters.Saturate.fromObject=function(object){return new fabric.Image.filters.Saturate(object);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,supportsLineDash=fabric.StaticCanvas.supports('setLineDash'),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(fabric.Text){fabric.warn('fabric.Text is already defined');return;}
var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push('fontFamily','fontWeight','fontSize','text','textDecoration','textAlign','fontStyle','lineHeight','textBackgroundColor');fabric.Text=fabric.util.createClass(fabric.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true,textAlign:true,letterSpacing:true},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:'text',letterSpacing:0,fontSize:40,fontWeight:'normal',fontFamily:'Times New Roman',textDecoration:'',textAlign:'left',fontStyle:'',lineHeight:1.16,textBackgroundColor:'',stateProperties:stateProperties,stroke:null,shadow:null,_fontSizeFraction:0.25,_fontSizeMult:1.13,initialize:function(text,options){options=options||{};this.text=text;this.__skipDimension=true;this.setOptions(options);this.__skipDimension=false;this._initDimensions();},_initDimensions:function(ctx){if(this.__skipDimension){return;}
if(!ctx){ctx=fabric.util.createCanvasElement().getContext('2d');this._setTextStyles(ctx);}
this._textLines=this._splitTextIntoLines();this._clearCache();this._cacheLinesWidth=(this.textAlign!=='justify');this.width=this._getTextWidth(ctx);this._cacheLinesWidth=true;this.height=this._getTextHeight(ctx);},toString:function(){return'#<fabric.Text ('+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>';},_render:function(ctx){this.clipTo&&fabric.util.clipContext(this,ctx);this._setOpacity(ctx);this._setShadow(ctx);this._setupCompositeOperation(ctx);this._renderTextBackground(ctx);this._setStrokeStyles(ctx);this._setFillStyles(ctx);this._renderText(ctx);this._renderTextDecoration(ctx);this.clipTo&&ctx.restore();},_renderText:function(ctx){this._translateForTextAlign(ctx);this._renderTextFill(ctx);this._renderTextStroke(ctx);this._translateForTextAlign(ctx,true);},_translateForTextAlign:function(ctx,back){if(this.textAlign!=='left'&&this.textAlign!=='justify'){var sign=back?-1:1;ctx.translate(this.textAlign==='center'?(sign*this.width/2):sign*this.width,0);}},_setTextStyles:function(ctx){ctx.textBaseline='alphabetic';if(!this.skipTextAlign){ctx.textAlign=this.textAlign;}
ctx.font=this._getFontDeclaration();},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine();},_getTextWidth:function(ctx){var maxWidth=this._getLineWidth(ctx,0);for(var i=1,len=this._textLines.length;i<len;i++){var currentLineWidth=this._getLineWidth(ctx,i);if(currentLineWidth>maxWidth){maxWidth=currentLineWidth;}}
return maxWidth;},_renderChars:function(method,ctx,chars,left,top){var shortM=method.slice(0,-4);if(this[shortM].toLive){var offsetX=-this.width/2+this[shortM].offsetX||0,offsetY=-this.height/2+this[shortM].offsetY||0;ctx.save();ctx.translate(offsetX,offsetY);left-=offsetX;top-=offsetY;}
if(!this.letterSpacing){ctx[method](chars,left,top);this[shortM].toLive&&ctx.restore();return;}
var characters=String.prototype.split.call(chars,''),index=0,current,align=1;if(this.textAlign==='right'){characters=characters.reverse();align=-1;}
else if(this.textAlign==='center'){ctx.textAlign='start';var totalWidth=0;for(var i=0;i<characters.length;i++){totalWidth+=(ctx.measureText(characters[i]).width+this.letterSpacing);}
totalWidth=totalWidth-this.letterSpacing;left=left-(totalWidth/2);}
while(index<(characters.length)){current=characters[index++];ctx[method](current,left,top);left+=(align*(ctx.measureText(current).width+this.letterSpacing));}
this[shortM].toLive&&ctx.restore();},_renderTextLine:function(method,ctx,line,left,top,lineIndex){top-=this.fontSize*this._fontSizeFraction;var lineWidth=this._getLineWidth(ctx,lineIndex)-this.letterSpacing;if(this.textAlign!=='justify'||this.width<lineWidth){this._renderChars(method,ctx,line,left,top,lineIndex);return;}
var words=line.split(/\s+/),wordsWidth=this._getWidthOfWords(ctx,line,lineIndex),widthDiff=this.width-wordsWidth,numSpaces=words.length-1,spaceWidth=numSpaces>0?widthDiff/numSpaces:0,leftOffset=0,charOffset=0,word;for(var i=0,len=words.length;i<len;i++){while(line[charOffset]===' '&&charOffset<line.length){charOffset++;}
word=words[i];this._renderChars(method,ctx,word,left+leftOffset,top,lineIndex,charOffset);leftOffset+=(this._getWidthOfWords(ctx,words[i],lineIndex)+spaceWidth);charOffset+=word.length;}},_getWidthOfWords:function(ctx,line){return ctx.measureText(line.replace(/\s+/g,'')).width;},_getLeftOffset:function(){return-this.width/2;},_getTopOffset:function(){return-this.height/2;},_renderTextFill:function(ctx){if(!this.fill&&!this._skipFillStrokeCheck){return;}
var lineHeights=0;for(var i=0,len=this._textLines.length;i<len;i++){var heightOfLine=this._getHeightOfLine(ctx,i),maxHeight=heightOfLine/this.lineHeight;this._renderTextLine('fillText',ctx,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights+maxHeight,i);lineHeights+=heightOfLine;}},_renderTextStroke:function(ctx){if((!this.stroke||this.strokeWidth===0)&&!this._skipFillStrokeCheck){return;}
var lineHeights=0;if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}
ctx.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);}
supportsLineDash&&ctx.setLineDash(this.strokeDashArray);}
ctx.beginPath();for(var i=0,len=this._textLines.length;i<len;i++){var heightOfLine=this._getHeightOfLine(ctx,i),maxHeight=heightOfLine/this.lineHeight;this._renderTextLine('strokeText',ctx,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights+maxHeight,i);lineHeights+=heightOfLine;}
ctx.closePath();ctx.restore();},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight;},_renderTextBackground:function(ctx){this._renderTextBoxBackground(ctx);this._renderTextLinesBackground(ctx);},_renderTextBoxBackground:function(ctx){if(!this.backgroundColor){return;}
ctx.fillStyle=this.backgroundColor;ctx.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);},_renderTextLinesBackground:function(ctx){if(!this.textBackgroundColor){return;}
var lineTopOffset=0,heightOfLine=this._getHeightOfLine(),lineWidth,lineLeftOffset;ctx.fillStyle=this.textBackgroundColor;for(var i=0,len=this._textLines.length;i<len;i++){if(this._textLines[i]!==''){lineWidth=this._getLineWidth(ctx,i);lineLeftOffset=this._getLineLeftOffset(lineWidth);ctx.fillRect(this._getLeftOffset()+lineLeftOffset,this._getTopOffset()+lineTopOffset,lineWidth,this.fontSize*this._fontSizeMult);}
lineTopOffset+=heightOfLine;}},_getLineLeftOffset:function(lineWidth){if(this.textAlign==='center'){return(this.width-lineWidth)/2;}
if(this.textAlign==='right'){return this.width-lineWidth;}
return 0;},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];},_shouldClearCache:function(){var shouldClear=false;if(this._forceClearCache){this._forceClearCache=false;return true;}
for(var prop in this._dimensionAffectingProps){if(this['__'+prop]!==this[prop]){this['__'+prop]=this[prop];shouldClear=true;}}
return shouldClear;},_getLineWidth:function(ctx,lineIndex){if(this.__lineWidths[lineIndex]){return this.__lineWidths[lineIndex];}
var width,wordCount,line=this._textLines[lineIndex];if(line===''){width=0;}
else if(this.textAlign==='justify'&&this._cacheLinesWidth){wordCount=line.split(' ');if(wordCount.length>1){width=this.width;}
else{width=ctx.measureText(line).width;}}
else{width=ctx.measureText(line).width;}
this._cacheLinesWidth&&(this.__lineWidths[lineIndex]=width);return width;},_renderTextDecoration:function(ctx){if(!this.textDecoration){return;}
var halfOfVerticalBox=this.height/2,_this=this,offsets=[];function renderLinesAtOffset(offsets){var i,lineHeight=0,len,j,oLen,lineWidth,lineLeftOffset,heightOfLine;for(i=0,len=_this._textLines.length;i<len;i++){lineWidth=_this._getLineWidth(ctx,i),lineLeftOffset=_this._getLineLeftOffset(lineWidth),heightOfLine=_this._getHeightOfLine(ctx,i);for(j=0,oLen=offsets.length;j<oLen;j++){ctx.fillRect(_this._getLeftOffset()+lineLeftOffset,lineHeight+(_this._fontSizeMult-1+offsets[j])*_this.fontSize-halfOfVerticalBox,lineWidth,_this.fontSize/15);}
lineHeight+=heightOfLine;}}
if(this.textDecoration.indexOf('underline')>-1){offsets.push(0.85);}
if(this.textDecoration.indexOf('line-through')>-1){offsets.push(0.43);}
if(this.textDecoration.indexOf('overline')>-1){offsets.push(-0.12);}
if(offsets.length>0){renderLinesAtOffset(offsets);}},_getFontDeclaration:function(){return[(fabric.isLikelyNode?this.fontWeight:this.fontStyle),(fabric.isLikelyNode?this.fontStyle:this.fontWeight),this.fontSize+'px',(fabric.isLikelyNode?('"'+this.fontFamily+'"'):this.fontFamily)].join(' ');},render:function(ctx,noTransform){if(!this.visible){return;}
ctx.save();this._setTextStyles(ctx);if(this._shouldClearCache()){this._initDimensions(ctx);}
if(!noTransform){this.transform(ctx);}
if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix);}
if(this.group&&this.group.type==='path-group'){ctx.translate(this.left,this.top);}
this._render(ctx);ctx.restore();},_splitTextIntoLines:function(){return this.text.split(this._reNewline);},toObject:function(propertiesToInclude){var object=extend(this.callSuper('toObject',propertiesToInclude),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});if(!this.includeDefaultValues){this._removeDefaultValues(object);}
return object;},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),offsets=this._getSVGLeftTopOffsets(this.ctx),textAndBg=this._getSVGTextAndBg(offsets.textTop,offsets.textLeft);this._wrapSVGTextAndBg(markup,textAndBg);return reviver?reviver(markup.join('')):markup.join('');},_getSVGLeftTopOffsets:function(ctx){var lineTop=this._getHeightOfLine(ctx,0),textLeft=-this.width/2,textTop=0;return{textLeft:textLeft+(this.group&&this.group.type==='path-group'?this.left:0),textTop:textTop+(this.group&&this.group.type==='path-group'?-this.top:0),lineTop:lineTop};},_wrapSVGTextAndBg:function(markup,textAndBg){markup.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',textAndBg.textBgRects.join(''),'\t\t<text ',(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,'\'')+'" ':''),(this.fontSize?'font-size="'+this.fontSize+'" ':''),(this.fontStyle?'font-style="'+this.fontStyle+'" ':''),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':''),(this.textDecoration?'text-decoration="'+this.textDecoration+'" ':''),'style="',this.getSvgStyles(),'" >',textAndBg.textSpans.join(''),'</text>\n','\t</g>\n');},_getSVGTextAndBg:function(textTopOffset,textLeftOffset){var textSpans=[],textBgRects=[],height=0;this._setSVGBg(textBgRects);for(var i=0,len=this._textLines.length;i<len;i++){if(this.textBackgroundColor){this._setSVGTextLineBg(textBgRects,i,textLeftOffset,textTopOffset,height);}
this._setSVGTextLineText(i,textSpans,height,textLeftOffset,textTopOffset,textBgRects);height+=this._getHeightOfLine(this.ctx,i);}
return{textSpans:textSpans,textBgRects:textBgRects};},_setSVGTextLineText:function(i,textSpans,height,textLeftOffset,textTopOffset){var yPos=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)
-textTopOffset+height-this.height/2;textSpans.push('<tspan x="',toFixed(textLeftOffset+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),NUM_FRACTION_DIGITS),'" ','y="',toFixed(yPos,NUM_FRACTION_DIGITS),'" ',this._getFillAttributes(this.fill),'>',fabric.util.string.escapeXml(this._textLines[i]),'</tspan>');},_setSVGTextLineBg:function(textBgRects,i,textLeftOffset,textTopOffset,height){textBgRects.push('\t\t<rect ',this._getFillAttributes(this.textBackgroundColor),' x="',toFixed(textLeftOffset+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),NUM_FRACTION_DIGITS),'" y="',toFixed(height-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(this._getLineWidth(this.ctx,i),NUM_FRACTION_DIGITS),'" height="',toFixed(this._getHeightOfLine(this.ctx,i)/this.lineHeight,NUM_FRACTION_DIGITS),'"></rect>\n');},_setSVGBg:function(textBgRects){if(this.backgroundColor){textBgRects.push('\t\t<rect ',this._getFillAttributes(this.backgroundColor),' x="',toFixed(-this.width/2,NUM_FRACTION_DIGITS),'" y="',toFixed(-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(this.width,NUM_FRACTION_DIGITS),'" height="',toFixed(this.height,NUM_FRACTION_DIGITS),'"></rect>\n');}},_getFillAttributes:function(value){var fillColor=(value&&typeof value==='string')?new fabric.Color(value):'';if(!fillColor||!fillColor.getSource()||fillColor.getAlpha()===1){return'fill="'+value+'"';}
return'opacity="'+fillColor.getAlpha()+'" fill="'+fillColor.setAlpha(1).toRgb()+'"';},_set:function(key,value){this.callSuper('_set',key,value);if(key in this._dimensionAffectingProps){this._initDimensions();this.setCoords();}},complexity:function(){return 1;}});fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y dx dy font-family font-style font-weight font-size text-decoration text-anchor'.split(' '));fabric.Text.DEFAULT_SVG_FONT_SIZE=16;fabric.Text.fromElement=function(element,options){if(!element){return null;}
var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES);options=fabric.util.object.extend((options?fabric.util.object.clone(options):{}),parsedAttributes);options.top=options.top||0;options.left=options.left||0;if('dx'in parsedAttributes){options.left+=parsedAttributes.dx;}
if('dy'in parsedAttributes){options.top+=parsedAttributes.dy;}
if(!('fontSize'in options)){options.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}
if(!options.originX){options.originX='left';}
var textContent=element.textContent.replace(/^\s+|\s+$|\n+/g,'').replace(/\s+/g,' '),text=new fabric.Text(textContent,options),offX=0;if(text.originX==='left'){offX=text.getWidth()/2;}
if(text.originX==='right'){offX=-text.getWidth()/2;}
text.set({left:text.getLeft()+offX,top:text.getTop()-text.getHeight()/2+text.fontSize*(0.18+text._fontSizeFraction)});return text;};fabric.Text.fromObject=function(object){return new fabric.Text(object.text,clone(object));};fabric.util.createAccessors(fabric.Text);})(typeof exports!=='undefined'?exports:this);(function(){var clone=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:'i-text',selectionStart:0,selectionEnd:0,selectionColor:'rgba(17,119,255,0.3)',isEditing:false,editable:true,editingBorderColor:'rgba(102,153,255,0.25)',cursorWidth:2,cursorColor:'#333',cursorDelay:1000,cursorDuration:600,styles:null,caching:true,_skipFillStrokeCheck:false,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,_charWidthsCache:{},__widthOfSpace:[],initialize:function(text,options){this.styles=options?(options.styles||{}):{};this.callSuper('initialize',text,options);this.initBehavior();},_clearCache:function(){this.callSuper('_clearCache');this.__widthOfSpace=[];},isEmptyStyles:function(){if(!this.styles){return true;}
var obj=this.styles;for(var p1 in obj){for(var p2 in obj[p1]){for(var p3 in obj[p1][p2]){return false;}}}
return true;},setSelectionStart:function(index){index=Math.max(index,0);if(this.selectionStart!==index){this.fire('selection:changed');this.canvas&&this.canvas.fire('text:selection:changed',{target:this});this.selectionStart=index;}
this._updateTextarea();},setSelectionEnd:function(index){index=Math.min(index,this.text.length);if(this.selectionEnd!==index){this.fire('selection:changed');this.canvas&&this.canvas.fire('text:selection:changed',{target:this});this.selectionEnd=index;}
this._updateTextarea();},getSelectionStyles:function(startIndex,endIndex){if(arguments.length===2){var styles=[];for(var i=startIndex;i<endIndex;i++){styles.push(this.getSelectionStyles(i));}
return styles;}
var loc=this.get2DCursorLocation(startIndex),style=this._getStyleDeclaration(loc.lineIndex,loc.charIndex);return style||{};},setSelectionStyles:function(styles){if(this.selectionStart===this.selectionEnd){this._extendStyles(this.selectionStart,styles);}
else{for(var i=this.selectionStart;i<this.selectionEnd;i++){this._extendStyles(i,styles);}}
this._forceClearCache=true;return this;},_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);if(!this._getLineStyle(loc.lineIndex)){this._setLineStyle(loc.lineIndex,{});}
if(!this._getStyleDeclaration(loc.lineIndex,loc.charIndex)){this._setStyleDeclaration(loc.lineIndex,loc.charIndex,{});}
fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex,loc.charIndex),styles);},_render:function(ctx){this.callSuper('_render',ctx);this.ctx=ctx;this.isEditing&&this.renderCursorOrSelection();},renderCursorOrSelection:function(){if(!this.active){return;}
var chars=this.text.split(''),boundaries,ctx;if(this.canvas.contextTop){ctx=this.canvas.contextTop;ctx.save();ctx.transform.apply(ctx,this.canvas.viewportTransform);this.transform(ctx);this.transformMatrix&&ctx.transform.apply(ctx,this.transformMatrix);}
else{ctx=this.ctx;ctx.save();}
if(this.selectionStart===this.selectionEnd){boundaries=this._getCursorBoundaries(chars,'cursor');this.renderCursor(boundaries,ctx);}
else{boundaries=this._getCursorBoundaries(chars,'selection');this.renderSelection(chars,boundaries,ctx);}
ctx.restore();},get2DCursorLocation:function(selectionStart){if(typeof selectionStart==='undefined'){selectionStart=this.selectionStart;}
var len=this._textLines.length;for(var i=0;i<len;i++){if(selectionStart<=this._textLines[i].length){return{lineIndex:i,charIndex:selectionStart};}
selectionStart-=this._textLines[i].length+1;}
return{lineIndex:i-1,charIndex:this._textLines[i-1].length<selectionStart?this._textLines[i-1].length:selectionStart};},getCurrentCharStyle:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex===0?0:charIndex-1);return{fontSize:style&&style.fontSize||this.fontSize,fill:style&&style.fill||this.fill,textBackgroundColor:style&&style.textBackgroundColor||this.textBackgroundColor,textDecoration:style&&style.textDecoration||this.textDecoration,fontFamily:style&&style.fontFamily||this.fontFamily,fontWeight:style&&style.fontWeight||this.fontWeight,fontStyle:style&&style.fontStyle||this.fontStyle,stroke:style&&style.stroke||this.stroke,strokeWidth:style&&style.strokeWidth||this.strokeWidth};},getCurrentCharFontSize:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex===0?0:charIndex-1);return style&&style.fontSize?style.fontSize:this.fontSize;},getCurrentCharColor:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex===0?0:charIndex-1);return style&&style.fill?style.fill:this.cursorColor;},_getCursorBoundaries:function(chars,typeOfBoundaries){var left=Math.round(this._getLeftOffset()),top=this._getTopOffset(),offsets=this._getCursorBoundariesOffsets(chars,typeOfBoundaries);return{left:left,top:top,leftOffset:offsets.left+offsets.lineLeft,topOffset:offsets.top};},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries){var lineLeftOffset=0,lineIndex=0,charIndex=0,topOffset=0,leftOffset=0;for(var i=0;i<this.selectionStart;i++){if(chars[i]==='\n'){leftOffset=0;topOffset+=this._getHeightOfLine(this.ctx,lineIndex);lineIndex++;charIndex=0;}
else{leftOffset+=this._getWidthOfChar(this.ctx,chars[i],lineIndex,charIndex);charIndex++;}
lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex));}
if(typeOfBoundaries==='cursor'){topOffset+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,lineIndex)/this.lineHeight
-this.getCurrentCharFontSize(lineIndex,charIndex)*(1-this._fontSizeFraction);}
return{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset};},renderCursor:function(boundaries,ctx){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getCurrentCharFontSize(lineIndex,charIndex),leftOffset=(lineIndex===0&&charIndex===0)?this._getLineLeftOffset(this._getLineWidth(ctx,lineIndex)):boundaries.leftOffset;ctx.fillStyle=this.getCurrentCharColor(lineIndex,charIndex);ctx.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;ctx.fillRect(boundaries.left+leftOffset,boundaries.top+boundaries.topOffset,this.cursorWidth/this.scaleX,charHeight);},renderSelection:function(chars,boundaries,ctx){ctx.fillStyle=this.selectionColor;var start=this.get2DCursorLocation(this.selectionStart),end=this.get2DCursorLocation(this.selectionEnd),startLine=start.lineIndex,endLine=end.lineIndex;for(var i=startLine;i<=endLine;i++){var lineOffset=this._getLineLeftOffset(this._getLineWidth(ctx,i))||0,lineHeight=this._getHeightOfLine(this.ctx,i),boxWidth=0,line=this._textLines[i];if(i===startLine){for(var j=0,len=line.length;j<len;j++){if(j>=start.charIndex&&(i!==endLine||j<end.charIndex)){boxWidth+=this._getWidthOfChar(ctx,line[j],i,j);}
if(j<start.charIndex){lineOffset+=this._getWidthOfChar(ctx,line[j],i,j);}}}
else if(i>startLine&&i<endLine){boxWidth+=this._getLineWidth(ctx,i)||5;}
else if(i===endLine){for(var j2=0,j2len=end.charIndex;j2<j2len;j2++){boxWidth+=this._getWidthOfChar(ctx,line[j2],i,j2);}}
ctx.fillRect(boundaries.left+lineOffset,boundaries.top+boundaries.topOffset,boxWidth,lineHeight);boundaries.topOffset+=lineHeight;}},_renderChars:function(method,ctx,line,left,top,lineIndex,charOffset){if(this.isEmptyStyles()){return this._renderCharsFast(method,ctx,line,left,top);}
charOffset=charOffset||0;this.skipTextAlign=true;left-=this.textAlign==='center'?(this.width/2):(this.textAlign==='right')?this.width:0;var lineHeight=this._getHeightOfLine(ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(ctx,lineIndex)),prevStyle,thisStyle,charsToRender='';left+=lineLeftOffset||0;ctx.save();top-=lineHeight/this.lineHeight*this._fontSizeFraction;for(var i=charOffset,len=line.length+charOffset;i<=len;i++){prevStyle=prevStyle||this.getCurrentCharStyle(lineIndex,i);thisStyle=this.getCurrentCharStyle(lineIndex,i+1);if(this._hasStyleChanged(prevStyle,thisStyle)||i===len){this._renderChar(method,ctx,lineIndex,i-1,charsToRender,left,top,lineHeight);charsToRender='';prevStyle=thisStyle;}
charsToRender+=line[i-charOffset];}
ctx.restore();},_renderCharsFast:function(method,ctx,line,left,top){this.skipTextAlign=false;if(method==='fillText'&&this.fill){this.callSuper('_renderChars',method,ctx,line,left,top);}
if(method==='strokeText'&&((this.stroke&&this.strokeWidth>0)||this.skipFillStrokeCheck)){this.callSuper('_renderChars',method,ctx,line,left,top);}},_renderChar:function(method,ctx,lineIndex,i,_char,left,top,lineHeight){var charWidth,charHeight,shouldFill,shouldStroke,decl=this._getStyleDeclaration(lineIndex,i),offset,textDecoration;if(decl){charHeight=this._getHeightOfChar(ctx,_char,lineIndex,i);shouldStroke=decl.stroke;shouldFill=decl.fill;textDecoration=decl.textDecoration;}
else{charHeight=this.fontSize;}
shouldStroke=(shouldStroke||this.stroke)&&method==='strokeText';shouldFill=(shouldFill||this.fill)&&method==='fillText';decl&&ctx.save();charWidth=this._applyCharStylesGetWidth(ctx,_char,lineIndex,i,decl||{});textDecoration=textDecoration||this.textDecoration;shouldFill&&ctx.fillText(_char,left,top);shouldStroke&&ctx.strokeText(_char,left,top);if(textDecoration||textDecoration!==''){offset=this._fontSizeFraction*lineHeight/this.lineHeight;this._renderCharDecoration(ctx,textDecoration,left,top,offset,charWidth,charHeight);}
decl&&ctx.restore();ctx.translate(charWidth,0);},_hasStyleChanged:function(prevStyle,thisStyle){return(prevStyle.fill!==thisStyle.fill||prevStyle.fontSize!==thisStyle.fontSize||prevStyle.textBackgroundColor!==thisStyle.textBackgroundColor||prevStyle.textDecoration!==thisStyle.textDecoration||prevStyle.fontFamily!==thisStyle.fontFamily||prevStyle.fontWeight!==thisStyle.fontWeight||prevStyle.fontStyle!==thisStyle.fontStyle||prevStyle.stroke!==thisStyle.stroke||prevStyle.strokeWidth!==thisStyle.strokeWidth);},_renderCharDecoration:function(ctx,textDecoration,left,top,offset,charWidth,charHeight){if(!textDecoration){return;}
var decorationWeight=charHeight/15,positions={underline:top+charHeight/10,'line-through':top-charHeight*(this._fontSizeFraction+this._fontSizeMult-1)+decorationWeight,overline:top-(this._fontSizeMult-this._fontSizeFraction)*charHeight},decorations=['underline','line-through','overline'],i,decoration;for(i=0;i<decorations.length;i++){decoration=decorations[i];if(textDecoration.indexOf(decoration)>-1){ctx.fillRect(left,positions[decoration],charWidth,decorationWeight);}}},_renderTextLine:function(method,ctx,line,left,top,lineIndex){if(!this.isEmptyStyles()){top+=this.fontSize*(this._fontSizeFraction+0.03);}
this.callSuper('_renderTextLine',method,ctx,line,left,top,lineIndex);},_renderTextDecoration:function(ctx){if(this.isEmptyStyles()){return this.callSuper('_renderTextDecoration',ctx);}},_renderTextLinesBackground:function(ctx){if(!this.textBackgroundColor&&!this.styles){return;}
ctx.save();if(this.textBackgroundColor){ctx.fillStyle=this.textBackgroundColor;}
var lineHeights=0;for(var i=0,len=this._textLines.length;i<len;i++){var heightOfLine=this._getHeightOfLine(ctx,i);if(this._textLines[i]===''){lineHeights+=heightOfLine;continue;}
var lineWidth=this._getLineWidth(ctx,i),lineLeftOffset=this._getLineLeftOffset(lineWidth);if(this.textBackgroundColor){ctx.fillStyle=this.textBackgroundColor;ctx.fillRect(this._getLeftOffset()+lineLeftOffset,this._getTopOffset()+lineHeights,lineWidth,heightOfLine/this.lineHeight);}
if(this._getLineStyle(i)){for(var j=0,jlen=this._textLines[i].length;j<jlen;j++){var style=this._getStyleDeclaration(i,j);if(style&&style.textBackgroundColor){var _char=this._textLines[i][j];ctx.fillStyle=style.textBackgroundColor;ctx.fillRect(this._getLeftOffset()+lineLeftOffset+this._getWidthOfCharsAt(ctx,i,j),this._getTopOffset()+lineHeights,this._getWidthOfChar(ctx,_char,i,j)+1,heightOfLine/this.lineHeight);}}}
lineHeights+=heightOfLine;}
ctx.restore();},_getCacheProp:function(_char,styleDeclaration){return _char+
styleDeclaration.fontFamily+
styleDeclaration.fontSize+
styleDeclaration.fontWeight+
styleDeclaration.fontStyle+
styleDeclaration.shadow;},_applyCharStylesGetWidth:function(ctx,_char,lineIndex,charIndex,decl){var charDecl=this._getStyleDeclaration(lineIndex,charIndex),styleDeclaration=decl||clone(charDecl),width;this._applyFontStyles(styleDeclaration);var cacheProp=this._getCacheProp(_char,styleDeclaration);if(!charDecl&&this._charWidthsCache[cacheProp]&&this.caching){return this._charWidthsCache[cacheProp]+this.letterSpacing;}
if(typeof styleDeclaration.shadow==='string'){styleDeclaration.shadow=new fabric.Shadow(styleDeclaration.shadow);}
var fill=styleDeclaration.fill||this.fill;ctx.fillStyle=fill.toLive?fill.toLive(ctx,this):fill;if(styleDeclaration.stroke){ctx.strokeStyle=(styleDeclaration.stroke&&styleDeclaration.stroke.toLive)?styleDeclaration.stroke.toLive(ctx,this):styleDeclaration.stroke;}
ctx.lineWidth=styleDeclaration.strokeWidth||this.strokeWidth;ctx.font=this._getFontDeclaration.call(styleDeclaration);this._setShadow.call(styleDeclaration,ctx);if(!this.caching||!this._charWidthsCache[cacheProp]){width=ctx.measureText(_char).width;this.caching&&(this._charWidthsCache[cacheProp]=width);}
return this._charWidthsCache[cacheProp]+this.letterSpacing;},_applyFontStyles:function(styleDeclaration){if(!styleDeclaration.fontFamily){styleDeclaration.fontFamily=this.fontFamily;}
if(!styleDeclaration.fontSize){styleDeclaration.fontSize=this.fontSize;}
if(!styleDeclaration.fontWeight){styleDeclaration.fontWeight=this.fontWeight;}
if(!styleDeclaration.fontStyle){styleDeclaration.fontStyle=this.fontStyle;}},_getStyleDeclaration:function(lineIndex,charIndex,returnCloneOrEmpty){if(returnCloneOrEmpty){return(this.styles[lineIndex]&&this.styles[lineIndex][charIndex])?clone(this.styles[lineIndex][charIndex]):{};}
return this.styles[lineIndex]&&this.styles[lineIndex][charIndex]?this.styles[lineIndex][charIndex]:null;},_setStyleDeclaration:function(lineIndex,charIndex,style){this.styles[lineIndex][charIndex]=style;},_deleteStyleDeclaration:function(lineIndex,charIndex){delete this.styles[lineIndex][charIndex];},_getLineStyle:function(lineIndex){return this.styles[lineIndex];},_setLineStyle:function(lineIndex,style){this.styles[lineIndex]=style;},_deleteLineStyle:function(lineIndex){delete this.styles[lineIndex];},_getWidthOfChar:function(ctx,_char,lineIndex,charIndex){if(this.textAlign==='justify'&&this._reSpacesAndTabs.test(_char)){return this._getWidthOfSpace(ctx,lineIndex);}
var styleDeclaration=this._getStyleDeclaration(lineIndex,charIndex,true);this._applyFontStyles(styleDeclaration);var cacheProp=this._getCacheProp(_char,styleDeclaration);if(this._charWidthsCache[cacheProp]&&this.caching){return this._charWidthsCache[cacheProp]+this.letterSpacing;}
else if(ctx){ctx.save();var width=this._applyCharStylesGetWidth(ctx,_char,lineIndex,charIndex);ctx.restore();return width+this.letterSpacing;}},_getHeightOfChar:function(ctx,lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex);return style&&style.fontSize?style.fontSize:this.fontSize;},_getWidthOfCharsAt:function(ctx,lineIndex,charIndex){var width=0,i,_char;for(i=0;i<charIndex;i++){_char=this._textLines[lineIndex][i];width+=this._getWidthOfChar(ctx,_char,lineIndex,i);}
return width;},_getLineWidth:function(ctx,lineIndex){if(this.__lineWidths[lineIndex]){return this.__lineWidths[lineIndex];}
this.__lineWidths[lineIndex]=this._getWidthOfCharsAt(ctx,lineIndex,this._textLines[lineIndex].length);return this.__lineWidths[lineIndex];},_getTextWidth:function(ctx){var maxWidth=this._getLineWidth(ctx,0);for(var i=1,len=this._textLines.length;i<len;i++){var currentLineWidth=this._getLineWidth(ctx,i);if(currentLineWidth>maxWidth){maxWidth=currentLineWidth;}}
return maxWidth;},_getWidthOfSpace:function(ctx,lineIndex){if(this.__widthOfSpace[lineIndex]){return this.__widthOfSpace[lineIndex];}
var line=this._textLines[lineIndex],wordsWidth=this._getWidthOfWords(ctx,line,lineIndex),widthDiff=this.width-wordsWidth,numSpaces=line.length-line.replace(this._reSpacesAndTabs,'').length,width=widthDiff/numSpaces;this.__widthOfSpace[lineIndex]=width;return width+this.letterSpacing;},_getWidthOfWords:function(ctx,line,lineIndex){var width=0;for(var charIndex=0;charIndex<line.length;charIndex++){var _char=line[charIndex];if(!_char.match(/\s/)){width+=this._getWidthOfChar(ctx,_char,lineIndex,charIndex);}}
return width;},_getHeightOfLine:function(ctx,lineIndex){if(this.__lineHeights[lineIndex]){return this.__lineHeights[lineIndex];}
var line=this._textLines[lineIndex],maxHeight=this._getHeightOfChar(ctx,lineIndex,0);for(var i=1,len=line.length;i<len;i++){var currentCharHeight=this._getHeightOfChar(ctx,lineIndex,i);if(currentCharHeight>maxHeight){maxHeight=currentCharHeight;}}
this.__lineHeights[lineIndex]=maxHeight*this.lineHeight*this._fontSizeMult;return this.__lineHeights[lineIndex];},_getTextHeight:function(ctx){var height=0;for(var i=0,len=this._textLines.length;i<len;i++){height+=this._getHeightOfLine(ctx,i);}
return height;},_renderTextBoxBackground:function(ctx){if(!this.backgroundColor){return;}
ctx.save();ctx.fillStyle=this.backgroundColor;ctx.fillRect(this._getLeftOffset()-this.padding,this._getTopOffset()-this.padding,this.width+(this.padding*2),this.height+(this.padding*2));ctx.restore();},toObject:function(propertiesToInclude){var clonedStyles={},i,j,row;for(i in this.styles){row=this.styles[i];clonedStyles[i]={};for(j in row){clonedStyles[i][j]=clone(row[j]);}}
return fabric.util.object.extend(this.callSuper('toObject',propertiesToInclude),{styles:clonedStyles});}});fabric.IText.fromObject=function(object){return new fabric.IText(object.text,clone(object));};})();(function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();},initSelectedHandler:function(){this.on('selected',function(){var _this=this;setTimeout(function(){_this.selected=true;},100);});},initAddedHandler:function(){var _this=this;this.on('added',function(){if(this.canvas&&!this.canvas._hasITextHandlers){this.canvas._hasITextHandlers=true;this._initCanvasHandlers();}
if(_this.canvas){_this.canvas._iTextInstances=_this.canvas._iTextInstances||[];_this.canvas._iTextInstances.push(_this);}});},initRemovedHandler:function(){var _this=this;this.on('removed',function(){if(_this.canvas){_this.canvas._iTextInstances=_this.canvas._iTextInstances||[];fabric.util.removeFromArray(_this.canvas._iTextInstances,_this);}});},_initCanvasHandlers:function(){var _this=this;this.canvas.on('selection:cleared',function(){fabric.IText.prototype.exitEditingOnOthers(_this.canvas);});this.canvas.on('mouse:up',function(){if(_this.canvas._iTextInstances){_this.canvas._iTextInstances.forEach(function(obj){obj.__isMousedown=false;});}});this.canvas.on('object:selected',function(){fabric.IText.prototype.exitEditingOnOthers(_this.canvas);});},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,'_onTickComplete');},_animateCursor:function(obj,targetOpacity,duration,completeMethod){var tickState;tickState={isAborted:false,abort:function(){this.isAborted=true;},};obj.animate('_currentCursorOpacity',targetOpacity,{duration:duration,onComplete:function(){if(!tickState.isAborted){obj[completeMethod]();}},onChange:function(){if(obj.canvas){obj.canvas.clearContext(obj.canvas.contextTop||obj.ctx);obj.renderCursorOrSelection();}},abort:function(){return tickState.isAborted;}});return tickState;},_onTickComplete:function(){var _this=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1);}
this._cursorTimeout1=setTimeout(function(){_this._currentTickCompleteState=_this._animateCursor(_this,0,this.cursorDuration/2,'_tick');},100);},initDelayedCursor:function(restart){var _this=this,delay=restart?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;if(this.canvas){this.canvas.clearContext(this.canvas.contextTop||this.ctx);this.renderCursorOrSelection();}
if(this._cursorTimeout2){clearTimeout(this._cursorTimeout2);}
this._cursorTimeout2=setTimeout(function(){_this._tick();},delay);},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx);},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length);},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd);},findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;if(this._reSpace.test(this.text.charAt(index))){while(this._reSpace.test(this.text.charAt(index))){offset++;index--;}}
while(/\S/.test(this.text.charAt(index))&&index>-1){offset++;index--;}
return startFrom-offset;},findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;if(this._reSpace.test(this.text.charAt(index))){while(this._reSpace.test(this.text.charAt(index))){offset++;index++;}}
while(/\S/.test(this.text.charAt(index))&&index<this.text.length){offset++;index++;}
return startFrom+offset;},findLineBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;while(!/\n/.test(this.text.charAt(index))&&index>-1){offset++;index--;}
return startFrom-offset;},findLineBoundaryRight:function(startFrom){var offset=0,index=startFrom;while(!/\n/.test(this.text.charAt(index))&&index<this.text.length){offset++;index++;}
return startFrom+offset;},getNumNewLinesInSelectedText:function(){var selectedText=this.getSelectedText(),numNewLines=0;for(var i=0,len=selectedText.length;i<len;i++){if(selectedText[i]==='\n'){numNewLines++;}}
return numNewLines;},searchWordBoundary:function(selectionStart,direction){var index=this._reSpace.test(this.text.charAt(selectionStart))?selectionStart-1:selectionStart,_char=this.text.charAt(index),reNonWord=/[ \n\.,;!\?\-]/;while(!reNonWord.test(_char)&&index>0&&index<this.text.length){index+=direction;_char=this.text.charAt(index);}
if(reNonWord.test(_char)&&_char!=='\n'){index+=direction===1?0:1;}
return index;},selectWord:function(selectionStart){var newSelectionStart=this.searchWordBoundary(selectionStart,-1),newSelectionEnd=this.searchWordBoundary(selectionStart,1);this.setSelectionStart(newSelectionStart);this.setSelectionEnd(newSelectionEnd);},selectLine:function(selectionStart){var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.setSelectionStart(newSelectionStart);this.setSelectionEnd(newSelectionEnd);},enterEditing:function(){if(this.isEditing||!this.editable){return;}
if(this.canvas){this.exitEditingOnOthers(this.canvas);}
this.isEditing=true;this.initHiddenTextarea();this.hiddenTextarea.focus();this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._tick();this.fire('editing:entered');if(!this.canvas){return this;}
this.canvas.renderAll();this.canvas.fire('text:editing:entered',{target:this});this.initMouseMoveHandler();return this;},exitEditingOnOthers:function(canvas){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.selected=false;if(obj.isEditing){obj.exitEditing();}});}},initMouseMoveHandler:function(){var _this=this;this.canvas.on('mouse:move',function(options){if(!_this.__isMousedown||!_this.isEditing){return;}
var newSelectionStart=_this.getSelectionStartFromPointer(options.e);if(newSelectionStart>=_this.__selectionStartOnMouseDown){_this.setSelectionStart(_this.__selectionStartOnMouseDown);_this.setSelectionEnd(newSelectionStart);}
else{_this.setSelectionStart(newSelectionStart);_this.setSelectionEnd(_this.__selectionStartOnMouseDown);}});},_setEditingProps:function(){this.hoverCursor='text';if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor='text';}
this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true;},_updateTextarea:function(){if(!this.hiddenTextarea){return;}
this.hiddenTextarea.value=this.text;this.hiddenTextarea.selectionStart=this.selectionStart;this.hiddenTextarea.selectionEnd=this.selectionEnd;},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor};},_restoreEditingProps:function(){if(!this._savedProps){return;}
this.hoverCursor=this._savedProps.overCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor;}},exitEditing:function(){this.selected=false;this.isEditing=false;this.selectable=true;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire('editing:exited');this.canvas&&this.canvas.fire('text:editing:exited',{target:this});return this;},_removeExtraneousStyles:function(){for(var prop in this.styles){if(!this._textLines[prop]){delete this.styles[prop];}}},_removeCharsFromTo:function(start,end){while(end!==start){this._removeSingleCharAndStyle(start+1);end--;}
this.setSelectionStart(start);},_removeSingleCharAndStyle:function(index){var isBeginningOfLine=this.text[index-1]==='\n',indexStyle=isBeginningOfLine?index:index-1;this.removeStyleObject(isBeginningOfLine,indexStyle);this.text=this.text.slice(0,index-1)+
this.text.slice(index);this._textLines=this._splitTextIntoLines();},insertChars:function(_chars,useCopiedStyle){var style;if(this.selectionEnd-this.selectionStart>1){this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart);}
if(!useCopiedStyle&&this.isEmptyStyles()){this.insertChar(_chars,false);return;}
for(var i=0,len=_chars.length;i<len;i++){if(useCopiedStyle){style=fabric.copiedTextStyle[i];}
this.insertChar(_chars[i],i<len-1,style);}},insertChar:function(_char,skipUpdate,styleObject){var isEndOfLine=this.text[this.selectionStart]==='\n';this.text=this.text.slice(0,this.selectionStart)+
_char+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(_char,isEndOfLine,styleObject);this.selectionStart+=_char.length;this.selectionEnd=this.selectionStart;if(skipUpdate){return;}
this._updateTextarea();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire('changed');this.canvas&&this.canvas.fire('text:changed',{target:this});},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){this.shiftLineStyles(lineIndex,+1);if(!this.styles[lineIndex+1]){this.styles[lineIndex+1]={};}
var currentCharStyle={},newLineStyles={};if(this.styles[lineIndex]&&this.styles[lineIndex][charIndex-1]){currentCharStyle=this.styles[lineIndex][charIndex-1];}
if(isEndOfLine){newLineStyles[0]=clone(currentCharStyle);this.styles[lineIndex+1]=newLineStyles;}
else{for(var index in this.styles[lineIndex]){if(parseInt(index,10)>=charIndex){newLineStyles[parseInt(index,10)-charIndex]=this.styles[lineIndex][index];delete this.styles[lineIndex][index];}}
this.styles[lineIndex+1]=newLineStyles;}
this._forceClearCache=true;},insertCharStyleObject:function(lineIndex,charIndex,style){var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=clone(currentLineStyles);if(charIndex===0&&!style){charIndex=1;}
for(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);if(numericIndex>=charIndex){currentLineStyles[numericIndex+1]=currentLineStylesCloned[numericIndex];if(!currentLineStylesCloned[numericIndex-1]){delete currentLineStyles[numericIndex];}}}
this.styles[lineIndex][charIndex]=style||clone(currentLineStyles[charIndex-1]);this._forceClearCache=true;},insertStyleObjects:function(_chars,isEndOfLine,styleObject){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;if(!this._getLineStyle(lineIndex)){this._setLineStyle(lineIndex,{});}
if(_chars==='\n'){this.insertNewlineStyleObject(lineIndex,charIndex,isEndOfLine);}
else{this.insertCharStyleObject(lineIndex,charIndex,styleObject);}},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine>lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine];}}}},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;this._removeStyleObject(isBeginningOfLine,cursorLocation,lineIndex,charIndex);},_getTextOnPreviousLine:function(lIndex){return this._textLines[lIndex-1];},_removeStyleObject:function(isBeginningOfLine,cursorLocation,lineIndex,charIndex){if(isBeginningOfLine){var textOnPreviousLine=this._getTextOnPreviousLine(cursorLocation.lineIndex),newCharIndexOnPrevLine=textOnPreviousLine?textOnPreviousLine.length:0;if(!this.styles[lineIndex-1]){this.styles[lineIndex-1]={};}
for(charIndex in this.styles[lineIndex]){this.styles[lineIndex-1][parseInt(charIndex,10)+newCharIndexOnPrevLine]=this.styles[lineIndex][charIndex];}
this.shiftLineStyles(cursorLocation.lineIndex,-1);}
else{var currentLineStyles=this.styles[lineIndex];if(currentLineStyles){delete currentLineStyles[charIndex];}
var currentLineStylesCloned=clone(currentLineStyles);for(var i in currentLineStylesCloned){var numericIndex=parseInt(i,10);if(numericIndex>=charIndex&&numericIndex!==0){currentLineStyles[numericIndex-1]=currentLineStylesCloned[numericIndex];delete currentLineStyles[numericIndex];}}}},insertNewline:function(){this.insertChars('\n');}});})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on('mousedown',this.onMouseDown.bind(this));},onMouseDown:function(options){this.__newClickTime=+new Date();var newPointer=this.canvas.getPointer(options.e);if(this.isTripleClick(newPointer)){this.fire('tripleclick',options);this._stopEvent(options.e);}
else if(this.isDoubleClick(newPointer)){this.fire('dblclick',options);this._stopEvent(options.e);}
this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=newPointer;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected;},isDoubleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y&&this.__lastIsEditing;},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y;},_stopEvent:function(e){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks();},initClicks:function(){this.on('dblclick',function(options){this.selectWord(this.getSelectionStartFromPointer(options.e));});this.on('tripleclick',function(options){this.selectLine(this.getSelectionStartFromPointer(options.e));});},initMousedownHandler:function(){this.on('mousedown',function(options){var pointer=this.canvas.getPointer(options.e);this.__mousedownX=pointer.x;this.__mousedownY=pointer.y;this.__isMousedown=true;if(this.hiddenTextarea&&this.canvas){this.canvas.wrapperEl.appendChild(this.hiddenTextarea);}
if(this.selected){this.setCursorByClick(options.e);}
if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;this.initDelayedCursor(true);}});},_isObjectMoved:function(e){var pointer=this.canvas.getPointer(e);return this.__mousedownX!==pointer.x||this.__mousedownY!==pointer.y;},initMouseupHandler:function(){this.on('mouseup',function(options){this.__isMousedown=false;if(this._isObjectMoved(options.e)){return;}
if(this.__lastSelected&&!this.__corner){this.enterEditing();this.initDelayedCursor(true);}
this.selected=true;});},setCursorByClick:function(e){var newSelectionStart=this.getSelectionStartFromPointer(e);if(e.shiftKey){if(newSelectionStart<this.selectionStart){this.setSelectionEnd(this.selectionStart);this.setSelectionStart(newSelectionStart);}
else{this.setSelectionEnd(newSelectionStart);}}
else{this.setSelectionStart(newSelectionStart);this.setSelectionEnd(newSelectionStart);}},getSelectionStartFromPointer:function(e){var mouseOffset=this.getLocalPointer(e),prevWidth=0,width=0,height=0,charIndex=0,newSelectionStart,line;for(var i=0,len=this._textLines.length;i<len;i++){line=this._textLines[i];height+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var widthOfLine=this._getLineWidth(this.ctx,i),lineLeftOffset=this._getLineLeftOffset(widthOfLine);width=lineLeftOffset*this.scaleX;if(this.flipX){this._textLines[i]=line.reverse().join('');}
for(var j=0,jlen=line.length;j<jlen;j++){prevWidth=width;width+=this._getWidthOfChar(this.ctx,line[j],i,this.flipX?jlen-j:j)*this.scaleX;if(height<=mouseOffset.y||width<=mouseOffset.x){charIndex++;continue;}
return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i,jlen);}
if(mouseOffset.y<height){return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i-1,jlen);}}
if(typeof newSelectionStart==='undefined'){return this.text.length;}},_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){var distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor>distanceBtwLastCharAndCursor?0:1,newSelectionStart=index+offset;if(this.flipX){newSelectionStart=jlen-newSelectionStart;}
if(newSelectionStart>this.text.length){newSelectionStart=this.text.length;}
return newSelectionStart;}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement('textarea');this.hiddenTextarea.setAttribute('autocapitalize','off');this.hiddenTextarea.style.cssText='white-space: nowrap; position: fixed; bottom: 20px; left: 0px; opacity: 0;'
+' width: 0px; height: 0px; z-index: -999;';fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,'keydown',this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,'input',this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,'copy',this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,'paste',this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,'click',this.onClick.bind(this));this._clickHandlerInitialized=true;}},_keysMap:{8:'removeChars',9:'exitEditing',27:'exitEditing',13:'insertNewline',33:'moveCursorUp',34:'moveCursorDown',35:'moveCursorRight',36:'moveCursorLeft',37:'moveCursorLeft',38:'moveCursorUp',39:'moveCursorRight',40:'moveCursorDown',46:'forwardDelete'},_ctrlKeysMap:{65:'selectAll',88:'cut'},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus();},onKeyDown:function(e){if(!this.isEditing){return;}
if(e.keyCode in this._keysMap){this[this._keysMap[e.keyCode]](e);}
else if((e.keyCode in this._ctrlKeysMap)&&(e.ctrlKey||e.metaKey)){this[this._ctrlKeysMap[e.keyCode]](e);}
else{return;}
e.stopImmediatePropagation();e.preventDefault();this.canvas&&this.canvas.renderAll();},onInput:function(e){if(!this.isEditing){return;}
var offset=this.selectionStart||0,offsetEnd=this.selectionEnd||0,textLength=this.text.length,newTextLength=this.hiddenTextarea.value.length,diff=newTextLength-textLength+offsetEnd-offset,charsToInsert=this.hiddenTextarea.value.slice(offset,offset+diff);this.insertChars(charsToInsert);e.stopPropagation();},forwardDelete:function(e){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length){return;}
this.moveCursorRight(e);}
this.removeChars(e);},copy:function(e){var selectedText=this.getSelectedText(),clipboardData=this._getClipboardData(e);if(clipboardData){clipboardData.setData('text',selectedText);}
fabric.copiedText=selectedText;fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd);},paste:function(e){var copiedText=null,clipboardData=this._getClipboardData(e),useCopiedStyle=true;if(clipboardData){copiedText=clipboardData.getData('text').replace(/\r/g,'');if(!fabric.copiedTextStyle||fabric.copiedText!==copiedText){useCopiedStyle=false;}}
else{copiedText=fabric.copiedText;}
if(copiedText){this.insertChars(copiedText,useCopiedStyle);}
e.stopImmediatePropagation();e.preventDefault();},cut:function(e){if(this.selectionStart===this.selectionEnd){return;}
this.copy();this.removeChars(e);},_getClipboardData:function(e){return e&&(e.clipboardData||fabric.window.clipboardData);},getDownCursorOffset:function(e,isRight){var selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp),_char,lineLeftOffset,lineIndex=cursorLocation.lineIndex,textOnSameLineBeforeCursor=this._textLines[lineIndex].slice(0,cursorLocation.charIndex),textOnSameLineAfterCursor=this._textLines[lineIndex].slice(cursorLocation.charIndex),textOnNextLine=this._textLines[lineIndex+1]||'';if(lineIndex===this._textLines.length-1||e.metaKey||e.keyCode===34){return this.text.length-selectionProp;}
var widthOfSameLineBeforeCursor=this._getLineWidth(this.ctx,lineIndex);lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor);var widthOfCharsOnSameLineBeforeCursor=lineLeftOffset;for(var i=0,len=textOnSameLineBeforeCursor.length;i<len;i++){_char=textOnSameLineBeforeCursor[i];widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i);}
var indexOnNextLine=this._getIndexOnNextLine(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor);return textOnSameLineAfterCursor.length+1+indexOnNextLine;},_getIndexOnNextLine:function(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor){var lineIndex=cursorLocation.lineIndex+1,widthOfNextLine=this._getLineWidth(this.ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfNextLine),widthOfCharsOnNextLine=lineLeftOffset,indexOnNextLine=0,foundMatch;for(var j=0,jlen=textOnNextLine.length;j<jlen;j++){var _char=textOnNextLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);widthOfCharsOnNextLine+=widthOfChar;if(widthOfCharsOnNextLine>widthOfCharsOnSameLineBeforeCursor){foundMatch=true;var leftEdge=widthOfCharsOnNextLine-widthOfChar,rightEdge=widthOfCharsOnNextLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnNextLine=offsetFromRightEdge<offsetFromLeftEdge?j+1:j;break;}}
if(!foundMatch){indexOnNextLine=textOnNextLine.length;}
return indexOnNextLine;},moveCursorDown:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var offset=this.getDownCursorOffset(e,this._selectionDirection==='right');if(e.shiftKey){this.moveCursorDownWithShift(offset);}
else{this.moveCursorDownWithoutShift(offset);}
this.initDelayedCursor();},moveCursorDownWithoutShift:function(offset){this._selectionDirection='right';this.setSelectionStart(this.selectionStart+offset);this.setSelectionEnd(this.selectionStart);},swapSelectionPoints:function(){var swapSel=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(swapSel);},moveCursorDownWithShift:function(offset){if(this.selectionEnd===this.selectionStart){this._selectionDirection='right';}
if(this._selectionDirection==='right'){this.setSelectionEnd(this.selectionEnd+offset);}
else{this.setSelectionStart(this.selectionStart+offset);}
if(this.selectionEnd<this.selectionStart&&this._selectionDirection==='left'){this.swapSelectionPoints();this._selectionDirection='right';}
if(this.selectionEnd>this.text.length){this.setSelectionEnd(this.text.length);}},getUpCursorOffset:function(e,isRight){var selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===0||e.metaKey||e.keyCode===33){return selectionProp;}
var textOnSameLineBeforeCursor=this._textLines[lineIndex].slice(0,cursorLocation.charIndex),textOnPreviousLine=this._textLines[lineIndex-1]||'',_char,widthOfSameLineBeforeCursor=this._getLineWidth(this.ctx,cursorLocation.lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor),widthOfCharsOnSameLineBeforeCursor=lineLeftOffset;for(var i=0,len=textOnSameLineBeforeCursor.length;i<len;i++){_char=textOnSameLineBeforeCursor[i];widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i);}
var indexOnPrevLine=this._getIndexOnPrevLine(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor);return textOnPreviousLine.length-indexOnPrevLine+textOnSameLineBeforeCursor.length;},_getIndexOnPrevLine:function(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor){var lineIndex=cursorLocation.lineIndex-1,widthOfPreviousLine=this._getLineWidth(this.ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfPreviousLine),widthOfCharsOnPreviousLine=lineLeftOffset,indexOnPrevLine=0,foundMatch;for(var j=0,jlen=textOnPreviousLine.length;j<jlen;j++){var _char=textOnPreviousLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);widthOfCharsOnPreviousLine+=widthOfChar;if(widthOfCharsOnPreviousLine>widthOfCharsOnSameLineBeforeCursor){foundMatch=true;var leftEdge=widthOfCharsOnPreviousLine-widthOfChar,rightEdge=widthOfCharsOnPreviousLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnPrevLine=offsetFromRightEdge<offsetFromLeftEdge?j:(j-1);break;}}
if(!foundMatch){indexOnPrevLine=textOnPreviousLine.length-1;}
return indexOnPrevLine;},moveCursorUp:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var offset=this.getUpCursorOffset(e,this._selectionDirection==='right');if(e.shiftKey){this.moveCursorUpWithShift(offset);}
else{this.moveCursorUpWithoutShift(offset);}
this.initDelayedCursor();},moveCursorUpWithShift:function(offset){if(this.selectionEnd===this.selectionStart){this._selectionDirection='left';}
if(this._selectionDirection==='right'){this.setSelectionEnd(this.selectionEnd-offset);}
else{this.setSelectionStart(this.selectionStart-offset);}
if(this.selectionEnd<this.selectionStart&&this._selectionDirection==='right'){this.swapSelectionPoints();this._selectionDirection='left';}},moveCursorUpWithoutShift:function(offset){if(this.selectionStart===this.selectionEnd){this.setSelectionStart(this.selectionStart-offset);}
this.setSelectionEnd(this.selectionStart);this._selectionDirection='left';},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}
this.abortCursorAnimation();this._currentCursorOpacity=1;if(e.shiftKey){this.moveCursorLeftWithShift(e);}
else{this.moveCursorLeftWithoutShift(e);}
this.initDelayedCursor();},_move:function(e,prop,direction){var propMethod=(prop==='selectionStart'?'setSelectionStart':'setSelectionEnd');if(e.altKey){this[propMethod](this['findWordBoundary'+direction](this[prop]));}
else if(e.metaKey||e.keyCode===35||e.keyCode===36){this[propMethod](this['findLineBoundary'+direction](this[prop]));}
else{this[propMethod](this[prop]+(direction==='Left'?-1:1));}},_moveLeft:function(e,prop){this._move(e,prop,'Left');},_moveRight:function(e,prop){this._move(e,prop,'Right');},moveCursorLeftWithoutShift:function(e){this._selectionDirection='left';if(this.selectionEnd===this.selectionStart){this._moveLeft(e,'selectionStart');}
this.setSelectionEnd(this.selectionStart);},moveCursorLeftWithShift:function(e){if(this._selectionDirection==='right'&&this.selectionStart!==this.selectionEnd){this._moveLeft(e,'selectionEnd');}
else{this._selectionDirection='left';this._moveLeft(e,'selectionStart');}},moveCursorRight:function(e){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length){return;}
this.abortCursorAnimation();this._currentCursorOpacity=1;if(e.shiftKey){this.moveCursorRightWithShift(e);}
else{this.moveCursorRightWithoutShift(e);}
this.initDelayedCursor();},moveCursorRightWithShift:function(e){if(this._selectionDirection==='left'&&this.selectionStart!==this.selectionEnd){this._moveRight(e,'selectionStart');}
else{this._selectionDirection='right';this._moveRight(e,'selectionEnd');}},moveCursorRightWithoutShift:function(e){this._selectionDirection='right';if(this.selectionStart===this.selectionEnd){this._moveRight(e,'selectionStart');this.setSelectionEnd(this.selectionStart);}
else{this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText());this.setSelectionStart(this.selectionEnd);}},removeChars:function(e){if(this.selectionStart===this.selectionEnd){this._removeCharsNearCursor(e);}
else{this._removeCharsFromTo(this.selectionStart,this.selectionEnd);}
this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire('changed');this.canvas&&this.canvas.fire('text:changed',{target:this});},_removeCharsNearCursor:function(e){if(this.selectionStart===0){return;}
if(e.metaKey){var leftLineBoundary=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftLineBoundary,this.selectionStart);this.setSelectionStart(leftLineBoundary);}
else if(e.altKey){var leftWordBoundary=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftWordBoundary,this.selectionStart);this.setSelectionStart(leftWordBoundary);}
else{this._removeSingleCharAndStyle(this.selectionStart);this.setSelectionStart(this.selectionStart-1);}}});(function(){var toFixed=fabric.util.toFixed,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(lineIndex,textSpans,height,textLeftOffset,textTopOffset,textBgRects){if(!this.styles[lineIndex]){fabric.Text.prototype._setSVGTextLineText.call(this,lineIndex,textSpans,height,textLeftOffset,textTopOffset);}
else{this._setSVGTextLineChars(lineIndex,textSpans,height,textLeftOffset,textBgRects);}},_setSVGTextLineChars:function(lineIndex,textSpans,height,textLeftOffset,textBgRects){var chars=this._textLines[lineIndex],charOffset=0,lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex))-this.width/2,lineOffset=this._getSVGLineTopOffset(lineIndex),heightOfLine=this._getHeightOfLine(this.ctx,lineIndex);for(var i=0,len=chars.length;i<len;i++){var styleDecl=this.styles[lineIndex][i]||{};textSpans.push(this._createTextCharSpan(chars[i],styleDecl,lineLeftOffset,lineOffset.lineTop+lineOffset.offset,charOffset));var charWidth=this._getWidthOfChar(this.ctx,chars[i],lineIndex,i);if(styleDecl.textBackgroundColor){textBgRects.push(this._createTextCharBg(styleDecl,lineLeftOffset,lineOffset.lineTop,heightOfLine,charWidth,charOffset));}
charOffset+=charWidth;}},_getSVGLineTopOffset:function(lineIndex){var lineTopOffset=0,lastHeight=0;for(var j=0;j<lineIndex;j++){lineTopOffset+=this._getHeightOfLine(this.ctx,j);}
lastHeight=this._getHeightOfLine(this.ctx,j);return{lineTop:lineTopOffset,offset:(this._fontSizeMult-this._fontSizeFraction)*lastHeight/(this.lineHeight*this._fontSizeMult)};},_createTextCharBg:function(styleDecl,lineLeftOffset,lineTopOffset,heightOfLine,charWidth,charOffset){return['<rect fill="',styleDecl.textBackgroundColor,'" x="',toFixed(lineLeftOffset+charOffset,NUM_FRACTION_DIGITS),'" y="',toFixed(lineTopOffset-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(charWidth,NUM_FRACTION_DIGITS),'" height="',toFixed(heightOfLine/this.lineHeight,NUM_FRACTION_DIGITS),'"></rect>'].join('');},_createTextCharSpan:function(_char,styleDecl,lineLeftOffset,lineTopOffset,charOffset){var fillStyles=this.getSvgStyles.call(fabric.util.object.extend({visible:true,fill:this.fill,stroke:this.stroke,type:'text',getSvgFilter:fabric.Object.prototype.getSvgFilter},styleDecl));return['<tspan x="',toFixed(lineLeftOffset+charOffset,NUM_FRACTION_DIGITS),'" y="',toFixed(lineTopOffset-this.height/2,NUM_FRACTION_DIGITS),'" ',(styleDecl.fontFamily?'font-family="'+styleDecl.fontFamily.replace(/"/g,'\'')+'" ':''),(styleDecl.fontSize?'font-size="'+styleDecl.fontSize+'" ':''),(styleDecl.fontStyle?'font-style="'+styleDecl.fontStyle+'" ':''),(styleDecl.fontWeight?'font-weight="'+styleDecl.fontWeight+'" ':''),(styleDecl.textDecoration?'text-decoration="'+styleDecl.textDecoration+'" ':''),'style="',fillStyles,'">',fabric.util.string.escapeXml(_char),'</tspan>'].join('');}});})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;fabric.Textbox=fabric.util.createClass(fabric.IText,fabric.Observable,{type:'textbox',minWidth:20,dynamicMinWidth:0,__cachedLines:null,initialize:function(text,options){this.ctx=fabric.util.createCanvasElement().getContext('2d');this.callSuper('initialize',text,options);this.set({lockUniScaling:false,lockScalingY:true,lockScalingFlip:true,hasBorders:true});this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=true;},_initDimensions:function(ctx){if(this.__skipDimension){return;}
if(!ctx){ctx=fabric.util.createCanvasElement().getContext('2d');this._setTextStyles(ctx);}
this.dynamicMinWidth=0;this._textLines=this._splitTextIntoLines();if(this.dynamicMinWidth>this.width){this._set('width',this.dynamicMinWidth);}
this._clearCache();this.height=this._getTextHeight(ctx);},_generateStyleMap:function(){var realLineCount=0,realLineCharCount=0,charCount=0,map={};for(var i=0;i<this._textLines.length;i++){if(this.text[charCount]==='\n'){realLineCharCount=0;charCount++;realLineCount++;}
else if(this.text[charCount]===' '){realLineCharCount++;charCount++;}
map[i]={line:realLineCount,offset:realLineCharCount};charCount+=this._textLines[i].length;realLineCharCount+=this._textLines[i].length;}
return map;},_getStyleDeclaration:function(lineIndex,charIndex,returnCloneOrEmpty){if(this._styleMap){var map=this._styleMap[lineIndex];if(!map){return returnCloneOrEmpty?{}:null;}
lineIndex=map.line;charIndex=map.offset+charIndex;}
return this.callSuper('_getStyleDeclaration',lineIndex,charIndex,returnCloneOrEmpty);},_setStyleDeclaration:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;this.styles[lineIndex][charIndex]=style;},_deleteStyleDeclaration:function(lineIndex,charIndex){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;delete this.styles[lineIndex][charIndex];},_getLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];return this.styles[map.line];},_setLineStyle:function(lineIndex,style){var map=this._styleMap[lineIndex];this.styles[map.line]=style;},_deleteLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];delete this.styles[map.line];},_wrapText:function(ctx,text){var lines=text.split(this._reNewline),wrapped=[],i;for(i=0;i<lines.length;i++){wrapped=wrapped.concat(this._wrapLine(ctx,lines[i],i));}
return wrapped;},_measureText:function(ctx,text,lineIndex,charOffset){var width=0;charOffset=charOffset||0;for(var i=0,len=text.length;i<len;i++){width+=this._getWidthOfChar(ctx,text[i],lineIndex,i+charOffset);}
return width;},_wrapLine:function(ctx,text,lineIndex){var lineWidth=0,lines=[],line='',words=text.split(' '),word='',offset=0,infix=' ',wordWidth=0,infixWidth=0,largestWordWidth=0;for(var i=0;i<words.length;i++){word=words[i];wordWidth=this._measureText(ctx,word,lineIndex,offset);offset+=word.length;lineWidth+=infixWidth+wordWidth;if(lineWidth>=this.width&&line!==''){lines.push(line);line='';lineWidth=wordWidth;}
if(line!==''||i===1){line+=infix;}
line+=word;infixWidth=this._measureText(ctx,infix,lineIndex,offset);offset++;if(wordWidth>largestWordWidth){largestWordWidth=wordWidth;}}
i&&lines.push(line);if(largestWordWidth>this.dynamicMinWidth){this.dynamicMinWidth=largestWordWidth;}
return lines;},_splitTextIntoLines:function(){var originalAlign=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign='left';var lines=this._wrapText(this.ctx,this.text);this.textAlign=originalAlign;this.ctx.restore();this._textLines=lines;this._styleMap=this._generateStyleMap();return lines;},setOnGroup:function(key,value){if(key==='scaleX'){this.set('scaleX',Math.abs(1/value));}
if(key=='scaleY'){this.set('scaleY',Math.abs(1/value));}},get2DCursorLocation:function(selectionStart){if(typeof selectionStart==='undefined'){selectionStart=this.selectionStart;}
var numLines=this._textLines.length,removed=0;for(var i=0;i<numLines;i++){var line=this._textLines[i],lineLen=line.length;if(selectionStart<=removed+lineLen){return{lineIndex:i,charIndex:selectionStart-removed};}
removed+=lineLen;if(this.text[removed]==='\n'||this.text[removed]===' '){removed++;}}
return{lineIndex:numLines-1,charIndex:this._textLines[numLines-1].length};},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries){var topOffset=0,leftOffset=0,cursorLocation=this.get2DCursorLocation(),lineChars=this._textLines[cursorLocation.lineIndex].split(''),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,cursorLocation.lineIndex));for(var i=0;i<cursorLocation.charIndex;i++){leftOffset+=this._getWidthOfChar(this.ctx,lineChars[i],cursorLocation.lineIndex,i);}
for(i=0;i<cursorLocation.lineIndex;i++){topOffset+=this._getHeightOfLine(this.ctx,i);}
if(typeOfBoundaries==='cursor'){topOffset+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,cursorLocation.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(cursorLocation.lineIndex,cursorLocation.charIndex)*(1-this._fontSizeFraction);}
return{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset};},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth);},toObject:function(propertiesToInclude){return fabric.util.object.extend(this.callSuper('toObject',propertiesToInclude),{minWidth:this.minWidth});}});fabric.Textbox.fromObject=function(object){return new fabric.Textbox(object.text,clone(object));};fabric.Textbox.getTextboxControlVisibility=function(){return{tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true};};fabric.Textbox.instances=[];})(typeof exports!=='undefined'?exports:this);(function(){var setObjectScaleOverridden=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim){var t=transform.target;if(t instanceof fabric.Textbox){var w=t.width*((localMouse.x/transform.scaleX)/(t.width+t.strokeWidth));if(w>=t.getMinWidth()){t.set('width',w);}}
else{setObjectScaleOverridden.call(fabric.Canvas.prototype,localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim);}};fabric.Group.prototype._refreshControlsVisibility=function(){if(typeof fabric.Textbox==='undefined'){return;}
for(var i=this._objects.length;i--;){if(this._objects[i]instanceof fabric.Textbox){this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());return;}}};var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var prop in this._styleMap){if(!this._textLines[prop]){delete this.styles[this._styleMap[prop].line];}}},insertCharStyleObject:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;fabric.IText.prototype.insertCharStyleObject.apply(this,[lineIndex,charIndex,style]);},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;fabric.IText.prototype.insertNewlineStyleObject.apply(this,[lineIndex,charIndex,isEndOfLine]);},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles),map=this._styleMap[lineIndex];lineIndex=map.line;for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine>lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine];}}}},_getTextOnPreviousLine:function(lIndex){var textOnPreviousLine=this._textLines[lIndex-1];while(this._styleMap[lIndex-2]&&this._styleMap[lIndex-2].line===this._styleMap[lIndex-1].line){textOnPreviousLine=this._textLines[lIndex-2]+textOnPreviousLine;lIndex--;}
return textOnPreviousLine;},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),map=this._styleMap[cursorLocation.lineIndex],lineIndex=map.line,charIndex=map.offset+cursorLocation.charIndex;this._removeStyleObject(isBeginningOfLine,cursorLocation,lineIndex,charIndex);}});})();(function(){var override=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(mouseOffset,prevWidth,width,index,jlen){index=override.call(this,mouseOffset,prevWidth,width,index,jlen);var tmp=0,removed=0;for(var i=0;i<this._textLines.length;i++){tmp+=this._textLines[i].length;if(tmp+removed>=index){break;}
if(this.text[tmp+removed]==='\n'||this.text[tmp+removed]===' '){removed++;}}
return index-i+removed;};})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;fabric.Tabs=fabric.util.createClass(fabric.Group,fabric.Observable,{type:'tabs'});fabric.Tabs.fromObject=fabric.Group.fromObject})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;fabric.Table=fabric.util.createClass(fabric.Group,fabric.Observable,{type:'table',rows:0,columns:0,layoutType:'',alternateBackgroundColor1:null,alternateBackgroundColor2:null,highlightedRowsBackgroundColor:null,highlightedRows:[],tableArray:[[]],ySpacing:0,xSpacing:0,hasButton:true,buttonText:'edit content',renderTableBorders:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}
ctx.save();this._setStrokeStyles(ctx);ctx.strokeRect((-(this.width/2)),(-(this.height/2)),(this.width),(this.height));if(this.isTableLayout()){this.drawColumnBorders(ctx);this.drawRowBorders(ctx);}
ctx.restore();},renderTableCustomBackground:function(ctx){if((this.highlightedRows.length==0&&!(this.alternateBackgroundColor1&&this.alternateBackgroundColor2))||!this.isTableLayout()){this.renderGroupBackground(ctx);return}
var backgroundData=this.getTableBackGroundData();ctx.save();var objects=this.getObjects(),top=null,height=null,renderBackground=false;for(var i=0;i<backgroundData.length;i++){renderBackground=false;if(backgroundData[i]!='none'){if(top==null){if(i==0){top=-this.height/2;}
else{top=objects[i].top-this.ySpacing/2;}}
if(backgroundData[i]!=backgroundData[i+1]){height=Math.abs(top-objects[i].top)+this.getHeightOfRow(i)+this.ySpacing/2;renderBackground=true;switch(backgroundData[i]){case'highlight':ctx.fillStyle=this.highlightedRowsBackgroundColor;break;case'color':ctx.fillStyle=this.backgroundColor;break;case'alternate1':ctx.fillStyle=this.alternateBackgroundColor1;break;case'alternate2':ctx.fillStyle=this.alternateBackgroundColor2;break;}}
else{renderBackground=false}
if(renderBackground){ctx.fillRect(-this.width/2,top,this.width,height);top=null;height=null;}}}
ctx.restore();},getTableBackGroundData:function(){var data=[];for(var i=0;i<this.rows;i++){if(this.highlightedRows.indexOf(i)!=-1){data.push('highlight');}
else if(this.backgroundColor!=null){data.push('color')}
else if(this.alternateBackgroundColor1&&this.alternateBackgroundColor2){if((i%2)==0){data.push('alternate1')}
else{data.push('alternate2')}}
else{data.push('none')}}
return data;},getHeightOfRow:function(row){var height=0,h;for(var i=0;i<this.columns;i++){h=this.tableArray[i][row]._getTextHeight();if(h>height){height=h}}
return height;},getWidthOfColumn:function(column){var width=0,w;for(var i=0;i<this.rows;i++){w=this.tableArray[column][i]._getTextWidth();if(w>width){width=w}}
return width;},drawColumnBorders:function(ctx){var objects=this.getObjects(),x=this.rows,maxWidth,w,itemIndex;for(var i=2;i<=this.columns;i++){maxWidth=0;while(objects[x]&&objects[x].column==i){w=objects[x].width;if(w>maxWidth){maxWidth=w;itemIndex=x;}
x++;}
ctx.beginPath();ctx.moveTo(objects[itemIndex].left-this.xSpacing/2,-(this.height/2));ctx.lineTo(objects[itemIndex].left-this.xSpacing/2,-(this.height/2)+this.height);ctx.stroke();}},drawRowBorders:function(ctx){var objects=this.getObjects();for(var i=1;i<this.rows;i++){var startX=-this.width/2,startY=objects[i].top-this.ySpacing/2,endX=startX+this.width,endY=startY;ctx.beginPath();ctx.moveTo(startX,startY);ctx.lineTo(endX,endY);ctx.stroke();}},isTableLayout:function(){return this.layoutType=='layout-1'||this.layoutType=='custom-table';}});fabric.Table.fromObject=fabric.Group.fromObject})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;fabric.CustomBorderTable=fabric.util.createClass(fabric.Table,fabric.Observable,{hasMiddleButtons:true,drawColumnBorders:function(ctx){var groups=this.getObjects(),w,maxWidth=0,left=0;for(var i=0;i<groups.length;i++){var items=groups[i].getObjects();w=items[1].width;if(w>maxWidth){maxWidth=w;left=this.width/2-maxWidth;}}
ctx.beginPath();ctx.moveTo(left-this.padding*2,-(this.height/2));ctx.lineTo(left-this.padding*2,-(this.height/2)+this.height);ctx.stroke();},isTableLayout:function(){return this.layoutType=='layout-13';}});fabric.CustomBorderTable.fromObject=fabric.Table.fromObject})(typeof exports!=='undefined'?exports:this);
;(function(window,document,undefined){var j=!0,l=null,m=!1;function n(a){return function(){return this[a]}}var q=this;function r(a,b){var c=a.split("."),d=q;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&void 0!==b?d[e]=b:d=d[e]?d[e]:d[e]={}}function aa(a,b,c){return a.call.apply(a.bind,arguments)}
function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function t(a,b,c){t=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return t.apply(l,arguments)}var u=Date.now||function(){return+new Date};function v(a,b){this.G=a;this.v=b||a;this.z=this.v.document}v.prototype.createElement=function(a,b,c){a=this.z.createElement(a);if(b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));c&&a.appendChild(this.z.createTextNode(c));return a};function ca(a,b,c){a=a.z.getElementsByTagName(b)[0];a||(a=document.documentElement);a&&a.lastChild&&a.insertBefore(c,a.lastChild)}
function w(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return;c.push(b);a.className=c.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function x(a,b){for(var c=a.className.split(/\s+/),d=[],e=0,g=c.length;e<g;e++)c[e]!=b&&d.push(c[e]);a.className=d.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function da(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return j;return m}
function y(a){var b=a.v.location.protocol;"about:"==b&&(b=a.G.location.protocol);return"https:"==b?"https:":"http:"}function ea(a,b){var c=a.createElement("link",{rel:"stylesheet",href:b}),d=m;c.onload=function(){d||(d=j)};c.onerror=function(){d||(d=j)};ca(a,"head",c)}
function z(a,b,c,d){var e=a.z.getElementsByTagName("head")[0];if(e){var g=a.createElement("script",{src:b}),f=m;g.onload=g.onreadystatechange=function(){if(!f&&(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState))f=j,c&&c(l),g.onload=g.onreadystatechange=l,"HEAD"==g.parentNode.tagName&&e.removeChild(g)};e.appendChild(g);window.setTimeout(function(){f||(f=j,c&&c(Error("Script load timeout")))},d||5E3);return g}return l};function A(a,b,c){this.M=a;this.U=b;this.Aa=c}r("webfont.BrowserInfo",A);A.prototype.pa=n("M");A.prototype.hasWebFontSupport=A.prototype.pa;A.prototype.qa=n("U");A.prototype.hasWebKitFallbackBug=A.prototype.qa;A.prototype.ra=n("Aa");A.prototype.hasWebKitMetricsBug=A.prototype.ra;function B(a,b,c,d){this.d=a!=l?a:l;this.o=b!=l?b:l;this.aa=c!=l?c:l;this.f=d!=l?d:l}var fa=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;B.prototype.toString=function(){return[this.d,this.o||"",this.aa||"",this.f||""].join("")};function C(a){a=fa.exec(a);var b=l,c=l,d=l,e=l;a&&(a[1]!==l&&a[1]&&(b=parseInt(a[1],10)),a[2]!==l&&a[2]&&(c=parseInt(a[2],10)),a[3]!==l&&a[3]&&(d=parseInt(a[3],10)),a[4]!==l&&a[4]&&(e=/^[0-9]+$/.test(a[4])?parseInt(a[4],10):a[4]));return new B(b,c,d,e)};function D(a,b,c,d,e,g,f,h,k,p,s){this.K=a;this.Ga=b;this.za=c;this.fa=d;this.Ea=e;this.ea=g;this.wa=f;this.Fa=h;this.va=k;this.da=p;this.k=s}r("webfont.UserAgent",D);D.prototype.getName=n("K");D.prototype.getName=D.prototype.getName;D.prototype.oa=n("za");D.prototype.getVersion=D.prototype.oa;D.prototype.ka=n("fa");D.prototype.getEngine=D.prototype.ka;D.prototype.la=n("ea");D.prototype.getEngineVersion=D.prototype.la;D.prototype.ma=n("wa");D.prototype.getPlatform=D.prototype.ma;D.prototype.na=n("va");D.prototype.getPlatformVersion=D.prototype.na;D.prototype.ja=n("da");D.prototype.getDocumentMode=D.prototype.ja;D.prototype.ia=n("k");D.prototype.getBrowserInfo=D.prototype.ia;function E(a,b){this.a=a;this.I=b}var ga=new D("Unknown",new B,"Unknown","Unknown",new B,"Unknown","Unknown",new B,"Unknown",void 0,new A(m,m,m));E.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE")||-1!=this.a.indexOf("Trident/")){a=F(this);var b=G(this),c=C(b),d=l,e=l,g=l,f=l,h=H(this.a,/Trident\/([\d\w\.]+)/,1),k=I(this.I),d=-1!=this.a.indexOf("MSIE")?H(this.a,/MSIE ([\d\w\.]+)/,1):H(this.a,/rv:([\d\w\.]+)/,1),e=C(d);""!=h?(g="Trident",f=C(h)):(g="Unknown",f=new B,h="Unknown");a=new D("MSIE",e,d,g,f,h,a,c,b,k,new A("Windows"==a&&6<=e.d||"Windows Phone"==a&&8<=c.d,m,m))}else if(-1!=this.a.indexOf("Opera"))a:if(a="Unknown",b=H(this.a,/Presto\/([\d\w\.]+)/,1),c=C(b),d=G(this),e=C(d),g=I(this.I),c.d!==l?a="Presto":(-1!=this.a.indexOf("Gecko")&&(a="Gecko"),b=H(this.a,/rv:([^\)]+)/,1),c=C(b)),-1!=this.a.indexOf("Opera Mini/"))f=H(this.a,/Opera Mini\/([\d\.]+)/,1),h=C(f),a=new D("OperaMini",h,f,a,c,b,F(this),e,d,g,new A(m,m,m));else{if(-1!=this.a.indexOf("Version/")&&(f=H(this.a,/Version\/([\d\.]+)/,1),h=C(f),h.d!==l)){a=new D("Opera",h,f,a,c,b,F(this),e,d,g,new A(10<=h.d,m,m));break a}f=H(this.a,/Opera[\/ ]([\d\.]+)/,1);h=C(f);a=h.d!==l?new D("Opera",h,f,a,c,b,F(this),e,d,g,new A(10<=h.d,m,m)):new D("Opera",new B,"Unknown",a,c,b,F(this),e,d,g,new A(m,m,m))}else/OPR\/[\d.]+/.test(this.a)?a=ha(this):/AppleWeb(K|k)it/.test(this.a)?a=ha(this):-1!=this.a.indexOf("Gecko")?(a="Unknown",b=new B,c="Unknown",d=G(this),e=C(d),g=m,-1!=this.a.indexOf("Firefox")?(a="Firefox",c=H(this.a,/Firefox\/([\d\w\.]+)/,1),b=C(c),g=3<=b.d&&5<=b.o):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),f=H(this.a,/rv:([^\)]+)/,1),h=C(f),g||(g=1<h.d||1==h.d&&9<h.o||1==h.d&&9==h.o&&2<=h.aa||f.match(/1\.9\.1b[123]/)!=l||f.match(/1\.9\.1\.[\d\.]+/)!=l),a=new D(a,b,c,"Gecko",h,f,F(this),e,d,I(this.I),new A(g,m,m))):a=ga;return a};function F(a){var b=H(a.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);if(""!=b)return/BB\d{2}/.test(b)&&(b="BlackBerry"),b;a=H(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1);return""!=a?("Mac_PowerPC"==a&&(a="Macintosh"),a):"Unknown"}
function G(a){var b=H(a.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b||(b=H(a.a,/Windows Phone( OS)? ([^;)]+)/,2))||(b=H(a.a,/(iPhone )?OS ([\d_]+)/,2)))return b;if(b=H(a.a,/(?:Linux|CrOS) ([^;)]+)/,1))for(var b=b.split(/\s/),c=0;c<b.length;c+=1)if(/^[\d\._]+$/.test(b[c]))return b[c];return(a=H(a.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}
function ha(a){var b=F(a),c=G(a),d=C(c),e=H(a.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1),g=C(e),f="Unknown",h=new B,k="Unknown",p=m;/OPR\/[\d.]+/.test(a.a)?f="Opera":-1!=a.a.indexOf("Chrome")||-1!=a.a.indexOf("CrMo")||-1!=a.a.indexOf("CriOS")?f="Chrome":/Silk\/\d/.test(a.a)?f="Silk":"BlackBerry"==b||"Android"==b?f="BuiltinBrowser":-1!=a.a.indexOf("PhantomJS")?f="PhantomJS":-1!=a.a.indexOf("Safari")?f="Safari":-1!=a.a.indexOf("AdobeAIR")&&(f="AdobeAIR");"BuiltinBrowser"==f?k="Unknown":"Silk"==f?k=H(a.a,/Silk\/([\d\._]+)/,1):"Chrome"==f?k=H(a.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=a.a.indexOf("Version/")?k=H(a.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==f?k=H(a.a,/AdobeAIR\/([\d\.]+)/,1):"Opera"==f?k=H(a.a,/OPR\/([\d.]+)/,1):"PhantomJS"==f&&(k=H(a.a,/PhantomJS\/([\d.]+)/,1));h=C(k);p="AdobeAIR"==f?2<h.d||2==h.d&&5<=h.o:"BlackBerry"==b?10<=d.d:"Android"==b?2<d.d||2==d.d&&1<d.o:526<=g.d||525<=g.d&&13<=g.o;return new D(f,h,k,"AppleWebKit",g,e,b,d,c,I(a.I),new A(p,536>g.d||536==g.d&&11>g.o,"iPhone"==b||"iPad"==b||"iPod"==b||"Macintosh"==b))}function H(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""}function I(a){if(a.documentMode)return a.documentMode};function ia(a){this.ua=a||"-"}ia.prototype.f=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.ua)};function J(a,b){this.K=a;this.V=4;this.L="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.L=c[1],this.V=parseInt(c[2],10))}J.prototype.getName=n("K");function K(a){return a.L+a.V}function ja(a){var b=4,c="n",d=l;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ka(a,b,c){this.c=a;this.h=b;this.O=c;this.j="wf";this.g=new ia("-")}function L(a){x(a.h,a.g.f(a.j,"loading"));da(a.h,a.g.f(a.j,"active"))||w(a.h,a.g.f(a.j,"inactive"));M(a,"inactive")}function M(a,b,c){if(a.O[b])if(c)a.O[b](c.getName(),K(c));else a.O[b]()};function la(){this.w={}};function O(a,b){this.c=a;this.C=b;this.s=this.c.createElement("span",{"aria-hidden":"true"},this.C)}
function P(a,b){var c;c=[];for(var d=b.K.split(/,\s*/),e=0;e<d.length;e++){var g=d[e].replace(/['"]/g,"");-1==g.indexOf(" ")?c.push(g):c.push("'"+g+"'")}c=c.join(",");d="normal";e=b.V+"00";"o"===b.L?d="oblique":"i"===b.L&&(d="italic");a.s.style.cssText="position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+c+";"+("font-style:"+d+";font-weight:"+e+";")}
function Q(a){ca(a.c,"body",a.s)}O.prototype.remove=function(){var a=this.s;a.parentNode&&a.parentNode.removeChild(a)};function ma(a,b,c,d,e,g,f,h){this.W=a;this.sa=b;this.c=c;this.q=d;this.C=h||"BESbswy";this.k=e;this.F={};this.T=g||5E3;this.Z=f||l;this.B=this.A=l;a=new O(this.c,this.C);Q(a);for(var k in R)R.hasOwnProperty(k)&&(P(a,new J(R[k],K(this.q))),this.F[R[k]]=a.s.offsetWidth);a.remove()}var R={Da:"serif",Ca:"sans-serif",Ba:"monospace"};ma.prototype.start=function(){this.A=new O(this.c,this.C);Q(this.A);this.B=new O(this.c,this.C);Q(this.B);this.xa=u();P(this.A,new J(this.q.getName()+",serif",K(this.q)));P(this.B,new J(this.q.getName()+",sans-serif",K(this.q)));oa(this)};function pa(a,b,c){for(var d in R)if(R.hasOwnProperty(d)&&b===a.F[R[d]]&&c===a.F[R[d]])return j;return m}
function oa(a){var b=a.A.s.offsetWidth,c=a.B.s.offsetWidth;b===a.F.serif&&c===a.F["sans-serif"]||a.k.U&&pa(a,b,c)?u()-a.xa>=a.T?a.k.U&&pa(a,b,c)&&(a.Z===l||a.Z.hasOwnProperty(a.q.getName()))?S(a,a.W):S(a,a.sa):setTimeout(t(function(){oa(this)},a),25):S(a,a.W)}function S(a,b){a.A.remove();a.B.remove();b(a.q)};function T(a,b,c,d){this.c=b;this.t=c;this.P=0;this.ba=this.Y=m;this.T=d;this.k=a.k}function qa(a,b,c,d,e){if(0===b.length&&e)L(a.t);else{a.P+=b.length;e&&(a.Y=e);for(e=0;e<b.length;e++){var g=b[e],f=c[g.getName()],h=a.t,k=g;w(h.h,h.g.f(h.j,k.getName(),K(k).toString(),"loading"));M(h,"fontloading",k);(new ma(t(a.ga,a),t(a.ha,a),a.c,g,a.k,a.T,d,f)).start()}}}
T.prototype.ga=function(a){var b=this.t;x(b.h,b.g.f(b.j,a.getName(),K(a).toString(),"loading"));x(b.h,b.g.f(b.j,a.getName(),K(a).toString(),"inactive"));w(b.h,b.g.f(b.j,a.getName(),K(a).toString(),"active"));M(b,"fontactive",a);this.ba=j;ra(this)};T.prototype.ha=function(a){var b=this.t;x(b.h,b.g.f(b.j,a.getName(),K(a).toString(),"loading"));da(b.h,b.g.f(b.j,a.getName(),K(a).toString(),"active"))||w(b.h,b.g.f(b.j,a.getName(),K(a).toString(),"inactive"));M(b,"fontinactive",a);ra(this)};function ra(a){0==--a.P&&a.Y&&(a.ba?(a=a.t,x(a.h,a.g.f(a.j,"loading")),x(a.h,a.g.f(a.j,"inactive")),w(a.h,a.g.f(a.j,"active")),M(a,"active")):L(a.t))};function U(a){this.G=a;this.u=new la;this.ya=new E(a.navigator.userAgent,a.document);this.a=this.ya.parse();this.Q=this.R=0}
U.prototype.load=function(a){var b=a.context||this.G;this.c=new v(this.G,b);var b=new ka(this.c,b.document.documentElement,a),c=[],d=a.timeout;w(b.h,b.g.f(b.j,"loading"));M(b,"loading");var c=this.u,e=this.c,g=[],f;for(f in a)if(a.hasOwnProperty(f)){var h=c.w[f];h&&g.push(h(a[f],e))}c=g;this.Q=this.R=c.length;a=new T(this.a,this.c,b,d);f=0;for(d=c.length;f<d;f++)e=c[f],e.H(this.a,t(this.ta,this,e,b,a))};U.prototype.ta=function(a,b,c,d){var e=this;d?a.load(function(a,b,d){var k=0==--e.R;setTimeout(function(){qa(c,a,b||{},d||l,k)},0)}):(a=0==--this.R,this.Q--,a&&0==this.Q&&L(b),qa(c,[],{},l,a))};function V(a,b){this.c=a;this.e=b}V.prototype.load=function(a){var b,c,d=this.e.urls||[],e=this.e.families||[],g=this.e.testStrings||{};b=0;for(c=d.length;b<c;b++)ea(this.c,d[b]);d=[];b=0;for(c=e.length;b<c;b++){var f=e[b].split(":");if(f[1])for(var h=f[1].split(","),k=0;k<h.length;k+=1)d.push(new J(f[0],h[k]));else d.push(new J(f[0]))}a(d,g)};V.prototype.H=function(a,b){return b(a.k.M)};function W(a,b){this.c=a;this.e=b;this.m=[]}W.prototype.H=function(a,b){var c=this,d=c.e.projectId,e=c.e.version;if(d){var g=c.c.v;z(this.c,c.D(d,e),function(f){if(f)b(m);else{if(g["__mti_fntLst"+d]&&(f=g["__mti_fntLst"+d]()))for(var e=0;e<f.length;e++)c.m.push(new J(f[e].fontfamily));b(a.k.M)}}).id="__MonotypeAPIScript__"+d}else b(m)};W.prototype.D=function(a,b){var c=y(this.c),d=(this.e.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")};W.prototype.load=function(a){a(this.m)};function sa(a,b,c){this.N=a?a:b+ta;this.p=[];this.S=[];this.ca=c||""}var ta="//fonts.googleapis.com/css";sa.prototype.f=function(){if(0==this.p.length)throw Error("No fonts to load!");if(-1!=this.N.indexOf("kit="))return this.N;for(var a=this.p.length,b=[],c=0;c<a;c++)b.push(this.p[c].replace(/ /g,"+"));a=this.N+"?family="+b.join("%7C");0<this.S.length&&(a+="&subset="+this.S.join(","));0<this.ca.length&&(a+="&text="+encodeURIComponent(this.ca));return a};function ua(a){this.p=a;this.$=[];this.J={}}
var va={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},wa={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},xa={i:"i",italic:"i",n:"n",normal:"n"},ya=RegExp("^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$");ua.prototype.parse=function(){for(var a=this.p.length,b=0;b<a;b++){var c=this.p[b].split(":"),d=c[0].replace(/\+/g," "),e=["n4"];if(2<=c.length){var g;var f=c[1];g=[];if(f)for(var f=f.split(","),h=f.length,k=0;k<h;k++){var p;p=f[k];if(p.match(/^[\w-]+$/)){p=ya.exec(p.toLowerCase());var s=void 0;if(p==l)s="";else{s=void 0;s=p[1];if(s==l||""==s)s="4";else var na=wa[s],s=na?na:isNaN(s)?"4":s.substr(0,1);s=[p[2]==l||""==p[2]?"n":xa[p[2]],s].join("")}p=s}else p="";p&&g.push(p)}0<g.length&&(e=g);3==c.length&&(c=c[2],g=[],c=!c?g:c.split(","),0<c.length&&(c=va[c[0]])&&(this.J[d]=c))}this.J[d]||(c=va[d])&&(this.J[d]=c);for(c=0;c<e.length;c+=1)this.$.push(new J(d,e[c]))}};function X(a,b){this.a=(new E(navigator.userAgent,document)).parse();this.c=a;this.e=b}var za={Arimo:j,Cousine:j,Tinos:j};X.prototype.H=function(a,b){b(a.k.M)};X.prototype.load=function(a){var b=this.c;if("MSIE"==this.a.getName()&&this.e.blocking!=j){var c=t(this.X,this,a),d=function(){b.z.body?c():setTimeout(d,0)};d()}else this.X(a)};X.prototype.X=function(a){for(var b=this.c,c=new sa(this.e.api,y(b),this.e.text),d=this.e.families,e=d.length,g=0;g<e;g++){var f=d[g].split(":");3==f.length&&c.S.push(f.pop());var h="";2==f.length&&""!=f[1]&&(h=":");c.p.push(f.join(h))}d=new ua(d);d.parse();ea(b,c.f());a(d.$,d.J,za)};function Y(a,b){this.c=a;this.e=b;this.m=[]}Y.prototype.D=function(a){var b=y(this.c);return(this.e.api||b+"//use.typekit.net")+"/"+a+".js"};Y.prototype.H=function(a,b){var c=this.e.id,d=this.e,e=this.c.v,g=this;c?(e.__webfonttypekitmodule__||(e.__webfonttypekitmodule__={}),e.__webfonttypekitmodule__[c]=function(c){c(a,d,function(a,c,d){for(var e=0;e<c.length;e+=1){var f=d[c[e]];if(f)for(var N=0;N<f.length;N+=1)g.m.push(new J(c[e],f[N]));else g.m.push(new J(c[e]))}b(a)})},z(this.c,this.D(c),function(a){a&&b(m)},2E3)):b(m)};Y.prototype.load=function(a){a(this.m)};function Z(a,b){this.c=a;this.e=b;this.m=[]}Z.prototype.D=function(a){return y(this.c)+(this.e.api||"//f.fontdeck.com/s/css/js/")+(this.c.v.location.hostname||this.c.G.location.hostname)+"/"+a+".js"};Z.prototype.H=function(a,b){var c=this.e.id,d=this.c.v,e=this;c?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[c]=function(a,c){for(var d=0,k=c.fonts.length;d<k;++d){var p=c.fonts[d];e.m.push(new J(p.name,ja("font-weight:"+p.weight+";font-style:"+p.style)))}b(a)},z(this.c,this.D(c),function(a){a&&b(m)})):b(m)};Z.prototype.load=function(a){a(this.m)};var $=new U(q);$.u.w.custom=function(a,b){return new V(b,a)};$.u.w.fontdeck=function(a,b){return new Z(b,a)};$.u.w.monotype=function(a,b){return new W(b,a)};$.u.w.typekit=function(a,b){return new Y(b,a)};$.u.w.google=function(a,b){return new X(b,a)};q.WebFont||(q.WebFont={},q.WebFont.load=t($.load,$),q.WebFontConfig&&$.load(q.WebFontConfig));})(this,document);
(function(scope){if(null==scope)
scope=window;if(scope.puremvc)
{return;}
function Observer(notifyMethod,notifyContext)
{this.setNotifyMethod(notifyMethod);this.setNotifyContext(notifyContext);};Observer.prototype.setNotifyMethod=function(notifyMethod)
{this.notify=notifyMethod;};Observer.prototype.setNotifyContext=function(notifyContext)
{this.context=notifyContext;};Observer.prototype.getNotifyMethod=function()
{return this.notify;};Observer.prototype.getNotifyContext=function()
{return this.context;};Observer.prototype.notifyObserver=function(notification)
{this.getNotifyMethod().call(this.getNotifyContext(),notification);};Observer.prototype.compareNotifyContext=function(object)
{return object===this.context;};Observer.prototype.notify=null;Observer.prototype.context=null;function Notification(name,body,type)
{this.name=name;this.body=body;this.type=type;};Notification.prototype.getName=function()
{return this.name;};Notification.prototype.setBody=function(body)
{this.body=body;};Notification.prototype.getBody=function()
{return this.body};Notification.prototype.setType=function(type)
{this.type=type;};Notification.prototype.getType=function()
{return this.type;};Notification.prototype.toString=function()
{var msg="Notification Name: "+this.getName();msg+="\nBody:"+((this.body==null)?"null":this.body.toString());msg+="\nType:"+((this.type==null)?"null":this.type);return msg;};Notification.prototype.name=null;Notification.prototype.type=null;Notification.prototype.body=null;function Notifier()
{};Notifier.prototype.sendNotification=function(notificationName,body,type)
{var facade=this.getFacade();if(facade)
{facade.sendNotification(notificationName,body,type);}};Notifier.prototype.facade;Notifier.prototype.initializeNotifier=function(key)
{this.multitonKey=String(key);this.facade=this.getFacade();};Notifier.prototype.getFacade=function()
{if(this.multitonKey==null)
{throw new Error(Notifier.MULTITON_MSG);};return Facade.getInstance(this.multitonKey);};Notifier.prototype.multitonKey=null;Notifier.MULTITON_MSG="multitonKey for this Notifier not yet initialized!";function SimpleCommand(){};SimpleCommand.prototype=new Notifier;SimpleCommand.prototype.constructor=SimpleCommand;SimpleCommand.prototype.execute=function(notification){};function MacroCommand()
{this.subCommands=[];this.initializeMacroCommand();};MacroCommand.prototype=new Notifier;MacroCommand.prototype.constructor=MacroCommand;MacroCommand.prototype.subCommands=null;MacroCommand.prototype.initializeMacroCommand=function(){}
MacroCommand.prototype.addSubCommand=function(commandClassRef)
{this.subCommands.push(commandClassRef);};MacroCommand.prototype.execute=function(note)
{while(this.subCommands.length>0)
{var ref=this.subCommands.shift();var cmd=new ref;cmd.initializeNotifier(this.multitonKey);cmd.execute(note);}};function Mediator(mediatorName,viewComponent)
{this.mediatorName=mediatorName||this.constructor.NAME;this.viewComponent=viewComponent;};Mediator.NAME="Mediator";Mediator.prototype=new Notifier;Mediator.prototype.constructor=Mediator;Mediator.prototype.getMediatorName=function()
{return this.mediatorName;};Mediator.prototype.setViewComponent=function(viewComponent)
{this.viewComponent=viewComponent;};Mediator.prototype.getViewComponent=function()
{return this.viewComponent;};Mediator.prototype.listNotificationInterests=function()
{return[];};Mediator.prototype.handleNotification=function(notification)
{return;};Mediator.prototype.onRegister=function()
{return;};Mediator.prototype.onRemove=function()
{return;};Mediator.prototype.mediatorName=null;Mediator.prototype.viewComponent=null;function Proxy(proxyName,data)
{this.proxyName=proxyName||this.constructor.NAME;if(data!=null)
{this.setData(data);}};Proxy.NAME="Proxy";Proxy.prototype=new Notifier;Proxy.prototype.constructor=Proxy;Proxy.prototype.getProxyName=function()
{return this.proxyName;};Proxy.prototype.setData=function(data)
{this.data=data;};Proxy.prototype.getData=function()
{return this.data;};Proxy.prototype.onRegister=function()
{return;};Proxy.prototype.onRemove=function()
{return;};Proxy.prototype.proxyName=null;Proxy.prototype.data=null;function Facade(key)
{if(Facade.instanceMap[key]!=null)
{throw new Error(Facade.MULTITON_MSG);}
this.initializeNotifier(key);Facade.instanceMap[key]=this;this.initializeFacade();};Facade.prototype.initializeFacade=function()
{this.initializeModel();this.initializeController();this.initializeView();};Facade.getInstance=function(key)
{if(null==key)
return null;if(Facade.instanceMap[key]==null)
{Facade.instanceMap[key]=new Facade(key);}
return Facade.instanceMap[key];};Facade.prototype.initializeController=function()
{if(this.controller!=null)
return;this.controller=Controller.getInstance(this.multitonKey);};Facade.prototype.initializeModel=function()
{if(this.model!=null)
return;this.model=Model.getInstance(this.multitonKey);};Facade.prototype.initializeView=function()
{if(this.view!=null)
return;this.view=View.getInstance(this.multitonKey);};Facade.prototype.registerCommand=function(notificationName,commandClassRef)
{this.controller.registerCommand(notificationName,commandClassRef);};Facade.prototype.removeCommand=function(notificationName)
{this.controller.removeCommand(notificationName);};Facade.prototype.hasCommand=function(notificationName)
{return this.controller.hasCommand(notificationName);};Facade.prototype.registerProxy=function(proxy)
{this.model.registerProxy(proxy);};Facade.prototype.retrieveProxy=function(proxyName)
{return this.model.retrieveProxy(proxyName);};Facade.prototype.removeProxy=function(proxyName)
{var proxy=null;if(this.model!=null)
{proxy=this.model.removeProxy(proxyName);}
return proxy;};Facade.prototype.hasProxy=function(proxyName)
{return this.model.hasProxy(proxyName);};Facade.prototype.registerMediator=function(mediator)
{if(this.view!=null)
{this.view.registerMediator(mediator);}};Facade.prototype.retrieveMediator=function(mediatorName)
{return this.view.retrieveMediator(mediatorName);};Facade.prototype.removeMediator=function(mediatorName)
{var mediator=null;if(this.view!=null)
{mediator=this.view.removeMediator(mediatorName);}
return mediator;};Facade.prototype.hasMediator=function(mediatorName)
{return this.view.hasMediator(mediatorName);};Facade.prototype.sendNotification=function(notificationName,body,type)
{this.notifyObservers(new Notification(notificationName,body,type));};Facade.prototype.notifyObservers=function(notification)
{if(this.view!=null)
{this.view.notifyObservers(notification);}};Facade.prototype.initializeNotifier=function(key)
{this.multitonKey=key;};Facade.hasCore=function(key)
{return Facade.instanceMap[key]!=null;};Facade.removeCore=function(key)
{if(Facade.instanceMap[key]==null)
return;Model.removeModel(key);View.removeView(key);Controller.removeController(key);delete Facade.instanceMap[key];};Facade.prototype.controller=null;Facade.prototype.model=null;Facade.prototype.view=null;Facade.prototype.multitonKey=null;Facade.instanceMap=[];Facade.MULTITON_MSG="Facade instance for this Multiton key already constructed!";function View(key)
{if(View.instanceMap[key]!=null)
{throw new Error(View.MULTITON_MSG);};this.multitonKey=key;View.instanceMap[this.multitonKey]=this;this.mediatorMap=[];this.observerMap=[];this.initializeView();};View.prototype.initializeView=function()
{return;};View.getInstance=function(key)
{if(null==key)
return null;if(View.instanceMap[key]==null)
{View.instanceMap[key]=new View(key);};return View.instanceMap[key];};View.prototype.registerObserver=function(notificationName,observer)
{if(this.observerMap[notificationName]!=null)
{this.observerMap[notificationName].push(observer);}
else
{this.observerMap[notificationName]=[observer];}};View.prototype.notifyObservers=function(notification)
{if(this.observerMap[notification.getName()]!=null)
{var observers_ref=this.observerMap[notification.getName()],observers=[],observer
for(var i=0;i<observers_ref.length;i++)
{observer=observers_ref[i];observers.push(observer);}
for(var i=0;i<observers.length;i++)
{observer=observers[i];observer.notifyObserver(notification);}}};View.prototype.removeObserver=function(notificationName,notifyContext)
{var observers=this.observerMap[notificationName];for(var i=0;i<observers.length;i++)
{if(observers[i].compareNotifyContext(notifyContext)==true)
{observers.splice(i,1);break;}}
if(observers.length==0)
{delete this.observerMap[notificationName];}};View.prototype.registerMediator=function(mediator)
{if(this.mediatorMap[mediator.getMediatorName()]!=null)
{return;}
mediator.initializeNotifier(this.multitonKey);this.mediatorMap[mediator.getMediatorName()]=mediator;var interests=mediator.listNotificationInterests();if(interests.length>0)
{var observer=new Observer(mediator.handleNotification,mediator);for(var i=0;i<interests.length;i++)
{this.registerObserver(interests[i],observer);}}
mediator.onRegister();}
View.prototype.retrieveMediator=function(mediatorName)
{return this.mediatorMap[mediatorName];};View.prototype.removeMediator=function(mediatorName)
{var mediator=this.mediatorMap[mediatorName];if(mediator)
{var interests=mediator.listNotificationInterests();for(var i=0;i<interests.length;i++)
{this.removeObserver(interests[i],mediator);}
delete this.mediatorMap[mediatorName];mediator.onRemove();}
return mediator;};View.prototype.hasMediator=function(mediatorName)
{return this.mediatorMap[mediatorName]!=null;};View.removeView=function(key)
{delete View.instanceMap[key];};View.prototype.mediatorMap=null;View.prototype.observerMap=null;View.instanceMap=[];View.prototype.multitonKey=null;View.MULTITON_MSG="View instance for this Multiton key already constructed!";function Model(key)
{if(Model.instanceMap[key])
{throw new Error(Model.MULTITON_MSG);}
this.multitonKey=key;Model.instanceMap[key]=this;this.proxyMap=[];this.initializeModel();};Model.prototype.initializeModel=function(){};Model.getInstance=function(key)
{if(null==key)
return null;if(Model.instanceMap[key]==null)
{Model.instanceMap[key]=new Model(key);}
return Model.instanceMap[key];};Model.prototype.registerProxy=function(proxy)
{proxy.initializeNotifier(this.multitonKey);this.proxyMap[proxy.getProxyName()]=proxy;proxy.onRegister();};Model.prototype.retrieveProxy=function(proxyName)
{return this.proxyMap[proxyName];};Model.prototype.hasProxy=function(proxyName)
{return this.proxyMap[proxyName]!=null;};Model.prototype.removeProxy=function(proxyName)
{var proxy=this.proxyMap[proxyName];if(proxy)
{this.proxyMap[proxyName]=null;proxy.onRemove();}
return proxy;};Model.removeModel=function(key)
{delete Model.instanceMap[key];};Model.prototype.proxyMap=null;Model.instanceMap=[];Model.prototype.multitonKey;Model.MULTITON_MSG="Model instance for this Multiton key already constructed!";function Controller(key)
{if(Controller.instanceMap[key]!=null)
{throw new Error(Controller.MULTITON_MSG);}
this.multitonKey=key;Controller.instanceMap[this.multitonKey]=this;this.commandMap=new Array();this.initializeController();}
Controller.prototype.initializeController=function()
{this.view=View.getInstance(this.multitonKey);};Controller.getInstance=function(key)
{if(null==key)
return null;if(null==this.instanceMap[key])
{this.instanceMap[key]=new this(key);}
return this.instanceMap[key];};Controller.prototype.executeCommand=function(note)
{var commandClassRef=this.commandMap[note.getName()];if(commandClassRef==null)
return;var commandInstance=new commandClassRef();commandInstance.initializeNotifier(this.multitonKey);commandInstance.execute(note);};Controller.prototype.registerCommand=function(notificationName,commandClassRef)
{if(this.commandMap[notificationName]==null)
{this.view.registerObserver(notificationName,new Observer(this.executeCommand,this));}
this.commandMap[notificationName]=commandClassRef;};Controller.prototype.hasCommand=function(notificationName)
{return this.commandMap[notificationName]!=null;};Controller.prototype.removeCommand=function(notificationName)
{if(this.hasCommand(notificationName))
{this.view.removeObserver(notificationName,this);this.commandMap[notificationName]=null;}};Controller.removeController=function(key)
{delete this.instanceMap[key];};Controller.prototype.view=null;Controller.prototype.commandMap=null;Controller.prototype.multitonKey=null;Controller.instanceMap=[];Controller.MULTITON_MSG="controller key for this Multiton key already constructed"
var OopHelp={global:(function(){return this})(),extend:function(child,parent)
{if('function'!==typeof child)
throw new TypeError('#extend- child should be Function');if('function'!==typeof parent)
throw new TypeError('#extend- parent should be Function');if(parent===child)
return;var Transitive=new Function;Transitive.prototype=parent.prototype;child.prototype=new Transitive;return child.prototype.constructor=child;},decorate:function(object,traits)
{for(var accessor in traits)
{object[accessor]=traits[accessor];}
return object;}};function declare(qualifiedName,object,scope)
{var nodes=qualifiedName.split('.'),node=scope||OopHelp.global,lastNode,newNode,nodeName;for(var i=0,n=nodes.length;i<n;i++)
{lastNode=node;nodeName=nodes[i];node=(null==node[nodeName]?node[nodeName]={}:node[nodeName]);}
if(null==object)
return node;return lastNode[nodeName]=object;};function define(classInfo,traits,staticTraits)
{if(!classInfo)
{classInfo={}}
var className=classInfo.name,classParent=classInfo.parent,doExtend='function'===typeof classParent,classConstructor,classScope=classInfo.scope||null,prototype
if('parent'in classInfo&&!doExtend)
{throw new TypeError('Class parent must be Function');}
if(classInfo.hasOwnProperty('constructor'))
{classConstructor=classInfo.constructor
if('function'!==typeof classConstructor)
{throw new TypeError('Class constructor must be Function')}}
else
{if(doExtend)
{classConstructor=function()
{classParent.apply(this,arguments);}}
else
{classConstructor=new Function;}}
if(doExtend)
{OopHelp.extend(classConstructor,classParent);}
if(traits)
{prototype=classConstructor.prototype
OopHelp.decorate(prototype,traits);prototype.constructor=classConstructor;}
if(staticTraits)
{OopHelp.decorate(classConstructor,staticTraits)}
if(className)
{if('string'!==typeof className)
{throw new TypeError('Class name must be primitive string');}
declare(className,classConstructor,classScope);}
return classConstructor;};scope.puremvc={View:View,Model:Model,Controller:Controller,SimpleCommand:SimpleCommand,MacroCommand:MacroCommand,Facade:Facade,Mediator:Mediator,Observer:Observer,Notification:Notification,Notifier:Notifier,Proxy:Proxy,define:define,declare:declare};})(this);
var initResponsiveToolTips=function()
{var targets=$('[rel~=tooltip]').not('[data-init-tooltip]'),target=false,tooltip=false,title=false;targets.on('mouseenter',function()
{target=$(this);tip=target.attr('title');if(!tip||tip=='')
return false;tooltip=$('<div id="tooltip"></div>');target.removeAttr('title');tooltip.css('opacity',0).html(tip).appendTo('body');var init_tooltip=function()
{if($(window).width()<tooltip.outerWidth()*1.5)
tooltip.css('max-width',$(window).width()/2);else
tooltip.css('max-width',340);var pos_left=target.offset().left+(target.outerWidth()/2)-(tooltip.outerWidth()/2),pos_top=target.offset().top-tooltip.outerHeight()-20;if(pos_left<0)
{pos_left=target.offset().left+target.outerWidth()/2-20;tooltip.addClass('left');}
else
tooltip.removeClass('left');if(pos_left+tooltip.outerWidth()>$(window).width())
{pos_left=target.offset().left-tooltip.outerWidth()+target.outerWidth()/2+20;tooltip.addClass('right');}
else
tooltip.removeClass('right');if(pos_top<0)
{var pos_top=target.offset().top+target.outerHeight();tooltip.addClass('top');}
else
tooltip.removeClass('top');tooltip.css({left:pos_left,top:pos_top}).animate({top:'+=10',opacity:1},50);};init_tooltip();$(window).resize(init_tooltip);var remove_tooltip=function(target_,tooltip_,tip_)
{setTimeout(function(){if(!tooltip_.is(":hover")){tooltip_.animate({top:'-=10',opacity:0},50,function(){$(this).remove();});target_.attr('title',tip_);}else{tooltip_.one('mouseleave',remove_tooltip.bind(this,target_,tooltip_,tip_));}},175);};target.one('mouseleave',remove_tooltip.bind(this,target,tooltip,tip));tooltip.one('click',remove_tooltip.bind(this,target,tooltip,tip));}).attr('data-init-tooltip',1);};$(initResponsiveToolTips);
(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=len;if(arguments.length>1){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=(1/0)&&n!=-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n));}}
var k=n>=0?Math.min(n,len-1):len-Math.abs(n);for(;k>=0;k--){if(k in t&&t[k]===searchElement){return k;}}
return-1;};}
if(typeof String.prototype.trim!=='function'){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');}}
var root=this,$=root.jQuery||root.Zepto,i18n={},resStore={},currentLng,replacementCounter=0,languages=[],initialized=false,sync={};if(typeof module!=='undefined'&&module.exports){if(!$){try{$=require('jquery');}catch(e){}}
if($){$.i18n=$.i18n||i18n;}
module.exports=i18n;}else{if($){$.i18n=$.i18n||i18n;}
root.i18n=root.i18n||i18n;}
sync={load:function(lngs,options,cb){if(options.useLocalStorage){sync._loadLocal(lngs,options,function(err,store){var missingLngs=[];for(var i=0,len=lngs.length;i<len;i++){if(!store[lngs[i]])missingLngs.push(lngs[i]);}
if(missingLngs.length>0){sync._fetch(missingLngs,options,function(err,fetched){f.extend(store,fetched);sync._storeLocal(fetched);cb(null,store);});}else{cb(null,store);}});}else{sync._fetch(lngs,options,function(err,store){cb(null,store);});}},_loadLocal:function(lngs,options,cb){var store={},nowMS=new Date().getTime();if(window.localStorage){var todo=lngs.length;f.each(lngs,function(key,lng){var local=window.localStorage.getItem('res_'+lng);if(local){local=JSON.parse(local);if(local.i18nStamp&&local.i18nStamp+options.localStorageExpirationTime>nowMS){store[lng]=local;}}
todo--;if(todo===0)cb(null,store);});}},_storeLocal:function(store){if(window.localStorage){for(var m in store){store[m].i18nStamp=new Date().getTime();window.localStorage.setItem('res_'+m,JSON.stringify(store[m]));}}
return;},_fetch:function(lngs,options,cb){var ns=options.ns,store={};if(!options.dynamicLoad){var todo=ns.namespaces.length*lngs.length,errors;f.each(ns.namespaces,function(nsIndex,nsValue){f.each(lngs,function(lngIndex,lngValue){var loadComplete=function(err,data){if(err){errors=errors||[];errors.push(err);}
store[lngValue]=store[lngValue]||{};store[lngValue][nsValue]=data;todo--;if(todo===0)cb(errors,store);};if(typeof options.customLoad=='function'){options.customLoad(lngValue,nsValue,options,loadComplete);}else{sync._fetchOne(lngValue,nsValue,options,loadComplete);}});});}else{var loadComplete=function(err,data){cb(null,data);};if(typeof options.customLoad=='function'){options.customLoad(lngs,ns.namespaces,options,loadComplete);}else{var url=applyReplacement(options.resGetPath,{lng:lngs.join('+'),ns:ns.namespaces.join('+')});f.ajax({url:url,success:function(data,status,xhr){f.log('loaded: '+url);loadComplete(null,data);},error:function(xhr,status,error){f.log('failed loading: '+url);loadComplete('failed loading resource.json error: '+error);},dataType:"json",async:options.getAsync});}}},_fetchOne:function(lng,ns,options,done){var url=applyReplacement(options.resGetPath,{lng:lng,ns:ns});f.ajax({url:url,success:function(data,status,xhr){f.log('loaded: '+url);done(null,data);},error:function(xhr,status,error){if((status&&status==200)||(xhr&&xhr.status&&xhr.status==200)){f.error('There is a typo in: '+url);}else if((status&&status==404)||(xhr&&xhr.status&&xhr.status==404)){f.log('Does not exist: '+url);}else{var theStatus=status?status:((xhr&&xhr.status)?xhr.status:null);f.log(theStatus+' when loading '+url);}
done(error,{});},dataType:"json",async:options.getAsync});},postMissing:function(lng,ns,key,defaultValue,lngs){var payload={};payload[key]=defaultValue;var urls=[];if(o.sendMissingTo==='fallback'&&o.fallbackLng[0]!==false){for(var i=0;i<o.fallbackLng.length;i++){urls.push({lng:o.fallbackLng[i],url:applyReplacement(o.resPostPath,{lng:o.fallbackLng[i],ns:ns})});}}else if(o.sendMissingTo==='current'||(o.sendMissingTo==='fallback'&&o.fallbackLng[0]===false)){urls.push({lng:lng,url:applyReplacement(o.resPostPath,{lng:lng,ns:ns})});}else if(o.sendMissingTo==='all'){for(var i=0,l=lngs.length;i<l;i++){urls.push({lng:lngs[i],url:applyReplacement(o.resPostPath,{lng:lngs[i],ns:ns})});}}
for(var y=0,len=urls.length;y<len;y++){var item=urls[y];f.ajax({url:item.url,type:o.sendType,data:payload,success:function(data,status,xhr){f.log('posted missing key \''+key+'\' to: '+item.url);var keys=key.split('.');var x=0;var value=resStore[item.lng][ns];while(keys[x]){if(x===keys.length-1){value=value[keys[x]]=defaultValue;}else{value=value[keys[x]]=value[keys[x]]||{};}
x++;}},error:function(xhr,status,error){f.log('failed posting missing key \''+key+'\' to: '+item.url);},dataType:"json",async:o.postAsync});}}};var o={lng:undefined,load:'all',preload:[],lowerCaseLng:false,returnObjectTrees:false,fallbackLng:['dev'],fallbackNS:[],detectLngQS:'setLng',detectLngFromLocalStorage:false,ns:'translation',fallbackOnNull:true,fallbackOnEmpty:false,fallbackToDefaultNS:false,nsseparator:':',keyseparator:'.',selectorAttr:'data-i18n',debug:false,resGetPath:'locales/__lng__/__ns__.json',resPostPath:'locales/add/__lng__/__ns__',getAsync:true,postAsync:true,resStore:undefined,useLocalStorage:false,localStorageExpirationTime:7*24*60*60*1000,dynamicLoad:false,sendMissing:false,sendMissingTo:'fallback',sendType:'POST',interpolationPrefix:'__',interpolationSuffix:'__',reusePrefix:'$t(',reuseSuffix:')',pluralSuffix:'_plural',pluralNotFound:['plural_not_found',Math.random()].join(''),contextNotFound:['context_not_found',Math.random()].join(''),escapeInterpolation:false,indefiniteSuffix:'_indefinite',indefiniteNotFound:['indefinite_not_found',Math.random()].join(''),setJqueryExt:true,defaultValueFromContent:true,useDataAttrOptions:false,cookieExpirationTime:undefined,useCookie:true,cookieName:'i18next',cookieDomain:undefined,objectTreeKeyHandler:undefined,postProcess:undefined,parseMissingKey:undefined,missingKeyHandler:sync.postMissing,shortcutFunction:'sprintf'};function _extend(target,source){if(!source||typeof source==='function'){return target;}
for(var attr in source){target[attr]=source[attr];}
return target;}
function _deepExtend(target,source){for(var prop in source)
if(prop in target)
_deepExtend(target[prop],source[prop]);else
target[prop]=source[prop];return target;}
function _each(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||Object.prototype.toString.apply(object)!=='[object Array]'||typeof object==="function";if(args){if(isObj){for(name in object){if(callback.apply(object[name],args)===false){break;}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break;}}}}else{if(isObj){for(name in object){if(callback.call(object[name],name,object[name])===false){break;}}}else{for(;i<length;){if(callback.call(object[i],i,object[i++])===false){break;}}}}
return object;}
var _entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function _escape(data){if(typeof data==='string'){return data.replace(/[&<>"'\/]/g,function(s){return _entityMap[s];});}else{return data;}}
function _ajax(options){var getXhr=function(callback){if(window.XMLHttpRequest){return callback(null,new XMLHttpRequest());}else if(window.ActiveXObject){try{return callback(null,new ActiveXObject("Msxml2.XMLHTTP"));}catch(e){return callback(null,new ActiveXObject("Microsoft.XMLHTTP"));}}
return callback(new Error());};var encodeUsingUrlEncoding=function(data){if(typeof data==='string'){return data;}
var result=[];for(var dataItem in data){if(data.hasOwnProperty(dataItem)){result.push(encodeURIComponent(dataItem)+'='+encodeURIComponent(data[dataItem]));}}
return result.join('&');};var utf8=function(text){text=text.replace(/\r\n/g,'\n');var result='';for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);if(c<128){result+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){result+=String.fromCharCode((c>>6)|192);result+=String.fromCharCode((c&63)|128);}else{result+=String.fromCharCode((c>>12)|224);result+=String.fromCharCode(((c>>6)&63)|128);result+=String.fromCharCode((c&63)|128);}}
return result;};var base64=function(text){var keyStr='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';text=utf8(text);var result='',chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;do{chr1=text.charCodeAt(i++);chr2=text.charCodeAt(i++);chr3=text.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
result+=keyStr.charAt(enc1)+
keyStr.charAt(enc2)+
keyStr.charAt(enc3)+
keyStr.charAt(enc4);chr1=chr2=chr3='';enc1=enc2=enc3=enc4='';}while(i<text.length);return result;};var mergeHeaders=function(){var result=arguments[0];for(var i=1;i<arguments.length;i++){var currentHeaders=arguments[i];for(var header in currentHeaders){if(currentHeaders.hasOwnProperty(header)){result[header]=currentHeaders[header];}}}
return result;};var ajax=function(method,url,options,callback){if(typeof options==='function'){callback=options;options={};}
options.cache=options.cache||false;options.data=options.data||{};options.headers=options.headers||{};options.jsonp=options.jsonp||false;options.async=options.async===undefined?true:options.async;var headers=mergeHeaders({'accept':'*/*','content-type':'application/x-www-form-urlencoded;charset=UTF-8'},ajax.headers,options.headers);var payload;if(headers['content-type']==='application/json'){payload=JSON.stringify(options.data);}else{payload=encodeUsingUrlEncoding(options.data);}
if(method==='GET'){var queryString=[];if(payload){queryString.push(payload);payload=null;}
if(!options.cache){queryString.push('_='+(new Date()).getTime());}
if(options.jsonp){queryString.push('callback='+options.jsonp);queryString.push('jsonp='+options.jsonp);}
queryString=queryString.join('&');if(queryString.length>1){if(url.indexOf('?')>-1){url+='&'+queryString;}else{url+='?'+queryString;}}
if(options.jsonp){var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.type='text/javascript';script.src=url;head.appendChild(script);return;}}
getXhr(function(err,xhr){if(err)return callback(err);xhr.open(method,url,options.async);for(var header in headers){if(headers.hasOwnProperty(header)){xhr.setRequestHeader(header,headers[header]);}}
xhr.onreadystatechange=function(){if(xhr.readyState===4){var data=xhr.responseText||'';if(!callback){return;}
callback(xhr.status,{text:function(){return data;},json:function(){return JSON.parse(data);}});}};xhr.send(payload);});};var http={authBasic:function(username,password){ajax.headers['Authorization']='Basic '+base64(username+':'+password);},connect:function(url,options,callback){return ajax('CONNECT',url,options,callback);},del:function(url,options,callback){return ajax('DELETE',url,options,callback);},get:function(url,options,callback){return ajax('GET',url,options,callback);},head:function(url,options,callback){return ajax('HEAD',url,options,callback);},headers:function(headers){ajax.headers=headers||{};},isAllowed:function(url,verb,callback){this.options(url,function(status,data){callback(data.text().indexOf(verb)!==-1);});},options:function(url,options,callback){return ajax('OPTIONS',url,options,callback);},patch:function(url,options,callback){return ajax('PATCH',url,options,callback);},post:function(url,options,callback){return ajax('POST',url,options,callback);},put:function(url,options,callback){return ajax('PUT',url,options,callback);},trace:function(url,options,callback){return ajax('TRACE',url,options,callback);}};var methode=options.type?options.type.toLowerCase():'get';http[methode](options.url,options,function(status,data){if(status===200||(status===0&&data.text())){options.success(data.json(),status,null);}else{options.error(data.text(),status,null);}});}
var _cookie={create:function(name,value,minutes,domain){var expires;if(minutes){var date=new Date();date.setTime(date.getTime()+(minutes*60*1000));expires="; expires="+date.toGMTString();}
else expires="";domain=(domain)?"domain="+domain+";":"";document.cookie=name+"="+value+expires+";"+domain+"path=/";},read:function(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length);}
return null;},remove:function(name){this.create(name,"",-1);}};var cookie_noop={create:function(name,value,minutes,domain){},read:function(name){return null;},remove:function(name){}};var f={extend:$?$.extend:_extend,deepExtend:_deepExtend,each:$?$.each:_each,ajax:$?$.ajax:(typeof document!=='undefined'?_ajax:function(){}),cookie:typeof document!=='undefined'?_cookie:cookie_noop,detectLanguage:detectLanguage,escape:_escape,log:function(str){if(o.debug&&typeof console!=="undefined")console.log(str);},error:function(str){if(typeof console!=="undefined")console.error(str);},getCountyIndexOfLng:function(lng){var lng_index=0;if(lng==='nb-NO'||lng==='nn-NO')lng_index=1;return lng_index;},toLanguages:function(lng){var log=this.log;var languages=[];var whitelist=o.lngWhitelist||false;var addLanguage=function(language){if(!whitelist||whitelist.indexOf(language)>-1){languages.push(language);}else{log('rejecting non-whitelisted language: '+language);}};if(typeof lng==='string'&&lng.indexOf('-')>-1){var parts=lng.split('-');lng=o.lowerCaseLng?parts[0].toLowerCase()+'-'+parts[1].toLowerCase():parts[0].toLowerCase()+'-'+parts[1].toUpperCase();if(o.load!=='unspecific')addLanguage(lng);if(o.load!=='current')addLanguage(parts[this.getCountyIndexOfLng(lng)]);}else{addLanguage(lng);}
for(var i=0;i<o.fallbackLng.length;i++){if(languages.indexOf(o.fallbackLng[i])===-1&&o.fallbackLng[i])languages.push(o.fallbackLng[i]);}
return languages;},regexEscape:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");},regexReplacementEscape:function(strOrFn){if(typeof strOrFn==='string'){return strOrFn.replace(/\$/g,"$$$$");}else{return strOrFn;}}};function init(options,cb){if(typeof options==='function'){cb=options;options={};}
options=options||{};f.extend(o,options);delete o.fixLng;if(typeof o.ns=='string'){o.ns={namespaces:[o.ns],defaultNs:o.ns};}
if(typeof o.fallbackNS=='string'){o.fallbackNS=[o.fallbackNS];}
if(typeof o.fallbackLng=='string'||typeof o.fallbackLng=='boolean'){o.fallbackLng=[o.fallbackLng];}
o.interpolationPrefixEscaped=f.regexEscape(o.interpolationPrefix);o.interpolationSuffixEscaped=f.regexEscape(o.interpolationSuffix);if(!o.lng)o.lng=f.detectLanguage();languages=f.toLanguages(o.lng);currentLng=languages[0];f.log('currentLng set to: '+currentLng);if(o.useCookie&&f.cookie.read(o.cookieName)!==currentLng){f.cookie.create(o.cookieName,currentLng,o.cookieExpirationTime,o.cookieDomain);}
if(o.detectLngFromLocalStorage&&typeof document!=='undefined'&&window.localstorage){window.localStorage.setItem('i18next_lng',currentLng);}
var lngTranslate=translate;if(options.fixLng){lngTranslate=function(key,options){options=options||{};options.lng=options.lng||lngTranslate.lng;return translate(key,options);};lngTranslate.lng=currentLng;}
pluralExtensions.setCurrentLng(currentLng);if($&&o.setJqueryExt)addJqueryFunct();var deferred;if($&&$.Deferred){deferred=$.Deferred();}
if(o.resStore){resStore=o.resStore;initialized=true;if(cb)cb(lngTranslate);if(deferred)deferred.resolve(lngTranslate);if(deferred)return deferred.promise();return;}
var lngsToLoad=f.toLanguages(o.lng);if(typeof o.preload==='string')o.preload=[o.preload];for(var i=0,l=o.preload.length;i<l;i++){var pres=f.toLanguages(o.preload[i]);for(var y=0,len=pres.length;y<len;y++){if(lngsToLoad.indexOf(pres[y])<0){lngsToLoad.push(pres[y]);}}}
i18n.sync.load(lngsToLoad,o,function(err,store){resStore=store;initialized=true;if(cb)cb(lngTranslate);if(deferred)deferred.resolve(lngTranslate);});if(deferred)return deferred.promise();}
function preload(lngs,cb){if(typeof lngs==='string')lngs=[lngs];for(var i=0,l=lngs.length;i<l;i++){if(o.preload.indexOf(lngs[i])<0){o.preload.push(lngs[i]);}}
return init(cb);}
function addResourceBundle(lng,ns,resources,deep){if(typeof ns!=='string'){resources=ns;ns=o.ns.defaultNs;}else if(o.ns.namespaces.indexOf(ns)<0){o.ns.namespaces.push(ns);}
resStore[lng]=resStore[lng]||{};resStore[lng][ns]=resStore[lng][ns]||{};if(deep){f.deepExtend(resStore[lng][ns],resources);}else{f.extend(resStore[lng][ns],resources);}}
function removeResourceBundle(lng,ns){if(typeof ns!=='string'){ns=o.ns.defaultNs;}
resStore[lng]=resStore[lng]||{};resStore[lng][ns]={};}
function addResource(lng,ns,key,value){if(typeof ns!=='string'){resource=ns;ns=o.ns.defaultNs;}else if(o.ns.namespaces.indexOf(ns)<0){o.ns.namespaces.push(ns);}
resStore[lng]=resStore[lng]||{};resStore[lng][ns]=resStore[lng][ns]||{};var keys=key.split(o.keyseparator);var x=0;var node=resStore[o.lng][ns];var origRef=node;while(keys[x]){if(x==keys.length-1)
node[keys[x]]=value;else{if(node[keys[x]]==null)
node[keys[x]]={};node=node[keys[x]];}
x++;}}
function addResources(lng,ns,resources){if(typeof ns!=='string'){resource=ns;ns=o.ns.defaultNs;}else if(o.ns.namespaces.indexOf(ns)<0){o.ns.namespaces.push(ns);}
for(var m in resources){if(typeof resources[m]==='string')addResource(lng,ns,m,resources[m]);}}
function setDefaultNamespace(ns){o.ns.defaultNs=ns;}
function loadNamespace(namespace,cb){loadNamespaces([namespace],cb);}
function loadNamespaces(namespaces,cb){var opts={dynamicLoad:o.dynamicLoad,resGetPath:o.resGetPath,getAsync:o.getAsync,customLoad:o.customLoad,ns:{namespaces:namespaces,defaultNs:''}};var lngsToLoad=f.toLanguages(o.lng);if(typeof o.preload==='string')o.preload=[o.preload];for(var i=0,l=o.preload.length;i<l;i++){var pres=f.toLanguages(o.preload[i]);for(var y=0,len=pres.length;y<len;y++){if(lngsToLoad.indexOf(pres[y])<0){lngsToLoad.push(pres[y]);}}}
var lngNeedLoad=[];for(var a=0,lenA=lngsToLoad.length;a<lenA;a++){var needLoad=false;var resSet=resStore[lngsToLoad[a]];if(resSet){for(var b=0,lenB=namespaces.length;b<lenB;b++){if(!resSet[namespaces[b]])needLoad=true;}}else{needLoad=true;}
if(needLoad)lngNeedLoad.push(lngsToLoad[a]);}
if(lngNeedLoad.length){i18n.sync._fetch(lngNeedLoad,opts,function(err,store){var todo=namespaces.length*lngNeedLoad.length;f.each(namespaces,function(nsIndex,nsValue){if(o.ns.namespaces.indexOf(nsValue)<0){o.ns.namespaces.push(nsValue);}
f.each(lngNeedLoad,function(lngIndex,lngValue){resStore[lngValue]=resStore[lngValue]||{};resStore[lngValue][nsValue]=store[lngValue][nsValue];todo--;if(todo===0&&cb){if(o.useLocalStorage)i18n.sync._storeLocal(resStore);cb();}});});});}else{if(cb)cb();}}
function setLng(lng,options,cb){if(typeof options==='function'){cb=options;options={};}else if(!options){options={};}
options.lng=lng;return init(options,cb);}
function lng(){return currentLng;}
function addJqueryFunct(){$.t=$.t||translate;function parse(ele,key,options){if(key.length===0)return;var attr='text';if(key.indexOf('[')===0){var parts=key.split(']');key=parts[1];attr=parts[0].substr(1,parts[0].length-1);}
if(key.indexOf(';')===key.length-1){key=key.substr(0,key.length-2);}
var optionsToUse;if(attr==='html'){optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.html()},options):options;ele.html($.t(key,optionsToUse));}else if(attr==='text'){optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.text()},options):options;ele.text($.t(key,optionsToUse));}else if(attr==='prepend'){optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.html()},options):options;ele.prepend($.t(key,optionsToUse));}else if(attr==='append'){optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.html()},options):options;ele.append($.t(key,optionsToUse));}else if(attr.indexOf("data-")===0){var dataAttr=attr.substr(("data-").length);optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.data(dataAttr)},options):options;var translated=$.t(key,optionsToUse);ele.data(dataAttr,translated);ele.attr(attr,translated);}else{optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.attr(attr)},options):options;ele.attr(attr,$.t(key,optionsToUse));}}
function localize(ele,options){var key=ele.attr(o.selectorAttr);if(!key&&typeof key!=='undefined'&&key!==false)key=ele.text()||ele.val();if(!key)return;var target=ele,targetSelector=ele.data("i18n-target");if(targetSelector){target=ele.find(targetSelector)||ele;}
if(!options&&o.useDataAttrOptions===true){options=ele.data("i18n-options");}
options=options||{};if(key.indexOf(';')>=0){var keys=key.split(';');$.each(keys,function(m,k){if(k!=='')parse(target,k,options);});}else{parse(target,key,options);}
if(o.useDataAttrOptions===true)ele.data("i18n-options",options);}
$.fn.i18n=function(options){return this.each(function(){localize($(this),options);var elements=$(this).find('['+o.selectorAttr+']');elements.each(function(){localize($(this),options);});});};}
function applyReplacement(str,replacementHash,nestedKey,options){if(!str)return str;options=options||replacementHash;if(str.indexOf(options.interpolationPrefix||o.interpolationPrefix)<0)return str;var prefix=options.interpolationPrefix?f.regexEscape(options.interpolationPrefix):o.interpolationPrefixEscaped,suffix=options.interpolationSuffix?f.regexEscape(options.interpolationSuffix):o.interpolationSuffixEscaped,unEscapingSuffix='HTML'+suffix;var hash=replacementHash.replace&&typeof replacementHash.replace==='object'?replacementHash.replace:replacementHash;f.each(hash,function(key,value){var nextKey=nestedKey?nestedKey+o.keyseparator+key:key;if(typeof value==='object'&&value!==null){str=applyReplacement(str,value,nextKey,options);}else{if(options.escapeInterpolation||o.escapeInterpolation){str=str.replace(new RegExp([prefix,nextKey,unEscapingSuffix].join(''),'g'),f.regexReplacementEscape(value));str=str.replace(new RegExp([prefix,nextKey,suffix].join(''),'g'),f.regexReplacementEscape(f.escape(value)));}else{str=str.replace(new RegExp([prefix,nextKey,suffix].join(''),'g'),f.regexReplacementEscape(value));}}});return str;}
f.applyReplacement=applyReplacement;function applyReuse(translated,options){var comma=',';var options_open='{';var options_close='}';var opts=f.extend({},options);delete opts.postProcess;while(translated.indexOf(o.reusePrefix)!=-1){replacementCounter++;if(replacementCounter>o.maxRecursion){break;}
var index_of_opening=translated.lastIndexOf(o.reusePrefix);var index_of_end_of_closing=translated.indexOf(o.reuseSuffix,index_of_opening)+o.reuseSuffix.length;var token=translated.substring(index_of_opening,index_of_end_of_closing);var token_without_symbols=token.replace(o.reusePrefix,'').replace(o.reuseSuffix,'');if(index_of_end_of_closing<=index_of_opening){f.error('there is an missing closing in following translation value',translated);return'';}
if(token_without_symbols.indexOf(comma)!=-1){var index_of_token_end_of_closing=token_without_symbols.indexOf(comma);if(token_without_symbols.indexOf(options_open,index_of_token_end_of_closing)!=-1&&token_without_symbols.indexOf(options_close,index_of_token_end_of_closing)!=-1){var index_of_opts_opening=token_without_symbols.indexOf(options_open,index_of_token_end_of_closing);var index_of_opts_end_of_closing=token_without_symbols.indexOf(options_close,index_of_opts_opening)+options_close.length;try{opts=f.extend(opts,JSON.parse(token_without_symbols.substring(index_of_opts_opening,index_of_opts_end_of_closing)));token_without_symbols=token_without_symbols.substring(0,index_of_token_end_of_closing);}catch(e){}}}
var translated_token=_translate(token_without_symbols,opts);translated=translated.replace(token,f.regexReplacementEscape(translated_token));}
return translated;}
function hasContext(options){return(options.context&&(typeof options.context=='string'||typeof options.context=='number'));}
function needsPlural(options,lng){return(options.count!==undefined&&typeof options.count!='string'&&pluralExtensions.needsPlural(lng,options.count));}
function needsIndefiniteArticle(options){return(options.indefinite_article!==undefined&&typeof options.indefinite_article!='string'&&options.indefinite_article);}
function exists(key,options){options=options||{};var notFound=_getDefaultValue(key,options),found=_find(key,options);return found!==undefined||found===notFound;}
function translate(key,options){options=options||{};if(!initialized){f.log('i18next not finished initialization. you might have called t function before loading resources finished.')
return options.defaultValue||'';};replacementCounter=0;return _translate.apply(null,arguments);}
function _getDefaultValue(key,options){return(options.defaultValue!==undefined)?options.defaultValue:key;}
function _injectSprintfProcessor(){var values=[];for(var i=1;i<arguments.length;i++){values.push(arguments[i]);}
return{postProcess:'sprintf',sprintf:values};}
function _translate(potentialKeys,options){if(options&&typeof options!=='object'){if(o.shortcutFunction==='sprintf'){options=_injectSprintfProcessor.apply(null,arguments);}else if(o.shortcutFunction==='defaultValue'){options={defaultValue:options}}}else{options=options||{};}
if(potentialKeys===undefined||potentialKeys===null||potentialKeys==='')return'';if(typeof potentialKeys=='string'){potentialKeys=[potentialKeys];}
var key=potentialKeys[0];if(potentialKeys.length>1){for(var i=0;i<potentialKeys.length;i++){key=potentialKeys[i];if(exists(key,options)){break;}}}
var notFound=_getDefaultValue(key,options),found=_find(key,options),lngs=options.lng?f.toLanguages(options.lng,options.fallbackLng):languages,ns=options.ns||o.ns.defaultNs,parts;if(key.indexOf(o.nsseparator)>-1){parts=key.split(o.nsseparator);ns=parts[0];key=parts[1];}
if(found===undefined&&o.sendMissing&&typeof o.missingKeyHandler==='function'){if(options.lng){o.missingKeyHandler(lngs[0],ns,key,notFound,lngs);}else{o.missingKeyHandler(o.lng,ns,key,notFound,lngs);}}
var postProcessor=options.postProcess||o.postProcess;if(found!==undefined&&postProcessor){if(postProcessors[postProcessor]){found=postProcessors[postProcessor](found,key,options);}}
var splitNotFound=notFound;if(notFound.indexOf(o.nsseparator)>-1){parts=notFound.split(o.nsseparator);splitNotFound=parts[1];}
if(splitNotFound===key&&o.parseMissingKey){notFound=o.parseMissingKey(notFound);}
if(found===undefined){notFound=applyReplacement(notFound,options);notFound=applyReuse(notFound,options);if(postProcessor&&postProcessors[postProcessor]){var val=_getDefaultValue(key,options);found=postProcessors[postProcessor](val,key,options);}}
return(found!==undefined)?found:notFound;}
function _find(key,options){options=options||{};var optionWithoutCount,translated,notFound=_getDefaultValue(key,options),lngs=languages;if(!resStore){return notFound;}
if(lngs[0].toLowerCase()==='cimode')return notFound;if(options.lng){lngs=f.toLanguages(options.lng,options.fallbackLng);if(!resStore[lngs[0]]){var oldAsync=o.getAsync;o.getAsync=false;i18n.sync.load(lngs,o,function(err,store){f.extend(resStore,store);o.getAsync=oldAsync;});}}
var ns=options.ns||o.ns.defaultNs;if(key.indexOf(o.nsseparator)>-1){var parts=key.split(o.nsseparator);ns=parts[0];key=parts[1];}
if(hasContext(options)){optionWithoutCount=f.extend({},options);delete optionWithoutCount.context;optionWithoutCount.defaultValue=o.contextNotFound;var contextKey=ns+o.nsseparator+key+'_'+options.context;translated=translate(contextKey,optionWithoutCount);if(translated!=o.contextNotFound){return applyReplacement(translated,{context:options.context});}}
if(needsPlural(options,lngs[0])){optionWithoutCount=f.extend({},options);delete optionWithoutCount.count;optionWithoutCount.defaultValue=o.pluralNotFound;var pluralKey=ns+o.nsseparator+key+o.pluralSuffix;var pluralExtension=pluralExtensions.get(lngs[0],options.count);if(pluralExtension>=0){pluralKey=pluralKey+'_'+pluralExtension;}else if(pluralExtension===1){pluralKey=ns+o.nsseparator+key;}
translated=translate(pluralKey,optionWithoutCount);if(translated!=o.pluralNotFound){return applyReplacement(translated,{count:options.count,interpolationPrefix:options.interpolationPrefix,interpolationSuffix:options.interpolationSuffix});}}
if(needsIndefiniteArticle(options)){var optionsWithoutIndef=f.extend({},options);delete optionsWithoutIndef.indefinite_article;optionsWithoutIndef.defaultValue=o.indefiniteNotFound;var indefiniteKey=ns+o.nsseparator+key+(((options.count&&!needsPlural(options,lngs[0]))||!options.count)?o.indefiniteSuffix:"");translated=translate(indefiniteKey,optionsWithoutIndef);if(translated!=o.indefiniteNotFound){return translated;}}
var found;var keys=key.split(o.keyseparator);for(var i=0,len=lngs.length;i<len;i++){if(found!==undefined)break;var l=lngs[i];var x=0;var value=resStore[l]&&resStore[l][ns];while(keys[x]){value=value&&value[keys[x]];x++;}
if(value!==undefined){var valueType=Object.prototype.toString.apply(value);if(typeof value==='string'){value=applyReplacement(value,options);value=applyReuse(value,options);}else if(valueType==='[object Array]'&&!o.returnObjectTrees&&!options.returnObjectTrees){value=value.join('\n');value=applyReplacement(value,options);value=applyReuse(value,options);}else if(value===null&&o.fallbackOnNull===true){value=undefined;}else if(value!==null){if(!o.returnObjectTrees&&!options.returnObjectTrees){if(o.objectTreeKeyHandler&&typeof o.objectTreeKeyHandler=='function'){value=o.objectTreeKeyHandler(key,value,l,ns,options);}else{value='key \''+ns+':'+key+' ('+l+')\' '+'returned an object instead of string.';f.log(value);}}else if(valueType!=='[object Number]'&&valueType!=='[object Function]'&&valueType!=='[object RegExp]'){var copy=(valueType==='[object Array]')?[]:{};f.each(value,function(m){copy[m]=_translate(ns+o.nsseparator+key+o.keyseparator+m,options);});value=copy;}}
if(typeof value==='string'&&value.trim()===''&&o.fallbackOnEmpty===true)
value=undefined;found=value;}}
if(found===undefined&&!options.isFallbackLookup&&(o.fallbackToDefaultNS===true||(o.fallbackNS&&o.fallbackNS.length>0))){options.isFallbackLookup=true;if(o.fallbackNS.length){for(var y=0,lenY=o.fallbackNS.length;y<lenY;y++){found=_find(o.fallbackNS[y]+o.nsseparator+key,options);if(found){var foundValue=found.indexOf(o.nsseparator)>-1?found.split(o.nsseparator)[1]:found,notFoundValue=notFound.indexOf(o.nsseparator)>-1?notFound.split(o.nsseparator)[1]:notFound;if(foundValue!==notFoundValue)break;}}}else{found=_find(key,options);}
options.isFallbackLookup=false;}
return found;}
function detectLanguage(){var detectedLng;var qsParm=[];if(typeof window!=='undefined'){(function(){var query=window.location.search.substring(1);var parms=query.split('&');for(var i=0;i<parms.length;i++){var pos=parms[i].indexOf('=');if(pos>0){var key=parms[i].substring(0,pos);var val=parms[i].substring(pos+1);qsParm[key]=val;}}})();if(qsParm[o.detectLngQS]){detectedLng=qsParm[o.detectLngQS];}}
if(!detectedLng&&typeof document!=='undefined'&&o.useCookie){var c=f.cookie.read(o.cookieName);if(c)detectedLng=c;}
if(!detectedLng&&typeof document!=='undefined'&&window.localstorage&&o.detectLngFromLocalStorage){detectedLng=window.localStorage.getItem('i18next_lng');}
if(!detectedLng&&typeof navigator!=='undefined'){detectedLng=(navigator.language)?navigator.language:navigator.userLanguage;}
if(!detectedLng){detectedLng=o.fallbackLng[0];}
return detectedLng;}
var pluralExtensions={rules:{"ach":{"name":"Acholi","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"af":{"name":"Afrikaans","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ak":{"name":"Akan","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"am":{"name":"Amharic","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"an":{"name":"Aragonese","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ar":{"name":"Arabic","numbers":[0,1,2,3,11,100],"plurals":function(n){return Number(n===0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5);}},"arn":{"name":"Mapudungun","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"ast":{"name":"Asturian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ay":{"name":"Aymar\u00e1","numbers":[1],"plurals":function(n){return 0;}},"az":{"name":"Azerbaijani","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"be":{"name":"Belarusian","numbers":[1,2,5],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"bg":{"name":"Bulgarian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"bn":{"name":"Bengali","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"bo":{"name":"Tibetan","numbers":[1],"plurals":function(n){return 0;}},"br":{"name":"Breton","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"bs":{"name":"Bosnian","numbers":[1,2,5],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"ca":{"name":"Catalan","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"cgg":{"name":"Chiga","numbers":[1],"plurals":function(n){return 0;}},"cs":{"name":"Czech","numbers":[1,2,5],"plurals":function(n){return Number((n==1)?0:(n>=2&&n<=4)?1:2);}},"csb":{"name":"Kashubian","numbers":[1,2,5],"plurals":function(n){return Number(n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"cy":{"name":"Welsh","numbers":[1,2,3,8],"plurals":function(n){return Number((n==1)?0:(n==2)?1:(n!=8&&n!=11)?2:3);}},"da":{"name":"Danish","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"de":{"name":"German","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"dz":{"name":"Dzongkha","numbers":[1],"plurals":function(n){return 0;}},"el":{"name":"Greek","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"en":{"name":"English","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"eo":{"name":"Esperanto","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"es":{"name":"Spanish","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"es_ar":{"name":"Argentinean Spanish","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"et":{"name":"Estonian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"eu":{"name":"Basque","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"fa":{"name":"Persian","numbers":[1],"plurals":function(n){return 0;}},"fi":{"name":"Finnish","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"fil":{"name":"Filipino","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"fo":{"name":"Faroese","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"fr":{"name":"French","numbers":[1,2],"plurals":function(n){return Number(n>=2);}},"fur":{"name":"Friulian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"fy":{"name":"Frisian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ga":{"name":"Irish","numbers":[1,2,3,7,11],"plurals":function(n){return Number(n==1?0:n==2?1:n<7?2:n<11?3:4);}},"gd":{"name":"Scottish Gaelic","numbers":[1,2,3,20],"plurals":function(n){return Number((n==1||n==11)?0:(n==2||n==12)?1:(n>2&&n<20)?2:3);}},"gl":{"name":"Galician","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"gu":{"name":"Gujarati","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"gun":{"name":"Gun","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"ha":{"name":"Hausa","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"he":{"name":"Hebrew","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"hi":{"name":"Hindi","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"hr":{"name":"Croatian","numbers":[1,2,5],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"hu":{"name":"Hungarian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"hy":{"name":"Armenian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ia":{"name":"Interlingua","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"id":{"name":"Indonesian","numbers":[1],"plurals":function(n){return 0;}},"is":{"name":"Icelandic","numbers":[1,2],"plurals":function(n){return Number(n%10!=1||n%100==11);}},"it":{"name":"Italian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ja":{"name":"Japanese","numbers":[1],"plurals":function(n){return 0;}},"jbo":{"name":"Lojban","numbers":[1],"plurals":function(n){return 0;}},"jv":{"name":"Javanese","numbers":[0,1],"plurals":function(n){return Number(n!==0);}},"ka":{"name":"Georgian","numbers":[1],"plurals":function(n){return 0;}},"kk":{"name":"Kazakh","numbers":[1],"plurals":function(n){return 0;}},"km":{"name":"Khmer","numbers":[1],"plurals":function(n){return 0;}},"kn":{"name":"Kannada","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ko":{"name":"Korean","numbers":[1],"plurals":function(n){return 0;}},"ku":{"name":"Kurdish","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"kw":{"name":"Cornish","numbers":[1,2,3,4],"plurals":function(n){return Number((n==1)?0:(n==2)?1:(n==3)?2:3);}},"ky":{"name":"Kyrgyz","numbers":[1],"plurals":function(n){return 0;}},"lb":{"name":"Letzeburgesch","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ln":{"name":"Lingala","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"lo":{"name":"Lao","numbers":[1],"plurals":function(n){return 0;}},"lt":{"name":"Lithuanian","numbers":[1,2,10],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2);}},"lv":{"name":"Latvian","numbers":[1,2,0],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n!==0?1:2);}},"mai":{"name":"Maithili","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"mfe":{"name":"Mauritian Creole","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"mg":{"name":"Malagasy","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"mi":{"name":"Maori","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"mk":{"name":"Macedonian","numbers":[1,2],"plurals":function(n){return Number(n==1||n%10==1?0:1);}},"ml":{"name":"Malayalam","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"mn":{"name":"Mongolian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"mnk":{"name":"Mandinka","numbers":[0,1,2],"plurals":function(n){return Number(0?0:n==1?1:2);}},"mr":{"name":"Marathi","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ms":{"name":"Malay","numbers":[1],"plurals":function(n){return 0;}},"mt":{"name":"Maltese","numbers":[1,2,11,20],"plurals":function(n){return Number(n==1?0:n===0||(n%100>1&&n%100<11)?1:(n%100>10&&n%100<20)?2:3);}},"nah":{"name":"Nahuatl","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"nap":{"name":"Neapolitan","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"nb":{"name":"Norwegian Bokmal","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ne":{"name":"Nepali","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"nl":{"name":"Dutch","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"nn":{"name":"Norwegian Nynorsk","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"no":{"name":"Norwegian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"nso":{"name":"Northern Sotho","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"oc":{"name":"Occitan","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"or":{"name":"Oriya","numbers":[2,1],"plurals":function(n){return Number(n!=1);}},"pa":{"name":"Punjabi","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"pap":{"name":"Papiamento","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"pl":{"name":"Polish","numbers":[1,2,5],"plurals":function(n){return Number(n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"pms":{"name":"Piemontese","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ps":{"name":"Pashto","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"pt":{"name":"Portuguese","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"pt_br":{"name":"Brazilian Portuguese","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"rm":{"name":"Romansh","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ro":{"name":"Romanian","numbers":[1,2,20],"plurals":function(n){return Number(n==1?0:(n===0||(n%100>0&&n%100<20))?1:2);}},"ru":{"name":"Russian","numbers":[1,2,5],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"sah":{"name":"Yakut","numbers":[1],"plurals":function(n){return 0;}},"sco":{"name":"Scots","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"se":{"name":"Northern Sami","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"si":{"name":"Sinhala","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"sk":{"name":"Slovak","numbers":[1,2,5],"plurals":function(n){return Number((n==1)?0:(n>=2&&n<=4)?1:2);}},"sl":{"name":"Slovenian","numbers":[5,1,2,3],"plurals":function(n){return Number(n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0);}},"so":{"name":"Somali","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"son":{"name":"Songhay","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"sq":{"name":"Albanian","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"sr":{"name":"Serbian","numbers":[1,2,5],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"su":{"name":"Sundanese","numbers":[1],"plurals":function(n){return 0;}},"sv":{"name":"Swedish","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"sw":{"name":"Swahili","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"ta":{"name":"Tamil","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"te":{"name":"Telugu","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"tg":{"name":"Tajik","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"th":{"name":"Thai","numbers":[1],"plurals":function(n){return 0;}},"ti":{"name":"Tigrinya","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"tk":{"name":"Turkmen","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"tr":{"name":"Turkish","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"tt":{"name":"Tatar","numbers":[1],"plurals":function(n){return 0;}},"ug":{"name":"Uyghur","numbers":[1],"plurals":function(n){return 0;}},"uk":{"name":"Ukrainian","numbers":[1,2,5],"plurals":function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);}},"ur":{"name":"Urdu","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"uz":{"name":"Uzbek","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"vi":{"name":"Vietnamese","numbers":[1],"plurals":function(n){return 0;}},"wa":{"name":"Walloon","numbers":[1,2],"plurals":function(n){return Number(n>1);}},"wo":{"name":"Wolof","numbers":[1],"plurals":function(n){return 0;}},"yo":{"name":"Yoruba","numbers":[1,2],"plurals":function(n){return Number(n!=1);}},"zh":{"name":"Chinese","numbers":[1],"plurals":function(n){return 0;}}},addRule:function(lng,obj){pluralExtensions.rules[lng]=obj;},setCurrentLng:function(lng){if(!pluralExtensions.currentRule||pluralExtensions.currentRule.lng!==lng){var parts=lng.split('-');pluralExtensions.currentRule={lng:lng,rule:pluralExtensions.rules[parts[0]]};}},needsPlural:function(lng,count){var parts=lng.split('-');var ext;if(pluralExtensions.currentRule&&pluralExtensions.currentRule.lng===lng){ext=pluralExtensions.currentRule.rule;}else{ext=pluralExtensions.rules[parts[f.getCountyIndexOfLng(lng)]];}
if(ext&&ext.numbers.length<=1){return false;}else{return this.get(lng,count)!==1;}},get:function(lng,count){var parts=lng.split('-');function getResult(l,c){var ext;if(pluralExtensions.currentRule&&pluralExtensions.currentRule.lng===lng){ext=pluralExtensions.currentRule.rule;}else{ext=pluralExtensions.rules[l];}
if(ext){var i;if(ext.noAbs){i=ext.plurals(c);}else{i=ext.plurals(Math.abs(c));}
var number=ext.numbers[i];if(ext.numbers.length===2&&ext.numbers[0]===1){if(number===2){number=-1;}else if(number===1){number=1;}}
return number;}else{return c===1?'1':'-1';}}
return getResult(parts[f.getCountyIndexOfLng(lng)],count);}};var postProcessors={};var addPostProcessor=function(name,fc){postProcessors[name]=fc;};var sprintf=(function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase();}
function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}
return output.join('');}
var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0]);}
return str_format.format.call(null,str_format.cache[arguments[0]],arguments);};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type='',arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==='string'){output.push(parse_tree[i]);}
else if(node_type==='array'){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw(sprintf('[sprintf] property "%s" does not exist',match[2][k]));}
arg=arg[match[2][k]];}}
else if(match[1]){arg=argv[match[1]];}
else{arg=argv[cursor++];}
if(/[^s]/.test(match[8])&&(get_type(arg)!='number')){throw(sprintf('[sprintf] expecting number but found %s',get_type(arg)));}
switch(match[8]){case'b':arg=arg.toString(2);break;case'c':arg=String.fromCharCode(arg);break;case'd':arg=parseInt(arg,10);break;case'e':arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case'f':arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case'o':arg=arg.toString(8);break;case's':arg=((arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg);break;case'u':arg=Math.abs(arg);break;case'x':arg=arg.toString(16);break;case'X':arg=arg.toString(16).toUpperCase();break;}
arg=(/[def]/.test(match[8])&&match[3]&&arg>=0?'+'+arg:arg);pad_character=match[4]?match[4]=='0'?'0':match[4].charAt(1):' ';pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):'';output.push(match[5]?arg+pad:pad+arg);}}
return output.join('');};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0]);}
else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push('%');}
else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==''){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else{throw('[sprintf] huh?');}}}
else{throw('[sprintf] huh?');}
match[2]=field_list;}
else{arg_names|=2;}
if(arg_names===3){throw('[sprintf] mixing positional and named placeholders is not (yet) supported');}
parse_tree.push(match);}
else{throw('[sprintf] huh?');}
_fmt=_fmt.substring(match[0].length);}
return parse_tree;};return str_format;})();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv);};addPostProcessor("sprintf",function(val,key,opts){if(!opts.sprintf)return val;if(Object.prototype.toString.apply(opts.sprintf)==='[object Array]'){return vsprintf(val,opts.sprintf);}else if(typeof opts.sprintf==='object'){return sprintf(val,opts.sprintf);}
return val;});i18n.init=init;i18n.setLng=setLng;i18n.preload=preload;i18n.addResourceBundle=addResourceBundle;i18n.addResource=addResource;i18n.addResources=addResources;i18n.removeResourceBundle=removeResourceBundle;i18n.loadNamespace=loadNamespace;i18n.loadNamespaces=loadNamespaces;i18n.setDefaultNamespace=setDefaultNamespace;i18n.t=translate;i18n.translate=translate;i18n.exists=exists;i18n.detectLanguage=f.detectLanguage;i18n.pluralExtensions=pluralExtensions;i18n.sync=sync;i18n.functions=f;i18n.lng=lng;i18n.addPostProcessor=addPostProcessor;i18n.options=o;})();
(function(root,factory){if(typeof define==='function'&&define.amd){define(factory);}else{root.Dragdealer=factory();}}(this,function(){var Dragdealer=function(wrapper,options){this.options=this.applyDefaults(options||{});this.bindMethods();this.wrapper=this.getWrapperElement(wrapper);if(!this.wrapper){return;}
this.handle=this.getHandleElement(this.wrapper,this.options.handleClass);if(!this.handle){return;}
this.init();this.bindEventListeners();};Dragdealer.prototype={defaults:{disabled:false,horizontal:true,vertical:false,slide:true,steps:0,snap:false,loose:false,speed:0.1,xPrecision:0,yPrecision:0,handleClass:'handle',css3:true,activeClass:'active',tapping:true},init:function(){if(this.options.css3){triggerWebkitHardwareAcceleration(this.handle);}
this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]};this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]};this.change=[0,0];this.stepRatios=this.calculateStepRatios();this.activity=false;this.dragging=false;this.tapping=false;this.reflow();if(this.options.disabled){this.disable();}},applyDefaults:function(options){for(var k in this.defaults){if(!options.hasOwnProperty(k)){options[k]=this.defaults[k];}}
return options;},getWrapperElement:function(wrapper){if(typeof(wrapper)=='string'){return document.getElementById(wrapper);}else{return wrapper;}},getHandleElement:function(wrapper,handleClass){var childElements,handleClassMatcher,i;if(wrapper.getElementsByClassName){childElements=wrapper.getElementsByClassName(handleClass);if(childElements.length>0){return childElements[0];}}else{handleClassMatcher=new RegExp('(^|\\s)'+handleClass+'(\\s|$)');childElements=wrapper.getElementsByTagName('*');for(i=0;i<childElements.length;i++){if(handleClassMatcher.test(childElements[i].className)){return childElements[i];}}}},calculateStepRatios:function(){var stepRatios=[];if(this.options.steps>=1){for(var i=0;i<=this.options.steps-1;i++){if(this.options.steps>1){stepRatios[i]=i/(this.options.steps-1);}else{stepRatios[i]=0;}}}
return stepRatios;},setWrapperOffset:function(){this.offset.wrapper=Position.get(this.wrapper);},calculateBounds:function(){var bounds={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};bounds.availWidth=(bounds.right-bounds.left)-this.handle.offsetWidth;bounds.availHeight=(bounds.bottom-bounds.top)-this.handle.offsetHeight;return bounds;},calculateValuePrecision:function(){var xPrecision=this.options.xPrecision||Math.abs(this.bounds.availWidth),yPrecision=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[xPrecision?1/xPrecision:0,yPrecision?1/yPrecision:0];},bindMethods:function(){if(typeof(this.options.customRequestAnimationFrame)==='function'){this.requestAnimationFrame=bind(this.options.customRequestAnimationFrame,window);}else{this.requestAnimationFrame=bind(requestAnimationFrame,window);}
if(typeof(this.options.customCancelAnimationFrame)==='function'){this.cancelAnimationFrame=bind(this.options.customCancelAnimationFrame,window);}else{this.cancelAnimationFrame=bind(cancelAnimationFrame,window);}
this.animateWithRequestAnimationFrame=bind(this.animateWithRequestAnimationFrame,this);this.animate=bind(this.animate,this);this.onHandleMouseDown=bind(this.onHandleMouseDown,this);this.onHandleTouchStart=bind(this.onHandleTouchStart,this);this.onDocumentMouseMove=bind(this.onDocumentMouseMove,this);this.onWrapperTouchMove=bind(this.onWrapperTouchMove,this);this.onWrapperMouseDown=bind(this.onWrapperMouseDown,this);this.onWrapperTouchStart=bind(this.onWrapperTouchStart,this);this.onDocumentMouseUp=bind(this.onDocumentMouseUp,this);this.onDocumentTouchEnd=bind(this.onDocumentTouchEnd,this);this.onHandleClick=bind(this.onHandleClick,this);this.onWindowResize=bind(this.onWindowResize,this);},bindEventListeners:function(){addEventListener(this.handle,'mousedown',this.onHandleMouseDown);addEventListener(this.handle,'touchstart',this.onHandleTouchStart);addEventListener(document,'mousemove',this.onDocumentMouseMove);addEventListener(this.wrapper,'touchmove',this.onWrapperTouchMove);addEventListener(this.wrapper,'mousedown',this.onWrapperMouseDown);addEventListener(this.wrapper,'touchstart',this.onWrapperTouchStart);addEventListener(document,'mouseup',this.onDocumentMouseUp);addEventListener(document,'touchend',this.onDocumentTouchEnd);addEventListener(this.handle,'click',this.onHandleClick);addEventListener(window,'resize',this.onWindowResize);this.animate(false,true);this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame);},unbindEventListeners:function(){removeEventListener(this.handle,'mousedown',this.onHandleMouseDown);removeEventListener(this.handle,'touchstart',this.onHandleTouchStart);removeEventListener(document,'mousemove',this.onDocumentMouseMove);removeEventListener(this.wrapper,'touchmove',this.onWrapperTouchMove);removeEventListener(this.wrapper,'mousedown',this.onWrapperMouseDown);removeEventListener(this.wrapper,'touchstart',this.onWrapperTouchStart);removeEventListener(document,'mouseup',this.onDocumentMouseUp);removeEventListener(document,'touchend',this.onDocumentTouchEnd);removeEventListener(this.handle,'click',this.onHandleClick);removeEventListener(window,'resize',this.onWindowResize);this.cancelAnimationFrame(this.interval);},onHandleMouseDown:function(e){$(".colpick:visible").hide();Cursor.refresh(e);preventEventDefaults(e);stopEventPropagation(e);this.activity=false;this.startDrag();},onHandleTouchStart:function(e){Cursor.refresh(e);stopEventPropagation(e);this.activity=false;this.startDrag();},onDocumentMouseMove:function(e){Cursor.refresh(e);if(this.dragging){this.activity=true;preventEventDefaults(e);}},onWrapperTouchMove:function(e){Cursor.refresh(e);if(!this.activity&&this.draggingOnDisabledAxis()){if(this.dragging){this.stopDrag();}
return;}
preventEventDefaults(e);this.activity=true;},onWrapperMouseDown:function(e){Cursor.refresh(e);preventEventDefaults(e);this.startTap();},onWrapperTouchStart:function(e){Cursor.refresh(e);preventEventDefaults(e);this.startTap();},onDocumentMouseUp:function(e){this.stopDrag();this.stopTap();},onDocumentTouchEnd:function(e){this.stopDrag();this.stopTap();},onHandleClick:function(e){if(this.activity){preventEventDefaults(e);stopEventPropagation(e);}},onWindowResize:function(e){this.reflow();},enable:function(){this.disabled=false;this.handle.className=this.handle.className.replace(/\s?disabled/g,'');},disable:function(){this.disabled=true;this.handle.className+=' disabled';},reflow:function(){this.setWrapperOffset();this.bounds=this.calculateBounds();this.valuePrecision=this.calculateValuePrecision();this.updateOffsetFromValue();},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])];},getValue:function(){return this.value.target;},setStep:function(x,y,snap){this.setValue(this.options.steps&&x>1?(x-1)/(this.options.steps-1):0,this.options.steps&&y>1?(y-1)/(this.options.steps-1):0,snap);},setValue:function(x,y,snap){this.setTargetValue([x,y||0]);if(snap){this.groupCopy(this.value.current,this.value.target);this.updateOffsetFromValue();this.callAnimationCallback();}},setValueWithoutCallback:function(x){var callback=this.options.callback;this.options.callback=null;this.setValue(x,0,true);this.options.callback=callback;},startTap:function(){if(this.disabled||!this.options.tapping){return;}
this.tapping=true;this.setWrapperOffset();this.setTargetValueByOffset([Cursor.x-this.offset.wrapper[0]-(this.handle.offsetWidth/2),Cursor.y-this.offset.wrapper[1]-(this.handle.offsetHeight/2)]);},stopTap:function(){if(this.disabled||!this.tapping){return;}
this.tapping=false;this.setTargetValue(this.value.current);},startDrag:function(){if(this.disabled){return;}
this.dragging=true;this.setWrapperOffset();this.offset.mouse=[Cursor.x-Position.get(this.handle)[0],Cursor.y-Position.get(this.handle)[1]];if(!this.wrapper.className.match(this.options.activeClass)){this.wrapper.className+=' '+this.options.activeClass;}
this.callDragStartCallback();},stopDrag:function(){if(this.disabled||!this.dragging){return;}
this.dragging=false;var target=this.groupClone(this.value.current);if(this.options.slide){var ratioChange=this.change;target[0]+=ratioChange[0]*4;target[1]+=ratioChange[1]*4;}
this.setTargetValue(target);this.wrapper.className=this.wrapper.className.replace(' '+this.options.activeClass,'');this.callDragStopCallback();},callAnimationCallback:function(){var value=this.value.current;if(this.options.snap&&this.options.steps>1){value=this.getClosestSteps(value);}
if(!this.groupCompare(value,this.value.prev)){if(typeof(this.options.animationCallback)=='function'){this.options.animationCallback.call(this,value[0],value[1]);}
this.groupCopy(this.value.prev,value);}},callTargetCallback:function(){if(typeof(this.options.callback)=='function'){this.options.callback.call(this,this.value.target[0],this.value.target[1]);}},callDragStartCallback:function(){if(typeof(this.options.dragStartCallback)=='function'){this.options.dragStartCallback.call(this,this.value.target[0],this.value.target[1]);}},callDragStopCallback:function(){if(typeof(this.options.dragStopCallback)=='function'){this.options.dragStopCallback.call(this,this.value.target[0],this.value.target[1]);}},animateWithRequestAnimationFrame:function(time){if(time){this.timeOffset=this.timeStamp?time-this.timeStamp:0;this.timeStamp=time;}else{this.timeOffset=25;}
this.animate();this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame);},animate:function(direct,first){if(direct&&!this.dragging){return;}
if(this.dragging){var prevTarget=this.groupClone(this.value.target);var offset=[Cursor.x-this.offset.wrapper[0]-this.offset.mouse[0],Cursor.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(offset,this.options.loose);this.change=[this.value.target[0]-prevTarget[0],this.value.target[1]-prevTarget[1]];}
if(this.dragging||first){this.groupCopy(this.value.current,this.value.target);}
if(this.dragging||this.glide()||first){this.updateOffsetFromValue();this.callAnimationCallback();}},glide:function(){var diff=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];if(!diff[0]&&!diff[1]){return false;}
if(Math.abs(diff[0])>this.valuePrecision[0]||Math.abs(diff[1])>this.valuePrecision[1]){this.value.current[0]+=diff[0]*Math.min(this.options.speed*this.timeOffset/25,1);this.value.current[1]+=diff[1]*Math.min(this.options.speed*this.timeOffset/25,1);}else{this.groupCopy(this.value.current,this.value.target);}
return true;},updateOffsetFromValue:function(){if(!this.options.snap){this.offset.current=this.getOffsetsByRatios(this.value.current);}else{this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current));}
if(!this.groupCompare(this.offset.current,this.offset.prev)){this.renderHandlePosition();this.groupCopy(this.offset.prev,this.offset.current);}},renderHandlePosition:function(){var transform='';if(this.options.css3&&StylePrefix.transform){if(this.options.horizontal){transform+='translateX('+this.offset.current[0]+'px)';}
if(this.options.vertical){transform+=' translateY('+this.offset.current[1]+'px)';}
this.handle.style[StylePrefix.transform]=transform;return;}
if(this.options.horizontal){this.handle.style.left=this.offset.current[0]+'px';}
if(this.options.vertical){this.handle.style.top=this.offset.current[1]+'px';}},setTargetValue:function(value,loose){var target=loose?this.getLooseValue(value):this.getProperValue(value);this.groupCopy(this.value.target,target);this.offset.target=this.getOffsetsByRatios(target);this.callTargetCallback();},setTargetValueByOffset:function(offset,loose){var value=this.getRatiosByOffsets(offset);var target=loose?this.getLooseValue(value):this.getProperValue(value);this.groupCopy(this.value.target,target);this.offset.target=this.getOffsetsByRatios(target);},getLooseValue:function(value){var proper=this.getProperValue(value);return[proper[0]+((value[0]-proper[0])/4),proper[1]+((value[1]-proper[1])/4)];},getProperValue:function(value){var proper=this.groupClone(value);proper[0]=Math.max(proper[0],0);proper[1]=Math.max(proper[1],0);proper[0]=Math.min(proper[0],1);proper[1]=Math.min(proper[1],1);if((!this.dragging&&!this.tapping)||this.options.snap){if(this.options.steps>1){proper=this.getClosestSteps(proper);}}
return proper;},getRatiosByOffsets:function(group){return[this.getRatioByOffset(group[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(group[1],this.bounds.availHeight,this.bounds.top)];},getRatioByOffset:function(offset,range,padding){return range?(offset-padding)/range:0;},getOffsetsByRatios:function(group){return[this.getOffsetByRatio(group[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(group[1],this.bounds.availHeight,this.bounds.top)];},getOffsetByRatio:function(ratio,range,padding){return Math.round(ratio*range)+padding;},getStepNumber:function(value){return this.getClosestStep(value)*(this.options.steps-1)+1;},getClosestSteps:function(group){return[this.getClosestStep(group[0]),this.getClosestStep(group[1])];},getClosestStep:function(value){var k=0;var min=1;for(var i=0;i<=this.options.steps-1;i++){if(Math.abs(this.stepRatios[i]-value)<min){min=Math.abs(this.stepRatios[i]-value);k=i;}}
return this.stepRatios[k];},groupCompare:function(a,b){return a[0]==b[0]&&a[1]==b[1];},groupCopy:function(a,b){a[0]=b[0];a[1]=b[1];},groupClone:function(a){return[a[0],a[1]];},draggingOnDisabledAxis:function(){return(!this.options.horizontal&&Cursor.xDiff>Cursor.yDiff)||(!this.options.vertical&&Cursor.yDiff>Cursor.xDiff);}};var bind=function(fn,context){return function(){return fn.apply(context,arguments);};};var addEventListener=function(element,type,callback){if(element.addEventListener){element.addEventListener(type,callback,false);}else if(element.attachEvent){element.attachEvent('on'+type,callback);}};var removeEventListener=function(element,type,callback){if(element.removeEventListener){element.removeEventListener(type,callback,false);}else if(element.detachEvent){element.detachEvent('on'+type,callback);}};var preventEventDefaults=function(e){if(!e){e=window.event;}
if(e.preventDefault){e.preventDefault();}
e.returnValue=false;};var stopEventPropagation=function(e){if(!e){e=window.event;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;};var Cursor={x:0,y:0,xDiff:0,yDiff:0,refresh:function(e){if(!e){e=window.event;}
if(e.type=='mousemove'){this.set(e);}else if(e.touches){this.set(e.touches[0]);}},set:function(e){var lastX=this.x,lastY=this.y;if(e.clientX||e.clientY){this.x=e.clientX;this.y=e.clientY;}else if(e.pageX||e.pageY){this.x=e.pageX-document.body.scrollLeft-document.documentElement.scrollLeft;this.y=e.pageY-document.body.scrollTop-document.documentElement.scrollTop;}
this.xDiff=Math.abs(this.x-lastX);this.yDiff=Math.abs(this.y-lastY);}};var Position={get:function(obj){var rect={left:0,top:0};if(obj.getBoundingClientRect!==undefined){rect=obj.getBoundingClientRect();}
return[rect.left,rect.top];}};var StylePrefix={transform:getPrefixedStylePropName('transform'),perspective:getPrefixedStylePropName('perspective'),backfaceVisibility:getPrefixedStylePropName('backfaceVisibility')};function getPrefixedStylePropName(propName){var domPrefixes='Webkit Moz ms O'.split(' '),elStyle=document.documentElement.style;if(elStyle[propName]!==undefined)return propName;propName=propName.charAt(0).toUpperCase()+propName.substr(1);for(var i=0;i<domPrefixes.length;i++){if(elStyle[domPrefixes[i]+propName]!==undefined){return domPrefixes[i]+propName;}}};function triggerWebkitHardwareAcceleration(element){if(StylePrefix.backfaceVisibility&&StylePrefix.perspective){element.style[StylePrefix.perspective]='1000px';element.style[StylePrefix.backfaceVisibility]='hidden';}};var vendors=['webkit','moz'];var requestAnimationFrame=window.requestAnimationFrame;var cancelAnimationFrame=window.cancelAnimationFrame;for(var x=0;x<vendors.length&&!requestAnimationFrame;++x){requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(!requestAnimationFrame){requestAnimationFrame=function(callback){return setTimeout(callback,25);};cancelAnimationFrame=clearTimeout;}
return Dragdealer;}));
(function($){var colpick=function(){var tpl='<div class="colpick">'+'<div class="colpick_color">'+'<div class="colpick_color_overlay1">'+'<div class="colpick_color_overlay2">'+'<div class="colpick_selector_outer">'+'<div class="colpick_selector_inner">'+'</div></div></div></div></div>'+'<div class="colpick_hue">'+'<div class="colpick_hue_arrs">'+'<div class="colpick_hue_larr"></div>'+'<div class="colpick_hue_rarr"></div>'+'</div></div>'+'<div class="colpick_new_color"></div>'+'<div class="colpick_current_color"></div>'+'<div class="colpick_hex_field">'+'<div class="colpick_field_letter">#</div>'+'<input type="text" maxlength="6" size="7" />'+'</div>'+'<div class="colpick_rgb_r colpick_field">'+'<div class="colpick_field_letter">R</div>'+'<input type="text" maxlength="3" size="3" />'+'<div class="colpick_field_arrs">'+'<div class="colpick_field_uarr"></div>'+'<div class="colpick_field_darr"></div>'+'</div></div>'+'<div class="colpick_rgb_g colpick_field">'+'<div class="colpick_field_letter">G</div>'+'<input type="text" maxlength="3" size="3" />'+'<div class="colpick_field_arrs">'+'<div class="colpick_field_uarr"></div>'+'<div class="colpick_field_darr"></div>'+'</div></div>'+'<div class="colpick_rgb_b colpick_field">'+'<div class="colpick_field_letter">B</div>'+'<input type="text" maxlength="3" size="3" />'+'<div class="colpick_field_arrs">'+'<div class="colpick_field_uarr"></div>'+'<div class="colpick_field_darr"></div>'+'</div></div>'+'<div class="colpick_hsb_h colpick_field">'+'<div class="colpick_field_letter">H</div>'+'<input type="text" maxlength="3" size="3" />'+'<div class="colpick_field_arrs">'+'<div class="colpick_field_uarr"></div>'+'<div class="colpick_field_darr"></div>'+'</div></div>'+'<div class="colpick_hsb_s colpick_field">'+'<div class="colpick_field_letter">S</div>'+'<input type="text" maxlength="3" size="3" />'+'<div class="colpick_field_arrs">'+'<div class="colpick_field_uarr"></div>'+'<div class="colpick_field_darr"></div>'+'</div></div>'+'<div class="colpick_hsb_b colpick_field">'+'<div class="colpick_field_letter">B</div>'+'<input type="text" maxlength="3" size="3" />'+'<div class="colpick_field_arrs">'+'<div class="colpick_field_uarr"></div>'+'<div class="colpick_field_darr"></div>'+'</div></div>'+'<div class="col_on_poster">'+'</div>'+'<div class="colpick_poster"></div>'+'<div class="colpick_submit"></div>'+'</div>',defaults={showEvent:'click',onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:'light',color:'3289c7',livePreview:true,flat:false,layout:'full',submit:1,submitText:'CLOSE',height:156},isDownHue_=false,isDownSelector_=false,fillRGBFields=function(hsb,cal){var rgb=hsbToRgb(hsb);$(cal).data('colpick').fields.eq(1).val(rgb.r).end().eq(2).val(rgb.g).end().eq(3).val(rgb.b).end();},fillHSBFields=function(hsb,cal){$(cal).data('colpick').fields.eq(4).val(Math.round(hsb.h)).end().eq(5).val(Math.round(hsb.s)).end().eq(6).val(Math.round(hsb.b)).end();},fillHexFields=function(hsb,cal){$(cal).data('colpick').fields.eq(0).val(hsbToHex(hsb));},setSelector=function(hsb,cal){$(cal).data('colpick').selector.css('backgroundColor','#'+hsbToHex({h:hsb.h,s:100,b:100}));$(cal).data('colpick').selectorIndic.css({left:parseInt($(cal).data('colpick').height*hsb.s/100,10),top:parseInt($(cal).data('colpick').height*(100-hsb.b)/100,10)});},setHue=function(hsb,cal){$(cal).data('colpick').hue.css('top',parseInt($(cal).data('colpick').height-$(cal).data('colpick').height*hsb.h/360,10));},setCurrentColor=function(hsb,cal){$(cal).data('colpick').currentColor.css('backgroundColor','#'+hsbToHex(hsb));},setNewColor=function(hsb,cal){$(cal).data('colpick').newColor.css('backgroundColor','#'+hsbToHex(hsb));},change=function(ev){var cal=$(this).parent().parent(),col;if(this.parentNode.className.indexOf('_hex')>0){cal.data('colpick').color=col=hexToHsb(fixHex(this.value));fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));}else if(this.parentNode.className.indexOf('_hsb')>0){cal.data('colpick').color=col=fixHSB({h:parseInt(cal.data('colpick').fields.eq(4).val(),10),s:parseInt(cal.data('colpick').fields.eq(5).val(),10),b:parseInt(cal.data('colpick').fields.eq(6).val(),10)});fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));}else{cal.data('colpick').color=col=rgbToHsb(fixRGB({r:parseInt(cal.data('colpick').fields.eq(1).val(),10),g:parseInt(cal.data('colpick').fields.eq(2).val(),10),b:parseInt(cal.data('colpick').fields.eq(3).val(),10)}));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));}
setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data('colpick').onChange.apply(cal.parent(),[col,hsbToHex(col),hsbToRgb(col),cal.data('colpick').el,0]);},blur=function(ev){$(this).parent().removeClass('colpick_focus');},focus=function(){$(this).parent().parent().data('colpick').fields.parent().removeClass('colpick_focus');$(this).parent().addClass('colpick_focus');},downIncrement=function(ev){ev.preventDefault?ev.preventDefault():ev.returnValue=false;var field=$(this).parent().find('input').focus();var current={el:$(this).parent().addClass('colpick_slider'),max:this.parentNode.className.indexOf('_hsb_h')>0?360:(this.parentNode.className.indexOf('_hsb')>0?100:255),y:ev.pageY,field:field,val:parseInt(field.val(),10),preview:$(this).parent().parent().data('colpick').livePreview};$(document).mouseup(current,upIncrement);$(document).mousemove(current,moveIncrement);},moveIncrement=function(ev){ev.data.field.val(Math.max(0,Math.min(ev.data.max,parseInt(ev.data.val-ev.pageY+ev.data.y,10))));if(ev.data.preview){change.apply(ev.data.field.get(0),[true]);}
return false;},upIncrement=function(ev){change.apply(ev.data.field.get(0),[true]);ev.data.el.removeClass('colpick_slider').find('input').focus();$(document).off('mouseup',upIncrement);$(document).off('mousemove',moveIncrement);return false;},downHue=function(ev){if(isDownHue_){upHue(ev,true);}
if(isDownSelector_){upSelector(ev,true);}
isDownHue_=true;ev.preventDefault?ev.preventDefault():ev.returnValue=false;var current={cal:$(this).parent(),y:$(this).offset().top};$(document).on('mouseup touchend',current,upHue);$(document).on('mousemove touchmove',current,moveHue);var pageY=((ev.type=='touchstart')?ev.originalEvent.changedTouches[0].pageY:ev.pageY);change.apply(current.cal.data('colpick').fields.eq(4).val(parseInt(360*(current.cal.data('colpick').height-(pageY-current.y))/current.cal.data('colpick').height,10)).get(0),[current.cal.data('colpick').livePreview]);return false;},moveHue=function(ev){var pageY=((ev.type=='touchmove')?ev.originalEvent.changedTouches[0].pageY:ev.pageY);change.apply(ev.data.cal.data('colpick').fields.eq(4).val(parseInt(360*(ev.data.cal.data('colpick').height-Math.max(0,Math.min(ev.data.cal.data('colpick').height,(pageY-ev.data.y))))/ev.data.cal.data('colpick').height,10)).get(0),[ev.data.preview]);return false;},upHue=function(ev,force){force=typeof force=='undefined'?false:force;isDownHue_=false;if(!force){fillRGBFields(ev.data.cal.data('colpick').color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data('colpick').color,ev.data.cal.get(0));}
$(document).off('mouseup touchend',upHue);$(document).off('mousemove touchmove',moveHue);return false;},downSelector=function(ev){if(isDownSelector_){upSelector(ev,true);}
if(isDownHue_){upHue(ev,true);}
isDownSelector_=true;ev.preventDefault?ev.preventDefault():ev.returnValue=false;var current={cal:$(this).parent(),pos:$(this).offset()};current.preview=current.cal.data('colpick').livePreview;$(document).on('mouseup touchend',current,upSelector);$(document).on('mousemove touchmove',current,moveSelector);var payeX,pageY;if(ev.type=='touchstart'){pageX=ev.originalEvent.changedTouches[0].pageX,pageY=ev.originalEvent.changedTouches[0].pageY;}else{pageX=ev.pageX;pageY=ev.pageY;}
change.apply(current.cal.data('colpick').fields.eq(6).val(parseInt(100*(current.cal.data('colpick').height-(pageY-current.pos.top))/current.cal.data('colpick').height,10)).end().eq(5).val(parseInt(100*(pageX-current.pos.left)/current.cal.data('colpick').height,10)).get(0),[current.preview]);return false;},moveSelector=function(ev){var payeX,pageY;if(ev.type=='touchmove'){pageX=ev.originalEvent.changedTouches[0].pageX,pageY=ev.originalEvent.changedTouches[0].pageY;}else{pageX=ev.pageX;pageY=ev.pageY;}
change.apply(ev.data.cal.data('colpick').fields.eq(6).val(parseInt(100*(ev.data.cal.data('colpick').height-Math.max(0,Math.min(ev.data.cal.data('colpick').height,(pageY-ev.data.pos.top))))/ev.data.cal.data('colpick').height,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(ev.data.cal.data('colpick').height,(pageX-ev.data.pos.left))))/ev.data.cal.data('colpick').height,10)).get(0),[ev.data.preview]);return false;},upSelector=function(ev,force){force=typeof force=='undefined'?false:force;isDownSelector_=false;if(!force){fillRGBFields(ev.data.cal.data('colpick').color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data('colpick').color,ev.data.cal.get(0));}
$(document).off('mouseup touchend',upSelector);$(document).off('mousemove touchmove',moveSelector);return false;},clickSubmit=function(ev){var cal=$(this).parent();var col=cal.data('colpick').color;cal.data('colpick').origColor=col;setCurrentColor(col,cal.get(0));cal.data('colpick').onSubmit(col,hsbToHex(col),hsbToRgb(col),cal.data('colpick').el);},doOnPickFromPoster=function(e){if($.isFunction(this.onPickFromPoster)){$(e.target).toggleClass('active');isPickingFromPoster=!isPickingFromPoster;this.onPickFromPoster(isPickingFromPoster);}},doOnColorSelect=function(e){isColorFromPalette=true;$(this).colpickSetColor(hexToRgb(e.target.getAttribute('data-color')),null,false);},isPickingFromPoster=false,isColorFromPalette=false,show=function(ev){ev.stopPropagation();var cal=$('#'+$(this).data('colpickId'));cal.data('colpick').onBeforeShow.apply(this,[cal.get(0)]);var pos=$(this).offset();var top=pos.top+this.offsetHeight;var left=pos.left;var viewPort=getViewport();var calW=cal.width();if(left+calW>viewPort.l+viewPort.w){left-=calW;}
var calH=cal.height();if(top+calH>viewPort.t+viewPort.h){top-=(calH+this.offsetHeight);left-=2;}
cal.css({left:left+'px',top:top+'px'});if(cal.data('colpick').onShow.apply(this,[cal.get(0)])!=false){cal.show();}
$('html').on('mousedown touchend',null,{cal:cal},hide);cal.on('mousedown touchend',null,null,function(ev){ev.stopPropagation();})},hide=function(ev){if(ev.data.cal.data('colpick').onHide.apply(this,[ev.data.cal.get(0)])!=false){ev.data.cal.hide();}
$('html').off('mousedown touchend',hide);if(isPickingFromPoster){ev.data.cal.data('colpick').onPickFromPoster();isPickingFromPoster=false;ev.data.cal.find('div.colpick_poster').removeClass('active');}},getViewport=function(){var m=document.compatMode=='CSS1Compat';return{l:window.pageXOffset||(m?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(m?document.documentElement.clientWidth:document.body.clientWidth),t:window.pageYOffset||(m?document.documentElement.scrollTop:document.body.scrollTop),h:window.innerHeight||(m?document.documentElement.clientHeight:document.body.clientHeight)};},fixHSB=function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))};},fixRGB=function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))};},fixHex=function(hex){var len=6-hex.length;if(len>0){var o=[];for(var i=0;i<len;i++){o.push('0');}
o.push(hex);hex=o.join('');}
return hex;},restoreOriginal=function(){var cal=$(this).parent();var col=cal.data('colpick').origColor;cal.data('colpick').color=col;fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data('colpick').onChange.apply(cal.parent(),[col,hsbToHex(col),hsbToRgb(col),cal.data('colpick').el,0]);};return{init:function(opt){opt=$.extend({},defaults,opt||{});if(typeof opt.color=='string'){opt.color=hexToHsb(opt.color);}else if(opt.color.r!=undefined&&opt.color.g!=undefined&&opt.color.b!=undefined){opt.color=rgbToHsb(opt.color);}else if(opt.color.h!=undefined&&opt.color.s!=undefined&&opt.color.b!=undefined){opt.color=fixHSB(opt.color);}else{return this;}
return this.each(function(){if(!$(this).data('colpickId')){var options=$.extend({},opt);options.origColor=opt.color;var id='collorpicker_'+parseInt(Math.random()*1000);$(this).data('colpickId',id);var cal=$(tpl).attr('id',id);cal.addClass('colpick_'+options.layout+(options.submit?'':' colpick_'+options.layout+'_ns'));if(options.colorScheme!='light'){cal.addClass('colpick_'+options.colorScheme);}
cal.find('div.colpick_submit').html($.t('pm_close')).on('mousedown touchend',null,{cal:cal},hide);cal.find('div.colpick_poster').html('<i class="icon-colorpicker"></i>'+$.t('pm_pick_from_design')).on('mousedown touchend',doOnPickFromPoster.bind(options));options.fields=cal.find('input').change(change).blur(blur).focus(focus);cal.find('div.colpick_field_arrs').mousedown(downIncrement).end().find('div.colpick_current_color').click(restoreOriginal);cal.find('.col_on_poster').on('mousedown touchend','.palette-item',doOnColorSelect.bind(this));options.selector=cal.find('div.colpick_color').on('mousedown touchstart',downSelector);options.selectorIndic=options.selector.find('div.colpick_selector_outer');options.el=this;options.hue=cal.find('div.colpick_hue_arrs');huebar=options.hue.parent();var UA=navigator.userAgent.toLowerCase();var isIE=navigator.appName==='Microsoft Internet Explorer';var IEver=isIE?parseFloat(UA.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0;var ngIE=(isIE&&IEver<10);var stops=['#ff0000','#ff0080','#ff00ff','#8000ff','#0000ff','#0080ff','#00ffff','#00ff80','#00ff00','#80ff00','#ffff00','#ff8000','#ff0000'];if(ngIE){var i,div;for(i=0;i<=11;i++){div=$('<div></div>').attr('style','height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+stops[i]+', endColorstr='+stops[i+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+stops[i]+', endColorstr='+stops[i+1]+')";');huebar.append(div);}}else{stopList=stops.join(',');huebar.attr('style','background:-webkit-linear-gradient(top,'+stopList+'); background: -o-linear-gradient(top,'+stopList+'); background: -ms-linear-gradient(top,'+stopList+'); background:-moz-linear-gradient(top,'+stopList+'); -webkit-linear-gradient(top,'+stopList+'); background:linear-gradient(to bottom,'+stopList+'); ');}
cal.find('div.colpick_hue').on('mousedown touchstart',downHue);options.newColor=cal.find('div.colpick_new_color');options.currentColor=cal.find('div.colpick_current_color');cal.data('colpick',options);fillRGBFields(options.color,cal.get(0));fillHSBFields(options.color,cal.get(0));fillHexFields(options.color,cal.get(0));setHue(options.color,cal.get(0));setSelector(options.color,cal.get(0));setCurrentColor(options.color,cal.get(0));setNewColor(options.color,cal.get(0));if(options.flat){cal.appendTo(this).show();cal.css({position:'relative',display:'block'});}else{cal.appendTo(document.body);$(this).on(options.showEvent,show);cal.css({position:'absolute'});}}});},showPicker:function(){return this.each(function(){if($(this).data('colpickId')){show.apply(this);}});},hidePicker:function(){return this.each(function(){if($(this).data('colpickId')){$('#'+$(this).data('colpickId')).hide();}});},hidePickFromPoster:function(){$('#'+$(this).data('colpickId')).addClass('colpick_poster_hide');},setColorPalette:function(colors){var html='',colorArray=[],fixedColors=['ffffff','000000'],maxColors=12,index;for(var i=0;i<fixedColors.length;i++){colors[fixedColors[i]]=true;}
var colorsLength=Object.keys(colors).length;if(colorsLength<maxColors){function addColorToMap(c){if(!colors[c]){colors[c]=true;colorsLength++;if(colorsLength>=maxColors){return true;}}
return false;}
for(var key in colors){if(!colors.hasOwnProperty(key))continue;var triadColor1=key.substr(4,2)+key.substr(0,2)+key.substr(2,2);if(addColorToMap(triadColor1))break;var triadColor2=key.substr(2,2)+key.substr(4,2)+key.substr(0,2);if(addColorToMap(triadColor2))break;var complementaryColor=('000000'+(('0xffffff'^('0x'+key)).toString(16))).slice(-6);if(addColorToMap(complementaryColor))break;}}
for(var key in colors){if(!colors.hasOwnProperty(key))continue;colorArray.push(key);}
if(colorArray.length>maxColors){for(var i=0;i<fixedColors.length;i++){index=colorArray.indexOf(fixedColors[i]);if(index>=maxColors){colorArray[i]=fixedColors[i];}}}
colorArray=colorArray.slice(0,maxColors);if(colorArray.length<=6){$('#'+$(this).data('colpickId')).addClass('one-row-color-palette');}else{$('#'+$(this).data('colpickId')).removeClass('one-row-color-palette');}
colorArray.sort(function(a,b){var hsb1=hexToHsb(a),hsb2=hexToHsb(b);if(hsb1.h-hsb2.h!=0){return(hsb1.h-hsb2.h);}else if((hsb1.b-hsb2.b)!=0){return(hsb1.b-hsb2.b);}else{return(hsb1.s-hsb2.s);}});for(var i=0;i<colorArray.length;i++){html+='<div class="palette-item" title="'+colorArray[i]+'" data-color="'+colorArray[i]+'" style="background: #'+colorArray[i]+'"></div>'}
$('.col_on_poster').html(html);},setColor:function(col,setCurrent,disableCallback){disableCallback=(typeof disableCallback==='undefined')?false:disableCallback;setCurrent=(typeof setCurrent==="undefined")?1:setCurrent;if(typeof col=='string'){col=hexToHsb(col);}else if(col.r!=undefined&&col.g!=undefined&&col.b!=undefined){col=rgbToHsb(col);}else if(col.h!=undefined&&col.s!=undefined&&col.b!=undefined){col=fixHSB(col);}else{return this;}
return this.each(function(){if($(this).data('colpickId')){var cal=$('#'+$(this).data('colpickId'));cal.data('colpick').color=col;if(!isColorFromPalette&&!isPickingFromPoster){cal.data('colpick').origColor=col;}
fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));fillHexFields(col,cal.get(0));setHue(col,cal.get(0));setSelector(col,cal.get(0));setNewColor(col,cal.get(0));if(!disableCallback){cal.data('colpick').onChange.apply(cal.parent(),[col,hsbToHex(col),hsbToRgb(col),cal.data('colpick').el,isPickingFromPoster||isColorFromPalette?0:1]);}
if(setCurrent&&!isPickingFromPoster){setCurrentColor(col,cal.get(0));}
isColorFromPalette=false;}});},setColorWithoutCallback:function(col,setCurrent){this.colpickSetColor(col,setCurrent,true);}};}();var hexToRgb=function(hex){var hex=parseInt(((hex.indexOf('#')>-1)?hex.substring(1):hex),16);return{r:hex>>16,g:(hex&0x00FF00)>>8,b:(hex&0x0000FF)};};var hexToHsb=function(hex){return rgbToHsb(hexToRgb(hex));};var rgbToHsb=function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;hsb.s=max!=0?255*delta/max:0;if(hsb.s!=0){if(rgb.r==max)hsb.h=(rgb.g-rgb.b)/delta;else if(rgb.g==max)hsb.h=2+(rgb.b-rgb.r)/delta;else hsb.h=4+(rgb.r-rgb.g)/delta;}else hsb.h=-1;hsb.h*=60;if(hsb.h<0)hsb.h+=360;hsb.s*=100/255;hsb.b*=100/255;return hsb;};var hsbToRgb=function(hsb){var rgb={};var h=hsb.h;var s=hsb.s*255/100;var v=hsb.b*255/100;if(s==0){rgb.r=rgb.g=rgb.b=v;}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h==360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}
else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}
else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}
else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}
else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}
else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}
else{rgb.r=0;rgb.g=0;rgb.b=0}}
return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)};};var rgbToHex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length==1){hex[nr]='0'+val;}});return hex.join('');};var hsbToHex=function(hsb){return rgbToHex(hsbToRgb(hsb));};$.fn.extend({colpick:colpick.init,colpickHide:colpick.hidePicker,colpickShow:colpick.showPicker,colpickSetColor:colpick.setColor,colpickSetColorWithoutCallback:colpick.setColorWithoutCallback,colpickHidePickFromDesign:colpick.hidePickFromPoster,colpickSetColorPalette:colpick.setColorPalette});$.extend({colpick:{rgbToHex:rgbToHex,rgbToHsb:rgbToHsb,hsbToHex:hsbToHex,hsbToRgb:hsbToRgb,hexToHsb:hexToHsb,hexToRgb:hexToRgb,}});})(jQuery);
/*! iNoBounce - v0.1.0
* https://github.com/lazd/iNoBounce/
* Copyright (c) 2013 Larry Davis <lazdnet@gmail.com>; Licensed BSD */
(function(global){var startY=0;var enabled=false;var handleTouchmove=function(evt){var el=evt.target;while(el!==document.body){var style=window.getComputedStyle(el);var scrolling=style.getPropertyValue('-webkit-overflow-scrolling');var overflowY=style.getPropertyValue('overflow-y');var height=parseInt(style.getPropertyValue('height'),10);var isScrollable=scrolling==='touch'&&(overflowY==='auto'||overflowY==='scroll');var canScroll=el.scrollHeight>el.offsetHeight;if(isScrollable&&canScroll){var curY=evt.touches?evt.touches[0].screenY:evt.screenY;var isAtTop=(startY<=curY&&el.scrollTop===0);var isAtBottom=(startY>=curY&&el.scrollHeight-el.scrollTop===height);if(isAtTop||isAtBottom){evt.preventDefault();}
return;}
el=el.parentNode;}
evt.preventDefault();};var handleTouchstart=function(evt){startY=evt.touches?evt.touches[0].screenY:evt.screenY;};var enable=function(){window.addEventListener('touchstart',handleTouchstart,false);window.addEventListener('touchmove',handleTouchmove,false);enabled=true;};var disable=function(){window.removeEventListener('touchstart',handleTouchstart,false);window.removeEventListener('touchmove',handleTouchmove,false);enabled=false;};var isEnabled=function(){return enabled;};var testDiv=document.createElement('div');document.documentElement.appendChild(testDiv);testDiv.style.WebkitOverflowScrolling='touch';var scrollSupport=window.getComputedStyle(testDiv)['-webkit-overflow-scrolling']==='touch';document.documentElement.removeChild(testDiv);if(scrollSupport){enable();}
var iNoBounce={enable:enable,disable:disable,isEnabled:isEnabled};if(typeof module!=='undefined'&&module.exports){module.exports=iNoBounce;}
if(typeof global.define==='function'){(function(define){define(function(){return iNoBounce;});}(global.define));}
else{global.iNoBounce=iNoBounce;}}(this));
(function(){var cache_={};window.$$={get:function(k){if(typeof cache_[k]==='undefined'){return false;}
return cache_[k];},set:function(k,v){cache_[k]=v;},clear:function(k){delete cache_[k];},keys:function(){return Object.keys(cache_);}};})();
(function(){puremvc.define({name:'postermywall.Util'},{},{colorToRGB:function(c){try{if(typeof c==='object'){return c;}
if(typeof c==='string'){c=c.toLowerCase().replace("rgb","").replace("(","").replace(")","");var parts=c.split(',');if(parts.length===3){return[parseInt(parts[0]),parseInt(parts[1]),parseInt(parts[2])];}
if(c.indexOf('0x')===0){c=parseInt(c);}
else{c=parseInt(c);if(isNaN(c)){c=0;}}}
var r=(c>>16)&0xff;var g=(c>>8)&0xff;var b=c&0xff;return[r,g,b];}
catch(e){return[0,0,0];}},rgbToHex:function(rgb){function componentToHex(c){try{var hex=c.toString(16);return hex.length==1?"0"+hex:hex;}
catch(e){return"00";}}
if(rgb&&rgb.length===3){return componentToHex(rgb[0])+componentToHex(rgb[1])+componentToHex(rgb[2]);}
return'000000';},hexToRgb:function(hex){var hex=parseInt(((hex.indexOf('#')>-1)?hex.substring(1):hex),16);return[(hex>>16),(hex&0x00FF00)>>8,(hex&0x0000FF)];},arraysEqual:function(a,b){if(a===b)return true;if(a==null||b==null)return false;if(a.length!=b.length)return false;if(a.length==0&&b.length==0)return true;for(var i=0;i<a.length;++i){if(typeof a[i]=='object'){if(!this.objectsEqual(a[i],b[i])){return false;}}
else if(a[i]!==b[i])return false;}
return true;},objectsEqual:function(x,y){var isSame=true;for(var key in x){if(x[key]!==y[key]){isSame=false;break;}}
return isSame;},getRgbLuminance:function(rgb){return((0.2126*rgb.r+0.7152*rgb.g+0.0722*rgb.b)/255)*100;},getUUID:function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});},createCache:function(requestFunction){var cache={};return function(key,callback){if(!cache[key]){cache[key]=$.Deferred(function(defer){requestFunction(defer,key);}).promise();}
return cache[key].done(callback);}},mapNumberToRange:function(input,inputStart,inputEnd,outputStart,outputEnd){var s=(outputEnd-outputStart)/(inputEnd-inputStart);return outputStart+s*(input-inputStart);},scrollTo:function(el,scrollTop){el.animate({'scrollTop':scrollTop},200);},getTimestampURLParameter:function(ts){if(ts===null){return"?ts="+new Date().getTime();}
return"?ts="+ts;},stringToFunction:function(str){var arr=str.split("."),fn=(window||this);for(var i=0,len=arr.length;i<len;i++){fn=fn[arr[i]];}
if(typeof fn!=="function"){throw new Error("function not found");}
return fn;},isStringAFunction:function(str){try{this.stringToFunction(str);}catch(e){return false;}
return true;},cloneVO:function(toClone){var voClass=postermywall.Util.stringToFunction(toClone.pmvcName);var vo=new voClass();vo.clone(toClone);return vo;},attachTypingStoppedHandler:function(el,handler){el.on('keypress input paste',handler_);var inputChangeDelay=null;function handler_(e){if(inputChangeDelay){clearTimeout(inputChangeDelay);}
if(typeof e.which!=='undefined'&&e.which===13){handler();return;}
inputChangeDelay=setTimeout(handler,500);}},getScaleForFitToScreen:function(w,h,pw,ph){var wr,hr,s;wr=w/pw;hr=h/ph;if(pw>ph){if(Math.round(pw*wr)<=w&&Math.round(ph*wr)<=h){s=wr;}
else if(Math.round(pw*hr)<=w&&Math.round(ph*hr)<=h){s=hr;}
else{s=wr;}}
else{if(Math.round(pw*hr)<=w&&Math.round(ph*hr)<=h){s=hr;}
else if(Math.round(pw*wr)<=w&&Math.round(ph*wr)<=h){s=wr;}
else{s=hr;}}
return Math.round(s*100)/100;},sortAlphabetically:function(a,b){if(a.name<b.name)
return-1;else if(a.name>b.name)
return 1;else
return 0},limitDimensions:function(width,height,upperLimit,lowerLimit){var dims={width:width,height:height};if(width>=height){if(width>upperLimit&&upperLimit!==false){dims.height=(upperLimit*height)/width;dims.width=upperLimit;}
else if(height<lowerLimit&&lowerLimit!==false){dims.width=(lowerLimit*width)/height;dims.height=lowerLimit;}}
else{if(height>upperLimit&&upperLimit!==false){dims.width=(upperLimit*width)/height;dims.height=upperLimit;}
else if(width<lowerLimit&&lowerLimit!==false){dims.height=(lowerLimit*height)/width;dims.width=lowerLimit;}}
return dims;},degToRad:function(deg){return deg*Math.PI/180;},doPolygonsIntersect:function(a,b){var polygons=[a,b];var minA,maxA,projected,i,i1,j,minB,maxB;for(i=0;i<polygons.length;i++){var polygon=polygons[i];for(i1=0;i1<polygon.length;i1++){var i2=(i1+1)%polygon.length;var p1=polygon[i1];var p2=polygon[i2];var normal={x:p2.y-p1.y,y:p1.x-p2.x};minA=maxA=undefined;for(j=0;j<a.length;j++){projected=normal.x*a[j].x+normal.y*a[j].y;if(typeof minA==='undefined'||projected<minA){minA=projected;}
if(typeof maxA==='undefined'||projected>maxA){maxA=projected;}}
minB=maxB=undefined;for(j=0;j<b.length;j++){projected=normal.x*b[j].x+normal.y*b[j].y;if(typeof minB==='undefined'||projected<minB){minB=projected;}
if(typeof maxB==='undefined'||projected>maxB){maxB=projected;}}
if(maxA<minB||maxB<minA){return false;}}}
return true;},dataURLToBlob:function(dataURL){var arr=dataURL.split(','),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n);}
return new Blob([u8arr],{type:mime});}});})();
puremvc.define({name:'postermywall.Core'},{},{CORE_NAME:'PosterMyWallPosterMaker',INIT_UI:'INIT_UI',AUTHENTICATE_USER:'AUTHENTICATE_USER',AUTHENTICATE_FACEBOOK_USER:'AUTHENTICATE_FACEBOOK_USER',LOG_OUT_USER:'LOG_OUT_USER',DROPBOX_API_LOAD_ERROR:'DROPBOX_API_LOAD_ERROR',DROPBOX_API_LOADED:'DROPBOX_API_LOADED',GOOGLE_AUTH_TOKEN_SET:'GOOGLE_AUTH_TOKEN_SET',AUTHENTICATION_CANCELED:'AUTHENTICATION_CANCELED',VIEWPORT_RESIZED:'VIEWPORT_RESIZED',SHOW_LOADING:'SHOW_LOADING',HIDE_LOADING:'HIDE_LOADING',SAVE:'SAVE',POSTER_SAVED:'POSTER_SAVED',SAVE_CONFLICT:'SAVE_CONFLICT',DUPLICATE_POSTER:'DUPLICATE_POSTER',IS_POSTER_PURCHASED:'IS_POSTER_PURCHASED',POSTER_PURCHASED_WARNING:'POSTER_PURCHASED_WARNING',STARTUP:'STARTUP',LOAD_IMAGE_AS_BACKGROUND:'LOAD_IMAGE_AS_BACKGROUND',RESIZE_POSTER:'RESIZE_POSTER',ADD_GRAPHIC_ITEM:'ADD_GRAPHIC_ITEM',UPDATE_GRAPHIC_ITEMS:'UPDATE_GRAPHIC_ITEMS',MOVE_GRAPHIC_ITEM:'MOVE_GRAPHIC_ITEM',REMOVE_GRAPHIC_ITEMS:'REMOVE_GRAPHIC_ITEMS',REPLACE_GRAPHIC_IMAGE:'REPLACE_GRAPHIC_IMAGE',GRAPHIC_ITEM_TEXT_UPDATED:'GRAPHIC_ITEM_TEXT_UPDATED',SHOW_GRAPHIC_ITEM_OPTIONS:'SHOW_GRAPHIC_ITEM_OPTIONS',UNDOABLE_UPDATE:'UNDOABLE_UPDATE',NON_UNDOABLE_UPDATE:'NON_UNDOABLE_UPDATE',GRAPHIC_ITEM_ADDED:'GRAPHIC_ITEM_ADDED',GRAPHIC_ITEM_UPDATED:'GRAPHIC_ITEM_UPDATED',GRAPHIC_ITEM_REMOVED:'GRAPHIC_ITEM_REMOVED',GRAPHIC_ITEM_IMAGE_LOAD_END:'GRAPHIC_ITEM_IMAGE_LOAD_END',GRAPHIC_ITEM_VIDEO_LOAD_END:'GRAPHIC_ITEM_VIDEO_LOAD_END',GRAPHIC_ITEM_SHAPE_LOAD_END:'GRAPHIC_ITEM_SHAPE_LOAD_END',GRAPHIC_ITEM_VECTOR_LOAD_END:'GRAPHIC_ITEM_VECTOR_LOAD_END',CHANGE_THEME:'CHANGE_THEME',BACKGROUND_UPDATED:'BACKGROUND_UPDATED',BACKGROUND_MODIFIED:'BACKGROUND_MODIFIED',MODIFY_BACKGROUND:'MODIFY_BACKGROUND',REFRESH_BACKGROUND_OPTIONS:'REFRESH_BACKGROUND_OPTIONS',FORCE_REFRESH:'FORCE_REFRESH',CONTEXTUAL_OPTIONS_HIDDEN:'CONTEXTUAL_OPTIONS_HIDDEN',UPDATE_WATERMARK:'UPDATE_WATERMARK',CROP:'CROP',POSTER_CHANGED:'POSTER_CHANGED',POSTER_NAME_CHANGED:'POSTER_NAME_CHANGED',POSTER_DESCRIPTION_CHANGED:'POSTER_DESCRIPTION_CHANGED',POSTER_RESIZED:'POSTER_RESIZED',ADD_IMAGE_TO_POSTER:'ADD_IMAGE_TO_POSTER',ADD_VIDEO_TO_POSTER:'ADD_VIDEO_TO_POSTER',USER_SET:'USER_SET',USER_UNSET:'USER_UNSET',UNDO_AVAILABLE:'UNDO_AVAILABLE',UNDO_UNAVAILABLE:'UNDO_UNAVAILABLE',REDO_AVAILABLE:'REDO_AVAILABLE',REDO_UNAVAILABLE:'REDO_UNAVAILABLE',SAVE_AVAILABLE:'SAVE_AVAILABLE',SAVE_UNAVAILABLE:'SAVE_UNAVAILABLE',SWITCH_VIEW:'SWITCH_VIEW',SHOW_ERROR:'SHOW_ERROR',SHOW_MESSAGE:'SHOW_MESSAGE',SHOW_REPLACE_SELECTED_IMAGE:'SHOW_REPLACE_SELECTED_IMAGE',UPDATE_FONT_FAMILY_SELECTOR:'UPDATE_FONT_FAMILY_SELECTOR',EDIT_TABLE_CONTENT:'EDIT_TABLE_CONTENT',POSTER_FONTS_LOAD_STARTED:'FONTS_LOAD_STARTED',POSTER_FONTS_LOAD_COMPLETE:'FONTS_LOAD_COMPLETE',POSTER_FONTS_LOAD_ERROR:'FONTS_LOAD_ERROR',POSTER_BACKGROUND_LOADED:'POSTER_BACKGROUND_LOADED',POSTER_GRAPHICITEMS_LOADED:'POSTER_GRAPHICITEMS_LOADED',SELECTION_CREATED:'SELECTION_CREATED',SELECTION_CLEARED:'SELECTION_CLEARED',OPEN_MODAL_RESIZE_POSTER:'OPEN_MODAL_RESIZE_POSTER',OPEN_MODAL_GRAPHIC_ITEM_LIST:'OPEN_MODAL_GRAPHIC_ITEM_LIST',OPEN_MODAL_UPLOAD:'OPEN_MODAL_UPLOAD',OPEN_MODAL_MOVE_POSTER:'OPEN_MODAL_MOVE_POSTER',OPEN_MODAL_PRINT_UNAVAILABLE:'OPEN_MODAL_PRINT_UNAVAILABLE',OPEN_MODAL_MANAGE_CONTRIBUTOR:'OPEN_MODAL_MANAGE_CONTRIBUTOR',OPEN_MODAL_SHARE_COLLECTION:'OPEN_MODAL_SHARE_COLLECTION',OPEN_MODAL_STOCK:'OPEN_MODAL_STOCK',OPEN_MODAL_IMAGE_STOCK:'OPEN_MODAL_IMAGE_STOCK',OPEN_MODAL_VIDEO_STOCK:'OPEN_MODAL_VIDEO_STOCK',OPEN_MODAL_FACEBOOK:'OPEN_MODAL_FACEBOOK',UPLOAD_USER_IMAGES:'UPLOAD_USER_IMAGES',UPLOAD_USER_VIDEOS:'UPLOAD_USER_VIDEOS',OPEN_MODAL_VIDEO_TRIM:'OPEN_MODAL_VIDEO_TRIM',OPEN_MODAL_CLIPART:'OPEN_MODAL_CLIPART',OPEN_MODAL_SHAPES:'OPEN_MODAL_SHAPES',OPEN_MODAL_SCHEDULE:'OPEN_MODAL_SCHEDULE',OPEN_MODAL_TABLE:'OPEN_MODAL_TABLE',OPEN_MODAL_VIDEO_UPLOAD:'OPEN_MODAL_VIDEO_UPLOAD',OPEN_MODAL_DROPBOX:'OPEN_MODAL_DROPBOX',OPEN_MODAL_GOOGLE_PHOTOS:'OPEN_MODAL_GOOGLE_PHOTOS',OPEN_DROPBOX_CONNECT_MODAL:'OPEN_DROPBOX_CONNECT_MODAL',OPEN_MODAL_MENU:'OPEN_MODAL_MENU',OPEN_MODAL_ADD_MENU_ITEM:'OPEN_MODAL_ADD_MENU_ITEM',UPDATE_MENU_ITEM_LIST:'UPDATE_MENU_ITEM_LIST',EDIT_MENU_ITEM:'EDIT_MENU_ITEM',OPEN_MODAL_CROPPER:'OPEN_MODAL_CROPPER',CROP_BACKGROUND:'CROP_BACKGROUND',GRAPHIC_ITEM_DOUBLE_CLICK:'GRAPHIC_ITEM_DOUBLE_CLICK',OPEN_MODAL_MASKING:'OPEN_MODAL_MASKING',OPEN_MODAL_UPLOAD_FONTS:'OPEN_MODAL_UPLOAD_FONTS',OPEN_MODAL_MANAGE_FONTS:'OPEN_MODAL_MANAGE_FONTS',OPEN_MODAL_SETTINGS:'OPEN_MODAL_SETTINGS',RESET_LANGUAGE_SETTINGS:'RESET_LANGUAGE_SETTINGS',OPEN_MODAL_CONFIRM_LANGUAGE_CHANGE:'OPEN_MODAL_CONFIRM_LANGUAGE_CHANGE',OPEN_MODAL_FANCY_TEXT:'OPEN_MODAL_FANCY_TEXT',OPEN_MODAL_SELECT_BACKGROUND:'OPEN_MODAL_SELECT_BACKGROUND',CLOSE_MODAL_SELECT_BACKGROUND:'CLOSE_MODAL_SELECT_BACKGROUND',OPEN_MODAL_SELECT_IMAGE_TYPE:'OPEN_MODAL_SELECT_IMAGE_TYPE',CLOSE_MODAL_SELECT_IMAGE_TYPE:'CLOSE_MODAL_SELECT_IMAGE_TYPE',OPEN_MODAL_SELECT_VIDEO_TYPE:'OPEN_MODAL_SELECT_VIDEO_TYPE',CLOSE_MODAL_SELECT_VIDEO_TYPE:'CLOSE_MODAL_SELECT_VIDEO_TYPE',OPEN_MODAL_VIDEO_LIMIT:'OPEN_MODAL_VIDEO_LIMIT',OPEN_MODAL_VIDEO_DURATION_LIMIT:'OPEN_MODAL_VIDEO_DURATION_LIMIT',OPEN_MODAL_SOLID_COLOR_BACKGROUND:'OPEN_MODAL_SOLID_COLOR_BACKGROUND',OPEN_MODAL_GRADIENT_BACKGROUND:'OPEN_MODAL_GRADIENT_BACKGROUND',OPEN_MODAL_IMAGE_BACKGROUND:'OPEN_MODAL_IMAGE_BACKGROUND',OPEN_MODAL_STOCK_BACKGROUND:'OPEN_MODAL_STOCK_BACKGROUND',OPEN_MODAL_STOCK_BACKGROUND_WITH_IMAGE:'OPEN_MODAL_STOCK_BACKGROUND_WITH_IMAGE',OPEN_MODAL_UPLOAD_BACKGROUND:'OPEN_MODAL_UPLOAD_BACKGROUND',OPEN_MODAL_DOWNLOAD:'OPEN_MODAL_DOWNLOAD',DOWNLOAD_MODAL_SHOW_MESSAGE:'DOWNLOAD_MODAL_SHOW_MESSAGE',DOWNLOAD_MODAL_RESTORE_STATE:'DOWNLOAD_MODAL_RESTORE_STATE',OPEN_MODAL_PREMIUM_LICENSE_AGREEMENT:'OPEN_MODAL_PREMIUM_LICENSE_AGREEMENT',OPEN_RESIZE_PURCHASED_POSTER_MODAL:'OPEN_RESIZE_PURCHASED_POSTER_MODAL',SHARE_COLLECTION:'SHARE_COLLECTION',PURCHASE_DOWNLOAD:'PURCHASE_DOWNLOAD',MULTIMEDIA_TYPE_VIDEO:'VIDEO',MULTIMEDIA_TYPE_IMAGE:'IMAGE',STOCK_SEARCH:'STOCK_SEARCH',SHOW_LANGUAGE_NOTIFICATION:'SHOW_LANGUAGE_NOTIFICATION',SHOW_UNSUPPORTED_BROWSER_NOTIFICATION:'SHOW_UNSUPPORTED_BROWSER_NOTIFICATION',serverRoot:null,readBucket:null,writeBucket:null,su:false,fancyTextRoot:null,hr:false,hrVideo:false,hrScale:1,renderRegion:null,isUnsupportedBrowser:false,googleAPIKey:'',googleClientId:'',isTouchSupported:Modernizr.touchevents,isMobileOS:typeof(bowser.ios||bowser.android)!=='undefined',isCORS_:false,timestamp_:new Date().getTime(),setConfig:function(o,k,d){this[k]=('undefined'!==typeof o[k])?o[k]:d;},initializeConfig:function(){this.serverRoot=PMW.BASE_URL;if(!this.isHighRes()){this.testCORSSupport_();}
else{this.isCORS_=true;}},isHighRes:function(){return this.hr;},isHighResVideo:function(){return this.hrVideo;},initRenderRegion:function(){if(this.renderRegion){if(this.renderRegion.x){this.renderRegion.x=parseInt(this.renderRegion.x,10);}
if(this.renderRegion.y){this.renderRegion.y=parseInt(this.renderRegion.y,10);}
if(this.renderRegion.width){this.renderRegion.width=parseInt(this.renderRegion.width,10);}
if(this.renderRegion.height){this.renderRegion.height=parseInt(this.renderRegion.height,10);}}},isValidHighResRenderRegion:function(){return(this.renderRegion!=null&&this.renderRegion.width>0&&this.renderRegion.height>0);},getRenderRegionCornerPoints:function(){return[{x:this.renderRegion.x,y:this.renderRegion.y},{x:this.renderRegion.x+this.renderRegion.width,y:this.renderRegion.y},{x:this.renderRegion.x+this.renderRegion.width,y:this.renderRegion.y+this.renderRegion.height},{x:this.renderRegion.x,y:this.renderRegion.y+this.renderRegion.height}];},getReferralURIComponent:function(id){if(id>0){return'rid='+id;}
return'';},repoURL:function(p,b,cors){if(!cors){cors=false;}
if(cors){if(!this.isCORS_){var uri='s3w';if(b===this.readBucket){uri='s3r';}
return this.serverRoot+uri+'/'+p;}}
var url='https://'+b+'/'+p,preventCaching=false;if(bowser.chrome){preventCaching=true;}
if(preventCaching){url+=(url.indexOf('?')===-1?'?':'&')+'ts='+this.timestamp_;}
return url;},getFontPath:function(fontFamily,type){var fonts=postermywall.core.model.AppProxy.FONTS,ext=(type=='preview')?'.png':'.css';if(postermywall.core.model.AppProxy.isInternalFont(fontFamily)){if(type=='preview'){return this.serverRoot+'assets/css/webfonts/previews/'+fontFamily+ext}
else{return this.serverRoot+'assets/css/webfonts/'+fontFamily+ext}}
else{return this.repoURL('fonts/'+fontFamily+ext,postermywall.Core.writeBucket,false);}},repoImgURL:function(o,t){if(o&&o.hashedFilename&&o.fileExtension){var bucket='';if(o instanceof postermywall.core.model.vo.GraphicItemImageVO&&o.isModified()){bucket='modified/screens';if(this.isHighRes()){bucket='modified';}}else{bucket=t==='screen'?'uploads/screens':'uploads/thumbs';if(this.isHighRes()){bucket='uploads';}}
return this.repoURL(bucket+'/'+postermywall.core.view.GraphicItemImageMediator.imageName(o),this.writeBucket,t!=='thumb');}
return null;},fancyTextURL:function(id,family,size,scale,text,c1,c2,c3,morph,morphAmount){function addColor_(c,qp){if(c!=-1){p[p.length]='&';p[p.length]=qp;p[p.length]='=';p[p.length]=c;}}
var root=this.isCORS_?this.fancyTextRoot:this.serverRoot+'ft/';var p=[root,'svgrenderer/transcode?id=',encodeURIComponent(id),'&f=',encodeURIComponent(family),'&fs=',encodeURIComponent(size),'&t=',encodeURIComponent(text),'&s=',encodeURIComponent(scale),'&mt=',encodeURIComponent(morph),'&ma=',encodeURIComponent(morphAmount)];addColor_(c1,'c1');addColor_(c2,'c2');addColor_(c3,'c3');return p.join('');},patternURL:function(id,isPreview){return(this.serverRoot+'assets/postermaker/patterns/'+id+(isPreview?'-preview.png':'.png'))},testCORSSupport_:function(){var key='isCORSSupported';if(window.localStorage){var cachedValue=localStorage.getItem(key);if(cachedValue!==null){this.isCORS_=cachedValue=='1'?true:false;return;}}
var whiteList=[{name:'msie',version:11},{name:'chrome'},{name:'firefox'},{name:'safari'}];for(var i=0;i<whiteList.length;i++){if(bowser[whiteList[i].name]){if(whiteList[i].version){if(bowser.version>=whiteList[i].version){this.isCORS_=true;try{localStorage.setItem(key,this.isCORS_?'1':'0');}
catch(e){}
return;}}
else{this.isCORS_=true;try{localStorage.setItem(key,this.isCORS_?'1':'0');}
catch(e){}
return;}}}
var can=document.createElement('canvas');var ctx=can.getContext('2d');var img=new Image();img.crossOrigin='';img.onload=function(){try{ctx.drawImage(img,0,0,1,1);can.toDataURL('image/jpeg',1);this.isCORS_=true;}
catch(e){}
if(window.localStorage){try{localStorage.setItem(key,this.isCORS_?'1':'0');}
catch(e){}}};img.src='https://s3.amazonaws.com/postermywall.com/testpixel.jpg';}});
puremvc.define({name:'postermywall.core.model.vo.BaseVO',constructor:function(o){if(typeof o!=='undefined'){for(var prop in o){if(typeof this[prop]!=='undefined'){this[prop]=o[prop];}}}}});
(function(){puremvc.define({name:'postermywall.core.model.vo.UserVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.UserVO';}},{pmvcName:'postermywall.core.model.vo.UserVO',id:-1,fbId:null,name:null,type:null,watermark:null,premiumLevel:0,preferredLanguage:null,isDesigner:function(){return this.type==='designer';},clone:function(sourceVO){this.id=sourceVO.id;this.fbId=sourceVO.fbId;this.name=sourceVO.name;this.type=sourceVO.type;this.watermark=sourceVO.watermark;this.premiumLevel=sourceVO.premiumLevel;this.preferredLanguage=sourceVO.preferredLanguage;},getPremiumLevel:function(){if(typeof this.premiumLevel!='number'){this.premiumLevel=parseInt(this.premiumLevel);}
return this.premiumLevel;}});})();
postermywall.core.model.trait={'TextTrait':{color:[],fontFamily:'',text:'',fontStyle:'',fontWeight:'',backgroundType:0,backgroundColor:[184,184,184],backgroundColorAlpha:1,fontLicense:'',editable:true,letterSpacing:0,leading:120,textAlign:'left',script:''}};
(function(){puremvc.define({name:'postermywall.core.model.vo.CellVO',constructor:function(type,value){this.pmvcName='postermywall.core.model.vo.CellVO';this.type=type;if(typeof value!='undefined'){this.value=value}
else{switch(this.type){case postermywall.core.model.vo.CellVO.CELL_TYPE_DATE:var currentDate=new Date();this.value={timestamp:Date.UTC(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()),dateFormat:'m-d-y'};break;case postermywall.core.model.vo.CellVO.CELL_TYPE_TIME:this.value={hours:0,minutes:0,meridiem:'PM'};break;default:this.value=this.type;}}}},{pmvcName:'postermywall.core.model.vo.CellVO',type:null,value:null,getValue:function(){switch(this.type){case postermywall.core.model.vo.CellVO.CELL_TYPE_DATE:return postermywall.core.library.DateLibrary.getFormattedDate(this.value.dateFormat,this.value.timestamp);case postermywall.core.model.vo.CellVO.CELL_TYPE_TIME:var minutes=this.value.minutes;if(parseInt(minutes,10)<10){minutes='0'+minutes}
return this.value.hours+':'+minutes+' '+this.value.meridiem;}
return this.value;},getType:function(){return this.type;},clone:function(sourceVO){this.type=sourceVO.type;this.value=sourceVO.value;}},{CELL_TYPE_DATE:'date',CELL_TYPE_TIME:'time',CELL_TYPE_TEAM:'team',CELL_TYPE_VENUE:'venue',CELL_TYPE_HIGHLIGHT:'highlight',CELL_TYPE_MONTH:'month',CELL_TYPE_NAME:'name',CELL_TYPE_DESCRIPTION:'description',CELL_TYPE_PRICE:'price',CELL_TYPE_ICONS:'iconsList',CELL_TYPE_SIZE:'sizesList',CELL_TYPE_ADDON:'addOnsList',CELL_TYPE_COLUMN1:'column1',CELL_TYPE_COLUMN2:'column2',CELL_TYPE_COLUMN3:'column3'});})();
(function(){puremvc.define({name:'postermywall.core.model.vo.MenuItemVO',constructor:function(){this.pmvcName='postermywall.core.model.vo.MenuItemVO';}},{pmvcName:'postermywall.core.model.vo.MenuItemVO',id:null,name:null,description:null,price:null,iconsList:[],sizesList:[],addOnsList:[],getType:function(){return this.type;},clone:function(sourceVO){this.id=sourceVO.id;this.name=sourceVO.name;this.description=sourceVO.description;this.price=sourceVO.price;this.iconsList=jQuery.extend(true,[],sourceVO.iconsList);this.sizesList=jQuery.extend(true,[],sourceVO.sizesList);this.addOnsList=jQuery.extend(true,[],sourceVO.addOnsList);}},{});})();
puremvc.define({name:'postermywall.core.model.vo.GraphicItemVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemVO';if(!this.uid){this.uid=postermywall.Util.getUUID();}
this.dropShadowColor=postermywall.Util.colorToRGB(this.dropShadowColor);this.solidBorderColor=postermywall.Util.colorToRGB(this.solidBorderColor);}},{pmvcName:'',gitype:'',uid:'',x:0,y:0,alpha:1,width:0,height:0,rotation:0,visible:true,glow:0,dropShadow:0,dropShadowColor:[0,0,0],dropShadowAlpha:0.5,dropShadowAngle:45,solidBorderType:0,solidBorderColor:[0,0,0],solidBorderThickness:4,zIndex:0,scaleX:1,scaleY:1,flipX:false,flipY:false,lockMovement:false,fillType:0,gradientFillColor1:[255,255,255],gradientFillColor2:[184,184,184],patternFill:0,isNewlyAdded:true,getScaledWidth:function(){return this.width*(this.scaleX>0?this.scaleX:1);},getScaledHeight:function(){return this.height*(this.scaleY>0?this.scaleY:1);},setScale:function(scale){this.scaleX*=scale;this.scaleY*=scale;},doReplaceItem:function(){return false;},getCornerPoints:function(){var angle=this.rotation,width=this.getScaledWidth(),height=this.getScaledHeight(),tl,tr,bl,br,theta=postermywall.Util.degToRad(angle);if(width<0){width=Math.abs(width);}
var sinTh=Math.sin(theta),cosTh=Math.cos(theta);tl={x:this.x,y:this.y};tr={x:this.x+(width*cosTh),y:this.y+(width*sinTh)};bl={x:this.x-(height*sinTh),y:this.y+(height*cosTh)};br={x:tr.x-(height*sinTh),y:tr.y+(height*cosTh)};return[tl,tr,bl,br];},clone:function(sourceVO){this.gitype=sourceVO.gitype;this.uid=sourceVO.uid;this.x=sourceVO.x;this.y=sourceVO.y;this.alpha=sourceVO.alpha;this.width=sourceVO.width;this.height=sourceVO.height;this.rotation=sourceVO.rotation;this.visible=sourceVO.visible;this.glow=sourceVO.glow;this.dropShadow=sourceVO.dropShadow;this.dropShadowColor=sourceVO.dropShadowColor.slice();this.dropShadowAlpha=sourceVO.dropShadowAlpha;this.dropShadowAngle=sourceVO.dropShadowAngle;this.solidBorderType=sourceVO.solidBorderType;this.solidBorderColor=sourceVO.solidBorderColor.slice();this.solidBorderThickness=sourceVO.solidBorderThickness;this.zIndex=sourceVO.zIndex;this.scaleX=sourceVO.scaleX;this.scaleY=sourceVO.scaleY;this.isNewlyAdded=sourceVO.isNewlyAdded;this.lockMovement=sourceVO.lockMovement;this.flipX=sourceVO.flipX;this.flipY=sourceVO.flipY;this.fillType=sourceVO.fillType;this.gradientFillColor1=sourceVO.gradientFillColor1;this.gradientFillColor2=sourceVO.gradientFillColor2;this.patternFill=sourceVO.patternFill;},copyVisuals:function(sourceVO){this.x=sourceVO.x;this.y=sourceVO.y;this.rotation=sourceVO.rotation;this.alpha=sourceVO.alpha;this.dropShadow=sourceVO.dropShadow;this.dropShadowColor=sourceVO.dropShadowColor;this.dropShadowAlpha=sourceVO.dropShadowAlpha;this.dropShadowAngle=sourceVO.dropShadowAngle;this.solidBorderType=sourceVO.solidBorderType;this.solidBorderColor=sourceVO.solidBorderColor;this.solidBorderThickness=sourceVO.solidBorderThickness;this.lockMovement=sourceVO.lockMovement;this.flipX=sourceVO.flipX;this.flipY=sourceVO.flipY;this.fillType=sourceVO.fillType;this.gradientFillColor1=sourceVO.gradientFillColor1;this.gradientFillColor2=sourceVO.gradientFillColor2;this.patternFill=sourceVO.patternFill;}},{TYPE_IMAGE:'image',TYPE_TEXT:'text',TYPE_VIDEO:'video',TYPE_FANCYTEXT:'fancytext',TYPE_VECTOR:'vector',TYPE_SHAPE:'shape',TYPE_TAB:'tabs',TYPE_TABLE:'table',TYPE_MENU:'menu',SOURCE_GETTY:'getty',SOURCE_UPLOAD:'upload',FILL_TYPE_SOLID:0,FILL_TYPE_LINEAR_GRADIENT:1,FILL_TYPE_RADIAL_GRADIENT:2,FILL_TYPE_PATTERN:3});
puremvc.define({name:'postermywall.core.model.vo.GraphicItemImageVO',parent:postermywall.core.model.vo.GraphicItemVO,constructor:function(o){postermywall.core.model.vo.GraphicItemVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemImageVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE;if(typeof o!=='undefined'&&typeof o.modification!=='undefined'&&o.modification!==null){switch(this.modification.modtype){case postermywall.core.model.vo.ImageModificationVO.MOD_TYPE_CROPPING:this.modification=new postermywall.core.model.vo.CroppingVO(o.modification);break;case postermywall.core.model.vo.ImageModificationVO.MOD_TYPE_MASKING:this.modification=new postermywall.core.model.vo.MaskingVO(o.modification);break;}}
this.imageBorderType=Math.max(0,this.imageBorderType);this.imageGlowColor=postermywall.Util.colorToRGB(this.imageGlowColor);if(!this.imageUid){this.imageUid=this.uid;}}},{pmvcName:'',hashedFilename:'',imageUid:'',fileExtension:'',imageSource:'',type:0,modification:null,imageGlowType:0,imageGlowColor:[255,255,255],imageBorderType:-1,imageBorderThickness:7,antique:0,replacingAspectRatio:0,hasReplaceOption_:false,brightness:0,tint:false,tintColor:[0,0,0],tintOpacity:0.5,multiply:false,multiplyColor:[140,133,140],removeWhite:false,removeWhiteThreshold:30,removeWhiteDistance:20,maskPoints:null,isMaskCurved:true,maskEffect:'normal',cropOnAdd:false,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.clone.call(this,sourceVO);this.hashedFilename=sourceVO.hashedFilename;this.fileExtension=sourceVO.fileExtension;this.imageSource=sourceVO.imageSource;this.type=sourceVO.type;if(typeof sourceVO.modification!=='undefined'&&sourceVO.modification!==null){this.modification=postermywall.Util.cloneVO(sourceVO.modification);}else{this.modification=null;}
this.imageGlowType=sourceVO.imageGlowType;this.imageGlowColor=sourceVO.imageGlowColor.slice();this.imageBorderType=sourceVO.imageBorderType;this.imageBorderThickness=sourceVO.imageBorderThickness;this.antique=sourceVO.antique;this.replacingAspectRatio=sourceVO.replacingAspectRatio;this.brightness=sourceVO.brightness;this.tint=sourceVO.tint;this.tintColor=sourceVO.tintColor;this.tintOpacity=sourceVO.tintOpacity;this.multiply=sourceVO.multiply;this.multiplyColor=sourceVO.multiplyColor;this.removeWhite=sourceVO.removeWhite;this.removeWhiteThreshold=sourceVO.removeWhiteThreshold;this.removeWhiteDistance=sourceVO.removeWhiteDistance;this.maskPoints=sourceVO.maskPoints;this.isMaskCurved=sourceVO.isMaskCurved;this.maskEffect=sourceVO.maskEffect;this.imageUid=sourceVO.imageUid;},copyVisuals:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.copyVisuals.call(this,sourceVO);this.imageGlowType=sourceVO.imageGlowType;this.imageGlowColor=sourceVO.imageGlowColor;this.imageBorderType=sourceVO.imageBorderType;this.imageBorderThickness=sourceVO.imageBorderThickness;this.antique=sourceVO.antique;this.brightness=sourceVO.brightness;this.tint=sourceVO.tint;this.tintColor=sourceVO.tintColor;this.tintOpacity=sourceVO.tintOpacity;this.multiply=sourceVO.multiply;this.multiplyColor=sourceVO.multiplyColor;this.removeWhite=sourceVO.removeWhite;this.removeWhiteThreshold=sourceVO.removeWhiteThreshold;this.removeWhiteDistance=sourceVO.removeWhiteDistance;this.maskPoints=sourceVO.maskPoints;this.isMaskCurved=sourceVO.isMaskCurved;this.maskEffect=sourceVO.maskEffect;},isModified:function(){return(this.type!==postermywall.core.model.vo.GraphicItemImageVO.TYPE_NORMAL);},isMasked:function(){return(this.maskPoints!=null&&this.maskPoints.length>2)},showReplaceOption:function(){this.hasReplaceOption_=true;},hasReplaceOption:function(){return this.hasReplaceOption_;}},{TYPE_NORMAL:0,TYPE_CROPPED:1,TYPE_MASKED:2,CURVED_EDGE_THICKNESS:7,GRADIENT_EDGE_THRESHOLD:25});
(function(){var unsupportedFonts_=["BermudaSquiggle","PrincessSofiaRegular","Bevan"];puremvc.define({name:'postermywall.core.model.vo.GraphicItemTextVO',parent:postermywall.core.model.vo.GraphicItemVO,constructor:function(o){postermywall.core.model.vo.GraphicItemVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemTextVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT;this.color=postermywall.Util.colorToRGB(this.color);this.text=postermywall.core.library.TextLibrary.validateText(this.text);if(unsupportedFonts_.indexOf(this.fontFamily)!==-1){this.fontFamily='AccidentalPresidency';}
if(this.fontFamily==='MountainsOfChristmas'){this.fontFamily='MountainsofChristmas';}}},$.extend({pmvcName:'',fontSize:0,wrappedLines:null,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.clone.call(this,sourceVO);this.text=sourceVO.text;this.color=sourceVO.color.slice();this.fontSize=sourceVO.fontSize;this.fontStyle=sourceVO.fontStyle;this.fontWeight=sourceVO.fontWeight;this.fontFamily=sourceVO.fontFamily;this.letterSpacing=sourceVO.letterSpacing;this.leading=sourceVO.leading;this.textAlign=sourceVO.textAlign;this.wrappedLines=sourceVO.wrappedLines;this.backgroundType=sourceVO.backgroundType;this.backgroundColor=sourceVO.backgroundColor;this.backgroundColorAlpha=sourceVO.backgroundColorAlpha;this.fontLicense=sourceVO.fontLicense;this.editable=sourceVO.editable;this.script=sourceVO.script;},setWrapping:function(){if(this.wrappedLines!=null&&this.wrappedLines.length>0){this.text=this.wrappedLines.join('\n');}},setScale:function(scale){this.fontSize*=scale;this.width*=scale;}},postermywall.core.model.trait.TextTrait));})();
puremvc.define({name:'postermywall.core.model.vo.GraphicItemShapeVO',parent:postermywall.core.model.vo.GraphicItemVO,constructor:function(o){postermywall.core.model.vo.GraphicItemVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemShapeVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE;this.fillColor=postermywall.Util.colorToRGB(this.fillColor);this.strokeColor=postermywall.Util.colorToRGB(this.strokeColor);}},{pmvcName:'',name:'',fillColor:[0,0,0],fillAlpha:1,strokeColor:[0,0,0],strokeWeight:0,lockAspectRatio:false,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.clone.call(this,sourceVO);this.name=sourceVO.name;this.fillColor=sourceVO.fillColor.slice();this.fillAlpha=sourceVO.fillAlpha;this.strokeColor=sourceVO.strokeColor.slice();this.strokeWeight=sourceVO.strokeWeight;this.lockAspectRatio=sourceVO.lockAspectRatio;},doReplaceItem:function(){return true;}});
puremvc.define({name:'postermywall.core.model.vo.GraphicItemFancyTextVO',parent:postermywall.core.model.vo.GraphicItemVO,constructor:function(o){postermywall.core.model.vo.GraphicItemVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemFancyTextVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT;this.color1=this.getColor(this.color1);this.color2=this.getColor(this.color2);this.color3=this.getColor(this.color3);}},{pmvcName:'',idFancyText:0,text:'',fontFamily:'',color1:-1,color2:-1,color3:-1,refDimension:0,morphType:0,morphAmount:0,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.clone.call(this,sourceVO);this.idFancyText=sourceVO.idFancyText;this.text=sourceVO.text;this.fontFamily=sourceVO.fontFamily;this.color1=typeof sourceVO.color1==='number'?sourceVO.color1:sourceVO.color1.slice();this.color2=typeof sourceVO.color2==='number'?sourceVO.color2:sourceVO.color2.slice();this.color3=typeof sourceVO.color3==='number'?sourceVO.color3:sourceVO.color3.slice();this.refDimension=sourceVO.refDimension;this.morphType=sourceVO.morphType;this.morphAmount=sourceVO.morphAmount;},isMorphCurve:function(){return(this.morphType==postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_CURVE_UP||this.morphType==postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_CURVE_DOWN);},isMorphWave:function(){return(this.morphType==postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_WAVE);},isColorSet:function(c){return(c!='-1'&&c!=-1&&c!=null);},getColor:function(c){if(!this.isColorSet(c)){return-1;}
if(typeof c==='object'){return c;}
return postermywall.Util.colorToRGB(parseInt(c,10));}},{MORPH_NONE:0,MORPH_CURVE_UP:1,MORPH_CURVE_DOWN:2,MORPH_WAVE:3,MORPH_WEDGE_LEFT:4,MORPH_WEDGE_RIGHT:5,MORPH_ROOF:6});
puremvc.define({name:'postermywall.core.model.vo.GraphicItemVectorVO',parent:postermywall.core.model.vo.GraphicItemShapeVO,constructor:function(o){postermywall.core.model.vo.GraphicItemShapeVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemVectorVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR;if(this.hashedFilename){this.isStrokeCustomisable=false;}else{this.isStrokeCustomisable=true;}}},{hashedFilename:null,defaultFillColor:null,defaultPathFills:[],isComplexSVG:false,isStrokeCustomisable:false,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemShapeVO.prototype.clone.call(this,sourceVO);this.hashedFilename=sourceVO.hashedFilename;this.defaultFillColor=sourceVO.defaultFillColor;this.defaultPathFills=sourceVO.defaultPathFills;this.isComplexSVG=sourceVO.isComplexSVG;this.isStrokeCustomisable=sourceVO.isStrokeCustomisable;}});
puremvc.define({name:'postermywall.core.model.vo.GraphicItemTabsVO',parent:postermywall.core.model.vo.GraphicItemVO,constructor:function(o){postermywall.core.model.vo.GraphicItemVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemTabsVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_TAB;this.color=postermywall.Util.colorToRGB(this.color);this.text=postermywall.core.library.TextLibrary.validateText(this.text);}},$.extend({pmvcName:'',numTabs:0,separatorColor:[],separatorType:0,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.clone.call(this,sourceVO);this.text=sourceVO.text;this.color=sourceVO.color;this.fontSize=sourceVO.fontSize;this.fontWeight=sourceVO.fontWeight;this.fontFamily=sourceVO.fontFamily;this.letterSpacing=sourceVO.letterSpacing;this.leading=sourceVO.leading;this.backgroundType=sourceVO.backgroundType;this.backgroundColor=sourceVO.backgroundColor;this.backgroundColorAlpha=sourceVO.backgroundColorAlpha;this.fontLicense=sourceVO.fontLicense;this.editable=sourceVO.editable;this.textAlign=sourceVO.textAlign;this.script=sourceVO.script;this.numTabs=sourceVO.numTabs;this.separatorColor=sourceVO.separatorColor;this.separatorType=sourceVO.separatorType;}},postermywall.core.model.trait.TextTrait),{SEPARATOR_TYPE_NONE:0,SEPARATOR_TYPE_SOLID:1,SEPARATOR_TYPE_DASHED:2});
(function(){puremvc.define({name:'postermywall.core.model.vo.GraphicItemTableVO',parent:postermywall.core.model.vo.GraphicItemVO,constructor:function(o){if(typeof o!='undefined'){var data=o.layoutDataMap,scheduleData={},unusedData={};for(var prop in data){var arr=data[prop],newArr=[];for(var i=0;i<arr.length;i++){var cell=new postermywall.core.model.vo.CellVO(arr[i].type,arr[i].value);newArr.push(cell);}
scheduleData[prop]=newArr;}
for(var prop in o.unusedData){arr=o.unusedData[prop];newArr=[];for(i=0;i<arr.length;i++){cell=new postermywall.core.model.vo.CellVO(arr[i].type,arr[i].value);newArr.push(cell);}
unusedData[prop]=newArr;}
o.layoutDataMap=scheduleData;o.unusedData=unusedData;}
postermywall.core.model.vo.GraphicItemVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemTableVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE;this.color=postermywall.Util.colorToRGB(this.color);this.text=postermywall.core.library.TextLibrary.validateText(this.text);}},$.extend({pmvcName:'',rows:0,columns:0,fontSize:0,layoutDataMap:null,unusedData:null,layoutStyle:null,alternateBackgroundColor1:[180,180,180],alternateBackgroundColor2:[0,0,0],alternateColor1Alpha:0.50,alternateColor2Alpha:0.50,highlightedBackgroundColor:[180,180,180],highlightedBackgroundColorAlpha:1,highlightedTextColor:[75,75,75],xSpacing:0,ySpacing:0,fontFamily2:'',clone:function(sourceVO){postermywall.core.model.vo.GraphicItemVO.prototype.clone.call(this,sourceVO);this.text=sourceVO.text;this.color=sourceVO.color;this.fontSize=sourceVO.fontSize;this.fontWeight=sourceVO.fontWeight;this.fontFamily=sourceVO.fontFamily;this.letterSpacing=sourceVO.letterSpacing;this.leading=sourceVO.leading;this.backgroundType=sourceVO.backgroundType;this.backgroundColor=sourceVO.backgroundColor;this.backgroundColorAlpha=sourceVO.backgroundColorAlpha;this.editable=sourceVO.editable;this.textAlign=sourceVO.textAlign;this.script=sourceVO.script;this.rows=sourceVO.rows;this.columns=sourceVO.columns;this.layoutDataMap={};for(var property in sourceVO.layoutDataMap){if(sourceVO.layoutDataMap.hasOwnProperty(property)){this.layoutDataMap[property]=[];for(var i=0;i<sourceVO.layoutDataMap[property].length;i++){this.layoutDataMap[property].push(postermywall.Util.cloneVO(sourceVO.layoutDataMap[property][i]));}}}
this.unusedData=sourceVO.unusedData;this.layoutStyle=sourceVO.layoutStyle;this.alternateBackgroundColor1=sourceVO.alternateBackgroundColor1;this.alternateBackgroundColor2=sourceVO.alternateBackgroundColor2;this.alternateColor1Alpha=sourceVO.alternateColor1Alpha;this.alternateColor2Alpha=sourceVO.alternateColor2Alpha;this.highlightedBackgroundColor=sourceVO.highlightedBackgroundColor;this.highlightedBackgroundColorAlpha=sourceVO.highlightedBackgroundColorAlpha;this.highlightedTextColor=sourceVO.highlightedTextColor;this.xSpacing=sourceVO.xSpacing;this.ySpacing=sourceVO.ySpacing;this.fontFamily2=sourceVO.fontFamily2;},getDataForLayout:function(layout){var layoutColumns=postermywall.core.model.LayoutProxy.getColumnsForLayout(layout),tableData={},availableData={};$.extend(true,availableData,this.layoutDataMap,this.unusedData);for(var prop in layoutColumns){tableData[prop]=availableData[prop];delete availableData[prop];}
return{layoutDataMap:tableData,unusedData:availableData}},getColumns:function(){var columns=Object.keys(this.layoutDataMap);columns.pop();return columns;},isCustomTableLayout:function(){return this.layoutStyle==postermywall.core.model.LayoutProxy.CUSTOM_TABLE_LAYOUT},getDateFormat:function(){if(typeof this.layoutDataMap.date!='undefined'){return this.layoutDataMap.date[0].value.dateFormat;}
else{return'm-d-y';}},getRecommendedFont:function(){switch(this.layoutStyle){case postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT:case postermywall.core.model.LayoutProxy.STRAIGHT_SPORTS_LAYOUT:return'LeagueSpartanBold';default:return'OpenSansRegular'}}},postermywall.core.model.trait.TextTrait),{});})();
(function(){puremvc.define({name:'postermywall.core.model.vo.GraphicItemMenuVO',parent:postermywall.core.model.vo.GraphicItemTableVO,constructor:function(o){postermywall.core.model.vo.GraphicItemTableVO.call(this,o);this.pmvcName='postermywall.core.model.vo.GraphicItemMenuVO';this.gitype=postermywall.core.model.vo.GraphicItemVO.TYPE_MENU;this.color=postermywall.Util.colorToRGB(this.color);this.text=postermywall.core.library.TextLibrary.validateText(this.text);}},$.extend({pmvcName:'',itemIds:[],iconsColor:[0,0,0],iconsSize:0,wrappingInfo:null,clone:function(sourceVO){postermywall.core.model.vo.GraphicItemTableVO.prototype.clone.call(this,sourceVO);this.itemIds=sourceVO.itemIds;this.iconsColor=sourceVO.iconsColor;this.iconsSize=sourceVO.iconsSize;this.wrappingInfo=sourceVO.wrappingInfo;},hasTableStyleBorder:function(){return this.layoutStyle==postermywall.core.model.LayoutProxy.MENU_LAYOUT_4}},postermywall.core.model.trait.TextTrait),{});})();
puremvc.define({name:'postermywall.core.model.vo.ImageModificationVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.ImageModificationVO';if(typeof o==='undefined'){this.creationID=Date.now();}}},{pmvcName:'',modtype:'',id:-1,creationID:0,baseVO:null,clone:function(sourceVO){this.modtype=sourceVO.modtype;this.id=sourceVO.id;this.creationID=sourceVO.creationID;if(sourceVO.baseVO!==null){this.baseVO=postermywall.Util.cloneVO(sourceVO.baseVO);}}},{MOD_TYPE_CROPPING:'crop',MOD_TYPE_MASKING:'mask'});
puremvc.define({name:'postermywall.core.model.vo.CroppingVO',parent:postermywall.core.model.vo.ImageModificationVO,constructor:function(o){postermywall.core.model.vo.ImageModificationVO.call(this,o);this.pmvcName='postermywall.core.model.vo.CroppingVO';this.modtype=postermywall.core.model.vo.ImageModificationVO.MOD_TYPE_CROPPING;}},{x:0,y:0,width:0,height:0,clone:function(sourceVO){postermywall.core.model.vo.ImageModificationVO.prototype.clone.call(this,sourceVO);this.x=sourceVO.x;this.y=sourceVO.y;this.width=sourceVO.width;this.height=sourceVO.height;}});
puremvc.define({name:'postermywall.core.model.vo.MaskingVO',parent:postermywall.core.model.vo.ImageModificationVO,constructor:function(o){postermywall.core.model.vo.ImageModificationVO.call(this,o);this.pmvcName='postermywall.core.model.vo.MaskingVO';this.modtype=postermywall.core.model.vo.ImageModificationVO.MOD_TYPE_MASKING;}},{clone:function(sourceVO){postermywall.core.model.vo.ImageModificationVO.prototype.clone.call(this,sourceVO);}});
puremvc.define({name:'postermywall.core.model.vo.BackgroundModificationVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.BackgroundModificationVO'}},{pmvcName:'',x:-1,y:-1,width:-1,height:-1,filterType:0,tint:false,tintColor:[0,0,0],tintOpacity:0.5,multiply:false,multiplyColor:[140,133,140],brightness:0,contrast:0,saturation:0,clone:function(sourceVO){this.x=sourceVO.x;this.y=sourceVO.y;this.width=sourceVO.width;this.height=sourceVO.height;this.filterType=sourceVO.filterType;this.tint=sourceVO.tint;this.tintColor=sourceVO.tintColor;this.tintOpacity=sourceVO.tintOpacity;this.multiply=sourceVO.multiply;this.multiplyColor=sourceVO.multiplyColor;this.brightness=sourceVO.brightness;this.contrast=sourceVO.contrast;this.saturation=sourceVO.saturation;},copyEffects:function(sourceVO){this.filterType=sourceVO.filterType;this.tint=sourceVO.tint;this.tintColor=sourceVO.tintColor;this.tintOpacity=sourceVO.tintOpacity;this.multiply=sourceVO.multiply;this.multiplyColor=sourceVO.multiplyColor;this.brightness=sourceVO.brightness;this.contrast=sourceVO.contrast;this.saturation=sourceVO.saturation;},isCropped:function(){return(this.width>0&&this.height>0&&this.x>=0&&this.y>=0);}},{FILTER_TYPE_NONE:0,FILTER_TYPE_BLACK_AND_WHITE:1,FILTER_TYPE_SEPIA:2});
puremvc.define({name:'postermywall.core.model.vo.BackgroundVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.BackgroundVO';}},{pmvcName:'',id:-1,name:null,fillType:null,fileExtension:null,hrFileExtension:null,idUser:null,attributionName:null,attributionURL:null,licenseName:null,licenseURL:null,source:null,width:null,height:null,displayAttribution:true,tempUID:'0',clone:function(sourceVO){this.id=sourceVO.id;this.name=sourceVO.name;this.fillType=sourceVO.fillType;this.fileExtension=sourceVO.fileExtension;this.hrFileExtension=sourceVO.hrFileExtension;this.idUser=sourceVO.idUser;this.attributionName=sourceVO.attributionName;this.attributionURL=sourceVO.attributionURL;this.licenseName=sourceVO.licenseName;this.licenseURL=sourceVO.licenseURL;this.source=sourceVO.source;this.width=sourceVO.width;this.height=sourceVO.height;this.displayAttribution=sourceVO.displayAttribution;this.tempUID=sourceVO.tempUID;},requiresAttribution:function(){return(this.attributionName!=null&&this.attributionName.length>0&&this.licenseName!=null&&this.licenseName.length>0);},isCustomizable:function(){return(typeof this.fillType!=='undefined'&&this.fillType===postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID);},isImage:function(){return(this.fillType==postermywall.core.model.vo.BackgroundVO.FILLTYPE_IMAGE||this.fillType==postermywall.core.model.vo.BackgroundVO.FILLTYPE_COLLAGE||this.fillType==postermywall.core.model.vo.BackgroundVO.FILLTYPE_CUSTOM_IMAGE);}},{FILLTYPE_SOLID:'SOLID',FILLTYPE_IMAGE:'IMAGE',FILLTYPE_COLLAGE:'COLLAGE',FILLTYPE_CUSTOM_IMAGE:'CIMAGE',FILLTYPE_CALENDAR:'CALENDAR'});
(function(){puremvc.define({name:'postermywall.core.model.vo.PosterThemeVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.PosterThemeVO';if(typeof o!=='undefined'){this.fontColor=postermywall.Util.colorToRGB(this.fontColor);this.background=new postermywall.core.model.vo.BackgroundVO(this.background);}}},{pmvcName:'',id:-1,background:null,fontColor:[],fontFamily:'',fontSize:0,clone:function(sourceVO){this.id=sourceVO.id;if(sourceVO.background!==null){this.background=postermywall.Util.cloneVO(sourceVO.background);}
this.fontColor=sourceVO.fontColor;this.fontFamily=sourceVO.fontFamily;this.fontSize=sourceVO.fontSize;}});})();
(function(){var DEFAULT_VERSION=10;var LEGACY_VERSION=3;var GRADIENT_LINEAR='linear';var unsavedId_='';function sortByIndex_(a,b){return a.zIndex-b.zIndex;}
puremvc.define({name:'postermywall.core.model.vo.PosterVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){this.type=new postermywall.core.model.vo.PosterTypeVO();this.graphicItems=[];postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.PosterVO';if(typeof o!=='undefined'){this.theme=new postermywall.core.model.vo.PosterThemeVO(this.theme);this.width=parseInt(this.width,10);this.height=parseInt(this.height,10);this.primaryColor=this.formatColor_(this.primaryColor);this.secondaryColor=this.formatColor_(this.secondaryColor);if(this.creator){this.creator=new postermywall.core.model.vo.UserVO(this.creator);}
var items=[];for(var i=0;i<this.graphicItems.length;i++){var item=null;switch(this.graphicItems[i].gitype){case postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE:item=new postermywall.core.model.vo.GraphicItemImageVO(this.graphicItems[i]);item.type=parseInt(item.type);item.imageGlowType=parseInt(item.imageGlowType);item.imageBorderThickness=parseInt(item.imageBorderThickness);item.antique=parseInt(item.antique);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT:item=new postermywall.core.model.vo.GraphicItemTextVO(this.graphicItems[i]);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE:item=new postermywall.core.model.vo.GraphicItemShapeVO(this.graphicItems[i]);if(this.version>LEGACY_VERSION){if(item.alpha==item.fillAlpha){item.alpha=item.alpha*item.fillAlpha;item.fillAlpha=1;}
else{item.fillAlpha=1;}}
else{item.alpha=item.alpha*item.fillAlpha;item.fillAlpha=1;}
break;case postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT:item=new postermywall.core.model.vo.GraphicItemFancyTextVO(this.graphicItems[i]);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR:item=new postermywall.core.model.vo.GraphicItemVectorVO(this.graphicItems[i]);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO:item=new postermywall.core.model.vo.GraphicItemVideoVO(this.graphicItems[i]);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TAB:item=new postermywall.core.model.vo.GraphicItemTabsVO(this.graphicItems[i]);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE:item=new postermywall.core.model.vo.GraphicItemTableVO(this.graphicItems[i]);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_MENU:item=new postermywall.core.model.vo.GraphicItemMenuVO(this.graphicItems[i]);break;}
if(item){item.isNewlyAdded=false;item.x=parseInt(item.x,10);item.y=parseInt(item.y,10);item.width=parseInt(item.width,10);item.height=parseInt(item.height,10);item.rotation=parseFloat(item.rotation);item.solidBorderThickness=parseInt(item.solidBorderThickness,10);item.dropShadow=parseInt(item.dropShadow);item.solidBorderThickness=parseInt(item.solidBorderThickness);item.zIndex=parseInt(item.zIndex);if(this.version<DEFAULT_VERSION){if(item.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&item.solidBorderType>0){item.width-=item.solidBorderThickness;item.height-=item.solidBorderThickness;}
else if(item.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE){item.scaleX=item.scaleY=0;}
else if(item.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT&&item.letterSpacing>0){item.width+=item.letterSpacing;}}
if(this.version<LEGACY_VERSION){if(item.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT){item.leading=120;}}
if(!postermywall.Core.isHighRes()){items[items.length]=item;}
else{if(postermywall.Core.isValidHighResRenderRegion()&&postermywall.Util.doPolygonsIntersect(item.getCornerPoints(),postermywall.Core.getRenderRegionCornerPoints())){items[items.length]=item;}}}}
this.graphicItems=items;this.sortItems();this.backgroundModification=new postermywall.core.model.vo.BackgroundModificationVO((o!==null)?o.backgroundModification:'');this.type=new postermywall.core.model.vo.PosterTypeVO((o!==null)?o.type:'');if(this.backgroundType_===-1){switch(this.theme.background.fillType){case postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID:if(this.primaryColor===this.secondaryColor){this.backgroundType_=0;}else{this.backgroundType_=1;}
break;case postermywall.core.model.vo.BackgroundVO.FILLTYPE_CUSTOM_IMAGE:if(this.theme.background.source===null||this.theme.background.source==='upload'){this.backgroundType_=2;}else if($.inArray(this.theme.background.source,['getty','pixabay','flickr'])!==-1){this.backgroundType_=4;}
break;case postermywall.core.model.vo.BackgroundVO.FILLTYPE_IMAGE:this.backgroundType_=3;break;case postermywall.core.model.vo.BackgroundVO.FILLTYPE_COLLAGE:this.backgroundType_=2;break;}}}}},{pmvcName:'',id:-1,name:'',description:'',isTemplate:false,isPublic:false,isCopyable:true,isPurchaseable:true,createdOn:0,lastModified:0,creator:null,idLastModifier:-1,isInternal:false,width:0,height:0,theme:null,primaryColor:'',secondaryColor:'',gradient:GRADIENT_LINEAR,backgroundModification:null,seoName:'',hashedID:'',isPremium:false,type:null,displayName:'',userWidth:0,userHeight:0,units:'',idTemplate:null,idGalleryTemplate:null,idGalleryTemplateCreator:-1,version:DEFAULT_VERSION,isVideo:false,graphicItems:[],backgroundType_:-1,isPosterTemplate:function(){return this.isPublic&&!this.isInternal;},isGraphicItemOnPoster:function(graphicItem){return postermywall.Util.doPolygonsIntersect(graphicItem.getCornerPoints(),this.getCornerPoints());},getGettyImagesNotOnPoster:function(){var gettyImagesNotOnPoster=[],posterCornerPoints=this.getCornerPoints();for(var i=0;i<this.graphicItems.length;i++){if(this.graphicItems[i].gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&this.graphicItems[i].imageSource=='getty'&&!postermywall.Util.doPolygonsIntersect(this.graphicItems[i].getCornerPoints(),posterCornerPoints)){gettyImagesNotOnPoster[gettyImagesNotOnPoster.length]=this.graphicItems[i];}}
return gettyImagesNotOnPoster;},getNumberOfGettyImagesOnPoster:function(){var numberOfGettyImagesOnPoster=0,posterCornerPoints=this.getCornerPoints();for(var i=0;i<this.graphicItems.length;i++){if(this.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&this.graphicItems[i].imageSource==='getty'&&postermywall.Util.doPolygonsIntersect(this.graphicItems[i].getCornerPoints(),posterCornerPoints)){numberOfGettyImagesOnPoster++;}}
return numberOfGettyImagesOnPoster;},getCornerPoints:function(){return[{x:0,y:0},{x:this.width,y:0},{x:this.width,y:this.height},{x:0,y:this.height}];},sortItems:function(){this.graphicItems.sort(sortByIndex_);},clone:function(sourceVO){this.id=sourceVO.id;this.name=sourceVO.name;this.description=sourceVO.description;this.isTemplate=sourceVO.isTemplate;this.isPublic=sourceVO.isPublic;this.isCopyable=sourceVO.isCopyable;this.isPurchaseable=sourceVO.isPurchaseable;this.createdOn=sourceVO.createdOn;this.lastModified=sourceVO.lastModified;if(sourceVO.creator!==null){this.creator=postermywall.Util.cloneVO(sourceVO.creator);}
this.idLastModifier=sourceVO.idLastModifier;this.isInternal=sourceVO.isInternal;this.width=sourceVO.width;this.height=sourceVO.height;this.idGalleryTemplate=sourceVO.idGalleryTemplate;this.idGalleryTemplateCreator=sourceVO.idGalleryTemplateCreator;if(sourceVO.theme!==null){this.theme=postermywall.Util.cloneVO(sourceVO.theme);}
this.primaryColor=sourceVO.primaryColor;this.secondaryColor=sourceVO.secondaryColor;this.gradient=sourceVO.gradient;if(sourceVO.backgroundModification!==null){this.backgroundModification=postermywall.Util.cloneVO(sourceVO.backgroundModification);}
this.seoName=sourceVO.seoName;this.hashedID=sourceVO.hashedID;this.isVideo=sourceVO.isVideo;this.isPremium=sourceVO.isPremium;if(sourceVO.type!==null){this.type=postermywall.Util.cloneVO(sourceVO.type);}
this.userWidth=sourceVO.userWidth;this.userHeight=sourceVO.userHeight;this.units=sourceVO.units;this.idTemplate=sourceVO.idTemplate;this.version=sourceVO.version;for(var i=0,len=sourceVO.graphicItems.length;i<len;i++){this.graphicItems[i]=postermywall.Util.cloneVO(sourceVO.graphicItems[i]);}
this.backgroundType_=sourceVO.backgroundType_;},getUnsavedId:function(){if(unsavedId_===''){unsavedId_=(Math.random()*Number.MAX_VALUE).toString();}
return unsavedId_;},setSolidBackground:function(){this.theme.background=new postermywall.core.model.vo.BackgroundVO();this.backgroundModification=new postermywall.core.model.vo.BackgroundModificationVO();this.theme.background.id=1;this.theme.background.fillType=postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID;this.primaryColor=postermywall.core.model.vo.PosterVO.DEFAULT_SOLID_COLOR;this.secondaryColor=postermywall.core.model.vo.PosterVO.DEFAULT_SOLID_COLOR;this.backgroundType_=postermywall.core.model.vo.PosterVO.BG_TYPE_SOLID_COLOR;this.gradient=postermywall.core.model.vo.PosterVO.GRADIENT_LINEAR;},getColorsOnPoster:function(){var colors={};if(this.theme.background.fillType==postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID){colors[this.primaryColor]=true;colors[this.secondaryColor]=true;}
for(var i=0;i<this.graphicItems.length;i++){var graphicItem=this.graphicItems[i];if(graphicItem.solidBorderType!=0){colors[postermywall.Util.rgbToHex(graphicItem.solidBorderColor)]=true;}
if(graphicItem.dropShadow==3){colors[postermywall.Util.rgbToHex(graphicItem.dropShadowColor)]=true;}
if(postermywall.core.model.vo.PosterVO.hasEditableText(graphicItem)){if(graphicItem.fillType==0){colors[postermywall.Util.rgbToHex(graphicItem.color)]=true;}else{colors[postermywall.Util.rgbToHex(graphicItem.gradientFillColor1)]=true;colors[postermywall.Util.rgbToHex(graphicItem.gradientFillColor2)]=true;}
if(graphicItem.backgroundType!=0){colors[postermywall.Util.rgbToHex(graphicItem.backgroundColor)]=true;}}else if(graphicItem.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE){if(graphicItem.imageGlowColor){colors[postermywall.Util.rgbToHex(graphicItem.imageGlowColor)]=true;}}else if(graphicItem.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE){if(graphicItem.fillType!=0){colors[postermywall.Util.rgbToHex(graphicItem.gradientFillColor1)]=true;colors[postermywall.Util.rgbToHex(graphicItem.gradientFillColor2)]=true;}else{colors[postermywall.Util.rgbToHex(graphicItem.fillColor)]=true;}
colors[postermywall.Util.rgbToHex(graphicItem.strokeColor)]=true;}}
return colors;},formatColor_:function(c){if(typeof c==='string'&&c.length!=6){return('000000'+c).slice(-6);}
return c;}},{DEFAULT_VERSION:DEFAULT_VERSION,SCREEN_LARGER_DIMENSION:690,MIN_DESIGN_SIDE:200,MAX_DESIGN_SIDE:1200,MIN_INCH_SIDE:1,MAX_INCH_SIDE:36,MIN_MM_SIDE:20,MAX_MM_SIDE:1200,PPI_INCH:96,PPI_MM:4,GRADIENT_NONE:'none',GRADIENT_LINEAR:GRADIENT_LINEAR,GRADIENT_RADIAL:'radial',BG_TYPE_SOLID_COLOR:0,BG_TYPE_GRADIENT:1,BG_TYPE_UPLOAD:2,BG_TYPE_PMW_IMAGE:3,BG_TYPE_STOCK:4,DEFAULT_SOLID_COLOR:'ffffff',hasEditableText:function(model){return(model.gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT||model.gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_TAB||model.gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE||model.gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_MENU)}});})();
(function(){puremvc.define({name:'postermywall.core.model.vo.PosterTypeVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.PosterTypeVO';}},{pmvcName:'',name:'',displayName:'',description:'',keywords:'',width:0,height:0,widthInch:0,heightInch:0,widthMm:0,heightMm:0,rotatable:false,hasPrintProduct:false,scaleFactors:[],clone:function(sourceVO){this.name=sourceVO.name;this.displayName=sourceVO.displayName;this.description=sourceVO.description;this.keywords=sourceVO.keywords;this.width=sourceVO.width;this.height=sourceVO.height;this.widthInch=sourceVO.widthInch;this.heightInch=sourceVO.heightInch;this.widthMm=sourceVO.widthMm;this.heightMm=sourceVO.heightMm;this.rotatable=sourceVO.rotatable;this.hasPrintProduct=sourceVO.hasPrintProduct;this.scaleFactors=sourceVO.scaleFactors;}},{TYPE_POSTER_CUSTOM:'poster-custom'});})();
(function(){puremvc.define({name:'postermywall.core.model.vo.FolderVO',parent:postermywall.core.model.vo.BaseVO,constructor:function(o){postermywall.core.model.vo.BaseVO.call(this,o);this.pmvcName='postermywall.core.model.vo.FolderVO';if(typeof o!=='undefined'&&this.creator){this.creator=new postermywall.core.model.vo.UserVO(this.creator);}}},{pmvcName:'',id:'',name:'',createdOn:0,creator:null,idParent:null,clone:function(sourceVO){this.id=sourceVO.id;this.name=sourceVO.name;this.createdOn=sourceVO.createdOn;if(sourceVO.creator!==null){this.creator=postermywall.Util.cloneVO(sourceVO.creator);}
this.idParent=sourceVO.idParent;}});})();
(function(){puremvc.define({name:'postermywall.core.model.vo.ResizeReferenceVO',constructor:function(){this.pmvcName='postermywall.core.model.vo.ResizeReferenceVO'}},{pmvcName:'',width:-1,height:-1,graphicItemsMap:{},backgroundModification:null,clone:function(sourceVO){this.width=sourceVO.width;this.height=sourceVO.height;this.backgroundModification=postermywall.Util.cloneVO(sourceVO.backgroundModification);this.graphicItemsMap={};for(var key in sourceVO.graphicItemsMap){if(!sourceVO.graphicItemsMap.hasOwnProperty(key))continue;this.graphicItemsMap[key]=postermywall.Util.cloneVO(sourceVO.graphicItemsMap[key]);}},set:function(poster){this.height=poster.height;this.width=poster.width;this.backgroundModification=postermywall.Util.cloneVO(poster.backgroundModification);this.graphicItemsMap={};for(var i=0;i<poster.graphicItems.length;i++){this.graphicItemsMap[poster.graphicItems[i].uid]=postermywall.Util.cloneVO(poster.graphicItems[i]);}}});})();
puremvc.define({name:'postermywall.core.model.CommandHistoryProxy',parent:puremvc.Proxy},{undoStack_:[],redoStack_:[],add:function(cmd){this.undoStack_.push(cmd);this.facade.sendNotification(postermywall.Core.UNDO_AVAILABLE);},undo:function(){if(this.canUndo()){var cmd=this.undoStack_.pop();cmd.undo();this.redoStack_.push(cmd);this.facade.sendNotification(postermywall.Core.REDO_AVAILABLE);if(this.undoStack_.length===0){this.facade.sendNotification(postermywall.Core.UNDO_UNAVAILABLE);}}},redo:function(){if(this.canRedo()){var cmd=this.redoStack_.pop();cmd.redo();this.undoStack_.push(cmd);this.facade.sendNotification(postermywall.Core.UNDO_AVAILABLE);if(this.redoStack_.length===0){this.facade.sendNotification(postermywall.Core.REDO_UNAVAILABLE);}}},canUndo:function(){return this.undoStack_.length>0;},canRedo:function(){return this.redoStack_.length>0;},clearRedo:function(){this.redoStack_=[];this.facade.sendNotification(postermywall.Core.REDO_UNAVAILABLE);}},{NAME:'CommandHistoryProxy'});
(function(){var DEFAULT_CACHE_EXPIRY=259200000;var CONTROLLER=window.location.pathname.split('index.php')[1].split('/')[1];var fallbackCache_={};puremvc.define({name:'postermywall.core.model.BaseProxy',parent:puremvc.Proxy,constructor:function(){puremvc.Proxy.call(this);}},{write:function(uri,data){return $.post(PMW.util.site_url(uri),data);},read:function(uri,data,key){var useCache=typeof key!=='undefined';if(useCache){var d=this.getCacheItem(key);if(d!==null){var def=$.Deferred();var p=def.promise();def.resolveWith(this,[d]);return p;}}
var self=this;return $.get(PMW.util.site_url(uri),data).done(function(data){if(useCache){self.setCacheItem(key,data);}});},getURIFromMethod_:function(m){return postermywall.core.model.BaseProxy.getURIFromMethod(m);},setCacheItem:function(k,data,e){var v={d:data,e:(typeof e==='number'?e:DEFAULT_CACHE_EXPIRY)+new Date().getTime()}
var value=JSON.stringify(v);if(window.localStorage){try{window.localStorage.setItem(k,value);}
catch(ex){fallbackCache_[k]=value;}}
else{fallbackCache_[k]=value;}},getCacheItem:function(k){var v;if(window.localStorage){v=window.localStorage.getItem(k);if(v===null&&typeof fallbackCache_[k]==='string'){v=fallbackCache_[k];}}
else{if(typeof fallbackCache_[k]==='string'){v=fallbackCache_[k];}}
if(v!==null&&v.length>0){try{v=JSON.parse(v);if(v.e&&v.e>new Date().getTime()){return v.d;}}
catch(e){PMW.log('BaseProxy.getCacheItem encountered parse error for string: '+v);return null;}}
return null;},clearCache:function(){if(window.localStorage){window.localStorage.clear();}
fallbackCache_={};},flatten:function(obj){var result=Object.create(obj);for(var key in result){result[key]=result[key];}
return result;}},{getURIFromMethod:function(m){return CONTROLLER+'/'+m;}});})();
puremvc.define({name:'postermywall.core.model.AppProxy',parent:postermywall.core.model.BaseProxy,constructor:function(){postermywall.core.model.BaseProxy.call(this);this.getScript=postermywall.Util.createCache(this.doGetScript_.bind(this));}},{languages:[],posterTypes:{},getPosterTypeDisplayName:function(posterTypeName){return this.posterTypes[posterTypeName].displayName;},initializeCache:function(v){var version=this.getCacheItem('version');if(version===null||(version!==null&&version.number!==v)){this.clearCache();this.setCacheItem('version',{number:v});}},loadModal:function(idModal,modalClasses,dragdrop,viewPath){return this.read(this.getURIFromMethod_('loadModal'),{idModal:idModal,modalClasses:modalClasses,dragdrop:dragdrop,viewPath:viewPath})},doGetScript_:function(defer,keys,ext){if(typeof ext==='undefined'){ext=false;}
var version=this.getCacheItem('version');$.ajax({url:ext?keys[0]:PMW.util.site_url('asset/getjs')+'?files='+encodeURIComponent(keys.join(','))+'&v='+encodeURIComponent(version&&version.number?version.number:'0'),dataType:"script",cache:true}).then(defer.resolve,defer.reject);},getLanguage:function(lng,ns){return this.read(this.getURIFromMethod_('getLanguage/'+encodeURIComponent(lng)+'/'+encodeURIComponent(ns)),null,'lang_'+lng);},getFancyTextEffects:function(){return this.read(this.getURIFromMethod_('getFancyTextEffects'),null,'fancytexteffects');},getFancyTextEffectById:function(id,cb){function callback(data){if(data){for(var i=0;i<data.length;i++){if(data[i].id==id){cb(data[i]);return;}}}
cb(null);}
this.getFancyTextEffects().done(callback);},getDownloadableProductList:function(idPoster,isPremium,posterType,idGalleryTemplate,idTemplate,unsavedChanges,isVideo,numberOfGettyImages){return this.read(this.getURIFromMethod_('listdownloads/'+idPoster+'/'+(isPremium?'1':'0')+"?"+(new Date()).getTime()),{pt:posterType,idgt:idGalleryTemplate,idt:idTemplate,uc:(unsavedChanges?'1':'0'),iv:isVideo?'1':'0',ng:numberOfGettyImages});},getPosterTypes:function(){return this.read(this.getURIFromMethod_('getPosterTypeCategories'),null,'posterTypes').done(this.onGetPosterTypesSuccess_.bind(this));},onGetPosterTypesSuccess_:function(data){var posterType;for(var j=0;j<data.length;j++){if(data[j].name!='Popular'){for(var i=0;i<data[j].posterTypes.length;i++){posterType=data[j].posterTypes[i];this.posterTypes[posterType.name]=new postermywall.core.model.vo.PosterTypeVO(posterType);}}}
var dfd=$.Deferred();dfd.resolve(data);return dfd.promise();}},{NAME:'AppProxy',isInternalFont:function(fontFamily,script){script=typeof script==='undefined'?'':script;this.initFontsMap();if(!script){return(fontFamily in postermywall.core.model.AppProxy.FONTS_MAP);}else{if(script&&postermywall.core.model.AppProxy.FONTS_MAP[fontFamily]){if(postermywall.core.model.AppProxy.FONTS_MAP[fontFamily].script&&postermywall.core.model.AppProxy.FONTS_MAP[fontFamily].script.indexOf(script)>-1){return true;}
else{return false;}}}
return true;},initFontsMap:function(){if(postermywall.core.model.AppProxy.FONTS_MAP==null){var fonts=postermywall.core.model.AppProxy.FONTS;postermywall.core.model.AppProxy.FONTS_MAP={};for(var i=0;i<fonts.length;i++){postermywall.core.model.AppProxy.FONTS_MAP[fonts[i].fontFamily]=fonts[i];}}},isFontHidden:function(fontFamily){this.initFontsMap();if(postermywall.core.model.AppProxy.FONTS_MAP[fontFamily].hidden){return true;}
return false;},getScriptMap:function(){if(postermywall.core.model.AppProxy.SCRIPTS_MAP==null){var fonts=postermywall.core.model.AppProxy.FONTS;postermywall.core.model.AppProxy.SCRIPTS_MAP={};for(var i=0;i<fonts.length;i++){if(fonts[i].script){for(var j=0;j<fonts[i].script.length;j++){if(!postermywall.core.model.AppProxy.SCRIPTS_MAP[fonts[i].script[j]]){postermywall.core.model.AppProxy.SCRIPTS_MAP[fonts[i].script[j]]=[];}
postermywall.core.model.AppProxy.SCRIPTS_MAP[fonts[i].script[j]].push({fontFamily:fonts[i].fontFamily,name:fonts[i].name});}}}}
return postermywall.core.model.AppProxy.SCRIPTS_MAP;},getScriptForText:function(text){var charCode=$.trim(text).charCodeAt(0),scriptName='';for(var key in postermywall.core.model.AppProxy.languageScript_){if(!postermywall.core.model.AppProxy.languageScript_.hasOwnProperty(key))continue;var script=postermywall.core.model.AppProxy.languageScript_[key];script.charCode.some(function(CodeRange){if(charCode>=CodeRange.start&&charCode<=CodeRange.end){scriptName=key;return true;}
return false;});if(scriptName){return scriptName;}}
return scriptName;},getScriptDisplayName:function(script){return postermywall.core.model.AppProxy.languageScript_[script].displayName;},getRecommendedFont:function(script){return postermywall.core.model.AppProxy.languageScript_[script].recommendedFont;},getFontsForScript:function(script){var scriptMap=postermywall.core.model.AppProxy.getScriptMap(),list=[];if(script&&scriptMap[script]){for(var i=0;i<scriptMap[script].length;i++){list.push({fontFamily:scriptMap[script][i].fontFamily,name:scriptMap[script][i].name});}}
return list;},languageScript_:{Arabic:{recommendedFont:'Lateef',displayName:'Arabic',charCode:[{start:parseInt('0x0600'),end:parseInt('0x06FF')},{start:parseInt('0x0750'),end:parseInt('0x077F')},{start:parseInt('0x08A0'),end:parseInt('0x08FF')},{start:parseInt('0xFB50'),end:parseInt('0xFDFF')},{start:parseInt('0xFE70'),end:parseInt('0xFEFF')}]},Armenian:{recommendedFont:'DejaVuSansMono',displayName:'Armenian',charCode:[{start:parseInt('0x0530'),end:parseInt('0x058F')}]},Bengali:{recommendedFont:'CharukolaUnicode',displayName:'Bengali',charCode:[{start:parseInt('0x0980'),end:parseInt('0x09FF')}]},CJK:{recommendedFont:'Mplus1cRegular',displayName:'Asian',charCode:[{start:parseInt('0x4E00'),end:parseInt('0x9FFF')},{start:parseInt('0x3000'),end:parseInt('0x303F')},{start:parseInt('0x3200'),end:parseInt('0x32FF')}]},Cyrillic:{recommendedFont:'Mplus1cRegular',displayName:'Russian',charCode:[{start:parseInt('0x0400'),end:parseInt('0x04FF')},{start:parseInt('0x0500'),end:parseInt('0x052F')},{start:parseInt('0x2DE0'),end:parseInt('0x2DFF')},{start:parseInt('0xA640'),end:parseInt('0xA69F')},{start:parseInt('0x1C80'),end:parseInt('0x1C87')}]},Devanagari:{recommendedFont:'VesperLibreRegular',displayName:'Hindi',charCode:[{start:parseInt('0x0900'),end:parseInt('0x097F')},{start:parseInt('0xA8E0'),end:parseInt('0xA8FF')}]},Ethiopic:{recommendedFont:'AbyssinicaSIL',displayName:'Ethiopic',charCode:[{start:parseInt('0x1200'),end:parseInt('0x139F')},{start:parseInt('0x2D80'),end:parseInt('0x2DDF')}]},Georgian:{recommendedFont:'DejaVuSansMono',displayName:'Georgian',charCode:[{start:parseInt('0x10A0'),end:parseInt('0x10FF')},{start:parseInt('0x2D00'),end:parseInt('0x2D2F')}]},Greek:{recommendedFont:'Gemerald',displayName:'Greek',charCode:[{start:parseInt('0x0370'),end:parseInt('0x03FF')},{start:parseInt('0x1F00'),end:parseInt('0x1FFF')}]},Gujarati:{recommendedFont:'Chrysanthi',displayName:'Gujarati',charCode:[{start:parseInt('0x0A80'),end:parseInt('0x0AFF')}]},Hebrew:{recommendedFont:'EzraSIL',displayName:'Hebrew',charCode:[{start:parseInt('0x0590'),end:parseInt('0x05FF')}]},Hiragana:{recommendedFont:'Mplus1cRegular',displayName:'Japanese',charCode:[{start:parseInt('0x3040'),end:parseInt('0x309F')}]},Katakana:{recommendedFont:'Mplus1cRegular',displayName:'Japanese',charCode:[{start:parseInt('0x30A0'),end:parseInt('0x30FF')},{start:parseInt('0x31F0'),end:parseInt('0x31FF')}]},Lao:{recommendedFont:'DejaVuSansMono',displayName:'Laotian',charCode:[{start:parseInt('0x0E80'),end:parseInt('0x0EFF')}]},Tamil:{recommendedFont:'Chanakya',displayName:'Tamil',charCode:[{start:parseInt('0x0B80'),end:parseInt('0x0BFF')}]},Thai:{recommendedFont:'WatinNew',displayName:'Thai',charCode:[{start:parseInt('0x0E00'),end:parseInt('0x0E7F')}]},Tibetan:{recommendedFont:'Chrysanthi',displayName:'Tibetan',charCode:[{start:parseInt('0x0F00'),end:parseInt('0x0FFF')}]},Yi:{recommendedFont:'NuosuSIL',displayName:'Yi',charCode:[{start:parseInt('0xA000'),end:parseInt('0xA48F')},{start:parseInt('0xA490'),end:parseInt('0xA4CF')}]}},SCRIPTS_MAP:null,FONTS_MAP:null,FONTS:[{fontFamily:'Abel',name:'Abel'},{fontFamily:'AbrilFatfaceRegular',name:'Abril Fatface',hidden:true},{fontFamily:'AbyssinicaSIL',name:'Abyssinica SIL',script:['Ethiopic']},{fontFamily:'AccidentalPresidency',name:'Accidental Presidency'},{fontFamily:'Acknowledgement',name:'Acknowledgement'},{fontFamily:'adigiana_extremeregular',name:'Adigiana Extreme',script:['Cyrillic','Greek']},{fontFamily:'AdventProRegular',name:'Advent Pro'},{fontFamily:'AgentOrange',name:'Agent Orange'},{fontFamily:'AlexBrushRegular',name:'Alex Brush'},{fontFamily:'alluraregular',name:'Allura'},{fontFamily:'amatic_scregular',name:'Amatic'},{fontFamily:'Android7',name:'Android 7'},{fontFamily:'AnimeAce',name:'Anime Ace'},{fontFamily:'AnuDaw',name:'AnuDaw'},{fontFamily:'ArbuckleRemix',name:'Arbuckle Remix'},{fontFamily:'ArchivoBlackRegular',name:'Archivo Black'},{fontFamily:'arizoniaregular',name:'Arizonia'},{fontFamily:'arrowesquemedium',name:'Arrowesque'},{fontFamily:'AsapRegular',name:'Asap',hidden:true},{fontFamily:'AYummyApology',name:'A Yummy Apology'},{fontFamily:'Bakery',name:'Bakery'},{fontFamily:'Bangers',name:'Bangers'},{fontFamily:'beach_resortregular',name:'Beach Resort'},{fontFamily:'BerkshireSwashRegular',name:'Berkshire Swash'},{fontFamily:'Bernadette',name:'Bernadette'},{fontFamily:'BeyondTheMountains',name:'BeyondTheMountains'},{fontFamily:'BigApple',name:'Big Apple'},{fontFamily:'bilbo_swash_capsregular',name:'Bilbo Swash'},{fontFamily:'Blackout2am',name:'Blackout 2am'},{fontFamily:'BlackoutMidnight',name:'Blackout Midnight'},{fontFamily:'BlackRose',name:'Black Rose'},{fontFamily:'BonvenoCFLight',name:'Bonveno'},{fontFamily:'BostonTraffic',name:'Boston Traffic'},{fontFamily:'BowlbyOneSCRegular',name:'Bowlby One'},{fontFamily:'BubbleBoy2',name:'Bubble Boy',hidden:true},{fontFamily:'BurnstownDam',name:'Burnstown Dam'},{fontFamily:'cabinregular',name:'Cabin'},{fontFamily:'cabin_sketchregular',name:'Cabin Sketch'},{fontFamily:'CACChampagne',name:'CAC Champagne'},{fontFamily:'Caeldera',name:'Caeldera'},{fontFamily:'carter_oneregular',name:'Carter'},{fontFamily:'CatCafe',name:'CatCafe',script:['Hiragana','Katakana']},{fontFamily:'champignonregular',name:'Champignon'},{fontFamily:'caveatregular',name:'Caveat'},{fontFamily:'caveat_brushregular',name:'Caveat Brush'},{fontFamily:'ceviche_oneregular',name:'Ceviche'},{fontFamily:'Chanakya',name:'Chanakya',script:['Tamil']},{fontFamily:'Chancery',name:'Chancery',hidden:true},{fontFamily:'CharukolaUnicode',name:'Charukola Unicode',script:['Bengali']},{fontFamily:'chathuraregular',name:'Chathura'},{fontFamily:'chewyregular',name:'Chewy'},{fontFamily:'chicleregular',name:'Chicle'},{fontFamily:'Chopin',name:'Chopin'},{fontFamily:'Chrysanthi',name:'Chrysanthi',script:['CJK','Cyrillic','Greek','Armenian','Arabic','Devanagari','Bengali','Gujarati','Tibetan','Hebrew','Hiragana','Katakana']},{fontFamily:'Chumbly',name:'Chumbly'},{fontFamily:'CicleFina',name:'Cicle'},{fontFamily:'CinzelDecorativeBold',name:'Cinzel'},{fontFamily:'cloud_worldregular',name:'Cloud World'},{fontFamily:'Coda',name:'Coda'},{fontFamily:'ComingSoon',name:'Coming Soon'},{fontFamily:'Concielian',name:'Concielian'},{fontFamily:'cooper_blackregular',name:'Cooper Black'},{fontFamily:'covered_by_your_graceregular',name:'Covered By Your Grace'},{fontFamily:'dancing_scriptregular',name:'Dancing'},{fontFamily:'DayPosterBlack',name:'Day Poster Black'},{fontFamily:'DejaVuSansMono',name:'DejaVu Sans Mono',script:['Cyrillic','Greek','Arabic','Georgian','Armenian','Lao']},{fontFamily:'devonshireregular',name:'Devonshire'},{fontFamily:'DigitalDream',name:'Digital Dream'},{fontFamily:'dr_sugiyamaregular',name:'Dr Sugiyama'},{fontFamily:'eaterregular',name:'Eater'},{fontFamily:'Effloresce',name:'Effloresce'},{fontFamily:'eggs_for_3_yrsregular',name:'Eggs For 3 Years'},{fontFamily:'EraserRegular',name:'Eraser'},{fontFamily:'EzraSIL',name:'Ezra SIL',script:['Hebrew']},{fontFamily:'FingerPaintRegular',name:'Finger Paint'},{fontFamily:'flavorsregular',name:'Flavors'},{fontFamily:'Flipside',name:'Flipside BRK'},{fontFamily:'freckle_faceregular',name:'Freckle Face'},{fontFamily:'FrijoleRegular',name:'Frijole'},{fontFamily:'frukturregular',name:'Fruktur'},{fontFamily:'FugazOneRegular',name:'Fugaz One'},{fontFamily:'GermaniaOneRegular',name:'Germania One'},{fontFamily:'Gemerald',name:'Gemerald',script:['Cyrillic','Greek']},{fontFamily:'giduguregular',name:'Gidugu'},{fontFamily:'GistLight',name:'Gist Light'},{fontFamily:'Gladifilthefte',name:'Gladifilthefte'},{fontFamily:'HamburgerHeaven',name:'Hamburger Heaven'},{fontFamily:'harmattanregular',name:'Harmattan'},{fontFamily:'Solov2',name:'Han Solo'},{fontFamily:'hbo_familyregular',name:'HBO Family'},{fontFamily:'HennyPennyRegular',name:'Henny Penny'},{fontFamily:'HoltwoodOneSC',name:'Holtwood'},{fontFamily:'homestileregular',name:'Homestile'},{fontFamily:'IndieFlower',name:'Indie Flower'},{fontFamily:'JariyaHandWritten',name:'Jariya Hand Written',script:['Thai']},{fontFamily:'jenna_sueregular',name:'Jenna Sue'},{fontFamily:'JockeyOneRegular',name:'Jockey One'},{fontFamily:'JosefinSlabRegular',name:'Josefin Slab'},{fontFamily:'joti_oneregular',name:'Joti One'},{fontFamily:'KaushanScriptRegular',name:'Kaushan Script'},{fontFamily:'kavoonregular',name:'Kavoon'},{fontFamily:'kids_clubregular',name:'Kids Club'},{fontFamily:'kon_systembold',name:'Kon System'},{fontFamily:'Lateef',name:'Lateef',script:['Arabic']},{fontFamily:'LeagueSpartanBold',name:'League Spartan'},{fontFamily:'LemonRegular',name:'Lemon'},{fontFamily:'LiberationSerif',name:'Liberation'},{fontFamily:'lifelogo_hardregular',name:'Lifelogo'},{fontFamily:'loved_by_the_kingregular',name:'Loved By The King'},{fontFamily:'lovers_quarrelregular',name:'Lovers Quarrel'},{fontFamily:'Liquidism',name:'Liquidism'},{fontFamily:'LoveYaLikeASister',name:'Love Ya Like A Sister'},{fontFamily:'MagnoliaSky',name:'MagnoliaSky'},{fontFamily:'mallannaregular',name:'Mallanna'},{fontFamily:'Marguerite',name:'Marguerite'},{fontFamily:'MarkMyWords',name:'MarkMyWords'},{fontFamily:'Mplus1cRegular',name:'M+1c Regular',script:['CJK','Cyrillic','Greek','Hebrew','Hiragana','Katakana']},{fontFamily:'merienda_oneregular',name:'Merienda One'},{fontFamily:'MerriweatherSansRegular',name:'Merriweather Sans'},{fontFamily:'MetalLord',name:'Metal Lord'},{fontFamily:'MetalManiaRegular',name:'Metal Mania'},{fontFamily:'micedgeregular',name:'Micedge'},{fontFamily:'Monoton',name:'Monoton'},{fontFamily:'moonhouseregular',name:'Moonhouse'},{fontFamily:'MountainsofChristmas',name:'Mountains of Christmas'},{fontFamily:'MouseMemoirsRegular',name:'Mouse Memoirs'},{fontFamily:'mrs_sheppardsregular',name:'Mrs Sheppards'},{fontFamily:'nicocyanregular',name:'Nicocyan'},{fontFamily:'newrockerregular',name:'Newrocker'},{fontFamily:'NixieOneRegular',name:'Nixie One'},{fontFamily:'new_walt_disney_fontregular',name:'New Walt Disney'},{fontFamily:'NuosuSIL',name:'Nuosu SIL',script:['Yi']},{fontFamily:'Oklahoma',name:'Oklahoma'},{fontFamily:'OldStandardRegular',name:'Old Standard'},{fontFamily:'OleoScript',name:'Oleo Script'},{fontFamily:'OpenSansRegular',name:'Open Sans'},{fontFamily:'OperatingInstructions',name:'Operating Instructions'},{fontFamily:'oreganoregular',name:'Oregano'},{fontFamily:'OriginalSurferRegular',name:'Original Surfer'},{fontFamily:'pacificoregular',name:'Pacifico'},{fontFamily:'PaprikaRegular',name:'Paprika'},{fontFamily:'patrick_hand_scregular',name:'Patrick Hand'},{fontFamily:'2peas_platf2peasplatformshoes',name:'Platform Shoes'},{fontFamily:'playballregular',name:'Playball',hidden:true},{fontFamily:'PlayfairDisplayRegular',name:'Playfair Display'},{fontFamily:'poiret_oneregular',name:'Poiret One'},{fontFamily:'PompiereRegular',name:'Pompiere'},{fontFamily:'Porter',name:'Porter'},{fontFamily:'Primitive',name:'Primitive'},{fontFamily:'prophecy_scriptregular',name:'Prophecy'},{fontFamily:'ranchersregular',name:'Ranchers'},{fontFamily:'rangaregular',name:'Ranga'},{fontFamily:'robotoregular',name:'Roboto'},{fontFamily:'rochesterregular',name:'Rochester'},{fontFamily:'romantiquesregular',name:'Romantiques'},{fontFamily:'rope_mfregular',name:'Rope'},{fontFamily:'ruge_boogieregular',name:'Ruge Boogie'},{fontFamily:'ruthieregular',name:'Ruthie'},{fontFamily:'SacramentoRegular',name:'Sacramento'},{fontFamily:'SancreekRegular',name:'Sancreek'},{fontFamily:'SevenMonkeyFury',name:'Seven Monkey Fury'},{fontFamily:'SFCollegiate',name:'SF Collegiate'},{fontFamily:'SFSpeedwaystar',name:'Speedwaystar'},{fontFamily:'ShadowsIntoLightTwoRegular',name:'Shadows Into Light'},{fontFamily:'Shermlock',name:'Shermlock'},{fontFamily:'SirinStencilRegular',name:'Sirin Stencil'},{fontFamily:'SixCaps',name:'Six Caps'},{fontFamily:'SmokumRegular',name:'Smokum'},{fontFamily:'SoftSugar',name:'Soft Sugar'},{fontFamily:'source_sans_proregular',name:'Source Sans Pro'},{fontFamily:'SpecialElite',name:'Special Elite'},{fontFamily:'SpiraxRegular',name:'Spirax'},{fontFamily:'SteelTongs',name:'Steeltongs'},{fontFamily:'Strasua',name:'Strasua'},{fontFamily:'Sveningsson',name:'Sveningsson'},{fontFamily:'TagsXtreme',name:'Tags Xtreme'},{fontFamily:'teletoon_lowercaseregular',name:'Teletoon'},{fontFamily:'timeburnerregular',name:'Timeburner'},{fontFamily:'Titania',name:'Titania'},{fontFamily:'thickchickmedium',name:'Thick Chick'},{fontFamily:'trenchthin',name:'Trench'},{fontFamily:'truetypewriter_polyglottRg',name:'True Typewriter'},{fontFamily:'TulpenOneRegular',name:'Tulpen One'},{fontFamily:'turkishyeregular',name:'Turkishye'},{fontFamily:'UbuntuMono',name:'Ubuntu Mono',script:['Cyrillic','Greek']},{fontFamily:'Ultra',name:'Ultra'},{fontFamily:'unileafitalic',name:'Unileaf'},{fontFamily:'ursularegular',name:'Ursula'},{fontFamily:'VarianeScript',name:'Variane Script'},{fontFamily:'VesperLibreRegular',name:'Vesper Libre',script:['Devanagari']},{fontFamily:'WaitingfortheSunrise',name:'Waiting for the Sunrise'},{fontFamily:'WatinNew',name:'Watin New',script:['Thai']},{fontFamily:'Windsong',name:'Windsong'},{fontFamily:'WoodWarrior',name:'Woodwarrior'},{fontFamily:'WorkInProgress',name:'WorkInProgress'}],FONTS_FANCYTEXT:[{fontFamily:'Accidental Presidency',preview:'AccidentalPresidency'},{fontFamily:'Agent Orange',preview:'AgentOrange'},{fontFamily:'Airstream',preview:'Airstream'},{fontFamily:'Arbuckle Remix NF',preview:'ArbuckleRemixNF'},{fontFamily:'AYummyApology',preview:'AYummyApology'},{fontFamily:'Berkshire Swash',preview:'BerkshireSwash'},{fontFamily:'Bevan',preview:'Bevan'},{fontFamily:'Big Apple NF',preview:'BigApple'},{fontFamily:'Boston Traffic',preview:'BostonTraffic'},{fontFamily:'Bowlby One SC',preview:'BowlbyOneSCRegular'},{fontFamily:'Bree Serif',preview:'BreeSerif'},{fontFamily:'BubbleBoy2',preview:'BubbleBoy2'},{fontFamily:'Caeldera',preview:'Caeldera'},{fontFamily:'Camp Granada NF',preview:'CampGranadaNF'},{fontFamily:'Char BB',preview:'CharBB'},{fontFamily:'Chancery Cursive',preview:'ChanceryCursive'},{fontFamily:'Chumbly BRK',preview:'ChumblyBRK'},{fontFamily:'Coda',preview:'Coda'},{fontFamily:'Concielian',preview:'Concielian'},{fontFamily:'DayPosterBlack',preview:'DayPosterBlack'},{fontFamily:'Delicious',preview:'Delicious'},{fontFamily:'Diner',preview:'Diner'},{fontFamily:'DOKTOR terror',preview:'DOKTORterror'},{fontFamily:'Dodger Italic',preview:'DodgerItalic'},{fontFamily:'Droid Lover',preview:'DroidLover'},{fontFamily:'Effloresce',preview:'Effloresce'},{fontFamily:'Feast of Flesh BB',preview:'FeastofFleshBB'},{fontFamily:'Frijole',preview:'Frijole'},{fontFamily:'Fugaz One',preview:'FugazOne'},{fontFamily:'Gang of Three',preview:'GangofThree'},{fontFamily:'Guardian',preview:'Guardian'},{fontFamily:'Hardkaze',preview:'Hardkaze'},{fontFamily:'Hero',preview:'Hero'},{fontFamily:'Jura',preview:'Jura'},{fontFamily:'JudasPriest',preview:'JudasPriest'},{fontFamily:'Kharnorric',preview:'Kharnorric'},{fontFamily:'Kontrapunkt Light',preview:'KontrapunktLight'},{fontFamily:'Kreeture',preview:'Kreeture'},{fontFamily:'Fontdinerdotcom Luvable',preview:'FontdinerdotcomLuvable'},{fontFamily:'Metal Lord',preview:'MetalLord'},{fontFamily:'Metropolis NF',preview:'MetropolisNF'},{fontFamily:'MotterFemD',preview:'MotterFemD'},{fontFamily:'New Day',preview:'NewDay'},{fontFamily:'Oklahoma',preview:'Oklahoma'},{fontFamily:'Planet Kosmos',preview:'PlanetKosmos'},{fontFamily:'Pincoyablack',preview:'PincoyaBlack'},{fontFamily:'Possum Saltare NF',preview:'PossumSaltareNF'},{fontFamily:'Primitive',preview:'Primitive'},{fontFamily:'RBNo2 Light',preview:'RBNo2Light'},{fontFamily:'Sancreek',preview:'Sancreek'},{fontFamily:'SFCollegiate',preview:'SFCollegiate'},{fontFamily:'SFSpeedwaystar',preview:'SFSpeedwaystar'},{fontFamily:'Shermlock',preview:'Shermlock'},{fontFamily:'Han Solo',preview:'HanSolo'},{fontFamily:'Star Avenue',preview:'StarAvenue'},{fontFamily:'Steiner',preview:'Steiner'},{fontFamily:'Sveningsson',preview:'Sveningsson'},{fontFamily:'TagsXtreme',preview:'TagsXtreme'},{fontFamily:'Titania',preview:'Titania'},{fontFamily:'Wicked Queen BB',preview:'WickedQueenBB'}],PATTERNS:[10,0,1,2,3,4,5,6,7,8,9],USER_FONT_LICENSE:'user'});
puremvc.define({name:'postermywall.core.model.UserProxy',parent:postermywall.core.model.BaseProxy,constructor:function(){postermywall.core.model.BaseProxy.call(this);this.setFlags_();if(typeof PMConfig.user!='undefined'){this.userFonts_=PMConfig.fonts;}}},{user_:null,unsavedId_:'',isStudent_:false,isAcademicUser_:false,premiumLicense_:false,unlinkedUserImageIds_:[],unlinkedUserVideoIds_:[],unlinkedCustomBackgroundIds_:[],unlinkedFontFamilies_:[],unlinkedUserMenuItems_:[],userFonts_:[],userMenuItems_:{},photoExtendedPermissions_:false,contributorFontsOnPoster_:[],isContributor_:false,isAcademicUser:function(){return this.isAcademicUser_;},setFlags_:function(){this.isStudent_=PMW.isStudent();this.isAcademicUser_=PMW.isEDU();},unSetFlags_:function(){this.isStudent_=false;this.isAcademicUser_=false;},setUser:function(o){this.user_=new postermywall.core.model.vo.UserVO(o);this.setFlags_();if(this.user_.id>0){this.facade.sendNotification(postermywall.Core.USER_SET,this.user_);}},unsetUser:function(){this.user_=null;this.unSetFlags_();this.facade.sendNotification(postermywall.Core.USER_UNSET);},setContributorFontsOnPoster:function(fonts){this.contributorFontsOnPoster_=fonts;},setIsContributor:function(isContributor){this.isContributor_=isContributor;},isContributor:function(){return this.isContributor_;},getContributorFontsOnPoster:function(){return this.contributorFontsOnPoster_;},getUser:function(){return this.user_;},getUserId:function(){return(this.user_===null?0:this.user_.id);},getUnsavedId:function(){if(this.unsavedId_===''){this.unsavedId_=(Math.random()*Number.MAX_VALUE).toString();}
return this.unsavedId_;},makeKeyForUser:function(key){if(this.user_!==null){return key+this.user_.id;}},setHasAgreedToPremiumLicense:function(v){this.premiumLicense_=v;},hasAgreedToPremiumLicense:function(){return this.premiumLicense_;},checkIfHasAgreedToLicense:function(licenseName){return this.read('user/hasuseragreedto',{license:licenseName},this.makeKeyForUser(licenseName));},addUserAgreement:function(licenseName){this.write('user/adduseragreement',{license:licenseName});},addUnlinkedUserImageId:function(id){this.unlinkedUserImageIds_.push(id);},addUnlinkedUserVideoId:function(id){this.unlinkedUserVideoIds_.push(id);},addUnlinkedUserFont:function(fontFamily){this.unlinkedFontFamilies_.push(fontFamily);},addUnlinkedUserMenuItem:function(itemIds){this.unlinkedUserMenuItems_=this.unlinkedUserMenuItems_.concat(itemIds);},addUnlinkedCustomBackgroundId:function(id){this.unlinkedCustomBackgroundIds_.push(id);},linkImageIds_:function(){if(this.user_!=null&&(this.unlinkedUserImageIds_.length>0||this.unlinkedCustomBackgroundIds_.length>0)){var params={userid:this.user_.id};if(this.unlinkedUserImageIds_.length>0){params.uids=this.unlinkedUserImageIds_.join(',');}
if(this.unlinkedCustomBackgroundIds_.length>0){params.bids=this.unlinkedCustomBackgroundIds_.join(',');}
this.write('posterimage/linkids',params).done(this.onImageIdsLinked_.bind(this));}},linkVideoIds_:function(){if(this.user_!=null&&this.unlinkedUserVideoIds_.length>0){var params={userId:this.user_.id};if(this.unlinkedUserVideoIds_.length>0){params.videoIds=this.unlinkedUserVideoIds_.join(',');}
this.write('postervideo/linkIds',params).done(this.onVideoIdsLinked_());}},linkUserFonts_:function(){if(this.user_!=null&&(this.unlinkedFontFamilies_.length>0)){this.write('font/linkfonts',{userid:this.user_.id,ffs:this.unlinkedFontFamilies_.join(',')}).done(this.onFontsLinked_.bind(this));}},linkUserMenuItems_:function(){if(this.user_!=null&&(this.unlinkedUserMenuItems_.length>0)){this.write('menuitem/linkmenuitems',{menuItemIds:this.unlinkedUserMenuItems_.join(',')}).done(this.onMenuItemsLinked_.bind(this));}},onImageIdsLinked_:function(response){this.unlinkedUserImageIds_=[];this.unlinkedCustomBackgroundIds_=[];},onVideoIdsLinked_:function(){this.unlinkedUserVideoIds_=[];},onFontsLinked_:function(response){this.unlinkedFontFamilies_=[];},onMenuItemsLinked_:function(response){this.unlinkedUserMenuItems_=[];},loadUser:function(){return this.read('user/getUserInfo',null).done(this.onAuthenticationDone_.bind(this));},onAuthenticationDone_:function(data){this.setUser(data);this.linkImageIds_();this.linkVideoIds_();this.linkUserFonts_();this.linkUserMenuItems_();if(this.user_.isDesigner()){this.facade.sendNotification(postermywall.Core.UPDATE_FONT_FAMILY_SELECTOR);}
else if(data.fonts.length>0){this.updateUserFonts(data.fonts);}},logOutUser:function(){return this.write('authenticate/asyncLogout',null).done(this.onLogOutDone_.bind(this));},onLogOutDone_:function(){this.unsetUser();this.userFonts_=[];this.facade.sendNotification(postermywall.Core.UPDATE_FONT_FAMILY_SELECTOR);},updateUserFonts:function(fonts,action){if(typeof action=="undefined"){action='add';}
if(fonts.length>0){if(action=='add'){for(var i=0;i<fonts.length;i++){this.userFonts_.push(fonts[i]);}}
else if(action=='remove'){for(var j=0;j<fonts.length;j++){for(var k=0;k<this.userFonts_.length;k++){if(this.userFonts_[k].fontFamily==fonts[j]){this.userFonts_.splice(k,1);}}}}}
this.facade.sendNotification(postermywall.Core.UPDATE_FONT_FAMILY_SELECTOR);},getUserFonts:function(){return this.userFonts_;},removeContributorToCollection:function(p){return this.write('collection/removeContributorToCollection',p);},getContributorsToCollection:function(p){return this.read('collection/getContributorsToCollection',p);},getUserCollections:function(p){return this.read('collection/getUserCollections',p);},deleteCollection:function(p){return this.write('collection/delete',p);},removeSharedCollection:function(p){return this.write('collection/removeSharedCollection',p);},saveCollection:function(p){return this.write('collection/save',p);},getUserMultiMediaItemsInCollection:function(p){return this.read('collection/getUserMultiMediaItemsInCollection',p);},uploadMultiMediaFile:function(fd,uxc,s,e,c,type){$.ajax({context:this,url:PMW.util.site_url(type===postermywall.Core.MULTIMEDIA_TYPE_VIDEO?'postervideo/upload':'posterimage/upload')+'/'+((this.user_)?this.user_.id:''),type:'POST',xhr:uxc,data:fd,cache:false,dataType:'json',processData:false,contentType:false,success:s,error:e,complete:c});},removeUserItem:function(p){return this.write('user/removeUserMultiMediaItem',p);},moveUserItem:function(p){return this.write('collection/moveUserItem',p);},removeUserFont:function(p){return this.write('font/removeUserFont',p);},uploadUserFont:function(fd,uxc,s,e,c){$.ajax({context:this,url:PMW.util.site_url('font/upload'),type:'POST',xhr:uxc,data:fd,cache:false,dataType:'json',processData:false,contentType:false,success:s,error:e,complete:c});},getFacebookAlbums:function(){return this.read('user/getFacebookAlbumsJSON');},getFacebookAlbumPhotos:function(aid){return this.read('user/getFacebookAlbumPhotos',{aid:aid});},facebookUpload:function(p){return this.write('posterimage/facebookupload',$.extend({u:this.user_.id},p));},importGoogleDrivePhoto:function(p){return this.write('posterimage/importGoogleDrivePhoto',$.extend({userId:this.getUserId()},p));},importDropboxPhoto:function(p){return this.write('posterimage/importDropboxPhoto',$.extend({userId:this.getUserId()},p));},importGoogleImage:function(p){return this.write('posterimage/importGoogleImage',$.extend({userId:this.getUserId()},p));},setUserLanguage:function(lang){PMW.trackGAEvent(PMW.POSTERBUILDER,'LanguageSwitch',lang,null);if(this.user_!=null){return this.write('user/setUserLanguage',{lang:lang});}else{var dfd=$.Deferred();PMW.util.setCookie('pmwpl',lang,300);dfd.resolve();return dfd.promise();}},addOrUpdateItemsInUserList:function(items){var vo;if(Array.isArray(items)){for(var i=0;i<items.length;i++){vo=new postermywall.core.model.vo.MenuItemVO();vo.clone(items[i]);this.userMenuItems_[items[i].id]=vo;}}
else{vo=new postermywall.core.model.vo.MenuItemVO();vo.clone(items);this.userMenuItems_[items.id]=vo;}},removeItemFromUserList:function(items){if(Array.isArray(items)){for(var i=0;i<items.length;i++){delete this.userMenuItems_[items[i]];}}
else{delete this.userMenuItems_[items];}},getUserMenuItemsList:function(){return this.userMenuItems_;},addUserMenuItem:function(p){return this.write('menuitem/addMenuItem',{menuItem:JSON.stringify(p)});},addUserMenuItems:function(items){return this.write('menuitem/addMenuItems',{menuItems:JSON.stringify(items)}).done((function(response){if(response.status=='success'){if(this.getUser()===null){this.addUnlinkedUserMenuItem(response.data.itemIds);}
else{this.addOrUpdateItemsInUserList(response.data.menuItems);}}}).bind(this));},updateUserMenuItem:function(menuItem,changes){return this.write('menuitem/updateMenuItem',{menuItem:JSON.stringify(menuItem),changes:JSON.stringify(changes)}).done((function(response){if(response.status=='success'){if(this.getUser()){this.addOrUpdateItemsInUserList(response.data.menuItem);}
else{this.addUnlinkedUserMenuItem([response.data.menuItem.id]);}}}).bind(this));},getUserMenuItems:function(){return this.read('menuitem/getMenuItemsForUser').done((function(response){if(response.status=='success'){this.addOrUpdateItemsInUserList(response.data);}}).bind(this));},deleteUserMenuItem:function(p){return this.write('menuitem/deleteItem',p).done((function(response){if(response.status=='success'){this.removeItemFromUserList(response.data);}}).bind(this));},isUserMenuItem:function(itemId){return this.userMenuItems_.hasOwnProperty(itemId)||(this.unlinkedUserMenuItems_.indexOf(itemId)!=-1);}},{NAME:'UserProxy'});
puremvc.define({name:'postermywall.core.model.PosterProxy',parent:postermywall.core.model.BaseProxy},{isPosterPurchased_:null,folder_:null,newFromTemplate:function(template){var poster=new postermywall.core.model.vo.PosterVO(),up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);poster.clone(template);poster.id=-1;poster.name='A New Design';poster.description='';poster.isInternal=poster.isTemplate=poster.isPublic=false;poster.isCopyable=poster.isPurchaseable=true;poster.createdOn=poster.lastModified=0;poster.idLastModifier=-1;poster.idTemplate=(template.id==-1?null:template.id);poster.idGalleryTemplate=template.idGalleryTemplate;if(template.creator!=null){poster.owner=template.creator;poster.name='Copy of '+template.name;if(template.creator.id==up.getUserId()){poster.description=template.description;}}
poster.creator=up.getUser();return poster;},loadPosterByHash:function(h,cb){var $this=this;return this.read(this.getURIFromMethod_('getJSON/'+h+(postermywall.Core.isHighRes()?'/highres':''))).done(function(data){if(data.contributorFontsOnPoster.length>0){var up=$this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);up.setContributorFontsOnPoster(data.contributorFontsOnPoster);up.setIsContributor(true);}
if(data.folder){$this.setFolderToSaveIn(data.folder)}
cb(new postermywall.core.model.vo.PosterVO(data.poster));}).fail(function(jqXHR){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'changeBg'});this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error'),debug:'loadPosterByHash :: '+jqXHR.status+' '+jqXHR.statusText});}.bind(this));},setFolderToSaveIn:function(folder){this.folder_=new postermywall.core.model.vo.FolderVO(folder);},savePoster:function(p,ignoreConflict){for(var i=0;i<p.graphicItems.length;i++){p.graphicItems[i]=this.flatten(p.graphicItems[i]);}
var data={poster:JSON.stringify(p),ignoreConflict:ignoreConflict?1:0};if(this.folder_){data.idFolder=this.folder_.id;}
return this.write(this.getURIFromMethod_('save'),data);},savePosterPreview:function(id,img){return this.write(this.getURIFromMethod_('savePreview'),{id:id,img:img});},getEditPosterURL:function(hash){return PMW.util.site_url(this.getURIFromMethod_('load/'+hash));},isPosterInCategory:function(idPoster){return this.read(this.getURIFromMethod_('isPosterInCategory'),{idPoster:idPoster});},checkoutDownload:function(p){return this.write('cart/checkoutdownload',p);},getFolder:function(){return this.folder_;},isPosterPurchased:function(id){if(this.isPosterPurchased_==null&&typeof id!='undefined'){return this.read('cart/isposterpurchased',{id:id}).done(function(data){this.isPosterPurchased_=(data=='yes');}.bind(this));}else{return this.isPosterPurchased_;}}},{NAME:'PosterProxy'});
puremvc.define({name:'postermywall.core.model.ImageProxy',parent:postermywall.core.model.BaseProxy},{createCroppedImage:function(p){return this.write('posterimage/crop',p);}},{NAME:'ImageProxy'});
puremvc.define({name:'postermywall.core.model.StockGraphicProxy',parent:postermywall.core.model.BaseProxy},{searchXHR_:null,getStockLibraryImages:function(p){if(this.searchXHR_!==null&&this.searchXHR_.readyState!==4){this.searchXHR_.abort();}
switch(p.src){case'pmw':PMW.trackGAEvent(PMW.POSTERBUILDER,'SearchBackground',p.st);break;case'openclipart':PMW.trackGAEvent(PMW.POSTERBUILDER,'OpenClipartSearch',p.st);break;default:PMW.trackGAEvent(PMW.POSTERBUILDER,p.src.substr(0,1).toUpperCase()+p.src.substr(1)+'Search',p.st);}
this.searchXHR_=this.read(this.getURIFromMethod_('getStockLibraryImages'),p);this.sendNotification(postermywall.Core.STOCK_SEARCH,this.searchXHR_);return this.searchXHR_;},getStockLibraryVideos:function(p){if(this.searchXHR_!==null&&this.searchXHR_.readyState!==4){this.searchXHR_.abort();}
switch(p.src){case'getty':PMW.trackGAEvent(PMW.POSTERBUILDER,'GettyVideoSearch',p.st);break;case'pixabay':PMW.trackGAEvent(PMW.POSTERBUILDER,'PixabayVideoSearch',p.st);break;}
this.searchXHR_=this.read(this.getURIFromMethod_('getStockLibraryVideos'),p);this.sendNotification(postermywall.Core.STOCK_SEARCH,this.searchXHR_);return this.searchXHR_;},getFlickrImageSizes:function(id){return this.read(this.getURIFromMethod_('getFlickrImageSizes'),{id:id});},gettyUpload:function(p){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return this.write('posterimage/gettyupload',$.extend({userId:up.getUserId()},p));},gettyVideoUpload:function(p){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return this.write('postervideo/gettyupload',$.extend({userId:up.getUserId()},p));},pixabayVideoUpload:function(p){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return this.write('postervideo/pixabayupload',$.extend({userId:up.getUserId()},p));},pixabayUpload:function(p){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return this.write('posterimage/pixabayupload',$.extend({userId:up.getUserId()},p));},flickrUpload:function(p){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return this.write('posterimage/flickrupload',$.extend({userId:up.getUserId()},p));},clipartUpload:function(p){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return this.write('posterimage/clipartupload',$.extend({userId:up.getUserId()},p));},importGettyBackground:function(p,w,h){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);return this.write('posterimage/gettybackgroundupload/'+w+'/'+h,$.extend({fc:true,posterType:wbp.getPosterTypeName()},p));},importPixabayBackground:function(p,w,h){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);return this.write('posterimage/pixabaybackgroundupload/'+w+'/'+h,$.extend({fc:true,posterType:wbp.getPosterTypeName()},p));},importFlickrBackground:function(p,w,h){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);return this.write('posterimage/flickrbackgroundupload/'+w+'/'+h,$.extend({fc:true,posterType:wbp.getPosterTypeName()},p));}},{NAME:'StockGraphicProxy'});
puremvc.define({name:'postermywall.core.model.BackgroundProxy',parent:postermywall.core.model.BaseProxy},{categoryXHR_:null,getAllBackgroundCategories:function(){return this.read(this.getURIFromMethod_('getAllBackgroundCategoriesJSON'));},getBackgroundCategory:function(id){if(this.categoryXHR_!==null&&this.categoryXHR_.readyState!==4){this.categoryXHR_.abort();}
this.categoryXHR_=this.read('posters/incategoryjson/'+id);return this.categoryXHR_;},getThemeById:function(id){return this.read(this.getURIFromMethod_('getThemeByIdJSON/'+id));},getUnmodifiedBackgroundPreview:function(bId){return this.read('posterimage/getUnmodifiedBackgroundPreview/'+bId);},addNewCustomBackground:function(p){return $.post(PMW.util.site_url('posterimage/addbackground_v2'),p);},uploadBackgroundImage:function(p,fd,uxc,s,e,c){$.ajax({context:this,url:(PMW.util.site_url('posterimage/backgroundupload')+'/'+p),type:'POST',xhr:uxc,data:fd,cache:false,dataType:'json',processData:false,contentType:false,success:s,error:e,complete:c});}},{NAME:'BackgroundProxy'});
(function(){var poster_=null;puremvc.define({name:'postermywall.core.model.WhiteboardProxy',parent:postermywall.core.model.BaseProxy},{tempPoster:null,resizeReference:null,unsavedChanges_:false,promptAboutChanges_:false,getWidth:function(){if(poster_==null){return this.tempPoster.width;}else{return poster_.width;}},getHeight:function(){if(poster_==null){return this.tempPoster.height;}else{return poster_.height;}},getPosterTypeName:function(){if(poster_==null){return this.tempPoster.type.name;}else{return poster_.type.name;}},getPosterTypeDisplayName:function(){if(poster_==null){return this.tempPoster.type.displayName;}else{return poster_.type.displayName;}},getPosterTypeDescription:function(){if(poster_==null){return this.tempPoster.type.description;}else{return poster_.type.description;}},getHasPrintProduct:function(){if(poster_==null){return this.tempPoster.type.hasPrintProduct;}else{return poster_.type.hasPrintProduct;}},setUnsavedChanges:function(val,setPromptFlag){this.unsavedChanges_=val;if(typeof setPromptFlag==='undefined'||setPromptFlag){this.promptAboutChanges_=val;}
if(this.unsavedChanges_){this.sendNotification(postermywall.Core.SAVE_AVAILABLE);}
else{this.sendNotification(postermywall.Core.SAVE_UNAVAILABLE);}},getUnsavedChanges:function(){return this.unsavedChanges_;},promptAboutChanges:function(){return this.promptAboutChanges_;},setPoster:function(v,forceChange){var isChanged=((poster_==null&&v!=null)||(poster_!=null&&v==null)||(poster_!=null&&v!=null&&poster_.id!=v.id));poster_=v;this.resizeReference=new postermywall.core.model.vo.ResizeReferenceVO();if(poster_){this.resizeReference.set(poster_);}
if(isChanged||forceChange){this.sendNotification(postermywall.Core.POSTER_CHANGED,poster_);this.sendNotification(postermywall.Core.POSTER_NAME_CHANGED,poster_?poster_.name:'');this.sendNotification(postermywall.Core.POSTER_DESCRIPTION_CHANGED,poster_?poster_.description:'');var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);if(up.getUser()==null){up.setHasAgreedToPremiumLicense(false);}
this.setUnsavedChanges((poster_&&poster_.id<=0),false);}},getPoster:function(){return poster_;},getResizeReference:function(){return this.resizeReference;},setResizeReference:function(resizeReference){this.resizeReference.clone(resizeReference);},getParametersForResizing:function(targetWidth,targetHeight,currentAspectRatio){var newHeight,newWidth,dx,dy;newHeight=targetHeight;newWidth=targetHeight*currentAspectRatio;if(newWidth>targetWidth){newWidth=targetWidth;newHeight=targetWidth/currentAspectRatio;}
dx=(targetWidth-newWidth)/2;dy=(targetHeight-newHeight)/2;return{newHeight:newHeight,newWidth:newWidth,dx:dx,dy:dy}},resizePosterToReference:function(poster){var currentWidth=poster.width,currentHeight=poster.height,referenceAspectRatio=this.resizeReference.width/this.resizeReference.height,sfDelta,params,i,j;if(!(currentWidth===this.resizeReference.width&&currentHeight===this.resizeReference.height)){params=this.getParametersForResizing(currentWidth,currentHeight,referenceAspectRatio);sfDelta=this.resizeReference.height/params.newHeight;for(i=0;i<poster.graphicItems.length;i++){var graphicItem=postermywall.Util.cloneVO(poster.graphicItems[i]);graphicItem.setScale(sfDelta);graphicItem.x=Math.floor((poster.graphicItems[i].x-params.dx)/params.newWidth*this.resizeReference.width);graphicItem.y=Math.floor((poster.graphicItems[i].y-params.dy)/params.newHeight*this.resizeReference.height);var cornerPoints=graphicItem.getCornerPoints();for(j=0;j<cornerPoints.length;j++){if(cornerPoints[j].x<0||cornerPoints[j].x>this.resizeReference.width||cornerPoints[j].y<0||cornerPoints[j].y>this.resizeReference.Height){if(this.resizeReference.graphicItemsMap[graphicItem.uid]){var oldCornerPoints=this.resizeReference.graphicItemsMap[graphicItem.uid].getCornerPoints();for(var k=0;k<cornerPoints.length;k++){if((Math.abs(cornerPoints[k].x-oldCornerPoints[k].x)>10)||(Math.abs(cornerPoints[k].y-oldCornerPoints[k].y)>10)){this.resizeReference.set(poster);return;}}}else{this.resizeReference.set(poster);return;}}}}
for(i=0;i<poster.graphicItems.length;i++){poster.graphicItems[i].setScale(sfDelta);poster.graphicItems[i].x=Math.floor((poster.graphicItems[i].x-params.dx)/params.newWidth*this.resizeReference.width);poster.graphicItems[i].y=Math.floor((poster.graphicItems[i].y-params.dy)/params.newHeight*this.resizeReference.height);}
if(poster.theme.background.fillType!=postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID){poster.backgroundModification=new postermywall.core.model.vo.BackgroundModificationVO();poster.backgroundModification.clone(this.resizeReference['backgroundModification']);if(poster.backgroundModification.isCropped()){poster.theme.background.tempUID=postermywall.Util.getUUID();}}
poster.width=this.resizeReference.width;poster.height=this.resizeReference.height;this.sendNotification(postermywall.Core.FORCE_REFRESH);}},resizePoster:function(poster,posterTypeName,targetWidth,targetHeight,showConfirmation){this.resizePosterToReference(poster);var currentWidth=poster.width,currentHeight=poster.height,currentAspectRatio=currentWidth/currentHeight,targetAspectRatio=targetWidth/targetHeight,params,sfDelta,resizeXAdjust,resizeYAdjust,i,ap;if(!(currentWidth===targetWidth&&currentHeight===targetHeight)){params=this.getParametersForResizing(targetWidth,targetHeight,currentAspectRatio);sfDelta=params.newHeight/currentHeight;resizeXAdjust=currentWidth-params.newWidth;resizeYAdjust=currentHeight-params.newHeight;for(i=0;i<poster.graphicItems.length;i++){poster.graphicItems[i].setScale(sfDelta);poster.graphicItems[i].x+=Math.floor(params.dx-((poster.graphicItems[i].x/currentWidth)*resizeXAdjust));poster.graphicItems[i].y+=Math.floor(params.dy-((poster.graphicItems[i].y/currentHeight)*resizeYAdjust));}
if(poster.theme.background.fillType!=postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID){var x,y,w,h;if(currentAspectRatio<targetAspectRatio||(targetWidth==targetHeight&&currentWidth<currentHeight)){if(poster.backgroundModification.isCropped()){x=poster.backgroundModification.x;w=poster.backgroundModification.width;h=w/targetAspectRatio;y=poster.backgroundModification.y+((poster.backgroundModification.height-h)/2);}else{x=0;w=poster.theme.background.width;h=w/targetAspectRatio;y=(poster.theme.background.height-h)/2;}}else{if(poster.backgroundModification.isCropped()){y=poster.backgroundModification.y;h=poster.backgroundModification.height;w=h*targetAspectRatio;x=poster.backgroundModification.x+((poster.backgroundModification.width-w)/2);}else{y=0;h=poster.theme.background.height;w=h*targetAspectRatio;x=(poster.theme.background.width-w)/2;}}
poster.backgroundModification.x=x;poster.backgroundModification.y=y;poster.backgroundModification.width=w;poster.backgroundModification.height=h;if(poster.backgroundModification.isCropped()){poster.theme.background.tempUID=postermywall.Util.getUUID();}}
ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);poster.width=targetWidth;poster.height=targetHeight;poster.type=ap.posterTypes[posterTypeName];this.sendNotification(postermywall.Core.FORCE_REFRESH);}else if(targetWidth===this.resizeReference.width&&targetHeight===this.resizeReference.height){ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);poster.type=ap.posterTypes[posterTypeName];}
this.setUnsavedChanges(true);if(poster_===null){var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);this.setPoster(pp.newFromTemplate(poster),true);}
else{ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);poster_.width=targetWidth;poster_.height=targetHeight;poster_.type=ap.posterTypes[posterTypeName];this.sendNotification(postermywall.Core.POSTER_RESIZED,{vo:poster,posterType:posterTypeName,showConfirmation:showConfirmation});}},setTempPoster:function(posterType,width,height,userWidth,userHeight,units){this.tempPoster=new postermywall.core.model.vo.PosterVO();this.tempPoster.type.name=posterType.name;this.tempPoster.type.displayName=posterType.displayName;this.tempPoster.type.description=posterType.description;this.tempPoster.type.hasPrintProduct=posterType.hasPrintProduct;this.tempPoster.width=parseInt(width,10);this.tempPoster.height=parseInt(height,10);if(isNaN(this.tempPoster.width)||isNaN(this.tempPoster.height)){this.tempPoster.width=600;this.tempPoster.height=900;this.tempPoster.type.name='poster';this.tempPoster.type.displayName='Poster';this.tempPoster.type.description='24in × 36in';this.tempPoster.type.hasPrintProduct=true;}
this.tempPoster.userWidth=userWidth;this.tempPoster.userHeight=userHeight;this.tempPoster.units=units;this.tempPoster.theme=new postermywall.core.model.vo.PosterThemeVO();this.tempPoster.theme.fontColor=[0,0,0];this.tempPoster.theme.fontFamily="AccidentalPresidency";this.tempPoster.theme.fontSize="40";this.tempPoster.theme.fontStyle="normal";this.tempPoster.theme.fontWeight="normal";this.tempPoster.theme.background=new postermywall.core.model.vo.BackgroundVO();this.tempPoster.backgroundModification=new postermywall.core.model.vo.BackgroundModificationVO();},setName:function(n){n=$.trim(n);if(!n.length){n='Untitled';}
var hasChanged=poster_.name!==n;poster_.name=n;if(hasChanged){this.setUnsavedChanges(true);this.sendNotification(postermywall.Core.POSTER_NAME_CHANGED,n);}},setDescription:function(d){d=$.trim(d);var hasChanged=poster_.description!==d;poster_.description=d;if(hasChanged){this.setUnsavedChanges(true);this.sendNotification(postermywall.Core.POSTER_DESCRIPTION_CHANGED,d);}},addItem:function(model,at){if(typeof at==='undefined'||at===null){at=-1;}
if(at>=0&&at<poster_.graphicItems.length){poster_.graphicItems.splice(at,0,model);}
else{poster_.graphicItems.push(model);}
this.setUnsavedChanges(true);this.sendNotification(postermywall.Core.GRAPHIC_ITEM_ADDED,{model:model,at:at});this.updatePosterIsPremium(model);},getItem:function(uid){for(var i=0;i<poster_.graphicItems.length;i++){if(poster_.graphicItems[i].uid===uid){return poster_.graphicItems[i];}}
return null;},removeItem:function(model){for(var i=0;i<poster_.graphicItems.length;i++){if(poster_.graphicItems[i].uid===model.uid){poster_.graphicItems.splice(i,1);break;}}
this.setUnsavedChanges(true);this.sendNotification(postermywall.Core.GRAPHIC_ITEM_REMOVED,model);this.updatePosterIsPremium(model);},updateGraphicItems:function(updatedItems){if(updatedItems.length>0){this.setUnsavedChanges(true);}
for(var i=0;i<poster_.graphicItems.length;i++){for(var j=0;j<updatedItems.length;j++){if(poster_.graphicItems[i].uid===updatedItems[j].uid){if(updatedItems[j].gitype==='image'&&poster_.graphicItems[i].hashedFilename!=updatedItems[j].hashedFilename){this.updatePosterIsPremium(updatedItems[j]);}
poster_.graphicItems[i]=updatedItems[j];this.sendNotification(postermywall.Core.GRAPHIC_ITEM_UPDATED,updatedItems[j]);break;}}}},modifyBackground:function(backgroundModification){poster_.backgroundModification.clone(backgroundModification);this.setUnsavedChanges(true);this.sendNotification(postermywall.Core.BACKGROUND_MODIFIED,backgroundModification);},changeTheme:function(p,refresh){refresh=typeof refresh==='undefined'?true:refresh;if(!p.theme.background.isCustomizable()){this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'changeBg'});}
poster_.clone(p);this.sendNotification(postermywall.Core.BACKGROUND_UPDATED,{poster:p,cb:this.onChangeThemeSuccess.bind(this,p),refresh:refresh});},onChangeThemeSuccess:function(p){this.setUnsavedChanges(true);if(!p.theme.background.isCustomizable()){this.resizeReference.set(p);this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'changeBg'});}},checkMaxGettyVideoLimit:function(showMessage){return false;showMessage=typeof showMessage!=='undefined'?showMessage:true;var count=0;if(poster_!==null&&poster_.graphicItems!==null){for(var i=0;i<poster_.graphicItems.length;i++){if(poster_.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO&&poster_.graphicItems[i].visible&&poster_.graphicItems[i].videoSource===postermywall.core.model.vo.GraphicItemVO.SOURCE_GETTY){count++;}}}
if(count>=postermywall.core.model.WhiteboardProxy.MAX_GETTY_VIDEOS_PER_POSTER){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'addVideo'});if(showMessage){this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:$.t('pm_video_getty_limit'),text:$.t('pm_video_getty_limit_message')});}
return true;}
return false;},checkGettyMaxImageLimit:function(showMessage){showMessage=typeof showMessage!=='undefined'?showMessage:true;var count=0;if(this.isBackgroundFromGetty()){count++;}
if(poster_!==null&&poster_.graphicItems!==null){for(var i=0;i<poster_.graphicItems.length;i++){if(poster_.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&poster_.graphicItems[i].visible&&poster_.graphicItems[i].imageSource===postermywall.core.model.vo.GraphicItemVO.SOURCE_GETTY){count++;}}}
if(count>=postermywall.core.model.WhiteboardProxy.MAX_GETTY_IMAGES_PER_POSTER){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'addImage'});this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'changeBg'});if(showMessage){this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:$.t('pm_getty_limit'),text:$.t('pm_getty_limit_message')});}
return true;}
return false;},isBackgroundFromGetty:function(){if(poster_===null){return false;}
if(poster_.theme!==null&&poster_.theme.background!==null&&poster_.theme.background.source!==null){return(poster_.theme.background.source==='getty');}
return false;},updatePosterIsVideo:function(){for(var i=0;i<poster_.graphicItems.length;i++){if(poster_.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO){poster_.isVideo=true;return;}}
poster_.isVideo=false;},updatePosterIsPremium:function(updatedGI){if(this.isBackgroundFromGetty()){if(!poster_.isPremium){poster_.isPremium=true;this.sendNotification(postermywall.Core.UPDATE_WATERMARK);}}else{if(updatedGI===null||updatedGI instanceof postermywall.core.model.vo.GraphicItemImageVO){for(var i=0;i<poster_.graphicItems.length;i++){if(poster_.graphicItems[i]instanceof postermywall.core.model.vo.GraphicItemImageVO&&poster_.graphicItems[i].imageSource==='getty'){if(!poster_.isPremium){poster_.isPremium=true;this.sendNotification(postermywall.Core.UPDATE_WATERMARK);}
return;}}
if(poster_.isPremium){poster_.isPremium=false;this.sendNotification(postermywall.Core.UPDATE_WATERMARK);}}}}},{NAME:'WhiteboardProxy',MAX_GETTY_IMAGES_PER_POSTER:3,MAX_GETTY_VIDEOS_PER_POSTER:3});})();
puremvc.define({name:'postermywall.core.model.LayoutProxy',parent:postermywall.core.model.BaseProxy,constructor:function(){postermywall.core.model.BaseProxy.call(this);postermywall.core.model.LayoutProxy.onRegister();}},{},{NAME:'LayoutProxy',layouts_:{},onRegister:function(){this.registerLayout_(postermywall.core.model.LayoutProxy.TABLE_LAYOUT,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_TIME,postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.BAND_LAYOUT_LEFT_ALIGN,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.BAND_LAYOUT_RIGHT_ALIGN,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.BAND_LAYOUT_CENTER_ALIGN,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.SPORTS_LAYOUT,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_TIME,postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.STRAIGHT_SPORTS_LAYOUT,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_TIME,postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.OFFSET_SPORTS_LAYOUT,[postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE,postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.CUSTOM_TABLE_LAYOUT,[postermywall.core.model.vo.CellVO.CELL_TYPE_COLUMN1,postermywall.core.model.vo.CellVO.CELL_TYPE_COLUMN2,postermywall.core.model.vo.CellVO.CELL_TYPE_COLUMN3,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.MENU_LAYOUT_1,[postermywall.core.model.vo.CellVO.CELL_TYPE_NAME,postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION,postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE,postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS,postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE,postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.MENU_LAYOUT_2,[postermywall.core.model.vo.CellVO.CELL_TYPE_NAME,postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION,postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE,postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS,postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE,postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.MENU_LAYOUT_3,[postermywall.core.model.vo.CellVO.CELL_TYPE_NAME,postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION,postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE,postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS,postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE,postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.MENU_LAYOUT_4,[postermywall.core.model.vo.CellVO.CELL_TYPE_NAME,postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION,postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE,postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS,postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE,postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.MENU_LAYOUT_5,[postermywall.core.model.vo.CellVO.CELL_TYPE_NAME,postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION,postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE,postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS,postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE,postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);this.registerLayout_(postermywall.core.model.LayoutProxy.MENU_LAYOUT_6,[postermywall.core.model.vo.CellVO.CELL_TYPE_NAME,postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION,postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE,postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS,postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE,postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON,postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT]);},registerLayout_:function(layoutType,columns){this.layouts_[layoutType]={'columns':this.initializeColumns(columns),'helperClass':this.getLayoutHelperClass(layoutType)};},initializeColumns:function(columns){var a={};for(var i=0;i<columns.length;i++){a[columns[i]]=[]}
return a;},isSecondFontFamilyUsed:function(layout){if(typeof layout==='undefined'){return false;}
return(layout===postermywall.core.model.LayoutProxy.BAND_LAYOUT_LEFT_ALIGN||layout===postermywall.core.model.LayoutProxy.BAND_LAYOUT_RIGHT_ALIGN||layout===postermywall.core.model.LayoutProxy.BAND_LAYOUT_CENTER_ALIGN||layout===postermywall.core.model.LayoutProxy.MENU_LAYOUT_1||layout===postermywall.core.model.LayoutProxy.MENU_LAYOUT_2||layout===postermywall.core.model.LayoutProxy.MENU_LAYOUT_3||layout===postermywall.core.model.LayoutProxy.MENU_LAYOUT_4||layout===postermywall.core.model.LayoutProxy.MENU_LAYOUT_5||layout===postermywall.core.model.LayoutProxy.MENU_LAYOUT_6||layout===postermywall.core.model.LayoutProxy.OFFSET_SPORTS_LAYOUT)},isXSpacingAdjustable:function(layout){if(typeof layout==='undefined'){return false;}
return(layout!=postermywall.core.model.LayoutProxy.BAND_LAYOUT_LEFT_ALIGN||layout!=postermywall.core.model.LayoutProxy.BAND_LAYOUT_RIGHT_ALIGN||layout!=postermywall.core.model.LayoutProxy.BAND_LAYOUT_CENTER_ALIGN||layout!=postermywall.core.model.LayoutProxy.OFFSET_SPORTS_LAYOUT)},getColumnCountForLayout:function(layout){return(Object.keys(this.getColumnsForLayout(layout)).length-1);},getColumnsForLayout:function(layout){return this.layouts_[layout].columns},getLayoutHelper:function(layoutName){return this.layouts_[layoutName].helperClass},getLayoutHelperClass:function(layoutName){switch(layoutName){case postermywall.core.model.LayoutProxy.TABLE_LAYOUT:return new postermywall.core.view.fabricjs.TableLayout(false);case postermywall.core.model.LayoutProxy.BAND_LAYOUT_LEFT_ALIGN:return new postermywall.core.view.fabricjs.BandLayout(layoutName);case postermywall.core.model.LayoutProxy.BAND_LAYOUT_RIGHT_ALIGN:return new postermywall.core.view.fabricjs.BandLayout(layoutName);case postermywall.core.model.LayoutProxy.BAND_LAYOUT_CENTER_ALIGN:return new postermywall.core.view.fabricjs.BandLayout(layoutName);case postermywall.core.model.LayoutProxy.SPORTS_LAYOUT:return new postermywall.core.view.fabricjs.SportsLayout();case postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT:return new postermywall.core.view.fabricjs.SlantedSportsLayout(layoutName);case postermywall.core.model.LayoutProxy.STRAIGHT_SPORTS_LAYOUT:return new postermywall.core.view.fabricjs.SlantedSportsLayout(layoutName);case postermywall.core.model.LayoutProxy.OFFSET_SPORTS_LAYOUT:return new postermywall.core.view.fabricjs.OffsetSportsLayout();case postermywall.core.model.LayoutProxy.CUSTOM_TABLE_LAYOUT:return new postermywall.core.view.fabricjs.TableLayout(true);case postermywall.core.model.LayoutProxy.MENU_LAYOUT_1:return new postermywall.core.view.fabricjs.MenuLayout1();case postermywall.core.model.LayoutProxy.MENU_LAYOUT_2:return new postermywall.core.view.fabricjs.MenuLayout2();case postermywall.core.model.LayoutProxy.MENU_LAYOUT_3:return new postermywall.core.view.fabricjs.MenuLayout3();case postermywall.core.model.LayoutProxy.MENU_LAYOUT_4:return new postermywall.core.view.fabricjs.MenuLayout4();case postermywall.core.model.LayoutProxy.MENU_LAYOUT_5:return new postermywall.core.view.fabricjs.MenuLayout5();case postermywall.core.model.LayoutProxy.MENU_LAYOUT_6:return new postermywall.core.view.fabricjs.MenuLayout6();}
return new postermywall.core.view.fabricjs.TableLayout(false);},getSpacingValuesForMenuLayouts:function(layoutName){var x,y;switch(layoutName){case postermywall.core.model.LayoutProxy.MENU_LAYOUT_1:x=postermywall.core.model.LayoutProxy.xSpacingDefaultValue1;y=postermywall.core.model.LayoutProxy.ySpacingDefaultValue;break;case postermywall.core.model.LayoutProxy.MENU_LAYOUT_3:x=postermywall.core.model.LayoutProxy.xSpacingDefaultValue2;y=postermywall.core.model.LayoutProxy.ySpacingDefaultValue;break;case postermywall.core.model.LayoutProxy.MENU_LAYOUT_2:case postermywall.core.model.LayoutProxy.MENU_LAYOUT_4:case postermywall.core.model.LayoutProxy.MENU_LAYOUT_5:case postermywall.core.model.LayoutProxy.MENU_LAYOUT_6:x=postermywall.core.model.LayoutProxy.xSpacingDefaultValue3;y=postermywall.core.model.LayoutProxy.ySpacingDefaultValue;break;default:x=postermywall.core.model.LayoutProxy.xSpacingDefaultValue3;y=postermywall.core.model.LayoutProxy.ySpacingDefaultValue;}
return{x:x,y:y}},TABLE_LAYOUT:'layout-1',BAND_LAYOUT_LEFT_ALIGN:'layout-2',BAND_LAYOUT_RIGHT_ALIGN:'layout-6',BAND_LAYOUT_CENTER_ALIGN:'layout-7',SPORTS_LAYOUT:'layout-3',SLANTED_SPORTS_LAYOUT:'layout-4',STRAIGHT_SPORTS_LAYOUT:'layout-8',OFFSET_SPORTS_LAYOUT:'layout-9',CUSTOM_TABLE_LAYOUT:'custom-table',MENU_LAYOUT_1:'layout-10',MENU_LAYOUT_2:'layout-11',MENU_LAYOUT_3:'layout-12',MENU_LAYOUT_4:'layout-13',MENU_LAYOUT_5:'layout-14',MENU_LAYOUT_6:'layout-15',xSpacingDefaultValue1:250,xSpacingDefaultValue2:200,xSpacingDefaultValue3:100,ySpacingDefaultValue:40,defaultSpacingBetweenItems:5,});
(function(){PMW.initVideoItems=function(element){if(element){element.on("mouseenter mouseleave",'.play-on-hover-video .preview-container',onHoverVideoThumb.bind(this));}else{$(document).on("mouseenter mouseleave",'.play-on-hover-video .preview-container',onHoverVideoThumb.bind(this));}
function onHoverVideoThumb(e){var targetElement=$(e.target),videoItem=targetElement.closest('.play-on-hover-video');PMW.loadVideoItem(videoItem,e.type)}};PMW.loadVideoItem=function(videoItem,eventType){eventType=(typeof eventType==='undefined')?'':eventType;var videoElement=videoItem.find('video'),loadingElement=videoItem.find('.icon-circle-o-notch'),playIconElement=videoItem.find('.icon-play-circle-outline'),videoElementDom=videoElement.get(0);if(eventType==="mouseenter"){videoItem.attr('play-video','1');videoItem.attr('data-show-error-message','1');setTimeout(function(){if(videoItem.attr('play-video')==='1'){addAndPlayVideo();}},200);}else if(eventType==="mouseleave"){videoItem.attr('play-video','0');videoItem.attr('data-show-error-message','0');pauseVideo();hideVideoErrorMessage();}else if(eventType===''){addAndPlayVideo();}
function addAndPlayVideo(){if(videoItem.attr('data-preview-video-src')){if(videoElement.length===0){onShowLoading();var newVideoElement=document.createElement('video');newVideoElement.crossOrigin='anonymous';newVideoElement.onloadedmetadata=onVideoDataLoaded.bind(this);if(!videoItem.hasClass('disable-video-loop')){newVideoElement.loop=true;}
newVideoElement.addEventListener('abort',onVideoError.bind(this),false);newVideoElement.addEventListener('error',onVideoError.bind(this),false);newVideoElement.addEventListener('waiting',onShowLoading.bind(this),false);newVideoElement.addEventListener('playing',hideLoading.bind(this),false);newVideoElement.style.zIndex="3";newVideoElement.src=videoItem.attr('data-preview-video-src');videoItem.find('img').after(newVideoElement);videoElement=videoItem.find('video');videoElementDom=videoElement.get(0);videoItem.trigger('videoThumbnail:onVideoAdded');if(isMobileOS()&&videoItem.hasClass('screen-size-video')){showVideoPlayButton();}}else{playVideo();}}}
function onVideoDataLoaded(e){if(e&&e.target.duration<0.05){onVideoError();return;}
if(!(isMobileOS()&&videoItem.hasClass('screen-size-video'))){playVideo();}}
function playVideo(){videoElement.attr('data-can-pause','0');videoElementDom.play().then(function(){if(videoElement.attr('data-delayed-pause')==='1'){videoElement.attr('data-delayed-pause','0');videoElementDom.pause();}
videoElement.attr('data-can-pause','1');}).catch(function(error){console.log('Error playing video ',error);onVideoError();});}
function pauseVideo(){if(videoElement.attr('data-can-pause')==='1'){videoElementDom.pause();}else{videoElement.attr('data-delayed-pause','1');}
hideLoading();}
function showVideoPlayButton(){hideLoading();videoElement=videoItem.find('video');videoElement.hide();var playVideoElement="<div class='play-video-button'><img src='"+PMW.BASE_URL+"assets/images/play-video-button.png' alt='Play Video'/></div>";videoItem.find('img').after(playVideoElement);var playVideoButton=videoItem.find('.play-video-button');PMW.onClick(playVideoButton,null,onPlayVideoButton.bind(this,playVideoButton));}
function onPlayVideoButton(playVideoButton){videoElement.show();playVideoButton.hide();videoElementDom.play();}
function onVideoError(){hideLoading();var playVideoButton=videoItem.find('.play-video-button');if(playVideoButton.length>0){playVideoButton.hide();}
videoItem.find('video').remove();if(videoItem.attr('data-show-error-message')==='0'){videoItem.find('.video-not-available').hide();}
else if(videoItem.find('.video-not-available').length===0){var videoNotAvailableElement="<div class='video-not-available'>"+(videoItem.attr('data-video-load-error')?videoItem.attr('data-video-load-error'):'The video preview is not yet generated. Click to edit poster')+"</div>";videoItem.find('img').after(videoNotAvailableElement);}else{videoItem.find('.video-not-available').show();}}
function hideVideoErrorMessage(){videoItem.find('.video-not-available').hide();}
function onShowLoading(){loadingElement.removeClass('hidden');loadingElement.css('display','block');if(playIconElement.get(0)&&!playIconElement.hasClass('hidden')){playIconElement.addClass('hidden');}}
function hideLoading(){if(!loadingElement.hasClass('hidden')){loadingElement.addClass('hidden');loadingElement.css('display','none');}
if(playIconElement.get(0)){playIconElement.removeClass('hidden');}}
function isMobileOS(){return typeof(bowser.ios||bowser.android)!=='undefined';}};})();
(function(){var STRAIGHT_PATH_TENSION=0;var CURVE_PATH_TENSION=0.5;puremvc.define({name:'postermywall.core.library.SplinesLibrary',constructor:function(ctx,isStroke,isFill,isBuilder,isColorPop){if(typeof isColorPop=='undefined'){isColorPop=false;}
this.ctx_=ctx;this.isStroke_=isStroke;this.isFill_=isFill;this.isBuilder_=isBuilder;this.isColorPop_=isColorPop;}},{ctx_:null,isStroke_:false,isFill_:false,isBuilder_:false,isCurves_:true,isColorPop_:false,tensionForControlPoints_:CURVE_PATH_TENSION,drawSplines:function(pts,close,isCurved){this.isCurves_=isCurved;this.setTensionForControlPoints_();var cps=[];if(pts.length>=3){for(var i=0;i<pts.length-2;i++){cps=cps.concat(this.getControlPoints_(pts[i],pts[i+1],pts[i+2]));}}
this.drawCurvedOrStraightPaths_(cps,pts,close);},drawCurvedOrStraightPaths_:function(cps,pts,close){var pointsCount=pts.length;if(pointsCount<2)
return;this.ctx_.save();if(pointsCount==2){this.ctx_.beginPath();this.ctx_.moveTo(pts[0].x,pts[0].y);this.ctx_.lineTo(pts[1].x,pts[1].y);}
else{this.ctx_.beginPath();this.ctx_.moveTo(pts[0].x,pts[0].y);this.ctx_.quadraticCurveTo(cps[0].x,cps[0].y,pts[1].x,pts[1].y);for(var i=2;i<pointsCount-1;i+=1){this.ctx_.bezierCurveTo(cps[(2*(i-1)-1)].x,cps[(2*(i-1)-1)].y,cps[(2*(i-1))].x,cps[(2*(i-1))].y,pts[i].x,pts[i].y);}
this.ctx_.quadraticCurveTo(cps[(2*(i-1)-1)].x,cps[(2*(i-1)-1)].y,pts[i].x,pts[i].y);if(close){var cpts=this.getControlPoints_(pts[pts.length-1],pts[0],pts[1]);this.ctx_.quadraticCurveTo(cpts[0].x,cpts[0].y,pts[0].x,pts[0].y);}}
this.setStrokeOrFillStyle_();this.ctx_.restore();},setStrokeOrFillStyle_:function(){if(this.isColorPop_){return;}
if(this.isStroke_){if(!this.isBuilder_){this.ctx_.strokeStyle="#ffffff";this.ctx_.shadowBlur=1;this.ctx_.shadowColor="#000000";}
this.ctx_.stroke();}
else if(this.isFill_){this.ctx_.fillStyle=fabric.Color.fromSource([105,105,105,1]).toRgba();this.ctx_.fill();}},setTensionForControlPoints_:function(){if(!this.isCurves_){this.tensionForControlPoints_=STRAIGHT_PATH_TENSION;}
else{this.tensionForControlPoints_=CURVE_PATH_TENSION;}},getControlPoints_:function(p1,p2,p3){var v=this.va_(arguments,0,2),d01=this.calculateDistance_(arguments,0,1),d12=this.calculateDistance_(arguments,1,2),d012=d01+d12,cpt1={x:(p2.x-v.x*this.tensionForControlPoints_*d01/d012),y:(p2.y-v.y*this.tensionForControlPoints_*d01/d012)},cpt2={x:(p2.x+v.x*this.tensionForControlPoints_*d12/d012),y:(p2.y+v.y*this.tensionForControlPoints_*d12/d012)};return[cpt1,cpt2];},va_:function(array,i,j){return{x:(array[j].x-array[i].x),y:(array[j].y-array[i].y)}},calculateDistance_:function(array,i,j){return Math.sqrt(Math.pow(array[i].x-array[j].x,2)+Math.pow(array[i].y-array[j].y,2));}},{});})();
(function(){puremvc.define({name:'postermywall.core.library.TextLibrary',constructor:function(){}},{},{NAME:'TextLibrary',validateLineHeight:function(value){return value/113},validateText:function(text){return text.replace(/\r/g,"\n");},getFontFamilyString:function(fontFamily){return"'"+fontFamily+"'"},getTextStyles:function(model){var options={};options.text=model.text;options.fontFamily=this.getFontFamilyString(model.fontFamily);options.fontStyle=model.fontStyle;options.fontWeight=model.fontWeight;options.textAlign=model.textAlign;options.letterSpacing=model.letterSpacing;options.lineHeight=this.validateLineHeight(model.leading);if(model.backgroundType===1){options.backgroundColor=fabric.Color.fromSource(model.backgroundColor.concat([model.backgroundColorAlpha])).toRgba();}
else{options.backgroundColor=null;}
return options;}});})();
(function(){puremvc.define({name:'postermywall.core.library.DateLibrary',constructor:function(){}},{},{NAME:'DateLibrary',getFormattedDate:function(dateFormat,milliseconds){if(typeof milliseconds=='undefined'){milliseconds=new Date().getTime();}
var formattedDate='',dateObj=new Date(milliseconds),self=postermywall.core.library.DateLibrary,formats={d:function(){var day=formats.j();return(day<10)?'0'+day:day;},D:function(){return self.CALENDER_DATA.weekdays.shorthand[formats.w()];},j:function(){return dateObj.getUTCDate();},l:function(){return self.CALENDER_DATA.weekdays.longhand[formats.w()];},w:function(){return dateObj.getUTCDay();},F:function(){return self.monthToStr(formats.n()-1,false);},m:function(){var month=formats.n();return(month<10)?'0'+month:month;},M:function(){return self.monthToStr(formats.n()-1,true);},n:function(){return dateObj.getUTCMonth()+1;},U:function(){return dateObj.getTime()/1000;},y:function(){return String(formats.Y()).substring(2);},Y:function(){return dateObj.getUTCFullYear();}},formatPieces=dateFormat.split('');self.forEach(formatPieces,function(formatPiece,index){if(formats[formatPiece]&&formatPieces[index-1]!=='\\'){formattedDate+=formats[formatPiece]();}else{if(formatPiece!=='\\'){formattedDate+=formatPiece;}}});return formattedDate;},forEach:function(items,callBack){[].forEach.call(items,callBack);},monthToStr:function(date,shorthand){if(shorthand===true){return postermywall.core.library.DateLibrary.CALENDER_DATA.months.shorthand[date];}
return postermywall.core.library.DateLibrary.CALENDER_DATA.months.longhand[date];},CALENDER_DATA:{weekdays:{shorthand:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],longhand:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']},months:{shorthand:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],longhand:['January','February','March','April','May','June','July','August','September','October','November','December']},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0}});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.Layout',constructor:function(){}},{layoutType:'',edgePadding:10,doLayout:function(){},setItems:function(){},setStylesForHighlightedItems:function(){},getLayoutName:function(){return this.layoutType;},horizontallyStackItems:function(group,offset,padding){var items=group.getObjects(),newDim=this.getNewViewDimensions(group,'horizontal');group.set({width:newDim.width+(2*padding),height:newDim.height+(items.length-1)*offset+(2*padding)});for(var i=0;i<items.length;i++){if(i==0){items[i].set({left:-group.width/2+padding,top:-group.height/2+padding});}
else{items[i].set({left:items[i-1].left,top:items[i-1].top+items[i-1].height+offset});}}},horizontallyCenterItems:function(group){var items=group.getObjects();for(var i=0;i<items.length;i++){var newCoords=items[i].getCornerPoints({x:0,y:items[i].top});items[i].set({left:newCoords.tl.x})}},verticallyCenterItems:function(group){var items=group.getObjects();for(var i=0;i<items.length;i++){var newCoords=items[i].getCornerPoints({x:items[i].left,y:0});items[i].set({top:newCoords.tl.y})}},doRightAlign:function(group){var items=group.getObjects(),groupWidth=group.width,padding=this.edgePadding;for(var i=0;i<items.length;i++){items[i].set({left:(groupWidth/2-items[i].width-padding*0.5)});}},doLeftAlign:function(group){var items=group.getObjects(),groupWidth=group.width,padding=this.edgePadding;for(var i=0;i<items.length;i++){items[i].set({left:(-groupWidth/2+padding*0.5)});}},doBottomAlign:function(group){var items=group.getObjects(),groupHeight=group.height,padding=this.edgePadding;for(var i=0;i<items.length;i++){items[i].set({top:(groupHeight/2-items[i].height-padding*0.5)});}},verticallyStackItems:function(group,offset,padding){var items=group.getObjects(),newDim=this.getNewViewDimensions(group,'vertical');group.set({width:newDim.width+(items.length-1)*offset+(2*padding),height:newDim.height+(2*padding)});for(var i=0;i<items.length;i++){if(i==0){items[i].set({left:-group.width/2+padding,top:-group.height/2+padding});}
else{items[i].set({left:items[i-1].left+items[i-1].width*items[i-1].scaleX+offset,top:items[i-1].top});}}},getNewViewDimensions:function(group,val){var objects=group.getObjects(),minWidth=0,minHeight=0,w,h;switch(val){case'vertical':for(i=0;i<objects.length;i++){minWidth+=objects[i].width*objects[i].scaleX;h=objects[i].height*objects[i].scaleY;if(h>minHeight){minHeight=h;}}
break;case'horizontal':for(var i=0;i<objects.length;i++){minHeight+=objects[i].height*objects[i].scaleY;w=objects[i].width*objects[i].scaleX;if(w>minWidth){minWidth=w;}}
break;}
return{width:minWidth,height:minHeight}},getScaleForMenuIcon:function(icon,fontSize){return fontSize/Math.max(icon.width,icon.height);},emptyGroup:function(group){var objectsCount=group.getObjects().length;for(var i=0;i<objectsCount;i++){group.remove(group.getObjects()[0]);}},getWrappingInfo:function(){return null;},getWrapping:function(model,row){if(model.wrappingInfo!=null&&model.wrappingInfo.length>0){return model.wrappingInfo[row].join('\n');}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.StackLayout',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){}},{doLayout:function(view){var items=view.getObjects(),viewWidth=view.width,itemHeight=items[0]._getTextHeight(),numberOfItems=(items.length),emptySpace=viewWidth-(itemHeight*numberOfItems),offset=emptySpace/(numberOfItems);for(var i=0;i<numberOfItems;i++){if(i==0){items[i].set({left:-view.width/2+itemHeight+offset/2,top:-view.height/2+this.edgePadding})}
else{items[i].set({left:items[i-1].left+offset+itemHeight,top:-view.height/2+this.edgePadding})}}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.TableLayout',parent:postermywall.core.view.fabricjs.Layout,constructor:function(isCustomTable){this.layoutType=isCustomTable?postermywall.core.model.LayoutProxy.CUSTOM_TABLE_LAYOUT:postermywall.core.model.LayoutProxy.TABLE_LAYOUT;}},{view_:null,tableArray_:[],columns_:0,rows_:0,xOffset_:0,yOffset_:0,doLayout:function(view,model){this.view_=view;this.rows_=model.rows;this.columns_=model.columns;this.tableArray_=[[]];this.yOffset_=model.ySpacing;this.xOffset_=model.xSpacing;var items=this.view_.getObjects();for(var i=0;i<items.length;i++){if(typeof this.tableArray_[(items[i].column-1)]=='undefined'){this.tableArray_.push([]);}
this.tableArray_[(items[i].column-1)].push(items[i]);}
var minTableWidth=this.getMinimumTableWidth_(),minTableHeight=this.getMinimumTableHeight_();this.view_.set({width:minTableWidth+((this.columns_)*this.xOffset_),height:minTableHeight+((this.rows_)*this.yOffset_),tableArray:this.tableArray_,ySpacing:this.yOffset_,xSpacing:this.xOffset_});for(i=0;i<this.tableArray_.length;i++){var left=this.getLeftPositionForColumn_(i),column=this.tableArray_[i];for(var x=0;x<column.length;x++){column[x].set({left:left,top:-this.view_.height/2+this.yOffset_/2})}}
for(i=1;i<this.rows_;i++){for(x=0;x<this.columns_;x++){this.tableArray_[x][i].set({top:this.tableArray_[x][i-1].top+this.getHeightOfRow_(i-1)+this.yOffset_});}}
this.doAlignColumns_(model.textAlign);this.setStylesForHighlightedItems(model);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,columns=model.getColumns();for(var c=0;c<columns.length;c++){var column=data[columns[c]];for(var i=0;i<model.rows;i++){view.add(new fabric.IText(column[i].getValue(),{row:i+1,column:c+1,editable:false}));}}},setStylesForHighlightedItems:function(model){var highlightedRows=this.view_.highlightedRows;if(highlightedRows.length>0){for(var i=0;i<highlightedRows.length;i++){for(var x=0;x<this.columns_;x++){this.tableArray_[x][highlightedRows[i]].set({fill:fabric.Color.fromSource(model.highlightedTextColor.concat([1])).toRgb()})}}}},doAlignColumns_:function(val){if(val=='left'){return}
var currentColumnWidth,currentColumn,c,i;switch(val){case'center':for(c=0;c<this.columns_;c++){currentColumnWidth=this.getWidthOfColumn_(c);currentColumn=this.tableArray_[c];for(i=0;i<currentColumn.length;i++){currentColumn[i].set({left:currentColumn[i].left+(currentColumnWidth-currentColumn[i].width)/2});}}
break;case'right':for(c=0;c<this.columns_;c++){currentColumnWidth=this.getWidthOfColumn_(c);currentColumn=this.tableArray_[c];for(i=0;i<currentColumn.length;i++){currentColumn[i].set({left:currentColumn[i].left+currentColumnWidth-currentColumn[i].width});}}
break;case'justify':for(c=0;c<this.columns_;c++){currentColumnWidth=this.getWidthOfColumn_(c);currentColumn=this.tableArray_[c];for(i=0;i<currentColumn.length;i++){currentColumn[i].set({width:currentColumnWidth});}}
break;}},getHeightOfRow_:function(row){var height=0,h;for(var i=0;i<this.columns_;i++){h=this.tableArray_[i][row]._getTextHeight();if(h>height){height=h}}
return height;},getWidthOfColumn_:function(column){var width=0,w;for(var i=0;i<this.rows_;i++){w=this.tableArray_[column][i]._getTextWidth();if(w>width){width=w}}
return width;},getLeftPositionForColumn_:function(numColumn){if(numColumn==0){return-this.view_.width/2+this.xOffset_/2;}
else{return this.tableArray_[numColumn-1][0].left+this.getWidthOfColumn_(numColumn-1)+this.xOffset_}},getMinimumTableWidth_:function(){var minWidth=0;for(var i=0;i<this.tableArray_.length;i++){var maxTextWidth=0,w,currentColumn=this.tableArray_[i];for(var x=0;x<currentColumn.length;x++){w=currentColumn[x]._getTextWidth();if(w>maxTextWidth){maxTextWidth=w;}}
minWidth+=maxTextWidth;}
return minWidth;},getMinimumTableHeight_:function(){var minHeight=0;for(var i=0;i<this.rows_;i++){var maxTextHeight=0,h;for(var x=0;x<this.columns_;x++){h=this.tableArray_[x][i]._getTextHeight();if(h>maxTextHeight){maxTextHeight=h;}}
minHeight+=maxTextHeight;}
return minHeight;}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.BandLayout',parent:postermywall.core.view.fabricjs.Layout,constructor:function(alignment){this.layoutType=alignment?alignment:postermywall.core.model.LayoutProxy.BAND_LAYOUT_LEFT_ALIGN;}},{view_:null,doLayout:function(view,model){this.view_=view;this.setViewStyles_(model);this.layoutItemsInsideGroups_();this.horizontallyStackItems(this.view_,model.ySpacing,this.edgePadding);this.setGroupAlignment_(this.view_);this.setStylesForHighlightedItems(model);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,textItems=[],t='add text';for(var a=0;a<model.rows;a++){textItems=[];for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();textItems.push(new fabric.IText(t.toUpperCase(),{editable:false}))}}
view.add(new fabric.Group(textItems,{}));}},setStylesForHighlightedItems:function(model){var highlightedRows=this.view_.highlightedRows,objects=this.view_.getObjects(),color=fabric.Color.fromSource(model.highlightedTextColor.concat([1])).toRgba();if(highlightedRows.length>0){for(var i=0;i<highlightedRows.length;i++){var item=objects[highlightedRows[i]],obs=item.getObjects();for(var x=0;x<obs.length;x++){var opts={fill:color};if(x==1){opts.stroke=color}
obs[x].set(opts);}}}},setViewStyles_:function(model){var groups=this.view_.getObjects(),color=fabric.Color.fromSource(model.color.concat([1])).toRgba();for(var i=0;i<groups.length;i++){var groupItems=groups[i].getObjects();groupItems[1].set({fontSize:groupItems[1].fontSize*1.5,strokeWidth:1,strokeLineJoin:'round',stroke:color,fontFamily:model.fontFamily2,letterSpacing:model.letterSpacing});}},setGroupAlignment_:function(group){if(this.layoutType==postermywall.core.model.LayoutProxy.BAND_LAYOUT_CENTER_ALIGN){this.horizontallyCenterItems(group);}else if(this.layoutType==postermywall.core.model.LayoutProxy.BAND_LAYOUT_RIGHT_ALIGN){this.doRightAlign(group);}},layoutItemsInsideGroups_:function(){var groups=this.view_.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'horizontal');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});this.horizontallyStackItems(groups[i],0,0);this.setGroupAlignment_(groups[i]);}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.SportsLayout',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.SPORTS_LAYOUT;}},{view_:null,doLayout:function(view,model){this.view_=view;this.setViewStyles_(model);this.layoutItemsInsideGroups_(model);this.verticallyStackItems(this.view_,model.xSpacing,this.edgePadding);this.setStylesForHighlightedItems(model);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t='add text';var w=0,v=1.0;for(var a=0;a<model.rows;a++){var textItemsGroup=new fabric.Group([],{});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();if(data[p][a].type==postermywall.core.model.vo.CellVO.CELL_TYPE_DATE){var date=data[p][a].value,dateInfo=postermywall.core.library.DateLibrary.getFormattedDate('M d',date.timestamp).split(" ");textItemsGroup.insertAt(new fabric.IText(dateInfo[0].toUpperCase(),{dataType:postermywall.core.model.vo.CellVO.CELL_TYPE_MONTH,padding:w,_fontSizeMult:v,editable:false}),textItemsGroup.getObjects().length,false);textItemsGroup.insertAt(new fabric.IText(dateInfo[1],{dataType:postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,padding:w,_fontSizeMult:v,editable:false}),textItemsGroup.getObjects().length,false);}
else if(data[p][a].type==postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE){textItemsGroup.insertAt(new fabric.IText('- '+t+' -',{dataType:data[p][a].type,_fontSizeMult:v,editable:false}),textItemsGroup.getObjects().length,false);}
else if(data[p][a].type==postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM){textItemsGroup.insertAt(new fabric.IText(t,{dataType:data[p][a].type,_fontSizeMult:v,editable:false}),0,false);}}}
view.add(textItemsGroup);}},setStylesForHighlightedItems:function(model){var highlightedRows=this.view_.highlightedRows,objects=this.view_.getObjects(),color=fabric.Color.fromSource(model.highlightedTextColor.concat([1])).toRgba();if(highlightedRows.length>0){for(var i=0;i<highlightedRows.length;i++){var item=objects[highlightedRows[i]],obs=item.getObjects();for(var x=0;x<obs.length;x++){var opts={fill:color};if(obs[x].dataType==postermywall.core.model.vo.CellVO.CELL_TYPE_MONTH||obs[x].dataType==postermywall.core.model.vo.CellVO.CELL_TYPE_DATE){opts.stroke=color;}
obs[x].set(opts);}}}},setViewStyles_:function(model){this.view_.set({lineHeight:(model.leading-30)/113});var fontSize2=model.fontSize*2,fontSize3=model.fontSize*0.3,strokeColor=fabric.Color.fromSource(model.color.concat([1])).toRgba();if(fontSize3<8){fontSize3=8;}
var groups=this.view_.getObjects();for(var i=0;i<groups.length;i++){var groupItems=groups[i].getObjects();for(var x=0;x<groupItems.length;x++){switch(groupItems[x].dataType){case postermywall.core.model.vo.CellVO.CELL_TYPE_MONTH:groupItems[x].set({fontSize:model.fontSize,strokeWidth:1,strokeLineJoin:'round',stroke:strokeColor});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DATE:groupItems[x].set({fontSize:fontSize2,strokeWidth:2,strokeLineJoin:'round',stroke:strokeColor});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM:case postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE:groupItems[x].set({fontSize:fontSize3});break;}}}},layoutItemsInsideGroups_:function(model){var groups=this.view_.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'horizontal');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});this.horizontallyStackItems(groups[i],model.ySpacing,0);this.horizontallyCenterItems(groups[i]);}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.OffsetSportsLayout',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.OFFSET_SPORTS_LAYOUT;}},{view_:null,doLayout:function(view,model){this.view_=view;this.setViewStyles_(model);this.layoutItemsInsideGroups_(model);this.horizontallyStackItems(this.view_,model.ySpacing,this.edgePadding);this.setStylesForHighlightedItems(model);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,textItems=[],t='add text';for(var a=0;a<model.rows;a++){textItems=[];for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();textItems.push(new fabric.IText(t.toUpperCase(),{editable:false}))}}
view.add(new fabric.Group(textItems,{}));}},setStylesForHighlightedItems:function(model){var highlightedRows=this.view_.highlightedRows,objects=this.view_.getObjects(),color=fabric.Color.fromSource(model.highlightedTextColor.concat([1])).toRgba();if(highlightedRows.length>0){for(var i=0;i<highlightedRows.length;i++){var item=objects[highlightedRows[i]],obs=item.getObjects();for(var x=0;x<obs.length;x++){var opts={fill:color};if(x==1){opts.stroke=color;}
obs[x].set(opts);}}}},setViewStyles_:function(model){var groups=this.view_.getObjects(),color=fabric.Color.fromSource(model.color.concat([1])).toRgba();for(var i=0;i<groups.length;i++){var groupItems=groups[i].getObjects();groupItems[1].set({fontSize:groupItems[1].fontSize*1.5,strokeWidth:2,strokeLineJoin:'round',fontFamily:model.fontFamily2,stroke:color});groupItems[0].set({width:groupItems[0].width+groupItems[0].fontSize*1.5});groupItems[2].set({width:groupItems[2].width+groupItems[2].fontSize*1.5});}},layoutItemsInsideGroups_:function(){var groups=this.view_.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'horizontal');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});var items=groups[i].getObjects();this.horizontallyStackItems(groups[i],0,0);for(var j=0;j<items.length;j++){if(j!=1){items[j].set({left:items[j].left+items[j].fontSize})}}}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.SlantedSportsLayout',parent:postermywall.core.view.fabricjs.Layout,constructor:function(layout){this.layoutType=layout?layout:postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT;}},{view_:null,doLayout:function(view,model){this.view_=view;this.setViewStyles_(model);this.layoutItemsInsideGroups_(model);this.horizontallyStackItems(this.view_,model.ySpacing,15);this.setStylesForHighlightedItems(model);if(this.layoutType==postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT){this.leanItemsInsideView_(model);}},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,textItems=[],t='add text';var w=0,v=1.0;for(var a=0;a<model.rows;a++){textItems=[];var venueAndTeamGroup=[];for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();if(data[p][a].type==postermywall.core.model.vo.CellVO.CELL_TYPE_DATE){var date=data[p][a].value,dateInfo=postermywall.core.library.DateLibrary.getFormattedDate('M d',date.timestamp).split(" "),dateBox=[];dateBox.push(new fabric.IText(dateInfo[1],{dataType:postermywall.core.model.vo.CellVO.CELL_TYPE_DATE,padding:w,_fontSizeMult:v,editable:false}));dateBox.push(new fabric.IText(dateInfo[0].toUpperCase(),{dataType:postermywall.core.model.vo.CellVO.CELL_TYPE_MONTH,padding:w,_fontSizeMult:v,editable:false}));textItems.push(new fabric.Group(dateBox,{}));}
else if(data[p][a].type==postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE){venueAndTeamGroup.push(new fabric.IText((t+' | '+data['time'][a].getValue()).toUpperCase(),{dataType:data[p][a].type,_fontSizeMult:v,editable:false}))}
else if(data[p][a].type==postermywall.core.model.vo.CellVO.CELL_TYPE_TIME){}
else{venueAndTeamGroup.push(new fabric.IText(t.toUpperCase(),{dataType:data[p][a].type,_fontSizeMult:v,editable:false}))}}}
textItems.push(new fabric.Group(venueAndTeamGroup,{}));view.add(new fabric.Group(textItems,{}));}},setStylesForHighlightedItems:function(model){var highlightedRows=this.view_.highlightedRows,objects=this.view_.getObjects(),done=0,textColo1=fabric.Color.fromSource(model.highlightedBackgroundColor.concat([1])).toRgba(),textColor2=fabric.Color.fromSource(model.highlightedTextColor.concat([1])).toRgba(),backgroundColor1=fabric.Color.fromSource(model.highlightedTextColor.concat([model.highlightedBackgroundColorAlpha])).toRgba(),backgroundColor2=fabric.Color.fromSource(model.highlightedBackgroundColor.concat([model.highlightedBackgroundColorAlpha])).toRgba();for(var i=0;i<objects.length;i++){var item=objects[i],itemsInside=item.getObjects(),textItems=itemsInside[0].getObjects(),backGroundColor,textColor;if($.inArray(i,highlightedRows,done)!=-1){textColor=textColo1;backGroundColor=backgroundColor1;done++;}
else{backGroundColor=backgroundColor2;textColor=textColor2;}
itemsInside[0].set({leanBackground:this.layoutType==postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT,leanBackgroundOffset:model.fontSize,backgroundColor:backGroundColor});for(var x=0;x<textItems.length;x++){textItems[x].set({fill:textColor,stroke:textColor});}}},setViewStyles_:function(model){this.view_.set({lineHeight:(model.leading-30)/113});var groups=this.view_.getObjects();for(var i=0;i<groups.length;i++){var groupItems=groups[i].getObjects();for(var i2=0;i2<groupItems.length;i2++){var items=groupItems[i2].getObjects();for(var x=0;x<items.length;x++){switch(items[x].dataType){case postermywall.core.model.vo.CellVO.CELL_TYPE_MONTH:items[x].set({fontSize:model.fontSize*0.75,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba(),});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DATE:items[x].set({fontSize:model.fontSize*2,strokeWidth:2,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba(),});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_TEAM:items[x].set({fontSize:model.fontSize*1.25,});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_VENUE:items[x].set({fontSize:model.fontSize*0.75,});break;}}}}},layoutItemsInsideGroups_:function(model){var groups=this.view_.getObjects(),dateItems=[];for(var i=0;i<groups.length;i++){var items=groups[i].getObjects();this.horizontallyStackItems(items[0],model.fontSize*0.5,model.fontSize*0.6);this.horizontallyCenterItems(items[0]);this.horizontallyStackItems(items[1],model.fontSize*0.5,0);dateItems.push(items[0]);}
var boxDimensions=this.getNewViewDimensions(new fabric.Group(dateItems,{}),'horizontal');for(var a=0;a<groups.length;a++){dateItems[a].set({width:boxDimensions.width});this.verticallyStackItems(groups[a],model.xSpacing,0);this.verticallyCenterItems(groups[a]);}},leanItemsInsideView_:function(model){var objects=this.view_.getObjects(),newViewDim=this.view_.width+model.fontSize/2*(objects.length-1)+2*this.edgePadding;this.view_.set({width:newViewDim});for(var i=(objects.length-1);i>=0;i--){if(i==(objects.length-1)){objects[i].set({left:-this.view_.width/2+this.edgePadding+model.fontSize/2})}
else{objects[i].set({left:objects[i+1].left+model.fontSize/2})}}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.MenuLayout1',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.MENU_LAYOUT_1;}},{doLayout:function(view,model){this.setViewStyles_(model,view);this.layoutItemsInsideGroups_(view);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);this.horizontallyCenterItems(view);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t;for(var a=0;a<model.rows;a++){var priceGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE}),finalGroup=new fabric.Group([],{}),iconsGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS}),addOnsGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();switch(p){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:finalGroup.insertAt(new fabric.IText(t,{editable:false,itemType:p}),finalGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:if(t.length>0){if(postermywall.Core.isHighRes()){t=this.getWrapping(model,a);}
finalGroup.insertAt(new fabric.Textbox(t,{editable:false,itemType:p}),finalGroup.getObjects().length,false);}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup.insertAt(new fabric.IText(t,{editable:false}),priceGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:for(var z=0;z<t.length;z++){var icon=postermywall.core.view.GraphicItemMenuMediator.getIconSvg(t[z]);if(icon){var scale=this.getScaleForMenuIcon(icon,model.iconsSize);icon.set({scaleX:scale,scaleY:scale});iconsGroup.insertAt(icon,iconsGroup.getObjects().length,false)}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE:if(t.length>0){priceGroup.remove(priceGroup.getObjects()[priceGroup.getObjects().length-1]);for(var i=0;i<t.length;i++){priceGroup.insertAt(new fabric.IText(t[i].name+' '+t[i].price,{editable:false}),priceGroup.getObjects().length,false);}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON:if(t.length>0){for(var i=0;i<t.length;i++){addOnsGroup.add(new fabric.IText(t[i].name+' '+t[i].price,{editable:false}));}}
break;}}}
finalGroup.add(priceGroup);if(addOnsGroup.getObjects().length>0){finalGroup.add(addOnsGroup);}
if(iconsGroup.getObjects().length>0){finalGroup.add(iconsGroup);}
view.add(finalGroup);}},setViewStyles_:function(model,view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var groupItems=groups[i].getObjects(),itemName=null,itemDescription=null,priceGroup=null,iconsGroup=null,addOnsGroup=null;for(var b=0;b<groupItems.length;b++){switch(groupItems[b].itemType){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:itemName=groupItems[b];itemName.set({fontSize:model.fontSize*1.3,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:itemDescription=groupItems[b];itemDescription.set({textAlign:'center',width:postermywall.core.view.fabricjs.MenuLayout1.MIN_WIDTH_FOR_DESCRIPTION+(model.xSpacing),fontFamily:"'"+model.fontFamily2+"'"});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup=groupItems[b];priceGroup.getObjects().forEach(function(obj){obj.set({fontSize:model.fontSize*1.1,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()})});this.verticallyStackItems(priceGroup,15,0);this.verticallyCenterItems(priceGroup);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:iconsGroup=groupItems[b];this.verticallyStackItems(iconsGroup,15,0);this.verticallyCenterItems(iconsGroup);iconsGroup.set({fill:fabric.Color.fromSource(model.iconsColor.concat([model.alpha])).toRgba()});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON:addOnsGroup=groupItems[b];addOnsGroup.set({fontFamily:"'"+model.fontFamily2+"'"});this.verticallyStackItems(addOnsGroup,15,0);this.verticallyCenterItems(addOnsGroup);break;default:}}}},layoutItemsInsideGroups_:function(view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'horizontal');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});this.horizontallyStackItems(groups[i],3,0);this.horizontallyCenterItems(groups[i]);}},getWrappingInfo:function(view){var menuItems=view.getObjects(),wrappingData=[];for(var i=0;i<menuItems.length;i++){var items=menuItems[i].getObjects();if(items[1].type=='textbox'){wrappingData.push(items[1]._textLines);}
else{wrappingData.push('');}}
return wrappingData;}},{MIN_WIDTH_FOR_DESCRIPTION:250});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.MenuLayout2',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.MENU_LAYOUT_2;}},{doLayout:function(view,model){this.setViewStyles_(model,view);this.layoutItemsInsideGroups_(view);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);if(!postermywall.Core.isHighRes()){this.setExtraStyles(model,view);this.layoutItemsInsideGroups_(view);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);}},setExtraStyles:function(model,view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndDescriptionGroup=menuItems[0],nameAndDescriptionItems=nameAndDescriptionGroup.getObjects(),descriptionAndPrice=nameAndDescriptionItems[1],sizesGroup=menuItems[1],priceItemWidth=(sizesGroup.getObjects().length==0)?descriptionAndPrice.getObjects()[1].width:sizesGroup.width,descriptionItem=descriptionAndPrice.getObjects()[0];descriptionItem.set({width:view.width+(model.xSpacing)-priceItemWidth});var textLines=descriptionItem._textLines,dummyText=new fabric.IText(textLines[textLines.length-1],{editable:false,fontSize:descriptionItem.fontSize,fontFamily:descriptionItem.fontFamily,letterSpacing:model.letterSpacing});var newText=descriptionItem.text;while(dummyText.width<descriptionItem.width-this.edgePadding){var nt=dummyText.text+'.';newText+='.';dummyText.set({text:nt})}
descriptionItem.set({text:newText});this.verticallyStackItems(descriptionAndPrice,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.doBottomAlign(descriptionAndPrice);this.horizontallyStackItems(nameAndDescriptionGroup,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);}},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t='add text';for(var a=0;a<model.rows;a++){var nameAndIcons=new fabric.Group([],{}),descriptionAndPrice=new fabric.Group([],{}),addOnsGroup=new fabric.Group([],{}),sizesGroup=new fabric.Group([],{});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();switch(p){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:nameAndIcons.insertAt(new fabric.IText(t.toUpperCase(),{editable:false}),nameAndIcons.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:var tb;if(postermywall.Core.isHighRes()){t=this.getWrapping(model,a);tb=new fabric.IText(t,{editable:false});}
else{tb=new fabric.Textbox(t,{editable:false});}
descriptionAndPrice.insertAt(tb,descriptionAndPrice.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:descriptionAndPrice.insertAt(new fabric.IText(t.toUpperCase(),{editable:false}),descriptionAndPrice.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:for(var z=0;z<t.length;z++){var icon=postermywall.core.view.GraphicItemMenuMediator.getIconSvg(t[z]);if(icon){var scale=this.getScaleForMenuIcon(icon,model.iconsSize);icon.set({scaleX:scale,scaleY:scale});nameAndIcons.insertAt(icon,nameAndIcons.getObjects().length,false)}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE:if(t.length>0){descriptionAndPrice.remove(descriptionAndPrice.getObjects()[descriptionAndPrice.getObjects().length-1]);for(var i=0;i<t.length;i++){var g=[];g.push(new fabric.IText(t[i].name,{editable:false}));g.push(new fabric.IText(t[i].price,{editable:false}));sizesGroup.insertAt(new fabric.Group(g,{}),sizesGroup.getObjects().length,false);}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON:if(t.length>0){for(var i=0;i<t.length;i++){addOnsGroup.insertAt(new fabric.IText(t[i].name+' '+t[i].price,{editable:false}),addOnsGroup.getObjects().length,false);}}
break;}}}
var verticalGroup=new fabric.Group([nameAndIcons,descriptionAndPrice],{}),HorizontalGroup=[verticalGroup];if(sizesGroup.getObjects.length>0){HorizontalGroup.push(sizesGroup)}
if(addOnsGroup.getObjects().length>0){verticalGroup.add(addOnsGroup)}
view.add(new fabric.Group(HorizontalGroup,{}));}},setViewStyles_:function(model,view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndDescriptionGroup=menuItems[0],nameAndDescriptionItems=nameAndDescriptionGroup.getObjects(),nameAndIcon=nameAndDescriptionItems[0],descriptionAndPrice=nameAndDescriptionItems[1],sizesGroup=null,addOnGroup=nameAndDescriptionItems[2];if(typeof menuItems[1]!='undefined'){sizesGroup=menuItems[1];}
nameAndIcon.getObjects()[0].set({fontSize:model.fontSize*1.3,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()});var icons=nameAndIcon.getObjects();for(var j=1;j<icons.length;j++){icons[j].set({fill:fabric.Color.fromSource(model.iconsColor.concat([model.alpha])).toRgba()})}
descriptionAndPrice.getObjects()[0].set({fontFamily:"'"+model.fontFamily2+"'"});if(sizesGroup.getObjects().length>0){var sizeGroupStyle={strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()};var szs=sizesGroup.getObjects();for(var t=0;t<szs.length;t++){szs[t].getObjects()[0].set(sizeGroupStyle);szs[t].getObjects()[1].set(sizeGroupStyle);}}
else{descriptionAndPrice.getObjects()[descriptionAndPrice.getObjects().length-1].set({strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()});}
this.verticallyStackItems(nameAndIcon,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyCenterItems(nameAndIcon);this.verticallyStackItems(descriptionAndPrice,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.horizontallyStackItems(nameAndDescriptionGroup,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);if(sizesGroup!=null){var sizes=sizesGroup.getObjects();for(var a=0;a<sizes.length;a++){this.horizontallyStackItems(sizes[a],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.horizontallyCenterItems(sizes[a]);}
this.verticallyStackItems(sizesGroup,10,0);}
if(addOnGroup){addOnGroup.set({fontFamily:"'"+model.fontFamily2+"'"});this.verticallyStackItems(addOnGroup,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyCenterItems(addOnGroup);}
this.horizontallyStackItems(nameAndDescriptionGroup,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.doBottomAlign(descriptionAndPrice);}},layoutItemsInsideGroups_:function(view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'vertical');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});this.verticallyStackItems(groups[i],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.doBottomAlign(groups[i]);}},getWrappingInfo:function(view){var groups=view.getObjects(),wrappingData=[];for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),description=menuItems[0].getObjects()[1].getObjects()[0];if(description.type=='textbox'){wrappingData.push(description._textLines);}
else{wrappingData.push('');}}
return wrappingData;}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.MenuLayout3',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.MENU_LAYOUT_3;}},{doLayout:function(view,model){this.setViewStyles_(view,model);this.layoutItemsInsideGroups_(view,this.edgePadding/2);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);this.setExtraStyles(view,model);this.layoutItemsInsideGroups_(view,this.edgePadding/2);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);},setExtraStyles:function(view,model){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndIcon=menuItems[0],price=menuItems[1];var dottedText=new fabric.IText('.',{fill:nameAndIcon.fill,fontSize:nameAndIcon.fontSize,editable:false});while(dottedText.width<((view.width+(model.xSpacing))-(nameAndIcon.width+price.width))){var newText=dottedText.text+'.';dottedText.set({text:newText})}
groups[i].insertAt(dottedText,1,false);}},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t='add text';for(var a=0;a<model.rows;a++){var nameAndIcons=new fabric.Group([],{}),priceGroup=new fabric.Group([],{});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();switch(p){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:nameAndIcons.insertAt(new fabric.IText(t,{editable:false}),nameAndIcons.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup.insertAt(new fabric.IText(t,{editable:false}),priceGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:for(var z=0;z<t.length;z++){var icon=postermywall.core.view.GraphicItemMenuMediator.getIconSvg(t[z]);if(icon){var scale=this.getScaleForMenuIcon(icon,model.iconsSize);icon.set({scaleX:scale,scaleY:scale});nameAndIcons.insertAt(icon,nameAndIcons.getObjects().length,false)}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE:if(t.length>0){this.emptyGroup(priceGroup);for(var i=0;i<t.length;i++){var g=[];g.push(new fabric.IText(t[i].name,{editable:false}));g.push(new fabric.IText(t[i].price,{editable:false}));priceGroup.insertAt(new fabric.Group(g,{}),0,false);}}
break;}}}
view.add(new fabric.Group([nameAndIcons,priceGroup],{}));}},setViewStyles_:function(view,model){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndIcon=menuItems[0],price=menuItems[1];nameAndIcon.getObjects()[0].set({fontSize:model.fontSize});var icons=nameAndIcon.getObjects();for(var j=1;j<icons.length;j++){icons[j].set({fill:fabric.Color.fromSource(model.iconsColor.concat([model.alpha])).toRgba()})}
price.set({fontFamily:"'"+model.fontFamily2+"'"});var priceObjects=price.getObjects();for(var a=0;a<priceObjects.length;a++){if(priceObjects[a].type=='group'){this.horizontallyStackItems(priceObjects[a],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.horizontallyCenterItems(priceObjects[a]);}}
this.verticallyStackItems(nameAndIcon,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyCenterItems(nameAndIcon);this.verticallyStackItems(price,10,0);}},layoutItemsInsideGroups_:function(view,xSpacing){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'vertical');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});this.verticallyStackItems(groups[i],xSpacing,0);}}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.MenuLayout4',parent:postermywall.core.view.fabricjs.MenuLayout3,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.MENU_LAYOUT_4;}},{doLayout:function(view,model){this.setViewStyles_(view,model);this.setExtraStyles(view,model);this.layoutItemsInsideGroups_(view,this.edgePadding*2);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);view.set({ySpacing:model.ySpacing,xSpacing:model.xSpacing})},setViewStyles_:function(view,model){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndDescription=menuItems[0],nameAndIcon=menuItems[0].getObjects()[0],price=menuItems[1];nameAndIcon.getObjects()[0].set({fontSize:model.fontSize});var icons=nameAndIcon.getObjects();for(var j=1;j<icons.length;j++){icons[j].set({fill:fabric.Color.fromSource(model.iconsColor.concat([model.alpha])).toRgba()})}
nameAndIcon.getObjects()[0].set({fontSize:model.fontSize*1.3,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()});price.set({fontFamily:"'"+model.fontFamily2+"'",fontSize:model.fontSize*1.2});var priceObjects=price.getObjects();for(var a=0;a<priceObjects.length;a++){if(priceObjects[a].type=='group'){this.horizontallyStackItems(priceObjects[a],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.horizontallyCenterItems(priceObjects[a]);}}
this.verticallyStackItems(nameAndIcon,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyCenterItems(nameAndIcon);this.verticallyStackItems(price,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems*2,0);this.horizontallyStackItems(nameAndDescription,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);}},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t='add text';for(var a=0;a<model.rows;a++){var nameAndDescription=new fabric.Group([],{backgroundColor:fabric.Color.fromSource([150,152,256,0]).toRgba()}),nameAndIcons=new fabric.Group([],{backgroundColor:fabric.Color.fromSource([74,252,289,0]).toRgba()}),priceGroup=new fabric.Group([],{backgroundColor:fabric.Color.fromSource([65,250,82,0]).toRgba()});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();switch(p){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:nameAndIcons.insertAt(new fabric.IText(t,{editable:false}),nameAndIcons.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:if(t.length>0){if(postermywall.Core.isHighRes()){t=this.getWrapping(model,a);}
nameAndDescription.insertAt(new fabric.Textbox(t,{editable:false}),nameAndDescription.getObjects().length,false);}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup.insertAt(new fabric.IText(t,{editable:false}),priceGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:for(var z=0;z<t.length;z++){var icon=postermywall.core.view.GraphicItemMenuMediator.getIconSvg(t[z]);if(icon){var scale=this.getScaleForMenuIcon(icon,model.iconsSize);icon.set({scaleX:scale,scaleY:scale});nameAndIcons.insertAt(icon,nameAndIcons.getObjects().length,false)}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE:if(t.length>0){this.emptyGroup(priceGroup);for(var i=0;i<t.length;i++){var g=[];g.push(new fabric.IText(t[i].name,{editable:false}));g.push(new fabric.IText(t[i].price,{editable:false}));priceGroup.insertAt(new fabric.Group(g,{}),0,false);}}
break;}}}
nameAndDescription.insertAt(nameAndIcons,0,false);view.add(new fabric.Group([nameAndDescription,priceGroup],{backgroundColor:fabric.Color.fromSource([250,25,100,0]).toRgba()}));}},setExtraStyles:function(view,model){var groups=view.getObjects(),maxWidth=0;for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndDescription=menuItems[0],nameAndIcon=menuItems[0].getObjects()[0],price=menuItems[1];if(nameAndDescription.width>maxWidth){maxWidth=nameAndDescription.width;}}
for(i=0;i<groups.length;i++){menuItems=groups[i].getObjects(),nameAndDescription=menuItems[0],nameAndIcon=menuItems[0].getObjects()[0],price=menuItems[1];nameAndDescription.set({width:maxWidth});this.doLeftAlign(nameAndDescription);var description=nameAndDescription.getObjects()[1];if(description){description.set({width:maxWidth+model.xSpacing});this.horizontallyStackItems(nameAndDescription,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);}
else{nameAndDescription.set({width:maxWidth+model.xSpacing});this.doLeftAlign(nameAndDescription);}
price.set({left:nameAndDescription.left+view.width-price.width-this.edgePadding*2});}},getWrappingInfo:function(view){var groups=view.getObjects(),wrappingData=[];for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),description=menuItems[0].getObjects()[1];if(description){if(description.type=='textbox'){wrappingData.push(description._textLines);}
else{wrappingData.push('');}}
else{wrappingData.push('')}}
return wrappingData;}},{});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.MenuLayout5',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.MENU_LAYOUT_5;}},{view_:null,doLayout:function(view,model){this.setViewStyles_(view,model);this.layoutItemsInsideGroups_(view);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);this.makePriceRightAlign(view);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t;for(var a=0;a<model.rows;a++){var priceGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE}),nameAndIconsGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_NAME}),finalGroup=new fabric.Group([],{}),iconsGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS}),addOnsGroup=new fabric.Group([],{itemType:postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();switch(p){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:nameAndIconsGroup.insertAt(new fabric.IText(t,{editable:false,itemType:p}),nameAndIconsGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:if(t.length>0){if(postermywall.Core.isHighRes()){t=this.getWrapping(model,a);}
finalGroup.insertAt(new fabric.Textbox(t,{editable:false,itemType:p}),finalGroup.getObjects().length,false);}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup.insertAt(new fabric.IText(t,{editable:false}),priceGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:for(var z=0;z<t.length;z++){var icon=postermywall.core.view.GraphicItemMenuMediator.getIconSvg(t[z]);if(icon){var scale=this.getScaleForMenuIcon(icon,model.iconsSize);icon.set({scaleX:scale,scaleY:scale});nameAndIconsGroup.insertAt(icon,nameAndIconsGroup.getObjects().length,false)}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE:if(t.length>0){priceGroup.remove(priceGroup.getObjects()[priceGroup.getObjects().length-1]);for(var i=0;i<t.length;i++){priceGroup.insertAt(new fabric.IText(t[i].name+' '+t[i].price,{editable:false}),priceGroup.getObjects().length,false);}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON:if(t.length>0){for(var i=0;i<t.length;i++){addOnsGroup.add(new fabric.IText(t[i].name+' '+t[i].price,{editable:false}));}}
break;}}}
finalGroup.insertAt(nameAndIconsGroup,0,false);finalGroup.add(priceGroup);if(addOnsGroup.getObjects().length>0){var obs=finalGroup.getObjects();if(obs[1].itemType&&obs[1].itemType==postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION){finalGroup.insertAt(addOnsGroup,2,false);}
else{finalGroup.insertAt(addOnsGroup,1,false);}}
if(iconsGroup.getObjects().length>0){finalGroup.add(iconsGroup);}
view.add(finalGroup);}},setViewStyles_:function(view,model){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var groupItems=groups[i].getObjects(),itemName=null,itemDescription=null,priceGroup=null,addOnsGroup=null;for(var b=0;b<groupItems.length;b++){switch(groupItems[b].itemType){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:itemName=groupItems[b].getObjects()[0];itemName.set({fontSize:model.fontSize*1.1,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()});var icons=groupItems[b].getObjects();for(var j=1;j<icons.length;j++){icons[j].set({fill:fabric.Color.fromSource(model.iconsColor.concat([model.alpha])).toRgba()})}
this.verticallyStackItems(groupItems[b],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyCenterItems(groupItems[b]);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:itemDescription=groupItems[b];itemDescription.set({width:postermywall.core.view.fabricjs.MenuLayout5.MIN_WIDTH_FOR_DESCRIPTION+(model.xSpacing),fontFamily:"'"+model.fontFamily2+"'"});break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup=groupItems[b];priceGroup.getObjects().forEach(function(obj){obj.set({fontSize:model.fontSize*1.5,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()})});this.verticallyStackItems(priceGroup,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems*3,0);this.verticallyCenterItems(priceGroup);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON:addOnsGroup=groupItems[b];this.verticallyStackItems(addOnsGroup,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems*3,0);this.verticallyCenterItems(addOnsGroup);break;default:}}}},layoutItemsInsideGroups_:function(view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){this.horizontallyStackItems(groups[i],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);}},getWrappingInfo:function(view){var menuItems=view.getObjects(),wrappingData=[];for(var i=0;i<menuItems.length;i++){var items=menuItems[i].getObjects();if(items[1].type=='textbox'){wrappingData.push(items[1]._textLines);}
else{wrappingData.push('');}}
return wrappingData;},makePriceRightAlign:function(view){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var item=groups[i].getObjects()[groups[i].getObjects().length-1];item.set({left:(item.left+view.width-item.width-this.edgePadding*2)});}}},{MIN_WIDTH_FOR_DESCRIPTION:250});})();
(function(){puremvc.define({name:'postermywall.core.view.fabricjs.MenuLayout6',parent:postermywall.core.view.fabricjs.Layout,constructor:function(){this.layoutType=postermywall.core.model.LayoutProxy.MENU_LAYOUT_6;}},{doLayout:function(view,model){this.setViewStyles_(view,model);this.layoutItemsInsideGroups_(view,this.edgePadding/2);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);this.setExtraStyles(view,model);this.layoutItemsInsideGroups_(view,this.edgePadding/2);this.horizontallyStackItems(view,model.ySpacing,this.edgePadding);},setItems:function(view,model){view._objects.length=0;var data=model.layoutDataMap,t='add text';for(var a=0;a<model.rows;a++){var nameAndIcons=new fabric.Group([],{}),description,priceGroup=new fabric.Group([],{}),addOnsGroup=new fabric.Group([],{});for(var p in data){if(data.hasOwnProperty(p)&&p!=postermywall.core.model.vo.CellVO.CELL_TYPE_HIGHLIGHT){t=data[p][a].getValue();switch(p){case postermywall.core.model.vo.CellVO.CELL_TYPE_NAME:nameAndIcons.insertAt(new fabric.IText(t,{editable:false}),nameAndIcons.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_DESCRIPTION:if(t.length>0){if(postermywall.Core.isHighRes()){t=this.getWrapping(model,a);}
description=new fabric.Textbox(t,{editable:false});}
else{description=new fabric.Group([],{});}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_PRICE:priceGroup.insertAt(new fabric.IText(t,{editable:false}),priceGroup.getObjects().length,false);break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ICONS:for(var z=0;z<t.length;z++){var icon=postermywall.core.view.GraphicItemMenuMediator.getIconSvg(t[z]);if(icon){var scale=this.getScaleForMenuIcon(icon,model.iconsSize);icon.set({scaleX:scale,scaleY:scale});nameAndIcons.insertAt(icon,nameAndIcons.getObjects().length,false)}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_SIZE:if(t.length>0){this.emptyGroup(priceGroup);for(var i=0;i<t.length;i++){var g=[];g.push(new fabric.IText(t[i].name,{editable:false}));g.push(new fabric.IText(t[i].price,{editable:false}));priceGroup.insertAt(new fabric.Group(g,{}),0,false);}}
break;case postermywall.core.model.vo.CellVO.CELL_TYPE_ADDON:if(t.length>0){for(var i=0;i<t.length;i++){addOnsGroup.insertAt(new fabric.IText(t[i].name+' '+t[i].price,{editable:false}),addOnsGroup.getObjects().length,false);}}
break;}}}
var nameAndPrice=new fabric.Group([nameAndIcons,priceGroup],{}),final=new fabric.Group([nameAndPrice,description,addOnsGroup],{});view.add(final);}},setViewStyles_:function(view,model){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndPriceGroup=menuItems[0].getObjects(),nameAndIcon=nameAndPriceGroup[0],price=nameAndPriceGroup[1],description=menuItems[1],addOns=menuItems[2];nameAndIcon.getObjects()[0].set({fontSize:model.fontSize*1.2,strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()});description.set('fontFamily',model.fontFamily2);var icons=nameAndIcon.getObjects();for(var j=1;j<icons.length;j++){icons[j].set({fill:fabric.Color.fromSource(model.iconsColor.concat([model.alpha])).toRgba()})}
var priceItems=price.getObjects(),priceStyles={strokeWidth:1,strokeLineJoin:'round',stroke:fabric.Color.fromSource(model.color.concat([1])).toRgba()};for(var a=0;a<priceItems.length;a++){if(priceItems[a].type=='group'){priceItems[a].getObjects()[0].set(priceStyles);priceItems[a].getObjects()[1].set(priceStyles);this.horizontallyStackItems(priceItems[a],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.horizontallyCenterItems(priceItems[a]);}
else{priceItems[a].set(priceStyles)}}
this.verticallyStackItems(nameAndIcon,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyCenterItems(nameAndIcon);this.verticallyStackItems(menuItems[0],postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems,0);this.verticallyStackItems(price,postermywall.core.model.LayoutProxy.defaultSpacingBetweenItems*2,0);if(addOns){this.verticallyStackItems(addOns,this.edgePadding,0);addOns.set('fontFamily',model.fontFamily2)}}},setExtraStyles:function(view,model){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var menuItems=groups[i].getObjects(),nameAndPriceGroup=menuItems[0].getObjects(),nameAndIcon=nameAndPriceGroup[0],price=nameAndPriceGroup[1],description=menuItems[1];this.verticallyStackItems(menuItems[0],view.width-nameAndIcon.width-price.width+model.xSpacing,0);description.set({width:menuItems[0].width-price.width});}},layoutItemsInsideGroups_:function(view,xSpacing){var groups=view.getObjects();for(var i=0;i<groups.length;i++){var newDim=this.getNewViewDimensions(groups[i],'vertical');groups[i].set({width:newDim.width,height:newDim.height,left:0,top:0});this.horizontallyStackItems(groups[i],xSpacing,0);}},getWrappingInfo:function(view){var menuItems=view.getObjects(),wrappingData=[];for(var i=0;i<menuItems.length;i++){var items=menuItems[i].getObjects();if(items[1].type=='textbox'){wrappingData.push(items[1]._textLines);}
else{wrappingData.push('');}}
return wrappingData;}},{});})();
(function(){var NAME='GraphicItemMediator';function getName_(uid){return NAME+uid;}
puremvc.define({name:'postermywall.core.view.GraphicItemMediator',parent:puremvc.Mediator,constructor:function(m,vc){this.model_=m;puremvc.Mediator.call(this,getName_(this.model_.uid),vc);this.linkViewToModel_();}},{setViewComponent:function(viewComponent){puremvc.Mediator.prototype.setViewComponent.call(this,viewComponent);this.linkViewToModel_();},model_:null,linkViewToModel_:function(){this.viewComponent.__PMWID=this.model_.uid;},getModel:function(){return this.model_;},setGradientFill:function(type,gradientOpts,alpha){this.viewComponent.setGradient(type,gradientOpts);},getCommonOptions_:function(){return{top:this.model_.y,left:this.model_.x,angle:this.model_.rotation,opacity:this.model_.alpha,scaleX:this.model_.scaleX,scaleY:this.model_.scaleY,visible:this.model_.visible,lockMovementX:this.model_.lockMovement,lockMovementY:this.model_.lockMovement,lockRotation:this.model_.lockMovement,lockScalingX:this.model_.lockMovement,lockScalingY:this.model_.lockMovement,hasControls:!this.model_.lockMovement,flipX:this.model_.flipX,flipY:this.model_.flipY}},invalidate:function(whiteboard,updatedModel){if(updatedModel){this.model_=updatedModel;}
if(typeof this.viewComponent.group=='undefined'&&!(this.viewComponent.group instanceof fabric.Group)){this.viewComponent.set(this.getCommonOptions_());}},applyColorOrPatternFill:function(color,alpha){var gradientOpts={},x=this.viewComponent.width,y=this.viewComponent.height,maxDimension=Math.max(x,y);if(this.model_.fillType===postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_LINEAR_GRADIENT){x=0;y=y*0.75;gradientOpts.colorStops={0.5:fabric.Color.fromSource(this.model_.gradientFillColor1.concat([alpha])).toRgba(),1:fabric.Color.fromSource(this.model_.gradientFillColor2.concat([alpha])).toRgba()};gradientOpts.type='linear';gradientOpts.x1=x;gradientOpts.y1=-y;gradientOpts.x2=x;gradientOpts.y2=y;this.setGradientFill('fill',gradientOpts,alpha);}
else if(this.model_.fillType===postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_RADIAL_GRADIENT){var radialCoords=this.getCoordinatesForRadialFill();gradientOpts.colorStops={0:fabric.Color.fromSource(this.model_.gradientFillColor1.concat([alpha])).toRgba(),1:fabric.Color.fromSource(this.model_.gradientFillColor2.concat([alpha])).toRgba()};gradientOpts.type='radial';gradientOpts.r1=0.1*maxDimension;gradientOpts.r2=maxDimension;gradientOpts.x1=radialCoords.x1;gradientOpts.y1=radialCoords.y1;gradientOpts.x2=radialCoords.x2;gradientOpts.y2=radialCoords.y2;this.setGradientFill('fill',gradientOpts,alpha);}
else{this.viewComponent.set({fill:fabric.Color.fromSource(color.concat([alpha])).toRgba()});}},getCoordinatesForRadialFill:function(){var x=this.viewComponent.width/2,y=this.viewComponent.height/2;return{x1:x,y1:y,x2:x,y2:y}},applyShadowOrGlow:function(d){if(typeof d==='undefined'){d=6;}
function getAlpha(a){return postermywall.Core.isHighRes()?a*1.1:a;}
this.viewComponent.setShadow(null);if(this.model_.imageGlowType>0){var c=fabric.Color.fromSource(this.model_.imageGlowColor.concat([1]));var b=10;switch(this.model_.imageGlowType){case 1:c.setAlpha(0.8);b=8;break;}
if(postermywall.Core.isHighRes()){b*=Math.round(postermywall.Core.hrScale);}
this.viewComponent.setShadow('0px 0px '+b+'px '+c.toRgba());}
if(!(postermywall.Core.isHighRes()&&this.model_ instanceof postermywall.core.model.vo.GraphicItemTextVO)){if(this.hasShadow()){var c,dx=d,dy=d;switch(this.model_.dropShadow){case 1:c=fabric.Color.fromSource([0,0,0,getAlpha(this.model_.dropShadowAlpha)]);break;case 2:c=fabric.Color.fromSource([0,0,0,getAlpha(this.model_.dropShadowAlpha)]);break;case 3:c=fabric.Color.fromSource(this.model_.dropShadowColor.concat([getAlpha(this.model_.dropShadowAlpha)]));dx=Math.round((d+2)*Math.cos(this.model_.dropShadowAngle*Math.PI/180));dy=Math.round((d+2)*Math.sin(this.model_.dropShadowAngle*Math.PI/180));break;}
if(postermywall.Core.isHighRes()){dx=dx*Math.round(postermywall.Core.hrScale);dy=dy*Math.round(postermywall.Core.hrScale);}
this.viewComponent.setShadow({color:c.toRgba(),blur:this.getShadowBlur(),offsetX:dx,offsetY:dy});}}},getCornerPoints:function(center){if(typeof center=='undefined'){center=this.getCenterPoint();}
return this.viewComponent.getCornerPoints(new fabric.Point(center.x,center.y));},getCenterPoint:function(){return this.viewComponent.getCenterPoint();},getShadowBlur:function(){return 2;},hasShadow:function(){return(this.model_.dropShadow>0&&this.model_.dropShadow<4);}},{NAME:'GraphicItemMediator',getName:function(vc){return getName_(vc.__PMWID?vc.__PMWID:'');},getNameByUID:function(uid){return getName_(uid);},getViewComponentUID:function(view){return view.__PMWID;},getInitOptionsForView:function(){return{hasControls:!postermywall.Core.isHighRes(),centeredScaling:postermywall.Core.isTouchSupported};},getAlphaForShadow:function(shadowType){switch(shadowType){case 1:return 0.25;case 2:return 0.5;}
return 0.25;}});})();
(function(){var super_=postermywall.core.view.GraphicItemMediator;puremvc.define({name:'postermywall.core.view.GraphicItemImageMediator',parent:super_,constructor:function(m,img,onContentLoaded){var opts=super_.getInitOptionsForView();opts.selectable=false;super_.call(this,m,new fabric.Image(img,opts));this.viewComponent.on('btn:clicked',this.onReplaceClicked_.bind(this));onContentLoaded(this);}},{loader_:null,loadTimer_:0,errorMessage_:'Sorry, an image could not be loaded. Please reload this page to try again.',splines_:null,onRegister:function(){this.loader_=document.createElement('img');this.loader_.crossOrigin='anonymous';this.loader_.onload=this.onImageLoaded_.bind(this);this.loader_.onerror=this.loader_.onabort=this.onImageLoadError_.bind(this);this.loader_.src=this.getImageURL_();this.loadTimer_=setTimeout(this.timeoutLoading_.bind(this),postermywall.core.view.GraphicItemImageMediator.getTimeout());},getImageURL_:function(){return postermywall.Core.repoImgURL(this.model_,'screen');},onImageLoaded_:function(){this.clearLoadTimer_();var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),self=this,isNew=this.model_.width===-1;if(isNew){var em=this.facade.retrieveMediator(postermywall.core.view.EditorMediator.NAME);this.model_.width=this.loader_.width;this.model_.height=this.loader_.height;this.model_.scaleX=this.model_.scaleY=em.getInitialScale(this.model_.x,this.model_.y,this.model_.width,this.model_.height);}
else{this.scaleLoadedImage_();}
if(this.model_.maskEffect=='colorpop'){this.applyColorPop_(this.model_.maskPoints,this.model_.isMaskCurved,setElementInViewComponent.bind(this));}
else{setElementInViewComponent.call(this,this.loader_);}
function setElementInViewComponent(image,badSource){if(image==null){PMW.log('Unable to load image with source: '+badSource);this.facade.sendNotification(postermywall.Core.GRAPHIC_ITEM_IMAGE_LOAD_END,this.model_);return;}
this.viewComponent.setElement(image,(function(){wbm.renderWhiteboard();this.viewComponent.setCoords();this.invalidate(wbm.getViewComponent(),this.getModel());this.facade.sendNotification(postermywall.Core.GRAPHIC_ITEM_IMAGE_LOAD_END,this.model_);}).bind(this),this.getElementOptions_());}},scaleLoadedImage_:function(){if(!postermywall.Core.isHighRes()&&this.model_.width!=this.loader_.width&&this.model_.height!=this.loader_.height){var ratio=this.model_.width/this.loader_.width;this.model_.width=this.loader_.width;this.model_.height=this.loader_.height;this.model_.scaleX=this.model_.scaleY=ratio;}},timeoutLoading_:function(){this.loader_.onload=this.loader_.onerror=this.loader_.onabort=null;this.clearLoadTimer_();this.onImageLoadError_();},clearLoadTimer_:function(){if(this.loadTimer_){clearTimeout(this.loadTimer_);this.loadTimer_=0;}},getElementOptions_:function(){return{scaleX:this.model_.scaleX,scaleY:this.model_.scaleY,width:this.model_.width,height:this.model_.height,selectable:true,hasButton:$.isFunction(this.model_.hasReplaceOption)?this.model_.hasReplaceOption():false};},onImageLoadError_:function(){this.clearLoadTimer_();var badSource=this.loader_.src;this.loader_.onabort=this.loader_.onerror=null;this.loader_.src=document.getElementById('imagePlaceholder').getAttribute('src');if(!postermywall.Core.isHighRes()){var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);wbm.updateModels([this.model_],[{visible:false}],false);wbm.clearSelection();}
PMW.log('Unable to load GraphicItemImage: '+badSource);this.facade.sendNotification(postermywall.Core.GRAPHIC_ITEM_IMAGE_LOAD_END,this.model_);},invalidate:function(whiteboard,updatedModel){super_.prototype.invalidate.call(this,whiteboard,updatedModel);while(this.viewComponent.filters.length){this.viewComponent.filters.pop();}
this.viewComponent.setClipTo(null);this.applyFadedBorderEffect();this.applyShadowOrGlow();if(this.model_.antique===1){this.viewComponent.filters.push(new fabric.Image.filters.Grayscale());}
else if(this.model_.antique===2){this.viewComponent.filters.push(new fabric.Image.filters.Sepia2());}
else if(this.model_.antique===3){this.viewComponent.filters.push(new fabric.Image.filters.Invert());}
if(this.model_.tint){this.viewComponent.filters.push(new fabric.Image.filters.Tint({color:fabric.Color.fromSource(this.model_.tintColor.concat([this.model_.tintOpacity])).toRgba()}));}
if(this.model_.multiply){this.viewComponent.filters.push(new fabric.Image.filters.Multiply({color:fabric.Color.fromSource(this.model_.multiplyColor).toRgb()}));}
if(this.model_.removeWhite){this.viewComponent.filters.push(new fabric.Image.filters.RemoveWhite({threshold:this.model_.removeWhiteThreshold,distance:this.model_.removeWhiteDistance}));}
if(this.model_.brightness!=0){this.viewComponent.filters.push(new fabric.Image.filters.Brightness({brightness:this.model_.brightness}));}
var strokeOptions={strokeWidth:0,strokeLineJoin:'miter'};if(this.model_.solidBorderType>0){strokeOptions.strokeWidth=this.model_.solidBorderThickness;strokeOptions.stroke=fabric.Color.fromSource(this.model_.solidBorderColor.concat([1])).toRgb();if(this.model_.solidBorderType===2){strokeOptions.strokeLineJoin='round';}}
this.viewComponent.set(strokeOptions);if(this.model_.maskPoints!=null&&this.model_.maskPoints.length>2&&this.model_.maskEffect=='normal'){this.viewComponent.setClipTo(this.getMaskedArea_.bind(this,this.translateMaskPoints_(this.model_.maskPoints,this.viewComponent.width,this.viewComponent.height),this.model_.isMaskCurved));}
this.viewComponent.applyFilters(whiteboard.renderAll.bind(whiteboard));},applyFadedBorderEffect:function(){if(this.model_.imageBorderType==3){this.viewComponent.setClipTo(this.drawCurvedBorder_.bind(this));}
else if(this.model_.imageBorderType==8){this.viewComponent.filters.push(new fabric.Image.filters.GradientTransparency({threshold:this.model_.imageBorderThickness}));}
else if(this.model_.imageBorderType>0){if(typeof fabric.Image.filters.ImageBorder==='undefined'){fabric.Image.filters.ImageBorder=fabric.util.createClass({type:'ImageBorder',initialize:function(options){options=options||{};this.borderType=options.borderType||0;},applyTo:function(canvasEl){function draw(img,canvasEl){var context=canvasEl.getContext('2d');context.globalCompositeOperation="destination-in";context.drawImage(img,0,0,canvasEl.width,canvasEl.height);}
var t=this.borderType;if(t>0){draw(document.getElementById('imageborder'+t),canvasEl);}}});}
this.viewComponent.filters.push(new fabric.Image.filters.ImageBorder({borderType:this.model_.imageBorderType}));}},drawCurvedBorder_:function(ctx){var r,w=this.viewComponent.width,h=this.viewComponent.height,x=-1*(w/2),y=-1*(h/2);r=postermywall.Util.mapNumberToRange(this.model_.imageBorderThickness,2,54,0,1)*Math.min(w,h);ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);this.applyShadowOrGlow();},applyColorPop_:function(maskPoints,isMaskCurved,callback){var points=this.translateMaskPoints_(maskPoints,this.model_.width,this.model_.height),c=document.createElement('canvas');c.width=this.model_.width;c.height=this.model_.height;var canvas=new fabric.StaticCanvas(c,{hoverCursor:'pointer',selection:true,controlsAboveOverlay:true,center:true,enableRetinaScaling:false}),backgroundImage=new fabric.Image(this.loader_);backgroundImage.filters.push(new fabric.Image.filters.Grayscale());canvas.setBackgroundImage(backgroundImage,(function(){backgroundImage.applyFilters(this.addMaskedImage_.bind(this,canvas,points,isMaskCurved,callback));}).bind(this),{width:this.model_.width,height:this.model_.height,originX:'left',originY:'top'});},addMaskedImage_:function(canvas,points,isMaskCurved,callback){var imageToMask=new fabric.Image(this.loader_,{left:0,top:0,width:this.model_.width,height:this.model_.height});canvas.add(imageToMask);if(points.length>2){imageToMask.setClipTo(this.getMaskedArea_.bind(this,points,isMaskCurved));}
else{imageToMask.setClipTo(null);}
canvas.renderAll();var dataURL=canvas.toDataURL({format:'png'}),img=new Image();img.onload=function(){callback(img);};img.onerror=img.onabort=function(){callback(null,img.src);};img.src=dataURL;},translateMaskPoints_:function(oldPoints,width,height){var points=[];for(var i=0;i<oldPoints.length;i++){points.push({x:(oldPoints[i].x-width/2),y:(oldPoints[i].y-height/2)});}
return points;},getMaskedArea_:function(points,maskCurves,ctx){this.splines_=new postermywall.core.library.SplinesLibrary(ctx,(this.model_.solidBorderType>0),true,true,(this.model_.maskEffect=='colorpop'));this.splines_.drawSplines(points,true,maskCurves);},onReplaceClicked_:function(){this.facade.sendNotification(postermywall.Core.SHOW_REPLACE_SELECTED_IMAGE);}},{TIMEOUT_:20000,getTimeout:function(){return postermywall.core.view.GraphicItemImageMediator.TIMEOUT_*(postermywall.Core.isHighRes()?10:1);},imageName:function(imageVO){var imageName='';if(imageVO instanceof postermywall.core.model.vo.GraphicItemImageVO&&imageVO.isModified()){imageName=imageVO.imageUid+"_"+imageVO.modification.creationID;if(imageVO.type===postermywall.core.model.vo.GraphicItemImageVO.TYPE_MASKED){imageName+=".png";}
else{imageName+="."+imageVO.fileExtension;}}
else{imageName=imageVO.hashedFilename+"."+imageVO.fileExtension;}
return imageName;},imageDirectory:function(imageVO,isHighRes){if(imageVO.isModified()){if(isHighRes){return'modified';}
return'modified/screens';}
else{if(isHighRes){return'uploads';}
return'uploads/screens';}}});})();
(function(){var super_=postermywall.core.view.GraphicItemMediator;puremvc.define({name:'postermywall.core.view.GraphicItemTextMediator',parent:super_,constructor:function(m,onContentLoaded){var opts=super_.getInitOptionsForView();opts.width=m.width;opts.height=m.height;opts.editingBorderColor='rgba(63,188,231,0.5)';opts.selectionColor='rgba(62,164,204,0.3)';opts.cursorColor='#1A4556';opts.cursorDelay=1000;opts.cursorDuration=600;if(postermywall.Core.isHighRes()){m.setWrapping();fabric.Textbox.prototype._wrapText=this.wrapTextSimple_;}
super_.call(this,m,new fabric.Textbox(m.text,opts));var self=this;this.viewComponent.on('changed',function(){if(self.changedTimeout_>0){clearTimeout(self.changedTimeout_);}
self.changedTimeout_=setTimeout(self.updateText_.bind(self,this.text),500);});onContentLoaded(this);}},{changedTimeout_:0,addHighresShadow:function(whiteboard){var shadow=this.model_,d,dx,dy;if(shadow.fontSize<14){d=1;}else{d=Math.floor(shadow.fontSize/14);}
dx=dy=d;if(shadow.dropShadow==3){dx=Math.round((d+2)*Math.cos(shadow.dropShadowAngle*Math.PI/180));dy=Math.round((d+2)*Math.sin(shadow.dropShadowAngle*Math.PI/180));shadow.color=shadow.dropShadowColor;}
else{shadow.color=[0,0,0];}
shadow.x+=dx;shadow.y+=dy;shadow.alpha*=shadow.dropShadowAlpha;shadow.fillType=postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_SOLID;shadow.backgroundType=0;var shadowM=new postermywall.core.view.GraphicItemTextMediator(shadow,$.noop);this.facade.registerMediator(shadowM);shadowM.invalidate(whiteboard,null);whiteboard.insertAt(shadowM.getViewComponent(),whiteboard.size());},updateText_:function(text){var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);wbm.updateModelByUID(this.model_.uid,[{text:text,width:this.viewComponent.width,height:this.viewComponent.height}]);wbm.notifyTextChanged(this.model_);},invalidate:function(whiteboard,updatedModel){super_.prototype.invalidate.call(this,whiteboard,updatedModel);this.viewComponent._fontSizeFraction=typeof postermywall.core.view.GraphicItemTextMediator.FONTSIZE_FRACTION[this.model_.fontFamily]==='undefined'?0.18:postermywall.core.view.GraphicItemTextMediator.FONTSIZE_FRACTION[this.model_.fontFamily];var options=postermywall.core.library.TextLibrary.getTextStyles(this.model_);options.fontSize=parseInt(this.model_.fontSize);if(this.isTextNotEditable()){options.editable=false;options.cursorWidth=0;}
else{options.editable=this.model_.editable;options.cursorWidth=(this.model_.editable)?2:0;}
options.width=this.model_.width;this.viewComponent.set(options);var d;if(this.model_.fontSize<14){d=1;}else{d=Math.floor(this.model_.fontSize/14);}
this.applyShadowOrGlow(d);this.applyColorOrPatternFill(this.model_.color,1);},getWrappedLines:function(){if(this.viewComponent!=null){return this.viewComponent._textLines;}
return null;},getCoordinatesForRadialFill:function(){var x=this.viewComponent.width/2,y=this.viewComponent.height/2;switch(this.viewComponent.textAlign){case'center':x=0;break;case'right':x-=this.viewComponent.width;break;}
return{x1:x,y1:y,x2:x,y2:y}},wrapTextSimple_:function(){return this.text.split('\n');},getShadowBlur:function(){return 0;},isTextNotEditable:function(){return postermywall.Core.isMobileOS;}},{FONTSIZE_FRACTION:{'AccidentalPresidency':0.18,'Acknowledgement':0.30,'AdventProRegular':0.15,'AgentOrange':0.285,'AlexBrushRegular':0.285,'AnimeAce':0.27,'AnuDaw':0.235,'ArbuckleRemix':0.38,'ArchivoBlackRegular':0.39,'AsapRegular':0.18,'AYummyApology':0.39,'Bangers':0.22,'BerkshireSwashRegular':0.12,'BigApple':0.31,'Blackout2am':0.35,'BlackoutMidnight':0.28,'BlackRose':0.21,'BostonTraffic':0.29,'BowlbyOneSCRegular':0.04,'BubbleBoy2':0,'BurnstownDam':0.42,'CACChampagne':0.34,'Caeldera':0.39,'Chancery':0,'Chopin':0,'Chumbly':0.45,'Coda':0.28,'ComingSoon':0.35,'Concielian':0.42,'DayPosterBlack':0.02,'DigitalDream':0.34,'Effloresce':0.29,'EraserRegular':0.15,'FingerPaintRegular':0.02,'FrijoleRegular':0.10,'FugazOneRegular':0.08,'GermaniaOneRegular':0.22,'HamburgerHeaven':0.18,'HennyPennyRegular':0.00,'HoltwoodOneSC':-0.08,'JockeyOneRegular':0.05,'JosefinSlabRegular':0.39,'KaushanScriptRegular':0.03,'LeagueSpartanBold':0.38,'LemonRegular':0.09,'LiberationSerif':0.42,'Liquidism':0.34,'LoveYaLikeASister':0.20,'MerriweatherSansRegular':0.15,'MetalLord':0.38,'MetalManiaRegular':0.19,'Monoton':-0.05,'MountainsofChristmas':0.20,'MouseMemoirsRegular':0.18,'NixieOneRegular':0.18,'Oklahoma':0.10,'OldStandardRegular':0.36,'OpenSansRegular':0.36,'OperatingInstructions':0.36,'OriginalSurferRegular':0.14,'PaprikaRegular':-0.03,'PompiereRegular':0.19,'Porter':0.38,'Primitive':0.20,'SacramentoRegular':0.20,'SancreekRegular':0.09,'SevenMonkeyFury':0.23,'SFCollegiate':0.34,'SFSpeedwaystar':0.45,'ShadowsIntoLightTwoRegular':0.02,'Shermlock':0.065,'SirinStencilRegular':-0.05,'SixCaps':0.025,'SmokumRegular':0.14,'SoftSugar':0.325,'Solov2':0.42,'SpecialElite':0.42,'SpiraxRegular':0.19,'Sveningsson':0.19,'TagsXtreme':0.36,'Titania':0.22,'TulpenOneRegular':0.25,'Ultra':0.12,'WaitingfortheSunrise':0.00,'Windsong':0.32}});})();
(function(){var super_=postermywall.core.view.GraphicItemImageMediator;puremvc.define({name:'postermywall.core.view.GraphicItemFancyTextMediator',parent:super_,constructor:function(m,img,onContentLoaded){super_.call(this,m,img,onContentLoaded);}},{errorMessage_:'Sorry, a fancy text could not be loaded. If you were editing it, use Edit > Undo to go to a previous state.',getImageURL_:function(){function getColor(c,m){if(m.isColorSet(c)){return postermywall.Util.rgbToHex(c);}
return-1;}
return postermywall.Core.fancyTextURL(this.model_.idFancyText,this.model_.fontFamily,postermywall.core.view.GraphicItemFancyTextMediator.getFontSize(this.model_.fontFamily),postermywall.Core.isHighRes()?2.2:0.7,this.model_.text,getColor(this.model_.color1,this.model_),getColor(this.model_.color2,this.model_),getColor(this.model_.color3,this.model_),this.model_.morphType,this.model_.morphAmount);},scaleLoadedImage_:function(){if(!postermywall.Core.isHighRes()&&this.model_.width!=this.loader_.width&&this.model_.height!=this.loader_.height){var ratio=this.model_.width*this.model_.scaleX/this.loader_.width;this.model_.width=this.loader_.width;this.model_.height=this.loader_.height;this.model_.scaleX=this.model_.scaleY=ratio;}},isRenderingOutdated_:function(updatedModel){if(this.model_==null||updatedModel==null){return false;}
var props=['idFancyText','fontFamily','text','color1','color2','color3','morphType','morphAmount'];for(var i=0;i<props.length;i++){if($.isArray(this.model_[props[i]])&&this.model_[props[i]].length===updatedModel[props[i]].length){for(var j=0;j<this.model_[props[i]].length;j++){if(this.model_[props[i]][j]!==updatedModel[props[i]][j]){return true;}}}
else if(this.model_[props[i]]!=updatedModel[props[i]]){return true;}}
return false;},invalidate:function(whiteboard,updatedModel){var doRender=this.isRenderingOutdated_(updatedModel);postermywall.core.view.GraphicItemMediator.prototype.invalidate.call(this,whiteboard,updatedModel);if(doRender){this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'loading-gi-'+updatedModel.uid});this.loader_.src=this.getImageURL_();}
this.applyShadowOrGlow();},getElementOptions_:function(){if(!this.model_.isNewlyAdded){var ratio=this.loader_.width/this.loader_.height;if(this.loader_.width>this.loader_.height){this.model_.height=this.model_.width/ratio;}
else{this.model_.width=this.model_.height*ratio;}}
return super_.prototype.getElementOptions_.call(this);},},{getFontSize:function(name){switch(name){case'Agent Orange':case'Berkshire Swash':return 150;case'Airstream':return 140;case'Boston Traffic':return 145;case'BubbleBoy2':return 125;case'Caeldera':return 160;case'Diner':case'Star Avenue':return 110;case'JudasPriest':return 105;case'Fontdinerdotcom Luvable':case'TagsXtreme':return 160;case'Planet Kosmos':return 120;case'Wicked Queen BB':return 200;}
return 170;}});})();
(function(){var super_=postermywall.core.view.GraphicItemMediator;puremvc.define({name:'postermywall.core.view.GraphicItemShapeMediator',parent:super_,constructor:function(m,wb,onContentLoaded,zIndex){super_.call(this,m,new fabric.Path('M 0 0 z',{selectable:true}));if(zIndex==-1){wb.add(this.viewComponent);}
else{wb.insertAt(this.viewComponent,zIndex,false);}
postermywall.core.view.GraphicItemShapeMediator.loadJSON(this.model_.name).done(this.onShapeLoaded_.bind(this,wb,onContentLoaded));}},{onShapeLoaded_:function(wb,onContentLoaded,json){this.json_=json;this.setViewComponent(new fabric.Path(this.json_.d,super_.getInitOptionsForView()));var initDims=(this.model_.width===-1);if(initDims){var canvasScale=wb.viewportTransform[0],dimensionToUse=(Math.min(wb.width/canvasScale,wb.height/canvasScale)/3),maxDimensionOfShape=Math.max(this.viewComponent.width,this.viewComponent.height),scale=dimensionToUse/maxDimensionOfShape;this.model_.width=this.json_.w;this.model_.height=this.json_.h;this.model_.scaleX=this.model_.scaleY=scale;}
if(this.model_.scaleX===0&&this.model_.scaleY===0){this.model_.scaleX=this.model_.width/this.viewComponent.width;this.model_.scaleY=this.model_.height/this.viewComponent.height;var offsets={};switch(this.model_.name){case'circle':offsets.x=14;offsets.y=15;break;case'heart':offsets.x=9;offsets.y=9;break;case'star':offsets.x=4;offsets.y=3;break;case'star2':case'star3':offsets.x=2;offsets.y=2;break;case'star4':offsets.x=4;offsets.y=12;break;case'arrow':offsets.x=11;offsets.y=11;break;case'arrow2':offsets.x=8;offsets.y=8;break;case'speech':offsets.x=5;offsets.y=4;break;case'speech2':offsets.x=5;offsets.y=13;break;case'speech3':case'speech4':case'speech5':case'speech12':case'speech13':case'speech14':offsets.x=5;offsets.y=5;break;case'speech9':case'speech10':case'speech11':offsets.x=5;offsets.y=6;break;case'dancer':case'dancer2':offsets.x=10;offsets.y=9;break;case'rockstar':case'rockstar2':case'rapper':offsets.x=8;offsets.y=9;break;case'woman':case'woman2':case'woman3':case'woman4':case'cardspade':offsets.x=4;offsets.y=4;break;case'woman5':offsets.x=19;offsets.y=12;break;case'leaf':offsets.x=0;offsets.y=6;break;case'cardclub':offsets.x=0;offsets.y=8;break;default:offsets.x=0;offsets.y=0;}
if(offsets.x!=0&&offsets.y!=0){this.model_.scaleX=(this.model_.width-offsets.x*this.model_.scaleX)/this.viewComponent.width;this.model_.scaleY=(this.model_.height-offsets.y*this.model_.scaleY)/this.viewComponent.height;var hypotenuse=Math.sqrt(Math.pow(offsets.x,2)+Math.pow(offsets.y,2));var xcor=hypotenuse*Math.cos((this.model_.rotation)*Math.PI/180+Math.atan(this.model_.scaleY/this.model_.scaleX));var ycor=hypotenuse*Math.sin((this.model_.rotation)*Math.PI/180+Math.atan(this.model_.scaleY/this.model_.scaleX));this.model_.x+=xcor*this.model_.scaleX;this.model_.y+=ycor*this.model_.scaleY;}
this.model_.width=this.viewComponent.width;this.model_.height=this.viewComponent.height;}
onContentLoaded(this);if(!initDims){this.viewComponent.setScaleX(this.model_.scaleX);this.viewComponent.setScaleY(this.model_.scaleY);}},json_:null,invalidate:function(whiteboard,updatedModel){if(this.json_===null){return;}
var alpha=this.model_.fillAlpha;if(updatedModel){alpha=updatedModel.fillAlpha;}
super_.prototype.invalidate.call(this,whiteboard,updatedModel);var options={};options.stroke='#'+postermywall.Util.rgbToHex(this.model_.strokeColor);options.strokeWidth=this.model_.strokeWeight;options.strokeLineCap=typeof this.json_.c==='undefined'?'round':this.json_.c;options.strokeLineJoin=typeof this.json_.j==='undefined'?'round':this.json_.j;options.strokeMiterLimit=isNaN(parseInt(this.json_.m))?3:parseInt(this.json_.m);options.lockUniScaling=false;this.viewComponent.set(options);this.applyShadowOrGlow();this.applyColorOrPatternFill(this.model_.fillColor,alpha);},getOriginOffset:function(){if(this.json_&&typeof this.json_.d==='string'){var p=this.json_.d.split(' ',3);if(p.length===3&&p[0]==='M'){var x=parseInt(p[1]),y=parseInt(p[2]);if(!isNaN(x)&&!isNaN(y)){return{x:x+this.json_.x,y:y+this.json_.y}}}}
return{x:0,y:0};}},{loadJSON:postermywall.Util.createCache(function(defer,key){$.get(postermywall.Core.repoURL('shapes/'+key+'.json',postermywall.Core.readBucket,false)).then(defer.resolve,defer.reject);}),shapeURL:function(name){return postermywall.Core.repoURL('shapes/'+name+'.png',postermywall.Core.readBucket,false);}});})();
(function(){var super_=postermywall.core.view.GraphicItemMediator;puremvc.define({name:'postermywall.core.view.GraphicItemVectorMediator',parent:super_,constructor:function(m,wb,onContentLoaded,zIndex){super_.call(this,m,new fabric.Path('M 0 0 z',{selectable:true}));if(zIndex==-1){wb.add(this.viewComponent);}
else{wb.insertAt(this.viewComponent,zIndex,false);}
var name="";if(m&&m.hashedFilename){name=m.hashedFilename+":1";this.model_.hashedFilename=name;}else{name=this.model_.name+":0";}
postermywall.core.view.GraphicItemVectorMediator.loadSVG(name).done(this.onJsonLoaded_.bind(this,wb,onContentLoaded));}},{onJsonLoaded_:function(wb,onContentLoaded,svgNode,status){if(status=="success"&&svgNode){if(typeof svgNode.nodeType==='undefined'){svgStr=svgNode;}else{var serializer=new XMLSerializer(),svgStr=serializer.serializeToString(svgNode);}
fabric.loadSVGFromString(svgStr,this.onVectorLoaded_.bind(this,wb,onContentLoaded));}},onVectorLoaded_:function(wb,onContentLoaded,obj,opt){var svg=fabric.util.groupSVGElements(obj,{left:this.model_.x,top:this.model_.y,height:opt.height,width:opt.width,selectable:true,lockUniScaling:false,});if(this.model_.defaultFillColor===null){if(typeof svg.paths[0].fill.length==="undefined"){this.model_.isComplexSVG=true;this.model_.defaultFillColor=(typeof svg.paths[0].fill==='string')?postermywall.Util.hexToRgb(svg.paths[0].fill):svg.paths[0].fill;}else{if(!postermywall.Util.arraysEqual(this.model_.fillColor,[0,0,0])){this.model_.defaultFillColor=this.model_.fillColor;}else{this.model_.defaultFillColor=this.model_.fillColor=(typeof svg.paths[0].fill==='string')?postermywall.Util.hexToRgb(svg.paths[0].fill):svg.paths[0].fill;}}
this.model_.defaultPathFills=[];for(var i=0;i<svg.paths.length;i++){this.model_.defaultPathFills.push(svg.paths[i].fill);}}
this.setViewComponent(svg);var initDims=(this.model_.width===-1);if(initDims){var canvasScale=wb.viewportTransform[0],dimensionToUse=(Math.min(wb.width/canvasScale,wb.height/canvasScale)/3),maxDimensionOfShape=Math.max(this.viewComponent.width,this.viewComponent.height),scale=dimensionToUse/maxDimensionOfShape;this.model_.width=opt.width;this.model_.height=opt.height;this.model_.scaleX=this.model_.scaleY=scale;}
onContentLoaded(this);},invalidate:function(whiteboard,updatedModel){if(typeof this.viewComponent.paths=='undefined'){return;}
super_.prototype.invalidate.call(this,whiteboard,updatedModel);if(!this.model_.isComplexSVG){var options={},i;if(this.model_.isStrokeCustomisable){options.stroke='#'+postermywall.Util.rgbToHex(this.model_.strokeColor);options.strokeWidth=this.model_.strokeWeight;}
if(this.model_.defaultFillColor!=null&&!postermywall.Util.arraysEqual(this.model_.fillColor,this.model_.defaultFillColor)){options.fill='#'+postermywall.Util.rgbToHex(this.model_.fillColor);options.lockUniScaling=false;for(i=0;i<this.viewComponent.paths.length;i++){this.viewComponent.paths[i].set(options);}}else if(postermywall.Util.arraysEqual(this.model_.fillColor,this.model_.defaultFillColor)){for(i=0;i<this.viewComponent.paths.length;i++){options.fill=this.model_.defaultPathFills[i];this.viewComponent.paths[i].set(options);}}
this.applyColorOrPatternFill(this.model_.fillColor,this.model_.fillAlpha);}},setGradientFill:function(type,opts,alpha){var gradientOpts={},x=this.viewComponent.width,y=this.viewComponent.height;if(this.model_.fillType===postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_LINEAR_GRADIENT){x=0;y=y*0.75;gradientOpts.colorStops={0.5:fabric.Color.fromSource(this.model_.gradientFillColor1.concat([alpha])).toRgba(),1:fabric.Color.fromSource(this.model_.gradientFillColor2.concat([alpha])).toRgba()};gradientOpts.type='linear';gradientOpts.x1=x;gradientOpts.y1=-y;gradientOpts.x2=x;gradientOpts.y2=y;for(var i=0;i<this.viewComponent.paths.length;i++){this.viewComponent.paths[i].setGradient('fill',gradientOpts);}}else if(this.model_.fillType===postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_RADIAL_GRADIENT){x=x/2;y=y/2;gradientOpts.colorStops={0:fabric.Color.fromSource(this.model_.gradientFillColor1.concat([alpha])).toRgba(),0.75:fabric.Color.fromSource(this.model_.gradientFillColor2.concat([alpha])).toRgba()};var maxDimension=Math.max(x,y);gradientOpts.type='radial';gradientOpts.r1=0.1*maxDimension*2;gradientOpts.r2=maxDimension*2;gradientOpts.x1=maxDimension;gradientOpts.y1=maxDimension;gradientOpts.x2=maxDimension;gradientOpts.y2=maxDimension;for(var i=0;i<this.viewComponent.paths.length;i++){this.viewComponent.paths[i].setGradient('fill',gradientOpts);}}}},{loadSVG:postermywall.Util.createCache(function(defer,name){var path='',nameSegments=name.split(":"),userUpload=nameSegments[1],bucket='';name=nameSegments[0];if(userUpload=="1"){path='uploads/'+name+'.svg';bucket=postermywall.Core.writeBucket;}else{path='shapes/vectors/'+name+'.svg';bucket=postermywall.Core.readBucket;}
$.get(postermywall.Core.repoURL(path,bucket,false)).then(defer.resolve,defer.reject);})});})();
(function(){var super_=postermywall.core.view.GraphicItemMediator;puremvc.define({name:'postermywall.core.view.GraphicItemTabsMediator',parent:super_,constructor:function(m,onContentLoaded){this.layout_=new postermywall.core.view.fabricjs.StackLayout();var opts=super_.getInitOptionsForView();opts.width=m.width;opts.height=m.height;var groupItems=[];for(var i=0;i<m.numTabs;i++){groupItems.push(new fabric.IText(m.text,{angle:90}));}
var currentAspectRatio=(m.y/m.width);if(currentAspectRatio>1){currentAspectRatio=1/currentAspectRatio;}
this.padding_=(m.width*0.045)*currentAspectRatio;if(this.padding_<25){this.padding_=25;}
super_.call(this,m,new fabric.Tabs(groupItems,opts));onContentLoaded(this);}},{layout_:null,padding_:25,invalidate:function(whiteboard,updatedModel){super_.prototype.invalidate.call(this,whiteboard,updatedModel);var options=postermywall.core.library.TextLibrary.getTextStyles(this.model_);this.removeSeparators();this.addOrRemoveItems();this.viewComponent.set(options);this.adjustFontSize();this.applyColorOrPatternFill(this.model_.color,1);this.layout_.doLayout(this.viewComponent);if(this.model_.separatorType!=postermywall.core.model.vo.GraphicItemTabsVO.SEPARATOR_TYPE_NONE){this.addSeparators();}},addOrRemoveItems:function(){var oldNumTabs=(this.viewComponent.getObjects().length),newNumTabs=this.model_.numTabs,o;if(oldNumTabs!=newNumTabs){var n=newNumTabs-oldNumTabs;if(n<0){for(var i=0;i<Math.abs(n);i++){o=this.viewComponent.getObjects();this.viewComponent.remove(o[o.length-1]);}}
else{for(i=0;i<n;i++){this.viewComponent.add(new fabric.IText('',{angle:90}));}}}},adjustFontSize:function(){var items=this.viewComponent.getObjects(),totalItems=items.length,spaceR=items[0]._textLines.length*totalItems,fontSize=(this.viewComponent.width-(totalItems*this.padding_))/spaceR,maxFontSize=100,minFontSize=8;if(fontSize>maxFontSize){fontSize=maxFontSize;}
if(fontSize<=minFontSize){fontSize=minFontSize;}
this.viewComponent.set({fontSize:fontSize});this.viewComponent.set({height:this.viewComponent.getObjects()[0]._getTextWidth()+(this.viewComponent.padding*2)});},addSeparators:function(){var items=this.viewComponent.getObjects(),itemsCount=items.length,style=0,strokeWidth=items[0].fontSize*0.05,lineLength=items[0]._getTextWidth(),lineColor=fabric.Color.fromSource(this.model_.separatorColor.concat(1)).toRgba();if(this.model_.separatorType==postermywall.core.model.vo.GraphicItemTabsVO.SEPARATOR_TYPE_DASHED){var d=items[0].fontSize*0.2;style=[d,d];}
for(var i=0;i<itemsCount-1;i++){this.viewComponent.add(new fabric.Line([0,0,0,lineLength],{stroke:lineColor,strokeWidth:strokeWidth,strokeDashArray:style,strokeLineCap:'round',angle:0,left:(items[i].getCenterPoint().x+items[i+1].getCenterPoint().x)/2,top:(items[i].top)}))}},removeSeparators:function(){var o=this.viewComponent.getObjects();while(o[o.length-1]instanceof fabric.Line){this.viewComponent.remove(o[o.length-1]);o=this.viewComponent.getObjects();}}},{});})();
(function(){var super_=postermywall.core.view.GraphicItemMediator;puremvc.define({name:'postermywall.core.view.GraphicItemTableMediator',parent:super_,constructor:function(m,wb,item,onContentLoaded){item.set(super_.getInitOptionsForView());super_.call(this,m,item);onContentLoaded(this);this.viewComponent.on('btn:clicked',this.onEditClicked_.bind(this));}},{layout_:null,invalidate:function(whiteboard,updatedModel){super_.prototype.invalidate.call(this,whiteboard,updatedModel);this.refreshView(whiteboard,this.model_);},refreshView:function(whiteboard,model){if(this.layout_==null||model.layoutStyle!=this.layout_.getLayoutName()){this.layout_=postermywall.core.model.LayoutProxy.getLayoutHelper(model.layoutStyle);}
this.layout_.setItems(this.viewComponent,model);var options={};options.fontSize=model.fontSize;options.lockUniScaling=true;options.columns=model.columns;options.rows=model.rows;options.layoutType=this.layout_.layoutType;$.extend(true,options,postermywall.core.library.TextLibrary.getTextStyles(model));delete options.text;if(model.backgroundType===2){options.alternateBackgroundColor1=fabric.Color.fromSource(model.alternateBackgroundColor1.concat([model.alternateColor1Alpha])).toRgba();options.alternateBackgroundColor2=fabric.Color.fromSource(model.alternateBackgroundColor2.concat([model.alternateColor2Alpha])).toRgba();}
else{options.alternateBackgroundColor1=null;options.alternateBackgroundColor2=null;}
var highlightedRowsOptions=this.getHighlightedRowsData_();options.highlightedRowsBackgroundColor=highlightedRowsOptions.color;options.highlightedRows=highlightedRowsOptions.rows;options.strokeWidth=0;options.strokeLineJoin='miter';if(model.solidBorderType>0){options.strokeWidth=model.solidBorderThickness;options.stroke=fabric.Color.fromSource(model.solidBorderColor.concat([1])).toRgb();if(model.solidBorderType===2){options.strokeLineJoin='round';}}
else{options.strokeWidth=0;}
this.viewComponent.set(options);this.applyColorOrPatternFill(model.color,1);this.layout_.doLayout(this.viewComponent,model);},getHighlightedRowsData_:function(){var options={color:fabric.Color.fromSource(this.model_.highlightedBackgroundColor.concat([this.model_.highlightedBackgroundColorAlpha])).toRgba(),rows:[]};var highlightedRowsData=this.model_.layoutDataMap.highlight;for(var i=0;i<highlightedRowsData.length;i++){var val=highlightedRowsData[i].getValue();if(val){options.rows.push(i);}}
return options;},onEditClicked_:function(){this.facade.sendNotification(postermywall.Core.EDIT_TABLE_CONTENT);}},{});})();
(function(){var super_=postermywall.core.view.GraphicItemTableMediator;puremvc.define({name:'postermywall.core.view.GraphicItemMenuMediator',parent:super_,whiteBoard:null,constructor:function(m,wb,onContentLoaded){super_.call(this,m,wb,new fabric.CustomBorderTable([],{}),onContentLoaded);this.whiteBoard=wb;this.viewComponent.on('pmwBtnMr:modifyingWidth',this.onResizeWithRightHandle_.bind(this));this.viewComponent.on('pmwBtnMl:modifyingWidth',this.onResizeWithLeftHandle_.bind(this));this.viewComponent.on('widthModified',this.onWidthModified_.bind(this));this.viewComponent.on('modified',this.takeModelSnapshot.bind(this));this.takeModelSnapshot();}},{modelSnapshot:new postermywall.core.model.vo.GraphicItemMenuVO(),invalidate:function(whiteboard,updatedModel){super_.prototype.invalidate.call(this,whiteboard,updatedModel);this.invalidateIcons();},onEditClicked_:function(){this.facade.sendNotification(postermywall.Core.EDIT_MENU_ITEM);},invalidateIcons:function(){var icons=this.model_.layoutDataMap.iconsList,iconsUsed=[];for(var i=0;i<icons.length;i++){var iconsList=icons[i].getValue();iconsUsed=iconsUsed.concat(iconsList);}
for(i=0;i<iconsUsed.length;i++){if(!postermywall.core.view.GraphicItemMenuMediator.loadedIcons.hasOwnProperty(iconsUsed[i])){postermywall.core.view.GraphicItemMenuMediator.cacheIcon(iconsUsed[i],this.onIconLoaded_.bind(this,iconsUsed[i],this.whiteBoard));}}},onIconLoaded_:function(name,wb,obj,opt){opt.selectable=false;opt.editable=false;opt.scaleX=0.5;opt.scaleY=0.5;postermywall.core.view.GraphicItemMenuMediator.loadedIcons[name]=fabric.util.groupSVGElements(obj,opt);var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);this.invalidate(wb,null);this.viewComponent.setCoords();wbm.refreshSelection();wbm.renderWhiteboard();},getWrappedLines:function(){return this.layout_.getWrappingInfo(this.viewComponent);},onResizeWithRightHandle_:function(event){var offset=event.e.movementX/this.viewComponent.scaleX;if(this.modelSnapshot.xSpacing+offset<0){return;}
this.updateModelSnapshot_();this.modelSnapshot.xSpacing+=offset;this.refreshView(this.whiteBoard,this.modelSnapshot);},onResizeWithLeftHandle_:function(event){var widthBefore=this.viewComponent.width,offset=event.e.movementX/this.viewComponent.scaleX;if(this.modelSnapshot.xSpacing-offset<0){return;}
this.updateModelSnapshot_();this.modelSnapshot.xSpacing-=offset;this.refreshView(this.whiteBoard,this.modelSnapshot);var widthAfter=this.viewComponent.width;this.modelSnapshot.x+=(widthBefore-widthAfter)*this.viewComponent.scaleX;this.viewComponent.set({left:this.modelSnapshot.x});},onWidthModified_:function(){var wbm_=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);var changes={xSpacing:this.modelSnapshot.xSpacing};if(this.model_.x!=this.modelSnapshot.x){changes.x=this.modelSnapshot.x;}
wbm_.updateSelection([changes],true);},takeModelSnapshot:function(){this.modelSnapshot.clone(this.model_);},updateModelSnapshot_:function(){var xSpacing=this.modelSnapshot.xSpacing,x=this.modelSnapshot.x;this.modelSnapshot.clone(this.model_);this.modelSnapshot.xSpacing=xSpacing;this.modelSnapshot.x=x;}},{loadedIcons:{},cacheIcon:function(icon,cb){fabric.loadSVGFromURL(postermywall.Core.serverRoot+'assets/postermaker/menu-icons/svgs/'+icon+'.svg',cb)},loadJSON:postermywall.Util.createCache(function(defer){$.get(postermywall.Core.repoURL('shapes/menu_icon.json',postermywall.Core.readBucket,false)).then(defer.resolve,defer.reject);}),getIconSvg:function(icon){if(this.loadedIcons.hasOwnProperty(icon)){var svg=postermywall.core.view.GraphicItemMenuMediator.loadedIcons[icon],paths=svg.paths,newPaths=[];for(var i=0;i<paths.length;i++){newPaths.push(fabric.util.object.clone(paths[i]))}
svg.set({paths:newPaths});return fabric.util.object.clone(svg);}
else{return false;}}});})();
(function(){var loadCount_=0;var queuedLoadingIndex_=0;var imagePlaceholder_=null;puremvc.define({name:'postermywall.core.view.WhiteboardMediator',parent:puremvc.Mediator},{fonts:{},scale_:1,proxy_:null,videoPlaying:true,viewContainer:null,watermarkAdvertView:null,watermarkAttributionView:null,renderDelay_:16,renderOnEachAnimationFrame:false,renderTimestamp_:null,renderTimeoutID_:0,forceRefresh_:false,watermarkFontSize_:11,isColorPickMode:false,alignmentPadding:10,videoData_:null,copyKey:'',duplicatedItems_:null,failedLoadedFonts_:{},isWatermarkVisible_:true,getScale:function(){return this.scale_;},getProxy:function(){if(!this.proxy_){this.proxy_=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);}
return this.proxy_;},loadFontsForPoster:function(poster,cb){var list=[];for(var i=0;i<poster.graphicItems.length;i++){if(postermywall.core.model.vo.PosterVO.hasEditableText(poster.graphicItems[i])){list[list.length]=poster.graphicItems[i].fontFamily;}
if(postermywall.core.model.LayoutProxy.isSecondFontFamilyUsed(poster.graphicItems[i].layoutStyle)){if(poster.graphicItems[i].fontFamily2!=''){list[list.length]=poster.graphicItems[i].fontFamily2;}}}
this.loadFonts(list,cb.bind(this,poster));},loadFonts:function(keys,cb){var i;if(keys!==null){for(i=0;i<keys.length;i++){if('undefined'===typeof this.fonts[keys[i]]){this.fonts[keys[i]]=1;}}}
var ffs=[],urls=[],url;for(var k in this.fonts){if(this.fonts.hasOwnProperty(k)&&this.fonts[k]===1){url=postermywall.Core.getFontPath(k,'stylesheet');ffs[ffs.length]=k;urls[urls.length]=this.failedLoadedFonts_[k]?this.addTimestamp_(url):url;}}
if(ffs.length>0){var self=this;WebFont.load({custom:{families:ffs,urls:urls},fontactive:function(ff){self.fonts[ff]=2;$('#buffer').append('<span style="font-family:\''+ff+'\'">force load</span>');},active:function(){setTimeout(function(){cb(true);},500);},inactive:function(){cb(false);},fontinactive:function(ff){self.fonts[ff]=1;self.failedLoadedFonts_[ff]=1;}});}
else{cb(true);}
return ffs.length;},addTimestamp_:function(url){var timestamp='ts='+(new Date()).getTime();return(url+(url.indexOf('?')===-1?'?':'&')+timestamp);},onRegister:function(){imagePlaceholder_=document.getElementById('imagePlaceholder');document.addEventListener('copy',this.copySelectedGraphicItems.bind(this));document.addEventListener('paste',this.pasteGraphicItems.bind(this));if(!postermywall.Core.isHighRes()){$(window).bind("beforeunload",this.onUnloadWindow_.bind(this));}},listNotificationInterests:function(){return[postermywall.Core.POSTER_CHANGED,postermywall.Core.USER_SET,postermywall.Core.GRAPHIC_ITEM_ADDED,postermywall.Core.GRAPHIC_ITEM_UPDATED,postermywall.Core.GRAPHIC_ITEM_REMOVED,postermywall.Core.BACKGROUND_UPDATED,postermywall.Core.BACKGROUND_MODIFIED,postermywall.Core.UPDATE_WATERMARK,postermywall.Core.GRAPHIC_ITEM_IMAGE_LOAD_END,postermywall.Core.GRAPHIC_ITEM_VIDEO_LOAD_END,postermywall.Core.FORCE_REFRESH,postermywall.Core.POSTER_RESIZED,postermywall.Core.ADD_IMAGE_TO_POSTER,postermywall.Core.GRAPHIC_ITEM_SHAPE_LOAD_END,postermywall.Core.GRAPHIC_ITEM_VECTOR_LOAD_END,postermywall.Core.ADD_VIDEO_TO_POSTER];},handleNotification:function(note){var b;switch(note.getName()){case postermywall.Core.POSTER_CHANGED:this.updateWatermarkProperties();this.onPosterChanged(note.getBody());this.validateTextItems(note.getBody());break;case postermywall.Core.USER_SET:this.setWatermark(note.getBody().watermark);this.validateTextItems(this.getProxy().getPoster());break;case postermywall.Core.USER_UNSET:this.setWatermark('');break;case postermywall.Core.BACKGROUND_UPDATED:this.setWhiteboardBackground(note.getBody().poster,note.getBody().cb,note.getBody().refresh);break;case postermywall.Core.BACKGROUND_MODIFIED:this.onBackgroundModified(note.getBody());break;case postermywall.Core.GRAPHIC_ITEM_ADDED:b=note.getBody();this.addGraphicItem(b.model,b.at);break;case postermywall.Core.GRAPHIC_ITEM_REMOVED:this.removeGraphicItem(note.getBody());break;case postermywall.Core.GRAPHIC_ITEM_UPDATED:this.onGraphicItemUpdated(note.getBody());break;case postermywall.Core.UPDATE_WATERMARK:this.refreshWatermark();break;case postermywall.Core.GRAPHIC_ITEM_IMAGE_LOAD_END:this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'loading-gi-'+note.getBody().uid});this.trackItemLoad(note.getBody());break;case postermywall.Core.GRAPHIC_ITEM_SHAPE_LOAD_END:case postermywall.Core.GRAPHIC_ITEM_VECTOR_LOAD_END:if(this.areItemsDuplicated_()){this.trackDuplicatedItemLoad_();this.selectDuplicatedGraphicItems();}
this.trackItemLoad(note.getBody());break;case postermywall.Core.FORCE_REFRESH:this.forceRefresh_=true;break;case postermywall.Core.POSTER_RESIZED:b=note.getBody();this.onPosterResize(b.vo,b.posterType,b.showConfirmation);break;case postermywall.Core.ADD_VIDEO_TO_POSTER:b=note.getBody();this.addVideoToPoster(b.hash,b.ext,b.src,b.duration,b.frameRate,b.voToReplace);break;case postermywall.Core.GRAPHIC_ITEM_VIDEO_LOAD_END:this.onVideoLoadEnd(note.getBody());break;case postermywall.Core.ADD_IMAGE_TO_POSTER:b=note.getBody();this.addImageToPoster(b.hash,b.ext,b.src,b.voToReplace);break;}},onUnloadWindow_:function(){if(this.getProxy().promptAboutChanges()){return $.t('pm_onUnloadWindow');}},setWatermark:function(userWatermark){},onVideoLoadEnd:function(model){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'loading-gi-'+model.uid});var m=this.getMediatorForModel(model),v=m.getViewComponent();if(!this.renderOnEachAnimationFrame&&!postermywall.Core.isHighResVideo()){this.renderOnEachAnimationFrame=true;var self=this;fabric.util.requestAnimFrame(function render(){if(self.videoPlaying){self.viewComponent.renderAll();}
fabric.util.requestAnimFrame(render);});}
var poster=this.getProxy().getPoster();poster.isVideo=true;this.trackItemLoad(model);if(model.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO&&model.duration>postermywall.core.model.vo.GraphicItemVideoVO.MAX_DURATION){var em=this.facade.retrieveMediator(postermywall.core.view.EditorMediator.NAME);em.onTrimVideo(postermywall.Core.OPEN_MODAL_VIDEO_TRIM,model);}},clearSelection:function(){this.viewComponent.discardActiveObject();this.viewComponent.discardActiveGroup(this.viewComponent.getActiveGroup());this.renderWhiteboard();},addImageToPoster:function(hash,ext,src,voToReplace){if(typeof voToReplace==='undefined'){voToReplace=null;}
if(ext=='svg'){var vo=new postermywall.core.model.vo.GraphicItemVectorVO();vo.hashedFilename=hash;}else{var vo=new postermywall.core.model.vo.GraphicItemImageVO();vo.hashedFilename=hash;vo.fileExtension=ext;vo.imageSource=src;}
if(voToReplace){vo.x=voToReplace.x;vo.y=voToReplace.y;vo.replacingAspectRatio=voToReplace.width/voToReplace.height;this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'loadImage'});var img=new Image();img.crossOrigin='anonymous';img.onload=function(){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'loadImage'});vo.width=img.width;vo.height=img.height;if(vo.replacingAspectRatio!==img.width/img.height){vo.cropOnAdd=true;}
this.facade.sendNotification(postermywall.Core.REPLACE_GRAPHIC_IMAGE,{o:voToReplace,n:vo},postermywall.Core.UNDOABLE_UPDATE);}.bind(this);img.onabort=img.onerror=function(){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'loadImage'});this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error'),debug:'StockLibraryMediator::addImageToPoster failed to load image during change image flow'});}.bind(this);img.src=postermywall.Core.repoImgURL({hashedFilename:hash,fileExtension:ext},'screen');}else{this.getCoordinatesForNewItem_(vo);}},addVideoToPoster:function(filename,ext,src,duration,frameRate,voToReplace){if(typeof voToReplace==='undefined'){voToReplace=null;}
var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),poster=postermywall.Util.cloneVO(wbp.getPoster());if(!voToReplace&&poster.isVideo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.VideoLimitReachedModalMediator'],postermywall.Core.OPEN_MODAL_VIDEO_LIMIT,{hash:filename,ext:ext,src:src,duration:duration,frameRate:frameRate,});return;}
var vo=new postermywall.core.model.vo.GraphicItemVideoVO();vo.hashedFilename=filename;vo.fileExtension=ext;vo.videoSource=src;vo.duration=vo.endTime=parseFloat(duration);vo.frameRate=parseFloat(frameRate);vo.startTime=0;if(voToReplace){vo.x=voToReplace.x;vo.y=voToReplace.y;vo.replacingAspectRatio=voToReplace.width/voToReplace.height;this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'replaceVideo'});var video=document.createElement('video');video.onloadedmetadata=this.onVideoMetaDataLoaded.bind(this,vo,voToReplace);video.addEventListener('abort',this.onVideoLoadError.bind(this),false);video.addEventListener('error',this.onVideoLoadError.bind(this),false);video.src=postermywall.core.view.GraphicItemVideoMediator.repoVideoURL(filename,ext,'screen');}else{this.getCoordinatesForNewItem_(vo);}},onVideoMetaDataLoaded:function(vo,voToReplace,e){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'replaceVideo'});vo.width=e.target.videoWidth;vo.height=e.target.videoHeight;vo.replacingAspectRatio=vo.width/vo.height;vo.startTime=0;vo.duration=vo.endTime=e.target.duration;this.facade.sendNotification(postermywall.Core.REPLACE_GRAPHIC_IMAGE,{o:voToReplace,n:vo},postermywall.Core.UNDOABLE_UPDATE);},onVideoLoadError:function(){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'replaceVideo'});this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error'),debug:'WhiteboardMediator::onVideoLoadError failed to load video during change video flow'});},updatePoster:function(changes,undoable){if(typeof undoable==='undefined'){undoable=true;}
var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var poster=postermywall.Util.cloneVO(wbp.getPoster());for(var p in changes){if(p==='length'||!changes.hasOwnProperty(p))continue;poster[p]=changes[p];}
this.facade.sendNotification(postermywall.Core.CHANGE_THEME,poster,undoable?postermywall.Core.UNDOABLE_UPDATE:postermywall.Core.NON_UNDOABLE_UPDATE);},updateSelection:function(changes,undoable){if(typeof undoable==='undefined'){undoable=true;}
this.updateGraphicItems_(changes,this.getSelectedModels(),undoable);},updateModels:function(models,changes,undoable){if(typeof undoable==='undefined'){undoable=true;}
this.updateGraphicItems_(changes,models,undoable);},updateModelByUID:function(uid,changes,undoable){if(typeof undoable==='undefined'){undoable=true;}
var model=this.getProxy().getItem(uid);if(model){this.updateGraphicItems_(changes,[model],undoable);}},duplicateSelection:function(){var selection=this.getSelectedModels();this.duplicateGraphicItems(selection,15,15);},copySelectedGraphicItems:function(e){if($(document.activeElement).is('body')){var selection=this.getSelectedModels();if(selection.length){var hasModifiedImage=false,graphicItems=[];for(var i=0;i<selection.length;i++){if(!(selection[i]instanceof postermywall.core.model.vo.GraphicItemImageVO&&selection[i].isModified())){graphicItems.push(selection[i]);}else{hasModifiedImage=true;}}
if(graphicItems.length){e.preventDefault();var poster=this.getProxy().getPoster();var group=this.viewComponent.getActiveGroup();this.copyKey=postermywall.Util.getUUID();var graphicItemsAndPoster={key:this.copyKey,graphicItems:graphicItems,poster:poster,group:{left:group?group.left:graphicItems[0].x,top:group?group.top:graphicItems[0].y}};var jsonString=JSON.stringify(graphicItemsAndPoster);(e.originalEvent||e).clipboardData.setData('application/json',jsonString);}else{this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:$.t('pm_copying_error_title'),text:$.t('pm_title_copy_disabled'),icon:true});}}}},pasteGraphicItems:function(e){if($(document.activeElement).is('body')){try{var jsonString=e.clipboardData.getData('application/json'),graphicItemsAndPoster=JSON.parse(jsonString);}catch(er){return;}
var poster=this.getProxy().getPoster();if(graphicItemsAndPoster&&typeof graphicItemsAndPoster==="object"){if(graphicItemsAndPoster.key==this.copyKey||!graphicItemsAndPoster.poster.idGalleryTemplate||graphicItemsAndPoster.poster.idGalleryTemplateCreator==this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME).getUserId()){e.preventDefault();this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'pastingGraphicItems'});var deltaX=15,deltaY=15,graphicItems=[],fonts=[];if(poster.width!=graphicItemsAndPoster.poster.width||poster.height!=graphicItemsAndPoster.poster.height){deltaX=40-(graphicItemsAndPoster.group.left);deltaY=40-(graphicItemsAndPoster.group.top);}
for(var i=0;i<graphicItemsAndPoster.graphicItems.length;i++){var graphicItem=postermywall.Util.cloneVO(graphicItemsAndPoster.graphicItems[i]);var propNames=Object.getOwnPropertyNames(graphicItem);for(var j=0;j<propNames.length;j++){var propName=propNames[j];if(graphicItem[propName]===null||graphicItem[propName]===undefined){delete graphicItem[propName];}}
if((graphicItem instanceof postermywall.core.model.vo.GraphicItemTextVO||graphicItem instanceof postermywall.core.model.vo.GraphicItemTableVO||graphicItem instanceof postermywall.core.model.vo.GraphicItemMenuVO||graphicItem instanceof postermywall.core.model.vo.GraphicItemTabsVO)&&graphicItem.fontFamily){fonts.push(graphicItem.fontFamily);}
if(postermywall.core.model.LayoutProxy.isSecondFontFamilyUsed(graphicItem.layoutStyle)&&graphicItem.fontFamily2){fonts.push(graphicItem.fontFamily2);}
graphicItems.push(graphicItem);}
this.loadFonts(fonts,this.completePasteGraphicItems_.bind(this,graphicItems,deltaX,deltaY));}
else{this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:$.t('pm_pasting_error_title'),text:$.t('pm_pasting_error'),icon:true});}}}},duplicateGraphicItems:function(graphicItems,x,y){if(graphicItems.length){var items=[],itemsToWaitFor=0;x=typeof x==='undefined'?0:x;y=typeof y==='undefined'?0:y;for(var i=0;i<graphicItems.length;i++){var toDuplicate=graphicItems[i],wbp=this.getProxy();if(this.isDuplicateAllowed(toDuplicate)&&!(toDuplicate.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&toDuplicate.imageSource==='getty'&&wbp.checkGettyMaxImageLimit(true))){var vo=postermywall.Util.cloneVO(toDuplicate);vo.uid=postermywall.Util.getUUID();if(x||y){vo.x+=x;vo.y+=y;}
if(vo.gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE||vo.gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR){itemsToWaitFor++;}
items.push(vo);}}
if(items.length>0){if(items.length>1){this.facade.retrieveProxy(postermywall.core.model.CommandHistoryProxy.NAME).clearRedo();}else if(items.length==1){items[0].isNewlyAdded=true;}
this.duplicatedItems_={items:items,itemsToWaitFor:itemsToWaitFor};this.facade.sendNotification(postermywall.Core.ADD_GRAPHIC_ITEM,items,postermywall.Core.UNDOABLE_UPDATE);}}},isDuplicateAllowed:function(graphicItem){return!((graphicItem.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&graphicItem.isModified())||graphicItem.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO)},selectDuplicatedGraphicItems:function(){if(this.areDuplicatedItemsLoaded_()){var objects=[],m=null,items=this.duplicatedItems_.items;for(var i=0;i<items.length;i++){m=this.getMediatorForModel(items[i]);objects.push(m.getViewComponent());}
this.setObjectsAsActiveGroup(objects);this.duplicatedItems_=null;}},areDuplicatedItemsLoaded_:function(){return(this.duplicatedItems_!=null&&this.duplicatedItems_.items.length>1&&this.duplicatedItems_.itemsToWaitFor==0);},areItemsDuplicated_:function(){return(this.duplicatedItems_!=null);},trackDuplicatedItemLoad_:function(){if(this.duplicatedItems_!=null&&typeof this.duplicatedItems_.itemsToWaitFor!='undefined'){this.duplicatedItems_.itemsToWaitFor--;}},deleteSelection:function(){var toDelete=this.getSelectedModels();if(toDelete.length>0){this.viewComponent.discardActiveObject();this.discardActiveGroup();this.facade.sendNotification(postermywall.Core.REMOVE_GRAPHIC_ITEMS,toDelete,postermywall.Core.UNDOABLE_UPDATE);}},deleteGraphicItems:function(toDelete){if(toDelete.length>0){this.viewComponent.discardActiveObject();this.discardActiveGroup();this.facade.sendNotification(postermywall.Core.REMOVE_GRAPHIC_ITEMS,toDelete,postermywall.Core.UNDOABLE_UPDATE);}},selectGraphicItem:function(model){var m=this.getMediatorForModel(model);if(m){this.viewComponent.setActiveObject(m.getViewComponent());}},moveSelection:function(move){var views=this.getSelectedViews();if(views.length===1){this.facade.sendNotification(postermywall.Core.MOVE_GRAPHIC_ITEM,{move:move,view:views[0]},postermywall.Core.UNDOABLE_UPDATE);this.getProxy().setUnsavedChanges(true);}},removeGraphicItem:function(item){var m=this.getMediatorForModel(item);switch(item.gitype){case postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO:var poster=this.getProxy().getPoster(),videoGraphicItemFound=false;for(var i=0;i<poster.graphicItems.length;i++){if(poster.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO){videoGraphicItemFound=true;break;}}
if(!videoGraphicItemFound){poster.isVideo=false;}
var v=m.getViewComponent(),videoElement=v.getElement();videoElement.pause();break;}
this.facade.removeMediator(postermywall.core.view.GraphicItemMediator.getNameByUID(item.uid));this.viewComponent.remove(m.getViewComponent());this.renderWhiteboard();},addGraphicItem:function(item,at){if(typeof at==='undefined'){at=-1;}
var m;switch(item.gitype){case postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE:this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'loading-gi-'+item.uid});this.setImagePlaceHoldersize_(item.height,item.width);m=new postermywall.core.view.GraphicItemImageMediator(item,imagePlaceholder_,this.completeAddGraphicItem_.bind(this,at));break;case postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO:var pc=$('<div class="progress-bar-container">');var progress=$('<div class="progress-bar">');if($.t){this.facade.sendNotification(postermywall.Core.SHOW_LOADING,{key:'loading-gi-'+item.uid,text:$.t('pm_loading_video'),priority:10,prepend:pc.append(progress)});}
m=new postermywall.core.view.GraphicItemVideoMediator(item,this.completeAddGraphicItem_.bind(this,at),progress);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT:m=new postermywall.core.view.GraphicItemTextMediator(item,this.completeAddGraphicItem_.bind(this,at));break;case postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT:this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'loading-gi-'+item.uid});this.setImagePlaceHoldersize_(item.height,item.width);m=new postermywall.core.view.GraphicItemFancyTextMediator(item,imagePlaceholder_,this.completeAddGraphicItem_.bind(this,at));break;case postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE:m=new postermywall.core.view.GraphicItemShapeMediator(item,this.viewComponent,this.completeAddGraphicItem_.bind(this,at),at);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR:m=new postermywall.core.view.GraphicItemVectorMediator(item,this.viewComponent,this.completeAddGraphicItem_.bind(this,at),at);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TAB:m=new postermywall.core.view.GraphicItemTabsMediator(item,this.completeAddGraphicItem_.bind(this,at));break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE:m=new postermywall.core.view.GraphicItemTableMediator(item,this.viewComponent,new fabric.Table([],{}),this.completeAddGraphicItem_.bind(this,at));break;case postermywall.core.model.vo.GraphicItemVO.TYPE_MENU:m=new postermywall.core.view.GraphicItemMenuMediator(item,this.viewComponent,this.completeAddGraphicItem_.bind(this,at));break;}},completeAddGraphicItem_:function(at,m){var model=m.getModel();if(model.isNewlyAdded){this.facade.retrieveProxy(postermywall.core.model.CommandHistoryProxy.NAME).clearRedo();}
this.facade.registerMediator(m);m.invalidate(this.viewComponent,null);if(at>=0&&at<this.viewComponent.getObjects().length){if(model.doReplaceItem()){this.viewComponent.insertAt(m.getViewComponent(),at,true);}
else{this.viewComponent.insertAt(m.getViewComponent(),at);}}
else{if(m.hasShadow()&&postermywall.Core.isHighRes()&&m.getModel()instanceof postermywall.core.model.vo.GraphicItemTextVO){m.addHighresShadow(this.viewComponent);}
if(model.doReplaceItem()){var views=this.viewComponent.getObjects();for(var i=0;i<views.length;i++){if(postermywall.core.view.GraphicItemMediator.getViewComponentUID(views[i])===model.uid){this.viewComponent.insertAt(m.getViewComponent(),i,true);m.invalidate(this,null);this.ensureWatermarkIsVisible();this.renderWhiteboard();m.getViewComponent().setCoords();this.facade.sendNotification(postermywall.Core.GRAPHIC_ITEM_VECTOR_LOAD_END,model);return;}}}
else{this.viewComponent.add(m.getViewComponent());}}
if(model.gitype!==postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR&&model.gitype!==postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE&&model.gitype!==postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE&&model.gitype!==postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO&&model.gitype!==postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT){this.trackItemLoad(model);}
this.ensureWatermarkIsVisible();this.renderWhiteboard();},onGraphicItemUpdated:function(item){var m=this.getMediatorForModel(item);m.invalidate(this.viewComponent,item);this.renderWhiteboard();m.getViewComponent().setCoords();},discardActiveGroup:function(){this.viewComponent.discardActiveGroup();},setObjectsAsActiveGroup:function(objects){this.viewComponent.setObjectsAsActiveGroup(objects);},setName:function(n){this.getProxy().setName(n);},setDescription:function(d){this.getProxy().setDescription(d);},positionWhiteboard:function(left,top,calcOffset){this.viewContainer.css({left:left+'px',top:top+'px'});if(calcOffset){var self=this;setTimeout(function(){self.viewComponent.calcOffset();},50);}},moveWhiteboard:function(dx,dy,calcOffset){var vcleft=parseInt(this.viewContainer.css('left').replace(/px/,''),10),vctop=parseInt(this.viewContainer.css('top').replace(/px/,''),10);this.positionWhiteboard(vcleft+dx,vctop+dy,calcOffset);},scaleWhiteboard:function(poster,scale){if(!poster){poster=this.getProxy().getPoster();}
this.scale_=scale;this.viewComponent.setDimensions({width:poster.width*this.scale_,height:poster.height*this.scale_}).setZoom(this.scale_);},toggleAlignmentGuides:function(val){if(typeof val=='undefined'){val=!this.viewComponent.areAlignmentGuidesEnabled;}
this.viewComponent.areAlignmentGuidesEnabled=val;},refreshWatermark:function(mode,showPMW){if(typeof showPMW=='undefined'){showPMW=true;}
var user=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME).getUser();if(user!=null&&user.getPremiumLevel()){showPMW=false;}
function getAttribution_(name){return'Background by '+name;}
var poster=this.getProxy().getPoster();if(poster===null){return;}
var text='',attrText='',linesCount=1,fontSize=this.watermarkFontSize_,attrFontSize=this.watermarkFontSize_,textAlign='left',topOffset,attrTopOffset,doRender=false,defaults={fill:'#000000',shadow:'rgba(255,255,255,1) 0px 0px 8px',opacity:0.5,fontFamily:'sans-serif',selectable:false,hasControls:false,hasBorders:false,lockRotation:true,lockScalingX:true,lockScalingY:true};if(typeof mode==='undefined'){mode='normal';}
if(postermywall.Core.isHighRes()){if(poster.theme.background.displayAttribution&&poster.theme.background.requiresAttribution()){attrText=getAttribution_(poster.theme.background.attributionName);attrFontSize=5;}}
else{if(showPMW){text='PosterMyWall.com';}else{text='';linesCount--;}
if(poster.creator!=null){if(poster.creator.watermark!='-1'){text=poster.creator.watermark;}}
else{if(user!=null&&user.watermark!='-1'){text=user.watermark;}}
if(poster.isPremium){if(text.length>0){text+='\nPremium Content';}
else{text='Premium Content';}
linesCount++;}
if(poster.theme.background.requiresAttribution()){attrText=getAttribution_(poster.theme.background.attributionName);}}
var watermarkChangeFactor=(poster.height/30);var attrChangeFactor=(poster.height/45);if(poster.width<poster.height){watermarkChangeFactor=(poster.width/30);attrChangeFactor=(poster.width/45);}
if(mode==='premium'){fontSize=this.watermarkFontSize_+watermarkChangeFactor;attrFontSize=this.watermarkFontSize_+attrChangeFactor;textAlign='center';}
if(attrText.length>0){linesCount++;}
var extraTranslation=(poster.height/70);if(textAlign==='center'){extraTranslation=(poster.height/10);}
topOffset=Math.ceil(poster.height-(linesCount*fontSize*(linesCount>1?1.25:1)+extraTranslation));attrTopOffset=poster.height-(fontSize+extraTranslation);if(mode==='premium'){var translation=poster.height/3;topOffset-=translation;attrTopOffset-=translation;}
if(this.watermarkAdvertView===null){if(text.length>0){var advertOptions={top:topOffset,left:10,fontSize:fontSize,lineHeight:1.2,textAlign:textAlign};$.extend(advertOptions,defaults);this.watermarkAdvertView=new fabric.Text(text,advertOptions);this.viewComponent.add(this.watermarkAdvertView);}}
else{this.watermarkAdvertView.set({text:text,fontSize:fontSize,top:topOffset,left:10,textAlign:textAlign});if(textAlign==='center'){this.watermarkAdvertView.set({left:Math.max(Math.round((poster.width-this.watermarkAdvertView.width)/2),10)})}
doRender=true;}
if(this.watermarkAttributionView===null){if(attrText.length>0){var attrOptions={top:attrTopOffset,left:10,fontSize:attrFontSize,lineHeight:1.2,textAlign:textAlign};$.extend(attrOptions,defaults);this.watermarkAttributionView=new fabric.Text(attrText,attrOptions);this.viewComponent.add(this.watermarkAttributionView);}}
else{this.watermarkAttributionView.set({text:attrText,fontSize:attrFontSize,top:attrTopOffset,left:10,textAlign:textAlign});if(textAlign==='center'){this.watermarkAttributionView.set({left:Math.max(Math.round((poster.width-this.watermarkAttributionView.width)/2),10)})}
doRender=true;}
if(doRender){this.renderWhiteboard();}
this.isWatermarkVisible_=showPMW;},ensureWatermarkIsVisible:function(){if(this.watermarkAdvertView){this.viewComponent.remove(this.watermarkAdvertView);this.viewComponent.add(this.watermarkAdvertView);}
if(this.watermarkAttributionView){this.viewComponent.remove(this.watermarkAttributionView);this.viewComponent.add(this.watermarkAttributionView);}},onItemsLoaded:function(){this.renderWhiteboard();this.sendNotification(postermywall.Core.POSTER_GRAPHICITEMS_LOADED);if(postermywall.Core.isHighResVideo()){var a=document.createElement("a");a.setAttribute('id','graphic-items-loaded');document.body.appendChild(a);}},videoRecordingData_:{videoElement:null,videoFrame:null,frameTime:0,fps:0,secondsToMicroSeconds:1000000,seekedDetectionInterval:null,videoGraphicItem:null,allVideoFrames:[]},initializeWhiteboardVideoRecording:function(scaleFactor,fps){var poster=this.getProxy().getPoster(),self=this;for(var i=0;i<poster.graphicItems.length;i++){if(poster.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO){var m=this.getMediatorForModel(poster.graphicItems[i]),v=m.getViewComponent();this.videoRecordingData_.videoGraphicItem=poster.graphicItems[i];this.videoRecordingData_.videoElement=v.getElement();break;}}
this.videoRecordingData_.fps=fps;this.videoRecordingData_.videoElement.addEventListener('seeked',setVideoFrame.bind(this),false);var seekedDetected=true;this.videoRecordingData_.seekedDetectionInterval=setInterval(function(){if(seekedDetected){seekedDetected=false;}else{self.videoRecordingData_.videoElement.currentTime+=0;}},5000);function setVideoFrame(){seekedDetected=true;this.viewComponent.renderAll();this.videoRecordingData_.videoFrame=this.viewComponent.toDataURL({format:'png',quality:1});var a=document.createElement("a");a.setAttribute('id','frame-done-'+(Math.round(this.videoRecordingData_.frameTime*this.videoRecordingData_.secondsToMicroSeconds)));document.body.appendChild(a);}
if(scaleFactor!=1){this.scaleWhiteboard(poster,scaleFactor);}
return true;},getVideoFrame:function(){return this.videoRecordingData_.videoFrame;},getVideoFrameAt:function(index){return this.videoRecordingData_.allVideoFrames[index]?this.videoRecordingData_.allVideoFrames[index]:-1;},generateAllVideoFrames:function(scaleFactor,endTime){var poster=this.getProxy().getPoster(),self=this,videoElement=null,videoGraphicItem=null,previousFrameTime=0,currentFrameTime=0,imageData=null,stopRecording=false;if(scaleFactor>0){this.scaleWhiteboard(poster,scaleFactor);}
for(var i=0;i<poster.graphicItems.length;i++){if(poster.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO){var m=this.getMediatorForModel(poster.graphicItems[i]),v=m.getViewComponent();videoGraphicItem=poster.graphicItems[i];videoElement=v.getElement();break;}}
videoElement.play().then(function(){setTimeout(function(){stopRecording=true;},endTime*1000);}).catch(function(error){PMW.log("ERROR: WhiteboardMediator::generateAllVideoFrames error on playing video for poster: "+poster.hashedFilename);var a=document.createElement("a");a.setAttribute('id','all-frames-done');document.body.appendChild(a);});fabric.util.requestAnimFrame(function render(){if(!stopRecording){self.viewComponent.renderAll();imageData=self.viewComponent.toDataURL({format:'png',quality:1});currentFrameTime=previousFrameTime?(new Date().getTime())-previousFrameTime:30;previousFrameTime=new Date().getTime();self.videoRecordingData_.allVideoFrames.push({frameTime:currentFrameTime,frameData:imageData});fabric.util.requestAnimFrame(render);}else{var a=document.createElement("a");a.setAttribute('id','all-frames-done');document.body.appendChild(a);}});},generateAllFramesUsingImages:function(data){var poster=this.getProxy().getPoster(),self=this,videoElement=null,videoGraphicItem=null,previousFrameTime=0,currentFrameTime=0,imageData=null,stopRecording=false;console.log('__________________-1');console.log(data.length);console.log(data.substring(0,100));var image=new Image();image.onload=function(){console.log('image.onLoad',(window.performance.now()-setSourceTime));self.viewComponent.renderAll();};var setSourceTime=window.performance.now();image.src=data;return;function setImage(){}
var fileName='',imageArray=[],frameIndex=1,totalTime=(new Date().getTime());loadNextShit();var imageobject=null,imageElement=null;function loadNextShit(){fileName='000'+frameIndex;fileName=postermywall.Core.serverRoot+'assets/frames/'+fileName.slice(-3)+'.bmp';console.log(fileName);fabric.Image.fromURL(fileName,function(myImg){if(!imageobject){imageobject=myImg;imageElement=imageobject.getElement();}
var img1=myImg.set({left:50,top:50,width:250,height:250});self.viewComponent.add(img1);self.viewComponent.renderAll();frameIndex++;imageData=self.viewComponent.toDataURL({format:'png',quality:1});if(frameIndex<100){loadNextImage();}else{totalTime=totalTime-(new Date().getTime());console.log(totalTime);var a=document.createElement("a");a.setAttribute('id','all-frames-done');document.body.appendChild(a);}});}
function loadNextImage(){fileName='000'+frameIndex;fileName=postermywall.Core.serverRoot+'assets/frames/'+fileName.slice(-3)+'.bmp';imageobject.getElement().src=fileName;imageobject.getElement().onload=function(e){console.log('loaded');self.viewComponent.renderAll();}}
console.log(imageArray);},setVideoTime:function(time){this.videoRecordingData_.frameTime=time;var delta=Math.round((0.5/this.videoRecordingData_.fps)*this.videoRecordingData_.secondsToMicroSeconds)/this.videoRecordingData_.secondsToMicroSeconds,varTime=Math.round((time+delta)*this.videoRecordingData_.secondsToMicroSeconds)/this.videoRecordingData_.secondsToMicroSeconds;this.videoRecordingData_.videoElement.currentTime=(this.videoRecordingData_.videoGraphicItem.duration<varTime)?time:varTime;},onDrag:function(e,s){if(s.fingers===3&&s.gesture==='drag'){if(s.state==='down'){this._dragId=s.identifier;this._dragX=s.x;this._dragY=s.y;}
else if(s.state==='move'){if(s.identifier!==this._dragId){return;}
this.moveWhiteboard(s.x-this._dragX,s.y-this._dragY,false);this._dragX=s.x;this._dragY=s.y;}
else if(s.state==='up'){this.moveWhiteboard(0,0,true);}}},onPosterChanged:function(poster){if(poster===null){this.viewComponent.clear();}
else{this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'background'});this.loadFontsForPoster(poster,this.onFontsLoaded);}},validateTextItems:function(poster){if(poster==null){return;}
var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);for(var i=0;i<poster.graphicItems.length;i++){if(poster.graphicItems[i]instanceof postermywall.core.model.vo.GraphicItemTextVO||poster.graphicItems[i]instanceof postermywall.core.model.vo.GraphicItemTabsVO){poster.graphicItems[i].editable=this.isTextEditable(poster.graphicItems[i],poster,up);}}},isTextEditable:function(item,poster,up){return((item.fontLicense=='')||up.isContributor()||poster.creator==null||(item.fontLicense==postermywall.core.model.AppProxy.USER_FONT_LICENSE&&!('owner'in poster)&&(poster.creator&&up.getUserId()==poster.creator.id))||(item.fontLicense==postermywall.core.model.AppProxy.USER_FONT_LICENSE&&poster.owner&&up.getUserId()==poster.owner.id))},onFontsLoaded:function(poster,success){if(!success){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'background'});this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_font_load_error')});}
if(!this.viewComponent){var c=document.getElementById('whiteboard');if(postermywall.Core.isHighRes()){c.width=poster.width;c.height=poster.height;this.setViewComponent(new fabric.StaticCanvas(c,{renderOnAddition:false}));}
else{c.width=1;c.height=1;this.setViewComponent(new fabric.Canvas(c,{hoverCursor:'pointer',selection:true,controlsAboveOverlay:true}));initAligningGuidelines(this.viewComponent);this.viewComponent.on('object:selected',this.onSelectionCreated.bind(this));this.viewComponent.on('selection:created',this.onSelectionCreated.bind(this));this.viewComponent.on('selection:cleared',this.onSelectionCleared.bind(this));this.viewComponent.on('object:modified',this.onViewModified.bind(this));if(postermywall.Core.isTouchSupported){this.viewComponent.on('touch:dbltap',this.onShowItemOptions_.bind(this));this.viewComponent.on('touch:longpress',this.onShowItemOptions_.bind(this));}
else if(!bowser.msie){this.viewComponent.on('touch:dbltap',this.onDoubleClickItem_.bind(this));}}
this.viewContainer=$(this.viewComponent.lowerCanvasEl.parentNode);}
else{this.viewComponent.clear();}
this.setWhiteboardBackground(poster,this.loadGraphicItems.bind(this,poster),false,true);},onBackgroundModified:function(backgroundModification){if(this.viewComponent.backgroundImage){while(this.viewComponent.backgroundImage.filters.length){this.viewComponent.backgroundImage.filters.pop();}
if(backgroundModification.filterType==postermywall.core.model.vo.BackgroundModificationVO.FILTER_TYPE_BLACK_AND_WHITE){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Grayscale());}
else if(backgroundModification.filterType==postermywall.core.model.vo.BackgroundModificationVO.FILTER_TYPE_SEPIA){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Sepia2());}
if(backgroundModification.tint){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Tint({color:fabric.Color.fromSource(backgroundModification.tintColor.concat([backgroundModification.tintOpacity])).toRgba()}));}
if(backgroundModification.multiply){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Multiply({color:fabric.Color.fromSource(backgroundModification.multiplyColor.concat([1])).toRgba()}));}
if(backgroundModification.brightness!=0){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Brightness({brightness:backgroundModification.brightness}));}
if(backgroundModification.contrast!=0){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Contrast({contrast:backgroundModification.contrast}));}
if(backgroundModification.saturation!=0){this.viewComponent.backgroundImage.filters.push(new fabric.Image.filters.Saturate({saturate:backgroundModification.saturation}));}
this.viewComponent.backgroundImage.applyFilters(this.viewComponent.renderAll.bind(this.viewComponent));}},setWhiteboardBackground:function(poster,cb,refresh,isPosterLoading){if(typeof refresh==='undefined'){refresh=false;}
if(typeof isPosterLoading==='undefined'){isPosterLoading=false;}
this.getProxy().updatePosterIsPremium(null);if(!postermywall.Core.isHighRes()){this.sendNotification(postermywall.Core.REFRESH_BACKGROUND_OPTIONS);}
if(poster.theme.background.fillType===postermywall.core.model.vo.BackgroundVO.FILLTYPE_SOLID){var that;if(poster.backgroundType_===0){this.viewComponent.backgroundColor='#'+poster.primaryColor;this.viewComponent.setBackgroundImage(null);this.onSetBackgroundImageDone_(cb);}
else if(poster.backgroundType_===1){if(postermywall.Core.isHighRes()){this.viewComponent.setBackgroundImage(null);this.onSetBackgroundImageDone_(cb);}
else{var buffer=this.getGradientBackground(poster.width,poster.height,poster.gradient,poster.primaryColor,poster.secondaryColor);var loader=document.createElement('img');loader.onload=this.setBackgroundImage_.bind(this,new fabric.Image(loader),cb);loader.src=buffer.toDataURL('image/png');}}}
else{if(postermywall.Core.isHighRes()){this.onSetBackgroundImageDone_(cb);}
else{this.viewComponent.backgroundColor='#ffffff';if(poster.theme.background.isImage()){that=this;var xmlHTTP=new XMLHttpRequest();if('onprogress'in xmlHTTP){var pc=$('<div class="progress-bar-container">');var progress=$('<div class="progress-bar">');var img=new Image();xmlHTTP.open('GET',this.getBackgroundURL_(poster,refresh,isPosterLoading),true);xmlHTTP.responseType='arraybuffer';xmlHTTP.onload=function(e){var h=xmlHTTP.getAllResponseHeaders(),m=h.match(/^Content-Type\:\s*(.*?)$/mi),mimeType=m[1]||'image/png';var blob=new Blob([this.response],{type:mimeType});var blobURL=window.URL.createObjectURL(blob);img.onload=function(){that.setBackgroundImage_(new fabric.Image(img),cb);window.URL.revokeObjectURL(blobURL);};img.onerror=function(){that.onBackgroundImageFail_(poster,cb);};img.onabort=function(){that.onBackgroundImageFail_(poster,cb);};img.src=blobURL;};xmlHTTP.onprogress=function(e){if(e.lengthComputable){progress.width(((e.loaded/e.total)*100)+'%');}else{progress.width('90%');}};xmlHTTP.onabort=function(){that.onBackgroundImageFail_(poster,cb);};xmlHTTP.onerror=function(){that.onBackgroundImageFail_(poster,cb);};xmlHTTP.onloadstart=function(){if(!postermywall.Core.isHighRes()){that.sendNotification(postermywall.Core.SHOW_LOADING,{key:'downloadBGImage',text:poster.theme.background.source==='upload'?$.t('pm_loading'):$.t('pm_downloading_background'),priority:10,prepend:pc.append(progress)});}};xmlHTTP.onloadend=function(){that.sendNotification(postermywall.Core.HIDE_LOADING,{key:'downloadBGImage'});};xmlHTTP.send();}else{this.setBackgroundImage_(this.getBackgroundURL_(poster,refresh,isPosterLoading),cb);}}}}},onBackgroundImageFail_:function(poster,cb){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'downloadBGImage'});this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_load_background_error')});var blankPoster=postermywall.Util.cloneVO(poster);blankPoster.setSolidBackground();this.facade.sendNotification(postermywall.Core.CHANGE_THEME,blankPoster,postermywall.Core.NON_UNDOABLE_UPDATE);cb();},setBackgroundImage_:function(imgOrURL,cb){var p=this.getProxy().getPoster();this.viewComponent.setBackgroundImage(imgOrURL,this.onSetBackgroundImageDone_.bind(this,cb),{width:p.width+1,height:p.height+1,originX:'left',originY:'top',top:-1,left:-1});},onSetBackgroundImageDone_:function(cb){var wbp=this.getProxy(),p=wbp.getPoster();this.sendNotification(postermywall.Core.POSTER_BACKGROUND_LOADED,p);if(!postermywall.Core.isHighRes()&&p.theme.background.isImage()){this.onBackgroundModified(p.backgroundModification);}
this.refreshWatermark('normal');cb();this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'background'});this.renderWhiteboard();},getBackgroundURL_:function(poster,refresh,isPosterLoading){if(typeof refresh==='undefined'){refresh=false;}
if(typeof isPosterLoading==='undefined'){isPosterLoading=false;}
if(this.forceRefresh_){refresh=true;this.forceRefresh_=false;}
var url='',bg=poster.theme.background,name=bg.id+'.'+bg.fileExtension;if(bg.fillType===postermywall.core.model.vo.BackgroundVO.FILLTYPE_COLLAGE){url=postermywall.Core.repoURL('custombackgrounds/'+name,postermywall.Core.writeBucket,true);}
else if(poster.backgroundModification!=null&&poster.backgroundModification.isCropped()){var source=bg.source?bg.source:'-1',imageId=bg.name?bg.name:'-1',hashedID=poster.hashedID.length>0?poster.hashedID:'-1',mod=poster.backgroundModification,tempUID=(typeof bg.tempUID=='undefined'||bg.tempUID=='')?(isPosterLoading?'-1':'0'):bg.tempUID;url=PMW.util.site_url(['posterimage/getmodifiedbackgroundscreen_v2',hashedID,poster.width,poster.height,bg.id,bg.fileExtension,source,imageId,mod.x,mod.y,mod.width,mod.height,tempUID,refresh?'1':'0'].join('/'));}
else{if(bg.fillType===postermywall.core.model.vo.BackgroundVO.FILLTYPE_CUSTOM_IMAGE){url=postermywall.Core.repoURL('custombackgrounds/'+name,postermywall.Core.writeBucket,true);}
else if(bg.fillType===postermywall.core.model.vo.BackgroundVO.FILLTYPE_IMAGE){url=postermywall.Core.repoURL('backgrounds/'+name,postermywall.Core.readBucket,true);}}
if(refresh){url+='?ts='+new Date().getTime();}
return url;},getGradientBackground:function(width,height,gradientType,c1,c2){return this.getGradientCanvas(width,height,gradientType,c1,c2,0,0,width,height);},getGradientCanvas:function(width,height,gradientType,color1,color2,tileLeft,tileTop,tileWidth,tileHeight){var buffer=document.getElementById('bufferCanvas'),ctx=buffer.getContext('2d'),gradient,centerX=width/2;buffer.width=tileWidth;buffer.height=tileHeight;ctx.rect(0,0,buffer.width,buffer.height);if(gradientType===postermywall.core.model.vo.PosterVO.GRADIENT_RADIAL){var centerY=height/2;gradient=ctx.createRadialGradient(centerX-tileLeft,centerY-tileTop,0,centerX-tileLeft,centerY-tileTop,Math.max(width,height));}
else if(gradientType===postermywall.core.model.vo.PosterVO.GRADIENT_LINEAR){gradient=ctx.createLinearGradient(centerX-tileLeft,0-tileTop,centerX-tileLeft,height-tileTop);}
gradient.addColorStop(0,'#'+color1);gradient.addColorStop(1,'#'+color2);ctx.fillStyle=gradient;ctx.fill();return buffer;},renderWhiteboard:function(){if(!this.renderTimeoutID_){if(new Date().getTime()-this.renderTimestamp_>this.renderDelay_){this.doRenderWhiteboard_();}
else{this.renderTimeoutID_=setTimeout(this.doRenderWhiteboard_.bind(this),this.renderDelay_);}}},getCoordinatesForNewItem_:function(vo){var offset=this.facade.retrieveMediator(postermywall.core.view.EditorMediator.NAME).getCoordinatesForNewItem();vo.x=offset.x;vo.y=offset.y;vo.width=-1;vo.height=-1;this.facade.sendNotification(postermywall.Core.ADD_GRAPHIC_ITEM,[vo],postermywall.Core.UNDOABLE_UPDATE);},doRenderWhiteboard_:function(){this.viewComponent.renderAll();this.renderTimestamp_=new Date().getTime();this.renderTimeoutID_=0;},getSnapshot:function(scale,showPMWWatermark){if(typeof showPMWWatermark=='undefined'){showPMWWatermark=true;}
var premiumWatermark=this.getProxy().getPoster().isPremium;if(premiumWatermark){this.refreshWatermark('premium',showPMWWatermark);}else if(!showPMWWatermark){this.refreshWatermark('normal',showPMWWatermark);}
var bits=this.viewComponent.toDataURL({format:'jpeg',quality:1,multiplier:1/this.scale_*scale,scaleShadow:true});if(premiumWatermark||!showPMWWatermark){this.refreshWatermark('normal',true);}
return bits;},loadGraphicItems:function(poster){loadCount_=poster.graphicItems.length;if(loadCount_===0){this.onItemsLoaded();return;}
switch(PMConfig.command){case'resize':this.resizeGraphicItems_(poster.graphicItems,PMConfig.resizeList);break;case'replace':this.showReplaceOption_(poster.graphicItems);break;}
if(postermywall.Core.isHighRes()){this.addGraphicItem(poster.graphicItems[queuedLoadingIndex_]);}
else{for(var i=0;i<poster.graphicItems.length;i++){this.addGraphicItem(poster.graphicItems[i],i);}}
if(PMConfig.command===null||(PMConfig.command!==null&&!(PMConfig.command==='regen'))){if(poster!==null&&poster.id>0&&poster.creator!==null){var user=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME).getUser();if(user!==null&&poster.creator.id===user.id&&!user.getPremiumLevel()){this.sendNotification(postermywall.Core.IS_POSTER_PURCHASED,{id:poster.id});}}}},resizeGraphicItems_:function(items,newSizes){for(var i=0;i<items.length;i++){if(typeof newSizes[items[i].uid]!=='undefined'){var item=items[i];item.scaleX=item.scaleY=1;item.width=newSizes[item.uid].w;item.height=newSizes[item.uid].h;}}
this.getProxy().setUnsavedChanges(true);},showReplaceOption_:function(items){for(var i=0;i<items.length;i++){if(items[i].gitype==='image'){items[i].showReplaceOption();}}},getWrappedLinesForModel:function(m){var med=this.getMediatorForModel(m);if(med){return med.getWrappedLines();}
return null;},getMediatorForView:function(vc){return this.facade.retrieveMediator(postermywall.core.view.GraphicItemMediator.getName(vc));},getMediatorForModel:function(m){return this.facade.retrieveMediator(postermywall.core.view.GraphicItemMediator.getNameByUID(m.uid));},onShowItemOptions_:function(e){this.sendNotification(postermywall.Core.SHOW_GRAPHIC_ITEM_OPTIONS,e);},onDoubleClickItem_:function(e){this.sendNotification(postermywall.Core.GRAPHIC_ITEM_DOUBLE_CLICK,e);},refreshSelection:function(){var o=this.viewComponent.getActiveObject();if(o){this.viewComponent.discardActiveObject();this.viewComponent.setActiveObject(o);}},onSelectionCreated:function(){if(!this.isColorPickMode){var s=this.getSelectedModels();if(s.length>0){this.sendNotification(postermywall.Core.SELECTION_CREATED,s);}}},onSelectionCleared:function(){if(!this.isColorPickMode){this.sendNotification(postermywall.Core.SELECTION_CLEARED,null);}},enableColorPickMode:function(el){var pickerRgb=el[0].style.backgroundColor;pickerRgb=pickerRgb.substring(4,pickerRgb.length-1).replace(/ /g,'').split(',');var currentColor={r:parseInt(pickerRgb[0]),g:parseInt(pickerRgb[1]),b:parseInt(pickerRgb[2])},selectedItem=this.viewComponent.getActiveObject();this.isColorPickMode=true;this.viewContainer.offsetParent().addClass('-pick-color');this.__onColorPicking=this.onColorPicking.bind(this,el);this.__onColorPicked=this.onColorPicked.bind(this,selectedItem);this.__onRevertColor=this.onColorRevert.bind(el,currentColor);this.viewComponent.on('mouse:move',this.__onColorPicking);this.viewComponent.on('mouse:down',this.__onColorPicked);this.viewContainer.on("mouseout",this.__onRevertColor);},disableColorPickMode:function(){this.viewComponent.off('mouse:move',this.__onColorPicking);this.viewComponent.off('mouse:down',this.__onColorPicked);this.viewContainer.off('mouseout',this.__onRevertColor);this.isColorPickMode=false;this.viewContainer.offsetParent().removeClass('-pick-color');},onColorPicked:function(o){if(o!=null){this.viewComponent.setActiveObject(o);}
else{this.viewComponent.discardActiveObject();}},onColorPicking:function(el){this.viewComponent.setCursor('url("'+postermywall.Core.serverRoot+'assets/images/postermaker/color-picker.ico") 0 16 , crosshair');var cursorCoords=this.viewComponent.getPointer(),scale=this.getScale(),p=this.viewComponent.contextContainer.getImageData((cursorCoords.x*scale),(cursorCoords.y*scale),1,1).data;el.colpickSetColor({r:p[0],g:p[1],b:p[2]});},onColorRevert:function(color){this.colpickSetColor(color);},onViewModified:function(e){var objects=null,group=null;if(e.target.type=='group'){group=e.target;objects=group.getObjects();}else{objects=[e.target];}
this.modifyView_(objects,group);},modifyView_:function(objects,group){var m=null,viewsAndModels=[];if(typeof group==='undefined'){group=null;}
for(var i=0;i<objects.length;i++){m=this.getMediatorForView(objects[i]);if(typeof m=='undefined'){return;}
m.setViewComponent(objects[i]);viewsAndModels.push({view:objects[i],model:m.getModel()});}
this.updateVisuals_(viewsAndModels,group);},updateVisuals_:function(viewsAndModels,group){var changes=[],models=[];if(typeof group==='undefined'){group=null;}
if(group){var p,b,radius,initialAngle=0,angle=0;}
for(var i=0;i<viewsAndModels.length;i++){models[i]=viewsAndModels[i].model;if(group){p=(viewsAndModels[i].view.left*group.scaleX)+(group.width*group.scaleX)/2;b=(viewsAndModels[i].view.top*group.scaleY)+(group.height*group.scaleY)/2;radius=Math.hypot(p,b);initialAngle=Math.atan(b/p);angle=initialAngle+fabric.util.degreesToRadians(group.angle);}
changes[i]={x:group?group.left+(radius*Math.cos(angle)):viewsAndModels[i].view.left,y:group?group.top+(radius*Math.sin(angle)):viewsAndModels[i].view.top,width:viewsAndModels[i].view.width,height:viewsAndModels[i].view.height,rotation:group?((group.angle+viewsAndModels[i].view.angle)>=360?(group.angle+viewsAndModels[i].view.angle-360):(group.angle+viewsAndModels[i].view.angle)):viewsAndModels[i].view.angle,scaleX:group?group.scaleX*viewsAndModels[i].view.scaleX:viewsAndModels[i].view.scaleX,scaleY:group?group.scaleY*viewsAndModels[i].view.scaleY:viewsAndModels[i].view.scaleY};}
this.updateGraphicItems_(changes,models);},updateGraphicItems_:function(changes,models,undoable){if(typeof undoable==='undefined'){undoable=true;}
this.sendNotification(postermywall.Core.UPDATE_GRAPHIC_ITEMS,{models:models,changes:changes},undoable?postermywall.Core.UNDOABLE_UPDATE:postermywall.Core.NON_UNDOABLE_UPDATE);this.facade.retrieveProxy(postermywall.core.model.CommandHistoryProxy.NAME).clearRedo();},notifyTextChanged:function(model){this.sendNotification(postermywall.Core.GRAPHIC_ITEM_TEXT_UPDATED,{model:model});},trackItemLoad:function(model){loadCount_--;if(postermywall.Core.isHighRes()){var poster=this.getProxy().getPoster();queuedLoadingIndex_++;if(queuedLoadingIndex_<poster.graphicItems.length){this.addGraphicItem(poster.graphicItems[queuedLoadingIndex_]);return;}}
if(!postermywall.Core.isHighRes()){if(model.isNewlyAdded){var m=this.getMediatorForModel(model);if(m){this.discardActiveGroup();this.viewComponent.setActiveObject(m.getViewComponent());}
model.isNewlyAdded=false;}
if(model.cropOnAdd){model.cropOnAdd=false;this.sendNotification(postermywall.Core.CROP,model);}}
if(loadCount_===0){this.onItemsLoaded();}},getSelectedModels:function(){var views=this.getSelectedViews();if(views.length===0){return[];}
var models=[];for(var i=0;i<views.length;i++){models[models.length]=this.getMediatorForView(views[i]).getModel();}
return models;},getSelectedGroup:function(){return this.viewComponent.getActiveGroup();},updateGroupSelection:function(changes){var group=this.getSelectedGroup();group.set(changes);this.modifyView_(group.getObjects(),group);this.renderWhiteboard();},alignSelection:function(type,undoable){if(typeof undoable=='undefined'){undoable=true}
var view=this.getSelectedViews(),isGroup=(view.length>1),m=isGroup?this.getSelectedGroup():this.getMediatorForView(view[0]),canvasCenter=this.viewComponent.getCenter(),viewCenter=m.getCenterPoint(),point={x:0,y:0},c;switch(type){case'vertical':point.x=viewCenter.x;point.y=canvasCenter.top/this.scale_;break;case'horizontal':point.x=canvasCenter.left/this.scale_;point.y=viewCenter.y;break;case'center':point.x=canvasCenter.left/this.scale_;point.y=canvasCenter.top/this.scale_;break;case'left':c=m.getCornerPoints(viewCenter);var minX=Math.min(c.tl.x,c.tr.x,c.bl.x,c.br.x);point.x=viewCenter.x-minX+this.alignmentPadding;point.y=viewCenter.y;break;case'right':c=m.getCornerPoints(viewCenter);var maxX=Math.max(c.tl.x,c.tr.x,c.bl.x,c.br.x);point.x=viewCenter.x+(this.viewComponent.width/this.scale_)-maxX-this.alignmentPadding;point.y=viewCenter.y;break;case'top':c=m.getCornerPoints(viewCenter);var minY=Math.min(c.tl.y,c.tr.y,c.bl.y,c.br.y);point.x=viewCenter.x;point.y=viewCenter.y-minY+this.alignmentPadding;break;case'bottom':c=m.getCornerPoints(viewCenter);var maxY=Math.max(c.tl.y,c.tr.y,c.bl.y,c.br.y);point.x=viewCenter.x;point.y=viewCenter.y+(this.viewComponent.height/this.scale_)-maxY-this.alignmentPadding;break;default:return}
var corner=m.getCornerPoints(point);if(isGroup){m.set({left:Math.round(corner.tl.x),top:Math.round(corner.tl.y)});this.modifyView_(view,m);}
else{this.updateSelection([{x:Math.round(corner.tl.x),y:Math.round(corner.tl.y)}],undoable);}},setGroupSpacing:function(type){var group=this.getSelectedGroup(),views=group.getObjects(),filledSpace,emptySpace=0,spaceBetweenEachItem=0,prevItem,nextItem,prevItemCorners,nextItemCorners,prevMax,nextMin,i=0;switch(type){case'vertical':views.sort(this.sortByPosition_.bind(this,'x'));filledSpace=this.getFilledSpace_(views,group,'x');emptySpace=group.width-filledSpace;spaceBetweenEachItem=emptySpace/(views.length-1);for(i=1;i<views.length;i++){views[i].set({left:views[i-1].left});prevItem=this.getMediatorForView(views[i-1]);nextItem=this.getMediatorForView(views[i]);prevItemCorners=prevItem.getCornerPoints();nextItemCorners=nextItem.getCornerPoints();prevMax=Math.max(prevItemCorners.tl.x,prevItemCorners.tr.x,prevItemCorners.br.x,prevItemCorners.bl.x);nextMin=Math.min(nextItemCorners.tl.x,nextItemCorners.tr.x,nextItemCorners.br.x,nextItemCorners.bl.x);views[i].set({left:views[i].left+(prevMax-views[i-1].left)+spaceBetweenEachItem+(views[i].left-nextMin)});}
break;case'horizontal':views.sort(this.sortByPosition_.bind(this,'y'));filledSpace=this.getFilledSpace_(views,group,'y');emptySpace=group.height-filledSpace;spaceBetweenEachItem=emptySpace/(views.length-1);for(i=1;i<views.length;i++){views[i].set({top:views[i-1].top});prevItem=this.getMediatorForView(views[i-1]);nextItem=this.getMediatorForView(views[i]);prevItemCorners=prevItem.getCornerPoints();nextItemCorners=nextItem.getCornerPoints();prevMax=Math.max(prevItemCorners.tl.y,prevItemCorners.tr.y,prevItemCorners.br.y,prevItemCorners.bl.y);nextMin=Math.min(nextItemCorners.tl.y,nextItemCorners.tr.y,nextItemCorners.br.y,nextItemCorners.bl.y);views[i].set({top:views[i].top+(prevMax-views[i-1].top)+spaceBetweenEachItem+(views[i].top-nextMin)});}
break;}
this.modifyView_(views,group);},setImagePlaceHoldersize_:function(height,width){imagePlaceholder_.setAttribute('height',(height>0)?height:1);imagePlaceholder_.setAttribute('width',(width>0)?width:1);},getFilledSpace_:function(views,group,axis){var filledSpace=0,firstItemCorners=this.getMediatorForView(views[0]).getCornerPoints(),lastItemCorners=this.getMediatorForView(views[views.length-1]).getCornerPoints(),firstItemMin=Math.min(firstItemCorners.tl[axis],firstItemCorners.tr[axis],firstItemCorners.br[axis],firstItemCorners.bl[axis]),lastItemMax=Math.max(lastItemCorners.tl[axis],lastItemCorners.tr[axis],lastItemCorners.br[axis],lastItemCorners.bl[axis]),padding,corners,min,max;if(axis=='x'){padding=(firstItemMin+group.width/2)+(group.width/2-lastItemMax);}
else if(axis=='y'){padding=(firstItemMin+group.height/2)+(group.height/2-lastItemMax);}
if(padding>(group.padding*3)){padding=group.padding*2;if(axis=='x'){views[0].set({left:padding/2+(views[0].left-firstItemMin)-group.width/2});}
else if(axis=='y'){views[0].set({top:padding/2+(views[0].top-firstItemMin)-group.height/2});}}
for(var i=0;i<views.length;i++){corners=this.getMediatorForView(views[i]).getCornerPoints();min=Math.min(corners.tl[axis],corners.tr[axis],corners.br[axis],corners.bl[axis]);max=Math.max(corners.tl[axis],corners.tr[axis],corners.br[axis],corners.bl[axis]);filledSpace+=(max-min);}
return filledSpace+padding;},completePasteGraphicItems_:function(graphicItems,deltaX,deltaY){this.duplicateGraphicItems(graphicItems,deltaX,deltaY);this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'pastingGraphicItems'});},sortByPosition_:function(axis,a,b){var aCor=this.getMediatorForView(a).getCornerPoints(),bCor=this.getMediatorForView(b).getCornerPoints(),aMin=Math.round(Math.min(aCor.tl[axis],aCor.tr[axis],aCor.br[axis],aCor.bl[axis])),bMin=Math.round(Math.min(bCor.tl[axis],bCor.tr[axis],bCor.br[axis],bCor.bl[axis]));if(aMin<bMin)
return-1;if(aMin>bMin)
return 1;return 0;},getSelectedViews:function(){var o=this.viewComponent.getActiveObject(),views=[];if(!o){o=this.viewComponent.getActiveGroup();}
if(o){if(o.type==='group'){views=o.getObjects();}
else{views[0]=o;}}
return views;},getScaleOfSelectedItem:function(){var model=this.getSelectedModels()[0];if(typeof model=='undefined'){return 1;}
return model.scaleX;},isAlignmentEnabled:function(){return this.viewComponent.areAlignmentGuidesEnabled;},onPosterResize:function(poster,posterType,showConfirmation){this.updateWatermarkProperties();this.setWhiteboardBackground(poster,this.onPosterResizeBackgroundReady.bind(this,poster,showConfirmation,posterType),true);},isBackgroundCovered:function(){var graphicItems=this.viewComponent.getObjects(),posterWidth=this.viewComponent.width,posterHeight=this.viewComponent.height,posterCoords={tl:{x:0,y:0},tr:{x:posterWidth,y:0},bl:{x:0,y:posterHeight},br:{x:posterWidth,y:posterHeight}};for(var i=0;i<graphicItems.length;i++){if(graphicItems[i]instanceof fabric.Image&&graphicItems[i].opacity>0.75&&graphicItems[i].containsPoint(posterCoords.tl)&&graphicItems[i].containsPoint(posterCoords.tr)&&graphicItems[i].containsPoint(posterCoords.bl)&&graphicItems[i].containsPoint(posterCoords.br)){return true;}}
return false;},onPosterResizeBackgroundReady:function(poster,showMessage,posterType){var em=this.facade.retrieveMediator(postermywall.core.view.EditorMediator.NAME);this.scaleWhiteboard(poster,1);for(var i=0;i<poster.graphicItems.length;i++){this.onGraphicItemUpdated(poster.graphicItems[i]);}
em.fitWhiteboardToScreen();if(showMessage){var message=$.t('pm_design_resized');if(posterType=='poster'||posterType=='poster-banner-4-6'){message+=' '+$.t('pm_buyprints_available');}
this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:$.t('pm_design_resized_title'),text:message,icon:false});}
this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'resizePoster'});},updateWatermarkProperties:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);this.watermarkFontSize_=Math.max(Math.floor(wbp.getPoster().width/54),11);},getObjects:function(){var objects=this.viewComponent.getObjects(),graphicItems=[];if(this.isWatermarkVisible_){for(var i=0;i<objects.length;i++){if(typeof objects[i].__PMWID!='undefined'){graphicItems.push(objects[i]);}}
return graphicItems}
else{return objects;}}},{NAME:'WhiteboardMediator'});})();
(function(){var SCROLL_STATUS_FIRST_HIGHLIGHTED=1;puremvc.define({name:'postermywall.core.view.widget.Selector',constructor:function(el,onSelected){if(el){this.el_=el;var self=this;PMW.onClick(this.el_,'.selected',this.onOpenSelector_.bind(this));PMW.onClick(this.el_,'> ul li',function(){self.onItemSelected_($(this));});if($.isFunction(onSelected)){this.el_.on('selector:selected',onSelected);}
this.invalidate_();}}},{on:function(event,handler){this.el_.on(event,handler);},setValue:function(value){var oldValue=this.el_.find('.highlight').removeClass('highlight');var item=$('> ul li[data-value="'+value+'"]',this.el_);if(item.length>0){this.highlightItem_(item);}
this.invalidate_();if(item.length>0&&oldValue!=value){this.el_.trigger('selector:change',[value]);}},getValue:function(){return this.el_.find('.highlight').data('value');},getValueAt:function(index){var list=this.getItems();if(list.length>0&&index>0&&index<list.length){return $(list[index]).data('value');}
return'';},getItemCount:function(){return $('> ul li',this.el_).length;},getElement:function(){return this.el_;},setItems:function(items,selectedValue){var html=['<ul>'];html[html.length]=this.getItemsHtml_(items);html[html.length]='</ul>';$('ul',this.el_).remove();$(this.el_).append(html.join(''));this.setValue(selectedValue);},addItemsAt:function(items,index){if(index>=0){$(this.getItemsHtml_(items)).insertBefore($('> ul li',this.el_)[index]);}
this.invalidate_();},getItems:function(){return $('> ul li',this.el_);},removeItemsAt:function(index){var lis=this.getItems();for(var i=0;i<index;i++){lis.eq(i).remove();}},getItemsHtml_:function(items){var html=[];for(var i=0;i<items.length;i++){html[html.length]='<li data-name="'+items[i].name+'" ';html[html.length]='data-value="'+items[i].value+'" ';html[html.length]='data-options="'+items[i].options+'" ';if(typeof items[i].url=='string'){html[html.length]='data-url="'+items[i].url+'" ';}
if('unselectable'in items[i]){html[html.length]='data-unselectable="'+items[i].unselectable+'" class="unselectable" ';}
if('link'in items[i]){html[html.length]='class="link btn-link"';}
html[html.length]='>';html[html.length]=items[i].html;html[html.length]='</li>';}
return html.join('');},el_:null,scrollStatus_:SCROLL_STATUS_FIRST_HIGHLIGHTED,setScrollStatus:function(value){this.scrollStatus_=value;},onOpenSelector_:function(){function closeOpenSelectors(){var openMenus=$('.selector').not('.closed');openMenus.addClass('closed');$(document).off(PMW.click,closeOtherSelectors);}
function closeOtherSelectors(e){var t=$(e.target);if(!t.closest('.selector').length){closeOpenSelectors();}}
if(this.el_.hasClass('closed')){closeOpenSelectors();}
this.el_.toggleClass('closed');if(this.el_.not('.closed')){$(document).on(PMW.click,closeOtherSelectors);setTimeout(this.scrollToOptions_.bind(this),200);}
else{$(document).off(PMW.click,closeOtherSelectors);}
if(this.scrollStatus_!=postermywall.core.view.widget.Selector.SCROLL_STATUS_DISABLED){var ul=$('ul',this.el_).scrollTop(0),highlighted=(this.scrollStatus_==postermywall.core.view.widget.Selector.SCROLL_STATUS_LAST_HIGHLIGHTED)?ul.find('.highlight').last():ul.find('.highlight');if(highlighted.length>0){ul.animate({scrollTop:highlighted.position().top},250,'swing');}}},onItemSelected_:function(li){if(li.data('unselectable')){return;}
if(!li.hasClass('highlight')){var oldLI=this.highlightItem_(li),params=[li.data('value')];$('.selected span',this.el_).html(this.getSelectorHTML(li));this.el_.trigger('selector:selected',params);this.el_.trigger('selector:change',params);if(oldLI.data('options')){$(oldLI.data('options')).addClass('closed');}}
this.el_.addClass('closed');if(li.data('options')){$(li.data('options')).removeClass('closed');}},getSelectorHTML:function(li){var htmlData;if(li.length==0){htmlData=this.el_.data('unselected');if(!htmlData){return $.t('pm_select_item');}
return htmlData;}
if(typeof li.data('url')=='string'){htmlData=document.createElement('IMG');htmlData.src=li.data('url');htmlData.width=150;}
else{htmlData=li.data('name');}
return htmlData},getIndexOfItemFromValue:function(value){var list=this.getItems();for(var i=0;i<list.length;i++){if($(list[i]).data('value')==value){return i;}}
return-1;},highlightItem_:function(li){var prevSelected=li.first().siblings('.highlight').removeClass('highlight');li.addClass('highlight');return prevSelected;},invalidate_:function(){$('.selected span',this.el_).html(this.getSelectorHTML($('> ul .highlight',this.el_)));},scrollToOptions_:function(){var co=$('#contextual-opts'),p=co.children('.options.active'),wh=$(window).height(),vOffset,elTop=this.el_.offset().top,listHeight=this.el_.find('ul').height(),visibleHeight;if(postermywall.core.view.EditorMediator.isBottomBarVisible){visibleHeight=wh-postermywall.core.view.EditorMediator.NAV_HEIGHT-postermywall.core.view.EditorMediator.BOTTOM_BAR_HEIGHT;}else{visibleHeight=wh-postermywall.core.view.EditorMediator.NAV_HEIGHT;}
if((elTop+listHeight)>visibleHeight){vOffset=listHeight>visibleHeight?co.width()>210?-80:-105:-visibleHeight+listHeight;postermywall.Util.scrollTo(p,elTop+p.scrollTop()+vOffset);}}},{SCROLL_STATUS_DISABLED:0,SCROLL_STATUS_FIRST_HIGHLIGHTED:SCROLL_STATUS_FIRST_HIGHLIGHTED,SCROLL_STATUS_LAST_HIGHLIGHTED:2});})();
(function(){puremvc.define({name:'postermywall.core.view.widget.Popover',constructor:function(el,onSelected){if(el){this.el_=el;if($.isFunction(onSelected)){PMW.onClick(this.el_,'ul > li',onSelected);}}}},{el_:null,on:function(event,handler){this.el_.on(event,handler);},setValue:function(value){var item=$('> ul li[data-value="'+value+'"]',this.el_);if(item.length>0){this.highlightItem_(item);}},getValue:function(){return this.el_.find('.highlight').data('value');},getItemCount:function(){return $('> ul li',this.el_).length;},getElement:function(){return this.el_;},setItems:function(items,selectedValue){var html=['<ul class="menu out">'];html[html.length]=this.getItemsHtml_(items);html[html.length]='</ul>';$('ul',this.el_).remove();$(this.el_).append(html.join(''));this.setValue(selectedValue);},addItemsAt:function(items,index){if(index>=0){$(this.getItemsHtml_(items)).insertBefore($('> ul li',this.el_)[index]);}},getItems:function(){return $('> ul li',this.el_);},getItemsHtml_:function(items){var html=[];for(var i=0;i<items.length;i++){html[html.length]='<li data-name="'+items[i].name+'" ';html[html.length]='data-value="'+items[i].value+'" ';html[html.length]='>';html[html.length]=items[i].html;html[html.length]='</li>';}
return html.join('');},open:function(e){function closeOpenMenus(){var openMenus=$('.menu.in');$('.icon-selector').removeClass('selected');openMenus.removeClass('in').addClass('out');}
function closeOtherMenus(e){var t=$(e.target);if(t.closest('.opens-sub-menu').length>0){$(document).one(PMW.click,closeOtherMenus);return;}
if(!t.parent('.icon-selector.selected').length){closeOpenMenus();}}
var btn=$(e.target).closest('.icon-selector');if(!btn.hasClass('selected')){closeOpenMenus();}
btn.toggleClass('selected');this.toggle();this.el_.appendTo($(e.target).closest('.icon-selector'));this.setValue(btn.attr('data-value'));setTimeout(function(){$(document).one(PMW.click,closeOtherMenus);},100);},toggle:function(){var el=this.el_.find('.menu');if(el.hasClass('out')){el.removeClass('out').addClass('in');}
else if(el.hasClass('in')){el.removeClass('in').addClass('out');}},getIndexOfItemFromValue:function(value){var list=this.getItems();for(var i=0;i<list.length;i++){if($(list[i]).data('value')==value){return i;}}
return-1;},highlightItem_:function(li){var prevSelected=li.first().siblings('.highlight').removeClass('highlight');li.addClass('highlight');return prevSelected;}},{});})();
puremvc.define({name:'postermywall.core.view.widget.ToggleButton',constructor:function(el,onClick){this.el_=el;var values=this.el_.data('values');if(values!=null&&values.length>0){values=values.split(',');if(values.length>0){this.values_=values;if($.isFunction(onClick)){this.clickHandler_=onClick;PMW.onClick(this.el_,null,this.onClick_.bind(this));}}}
this.setValue(this.el_.data('value'));}},{el_:null,values_:[],onClick_:function(){var nextValue='';for(var i=0;i<this.values_.length;i++){if(this.values_[i]==this.el_.data('value')){if(i+1<this.values_.length){nextValue=this.values_[i+1];}
else{nextValue=this.values_[0];}
break;}}
if(nextValue.length>0){this.setValue(nextValue);this.clickHandler_(nextValue);}},setValue:function(value){if(value!=null&&value.length>0){this.el_.data('value',value);this.el_.find('[data-class-'+value+']').each(function(){this.className=this.getAttribute('data-class-'+value);});this.el_.find('[data-html-'+value+']').each(function(){this.innerHTML=this.getAttribute('data-html-'+value);});}}},{});
puremvc.define({name:'postermywall.core.view.widget.Slider',constructor:function(id,changeHandler,inputStart,inputEnd,round,options,transformInput,customTransformFunc){if(typeof round==='undefined'){round=false;}
if(typeof options==='undefined'){options={};}
this.id_=id;this.onChangeHandler_=changeHandler;this.inputStart_=inputStart;this.inputEnd_=inputEnd;this.round_=round;this.multiplier_=function(){return 1};if(transformInput=='percentage'){this.transformInputFunction_=this.percentageInputTransform_;this.reverseTransformInputFunction_=this.reversePercentageInputTransform_;}
else if(transformInput=='custom'){this.multiplier_=customTransformFunc;this.transformInputFunction_=this.multiplierInputTransform_;this.reverseTransformInputFunction_=this.reverseMultiplierInputTransform_;}
else{this.transformInputFunction_=this.reverseTransformInputFunction_=this.defaultInputTransform_;}
this.elInput_=$('#'+this.id_+'Input');if(this.elInput_.length){this.elInput_.attr({min:this.transformInputFunction_(this.inputStart_),max:this.transformInputFunction_(this.inputEnd_)});postermywall.Util.attachTypingStoppedHandler(this.elInput_,this.onInputChanged_.bind(this));this.elInput_.blur(this.onInputBlur_.bind(this));}
$.extend(options,{slide:false,callback:this.onValueChanged_.bind(this),animationCallback:this.setInputValue_.bind(this)});this.el_=new Dragdealer(this.id_,options);}},{el_:null,elInput_:null,id_:'',property_:'',onChangeHandler_:null,outputStart_:0,outputEnd_:1,inputStart_:0,inputEnd_:1,round_:false,transformInputFunction_:null,reverseTransformInputFunction_:null,multiplier_:null,setValue:function(value,setInput){this.el_.setValueWithoutCallback(value);if(setInput){this.setInputValue_(value);}},onValueChanged_:function(x){this.onChangeHandler_(this.calculateInputValue_(x));},onInputChanged_:function(){var value=this.elInput_.val();if($.isNumeric(value)){var maxValue=this.transformInputFunction_(this.inputEnd_),minValue=this.transformInputFunction_(this.inputStart_);if(value>maxValue){value=maxValue;}
else if(value<minValue){value=minValue;}
value=postermywall.Util.mapNumberToRange(value,minValue,maxValue,this.outputStart_,this.outputEnd_);this.onValueChanged_(value);this.setValue(value);}},setInputValue_:function(x){this.elInput_.val(this.transformInputFunction_(this.calculateInputValue_(x)));},onInputBlur_:function(){this.setInputValue_(this.el_.getValue()[0]);},calculateInputValue_:function(x){var val=postermywall.Util.mapNumberToRange(x,this.outputStart_,this.outputEnd_,this.inputStart_,this.inputEnd_);if(this.round_){return Math.round(val);}
return val;},calculateSliderValue:function(x){return postermywall.Util.mapNumberToRange(x,this.inputStart_,this.inputEnd_,this.outputStart_,this.outputEnd_);},multiplierInputTransform_:function(v){var a=postermywall.Util.mapNumberToRange(v,this.inputStart_,this.inputEnd_,this.inputStart_*this.multiplier_(),this.inputEnd_*this.multiplier_());return Math.round(a);},reverseMultiplierInputTransform_:function(v){return postermywall.Util.mapNumberToRange(v,this.outputStart_,this.outputEnd_,this.inputStart_*this.multiplier_(),this.inputEnd_*this.multiplier_());},percentageInputTransform_:function(v){var a=postermywall.Util.mapNumberToRange(v,this.inputStart_,this.inputEnd_,0,100);return Math.round(a);},reversePercentageInputTransform_:function(v){return postermywall.Util.mapNumberToRange(v,this.outputStart_,this.outputEnd_,this.inputStart_,this.inputEnd_);},defaultInputTransform_:function(v){return v;}});
(function(){var THUMB_WIDTH_WITH_NO_MARGIN_RIGHT=172;var THUMB_WIDTH_WITH_MIN_MARGIN_RIGHT=182;var THUMB_HEIGHT=182;var VIDEO_THUMB_WIDTH_WITH_NO_MARGIN_RIGHT=242;var VIDEO_THUMB_WIDTH_WITH_MIN_MARGIN_RIGHT=252;var VIDEO_THUMB_HEIGHT=162;puremvc.define({name:'postermywall.core.view.widget.Grid',constructor:function(cp,el,m,options){if(el){this.selected_=0;this.offset_=0;this.searchTerm_='';this.itemSource_='';this.page_=0;this.more_=false;this.total_=0;this.visible_=false;this.error_=false;this.$contentParent_=cp;this.el_=el;PMW.onClick(this.el_,'.grid-item',this.onSelectGridItem_.bind(this,options.dbl));this.gridItemType_=(typeof options.gridItemType!=='undefined')?options.gridItemType:postermywall.Core.MULTIMEDIA_TYPE_IMAGE;PMW.initVideoItems(this.el_);this.calculateNumImageLimits();if(typeof options.paginationType!=='undefined'){this.paginationType=options.paginationType;}else{this.paginationType=postermywall.core.view.widget.Grid.PAGINATION_TYPE_PAGES;}
if(m){m.grids_[m.grids_.length]=this;this.el_.on('grid:onImage',m.onGridChange.bind(m,this));}}}},{$contentParent_:null,paginationType:0,gridItemType_:'',selected_:0,itemsPerRow:0,limit_:0,collectionId_:'',offset_:0,searchTerm_:'',itemSource_:'',page_:0,minItems_:0,more_:false,total_:0,totalImages_:0,visible_:false,error_:false,multiSelect_:true,manual_:false,getContentParent:function(){return this.$contentParent_;},getSelected:function(){return this.selected_;},setSelected:function(val){this.selected_=val;return this;},getItemsPerRow:function(){return this.itemsPerRow;},setItemsPerRow:function(val){this.itemsPerRow=val;return this;},getLimit:function(){return this.limit_;},setLimit:function(val){this.limit_=val;return this;},setCollectionId:function(val){this.collectionId_=val;return this;},getCollectionId:function(){return this.collectionId_;},getOffset:function(){return this.offset_;},getTotalImages:function(){return this.totalImages_;},setOffset:function(val){this.offset_=val;return this;},getSearchTerm:function(){return this.searchTerm_;},setSearchTerm:function(val){this.searchTerm_=val;return this;},getItemSource:function(){return this.itemSource_;},setItemSource:function(val){this.itemSource_=val;return this;},getPage:function(){return this.page_;},setPage:function(val){this.page_=val;return this;},getMinItems:function(){return this.minItems_;},setMinItems:function(val){this.minItems_=val;return this;},getMore:function(){return this.more_;},setMore:function(val){this.more_=val;return this;},getTotal:function(){return this.total_;},setTotal:function(val){this.total_=val;return this;},isVisible:function(){return this.visible_;},getError:function(){return this.error_;},setError:function(val){this.error_=val;return this;},canLoadMore:function(){return this.visible_&&!this.error_&&(this.more_||(this.offset_<this.total_));},getElement:function(){return this.el_},getItemCount:function(){return this.el_.children('.grid-item').length;},getParamsForInfiniteLoad:function(){if(this.paginationType===postermywall.core.view.widget.Grid.PAGINATION_TYPE_PAGES){return{src:this.itemSource_,st:this.searchTerm_,pg:this.page_};}else{return{o:this.offset_,l:this.limit_+1,c:this.collectionId_};}},show:function(){this.visible_=true;this.el_.removeClass('hidden');return this;},hide:function(){this.visible_=false;this.el_.addClass('hidden');return this;},appendVideos:function(items,returnItem){if(typeof returnItem==='undefined'){returnItem=false;}
var html=[],itemCount=items.length,i;this.totalImages_=itemCount;for(i=0;i<itemCount;i++){var dataStr='data-video-load-error="'+$.t("pm_video_grid_item_load_error")+'" ';$.each(items[i].data,function(key,value){dataStr+='data-'+key+'="'+value+'" ';});var img='';if(typeof items[i].lazy==='undefined'){img='<img src="'+items[i].imgSrc+'"/>'}else{img='<img class="lazy" data-original="'+items[i].imgSrc+'"/>'}
if(items[i].duration){var durationInSeconds=parseFloat(items[i].duration),hourPart=Math.floor(durationInSeconds/3600),minutePart=Math.floor((durationInSeconds-hourPart*3600)/60),secondPart=Math.floor(durationInSeconds-hourPart*3600-minutePart*60),finalDurationString='';if(hourPart){finalDurationString+=('00'+(hourPart).toString(10)).slice(-2)+':';}
finalDurationString+=('00'+(minutePart).toString(10)).slice(-2)+':'+('00'+(secondPart).toString(10)).slice(-2);var duration='<span class="video-length">'+finalDurationString+'</span>';var loadingIcon='<i class="icon-circle-o-notch hidden"></i>';var addedByStr=typeof items[i].uploaderName!='undefined'?'title="'+$.t('pm_added_by')+' '+items[i].uploaderName+'"':'';html[html.length]='<li class="grid-item play-on-hover-video video-item" '+
dataStr+
addedByStr+'>'+'<div class="preview-container thumb">'+
img+
loadingIcon+
duration+'</div>'+'</li>';}}
if(!returnItem){this.el_.append(html.join(''));}
this.offset_+=itemCount;this.show();if(returnItem){return html;}else{return this;}},append:function(items){var html=[],itemCount=items.length,i;this.totalImages_=itemCount;for(i=0;i<itemCount;i++){var dataStr='';$.each(items[i].data,function(key,value){dataStr+='data-'+key+'="'+value+'" ';});var img='';if(typeof items[i].lazy==='undefined'){img='<img src="'+items[i].imgSrc+'"/>'}else{img='<img class="lazy" data-original="'+items[i].imgSrc+'"/>'}
var addedByStr=items[i].uploaderName?'title="'+$.t('pm_added_by')+' '+items[i].uploaderName+'"':'';html[html.length]='<li class="grid-item" '+
dataStr+
addedByStr+'>'+'<div class="thumb">'+
img+'</div>'+'</li>';}
this.el_.append(html.join(''));this.offset_+=itemCount;this.show();return this;},getColor:function(c,m){if(m.isColorSet(c)){return postermywall.Util.rgbToHex(c);}
return-1;},removeSelected:function(li){var oldSelectionCount=this.selected_--;li.remove();this.offset_--;this.el_.trigger('grid:onImage',[oldSelectionCount,this.selected_]);return this;},clearSelection:function(){var oldSelectionCount=this.selected_;this.selected_=0;this.el_.trigger('grid:onImage',[oldSelectionCount,this.selected_]);return this.el_.find('.selected').removeClass('selected');},empty:function(selector){if(this.selected_>0){this.clearSelection();}
if(typeof selector==='undefined'){this.el_.empty();}else{this.el_.children(selector).remove();}
return this;},fillVisibleArea:function(){if(this.canLoadMore()&&this.offset_<this.minItems_){if(this.paginationType===postermywall.core.view.widget.Grid.PAGINATION_TYPE_OFFSET){var temp=this.limit_;this.limit_=this.minItems_-this.offset_+this.itemsPerRow;this.loadMore();this.limit_=temp;}else{this.loadMore();}}
return this;},calculateNumImageLimits:function(){this.$contentParent_.css('overflow','scroll');var col=Math.floor(parseInt(this.$contentParent_.width(),10)/(this.gridItemType_==postermywall.Core.MULTIMEDIA_TYPE_VIDEO?VIDEO_THUMB_WIDTH_WITH_MIN_MARGIN_RIGHT:THUMB_WIDTH_WITH_MIN_MARGIN_RIGHT));var row=Math.floor(this.$contentParent_.height()/(this.gridItemType_==postermywall.Core.MULTIMEDIA_TYPE_VIDEO?VIDEO_THUMB_HEIGHT:THUMB_HEIGHT))+1;this.$contentParent_.css('overflow','auto');this.itemsPerRow=col;this.limit_=col*2;this.minItems_=row*col;this.limit_=(this.limit_<postermywall.core.view.widget.Grid.PAGE_SIZE?postermywall.core.view.widget.Grid.PAGE_SIZE:this.limit_);this.minItems_=(this.minItems_<postermywall.core.view.widget.Grid.PAGE_SIZE?postermywall.core.view.widget.Grid.PAGE_SIZE:this.minItems_);return this;},setImageSpacing:function(){var width=this.$contentParent_.width()-5,numImgPerRow=this.itemsPerRow,margin,li=this.el_.find('li');if(this.$contentParent_.hasClass('photo-column')){width=this.el_.width()-5;}else{this.el_.width(width);}
if(numImgPerRow==1){this.el_.addClass('-one-column');margin=0;}else{this.el_.removeClass('-one-column');margin=((width-((this.gridItemType_==postermywall.Core.MULTIMEDIA_TYPE_VIDEO?VIDEO_THUMB_WIDTH_WITH_NO_MARGIN_RIGHT:THUMB_WIDTH_WITH_NO_MARGIN_RIGHT)*numImgPerRow))/(numImgPerRow-1));margin=(margin%1<0.5)?Math.floor(margin-1):Math.floor(margin);}
li.css('margin-right',margin);if(numImgPerRow>1){li.filter(':visible').each(function(i){var modulus=(i+1)%numImgPerRow;if(modulus===0){$(this).css('margin-right',0);}});}
return this;},loadMore:function(){PMW.forceLoad=true;this.$contentParent_.scroll();},onSelectGridItem_:function(dbl,e){var gi=$(e.currentTarget);if(gi.hasClass('collection')){var t=$(e.target);if(t.hasClass('btn-collection-options')||t.parent().hasClass('btn-collection-options')){this.el_.trigger('grid:onCollectionOptionsButton',gi);}
else if(t.hasClass('btn-collection-option')||t.parent().hasClass('btn-collection-option')){this.el_.trigger('grid:onCollectionOption',t);}
else{this.el_.trigger('grid:onCollection',gi);}
return;}
if($.isFunction(dbl)){if(this.selected_<2&&!gi.data('click-timer-id')){gi.data('click-timer-id',setTimeout(function(){gi.data('click-timer-id',0);},500));}
else if(this.selected_<2&&gi.data('click-timer-id')){clearTimeout(gi.data('click-timer-id'));gi.data('click-timer-id',0);if(this.selected_===0){gi.addClass('selected');}
if(this.selected_===0||this.selected_===1){dbl();return;}}}
var oldSelectionCount=this.selected_;if(this.multiSelect_){if(gi.hasClass('selected')){gi.removeClass('selected');this.selected_-=1;}
else{gi.addClass('selected');this.selected_+=1;}}
else{if(gi.hasClass('selected')){gi.removeClass('selected');this.selected_-=1;}
else{gi.addClass('selected').siblings('.selected').removeClass('selected');if(this.selected_===0){this.selected_=1;}}}
this.el_.trigger('grid:onImage',[oldSelectionCount,this.selected_]);}},{PAGINATION_TYPE_PAGES:0,PAGINATION_TYPE_OFFSET:1,PAGE_SIZE:30});})();
(function(){puremvc.define({name:'postermywall.core.view.widget.Cropper',constructor:function(el,src,mc,params){this.el_=el;this.image_=el.find('img.to-crop');this.mc_=mc;this.params_=params;this.image_.one('load',this.onLoadImageSuccess.bind(this)).on('error',this.onLoadImageError.bind(this)).on('abort',this.onLoadImageError.bind(this)).attr('src',src).each(function(){if(this.complete)$(this).load();});}},{el_:null,image_:null,mc_:null,params_:{},getElement:function(){return this.el_},show:function(){this.el_.removeClass('hidden');return this;},hide:function(){this.el_.addClass('hidden');return this;},onLoadImageSuccess:function(){this.image_.off();var img=this.image_[0],imgWidth=img.width,imgHeight=img.height,minSide=200;if(this.params_.maxContentHeight-25<imgHeight){imgHeight=this.params_.maxContentHeight-25;imgWidth=(img.width/img.height)*imgHeight;}
if(imgWidth>this.params_.maxContentWidth){imgWidth=this.params_.maxContentWidth;imgHeight=imgWidth/(img.width/img.height);}
var ratio=imgWidth/imgHeight;if(imgHeight<minSide){imgHeight=minSide;imgWidth=imgHeight*ratio;}else if(imgWidth<minSide){imgWidth=minSide;imgHeight=imgWidth/ratio;}
this.el_.find('.crop-wrap').css({'height':imgHeight,'width':imgWidth});this.el_.find('.cropper-container').css({'height':imgHeight,'width':imgWidth});this.image_.on('built.cropper',this.onCropperLoaded.bind(this,imgWidth,imgHeight,img.width,img.height));var cropperParams={minContainerWidth:imgWidth,autoCropArea:1,checkOrientation:false,viewMode:1};if(typeof this.params_.width!=='undefined'&&typeof this.params_.height!=='undefined'){cropperParams['aspectRatio']=this.params_.width/this.params_.height;}else if(typeof this.params_.aspectRatio!=='undefined'){cropperParams['aspectRatio']=this.params_.aspectRatio;}
this.image_.cropper(cropperParams);},onLoadImageError:function(){this.image_.off();this.el_.trigger('cropper:error');},onCropperLoaded:function(w,h,pw,ph){this.el_.trigger('cropper:loaded',[w,h,pw,ph]);},destroyCropper:function(){if(this.image_!==null){this.image_.cropper('destroy');this.el_.off();this.hide();}}},{});})();
"use strict";puremvc.define({name:'postermywall.core.view.modal.ModalMediator',parent:puremvc.Mediator,constructor:function(el,options){puremvc.Mediator.call(this,null,el);this.el_=this.getViewComponent();this.options=$.extend({},postermywall.core.view.modal.ModalMediator.DEFAULTS,$.isPlainObject(options)&&options);this.init_=false;this.open_=false;this.escHandler_=null;this.grids_=[];if(typeof this.el_!=='undefined'&&this.options.dismissible){PMW.onClick(this.el_.find('.close'),null,this.closeModal.bind(this));}}},{grids_:[],changeMultiMediaItem_:false,notificationInterests_:[],listNotificationInterests:function(){this.notificationInterests_[this.notificationInterests_.length]=postermywall.Core.VIEWPORT_RESIZED;return this.notificationInterests_;},handleNotification:function(note){if(typeof this.getViewComponent()!=='undefined'){switch(note.getName()){case postermywall.Core.VIEWPORT_RESIZED:this.onResize();break;}}},onResize:function(){if(this.open_){this.updateModalDimensions();this.fixGridSpacing_();}},openModal:function(options,cb){if(typeof options==='object'){this.options=$.extend({},this.options,$.isPlainObject(options)&&options);}else if(typeof options==='function'){cb=options;}
this.updateModalDimensions();this.fixGridSpacing_();if(!this.open_){var vc=this.getViewComponent(),self=this;vc.addClass('modal-open').children().addClass('animated fadeInDown').one(PMW.util.animationEndEvents,function(){self.open_=true;$(this).removeClass('animated fadeInDown');if(typeof cb==='function'){cb();}});if(this.options.dismissible&&this.escHandler_===null){this.escHandler_=this.onEsc.bind(this);$(document).keyup(this.escHandler_);}
vc.find('img[data-url]').each(function(){this.src=this.getAttribute('data-url');this.removeAttribute('data-url');});vc.find('div[data-sprite]').each(function(){this.style.backgroundImage='url('+this.getAttribute('data-sprite')+')';this.removeAttribute('data-sprite');});}},closeModal:function(cb){var mc=this.getViewComponent().children('.modal-content'),self=this;if(this.open_){this.open_=false;if(this.options.dismissible&&typeof this.escHandler_==='function'){this.escHandler_=null;$(document).off('keyup',this.escHandler_);}
if(this.options.animateClose){mc.addClass('animated fadeOutUp').one(PMW.util.animationEndEvents,function(){self.onModalClose(cb);});}else{this.onModalClose(cb);}}else if(mc.hasClass('animated')){mc.removeClass('fadeInDown').addClass('fadeOutUp').one(PMW.util.animationEndEvents,function(){self.open_=false;self.onModalClose(cb);});}},onModalClose:function(cb){var vc=this.getViewComponent(),i;vc.removeClass('modal-open').children().removeClass('animated fadeOutUp').off();for(i=0;i<this.grids_.length;i++){this.grids_[i].clearSelection();}
if(typeof this.options.onClose=='function'){this.options.onClose();}
if(typeof cb==='function'){cb();}},updateModalDimensions:function(){if(bowser.safari||bowser.ipad||(bowser.msie&&bowser.version<=11)){var m=this.getViewComponent(),mc=m.find('div.modal-content');mc.find('.content').height(mc.height()-mc.find('.header').outerHeight(true)-mc.find('.footer').outerHeight(true));}},onEsc:function(e){if(e.which===27){this.closeModal();}},initGrid:function(m,s,g,lc,lsc,t){t=typeof t==='undefined'?null:t;s.scroll(PMW.debounce(function(){if(PMW.loading===null){PMW.loading=false;}
if(g.canLoadMore()&&!PMW.loading){var $g=g.getElement();if(($g.height()>=s.height()&&($g.height()-s.height()-s.scrollTop())<=100)||PMW.forceLoad===true){this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'loadMoreImagesGrid',text:(t==postermywall.Core.MULTIMEDIA_TYPE_VIDEO?$.t('pm_loading_more_videos'):$.t('pm_loading_more_images'))});PMW.loading=true;m.attr('data-view','loading-more');var params=g.getParamsForInfiniteLoad();if(t){params['collectionType']=t;}
lc(params).done(this.onLoadingSuccess_.bind(this,m,g,lsc.bind(this,params))).fail(this.onLoadingError_.bind(this,m,g)).always(this.onLoadingComplete_.bind(this,g));}}}.bind(this),100));},onLoadingSuccess_:function(m,g,cb,data){if(data!==null){if(g.manual_===true){g.manual_=false;m.find('.manual-load-more').hide();m.find('.load-more-error').hide();}
cb(data);}else{this.showLoadMore(m,g);}},onLoadingError_:function(m,g,xhr,status){if(status!=='abort'){this.showLoadMore(m,g);}},onLoadingComplete_:function(g){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'loadMoreImagesGrid'});PMW.loading=false;PMW.forceLoad=false;g.fillVisibleArea();},showLoadMore:function(m,g){g.setError(true);m.find('.manual-load-more').show();m.find('.btn-load-more').prop('disabled',false);if(g.manual_===true){m.find('.load-more-error').show();}},onGridChange:function(grid,e,oldCount,curCount){if(oldCount===0&&curCount>0){this.el_.find('.enable-on-selection').prop('disabled',false);}
else if(oldCount>0&&curCount===0){this.el_.find('.enable-on-selection').prop('disabled',true);}
if(grid.multiSelect_){var btn;if(oldCount<2&&curCount>1){btn=this.el_.find('.btn[data-plural]');btn.find('.txt').text(btn.attr('data-plural'));}else if(oldCount>1&&curCount<2){btn=this.el_.find('.btn[data-singular]');btn.find('.txt').text(btn.attr('data-singular'));}}},fixGridSpacing_:function(){for(var i=0;i<this.grids_.length;i++){if(this.grids_[i].isVisible()){this.grids_[i].calculateNumImageLimits().setImageSpacing().fillVisibleArea();}}},abortXHR:function(xhr){if(typeof xhr!=='undefined'&&xhr!==null&&xhr.readyState!==4){xhr.abort();}}},{NAME:'ModalMediator',DEFAULTS:{animateClose:true,dismissible:true}});
"use strict";puremvc.define({name:'postermywall.core.view.modal.ErrorModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#error-modal'));}},{notificationInterests_:[postermywall.Core.SHOW_ERROR],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);this.el_.on('keyup',this.onKeyup.bind(this));},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.SHOW_ERROR:var b=note.getBody(),message=typeof b.message==='string'?b.message:$.t('pm_default_error'),debug=b.debug,str=typeof debug==='string'?debug:(typeof debug==='undefined')?'':JSON.stringify(debug),log=typeof b.log=='boolean'?log:true;if(log){if(str.length){str='\nDebug data: '+str;}
PMW.log(message+str);}
if(!postermywall.Core.isHighRes()){this.el_.find('.message').html(message);this.openModal();this.el_.focus();}
break;}},onKeyup:function(e){if(e.which===13||e.which===27){this.closeModal();}}},{NAME:'ErrorModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.MessageModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#message-modal'));}},{notificationInterests_:[postermywall.Core.SHOW_MESSAGE],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.SHOW_MESSAGE:var params=note.getBody();if(typeof params.title==='string'&&params.title.length>0&&typeof params.text==='string'&&params.text.length>0){this.el_.find('.title > h2').html(params.title);this.el_.find('.content > p').html(params.text);this.el_.find('.content .icon-wrapper').toggle((typeof params.icon!=='undefined'&&params.icon));var height='';if(!isNaN(parseInt(params.height))){height=params.height+'px';}
this.el_.find('.modal-content').css('height',height);var options={};if(typeof params.onClose=='function'){options={'onClose':params.onClose}}
this.openModal(options);}
break;}}},{NAME:'MessageModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.SaveConfirmationModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#saved-modal'));PMW.onClick($('#modal-widget-container').find('#saved-modal .header .close'),null,this.closeModal.bind(this));}},{notificationInterests_:[postermywall.Core.POSTER_SAVED],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.POSTER_SAVED:if(note.getBody().callbackHasRedirect){return;}
if(!this.init_){this.init_=true;var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME),folder=pp.getFolder();if(folder!=null){this.el_.find('.message').removeClass('hidden').html($.t('pm_saved_in',{href:PMW.util.site_url('posters/mine#/designs/'+folder.id),folderName:PMW.util.escapeHTML(folder.name)}));}
var poster=note.getBody().poster,footer=this.el_.find('.footer'),up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME),url=PMW.util.site_url('poster/view/'+poster.hashedID+'?utm_source=postersave&utm_medium=onlineposting&utm_campaign=refer'),btnSavedSell=$('#btn-saved-sell');if(up.getUserId()>0){url+='&'+postermywall.Core.getReferralURIComponent(up.getUserId());}
PMW.sharingAfterAction='AfterSaveShare';PMW.loadAddThisToolbox(this.el_.find('.addthis_toolbox_stub').attr('data-url',url));PMW.onClick(btnSavedSell,null,this.submitTemplate_.bind(this,poster));PMW.onClick($('.btn-download',this.el_),null,this.closeModal.bind(this));if(up.isAcademicUser()){this.el_.find('.sell').hide();this.el_.find('.footer').addClass('thin');}
else{if(up.getUser().isDesigner()){if(!poster.isPosterTemplate()){$('.btn-download',this.el_).hide();}
else{btnSavedSell.hide();}}
else{btnSavedSell.hide();}}}
this.openModal();break;}},submitTemplate_:function(poster){if(poster){window.location.href=PMW.util.site_url('sell/submit/'+poster.hashedID);}}},{NAME:'SaveConfirmationModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.BackgroundTypeModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#background-type-modal'),{dismissible:false,animateClose:false});}},{notificationInterests_:[postermywall.Core.OPEN_MODAL_SELECT_BACKGROUND,postermywall.Core.CLOSE_MODAL_SELECT_BACKGROUND],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.OPEN_MODAL_SELECT_BACKGROUND:this.init();this.openModal();break;case postermywall.Core.CLOSE_MODAL_SELECT_BACKGROUND:this.closeModal();break;}},init:function(){if(!this.init_){this.init_=true;PMW.onClick(this.el_.find('.background-type-list'),'li',this.onBackgroundType.bind(this));}},onBackgroundType:function(e){var em=this.facade.retrieveMediator(postermywall.core.view.EditorMediator.NAME);switch($(e.currentTarget).attr('data-bg-type')){case'image':em.onImageBackground(postermywall.Core.OPEN_MODAL_IMAGE_BACKGROUND);break;case'stock':em.onImageBackground(postermywall.Core.OPEN_MODAL_STOCK_BACKGROUND);break;case'upload':em.onUploadBackground();break;case'solid':em.onColorBackground(postermywall.Core.OPEN_MODAL_SOLID_COLOR_BACKGROUND);break;case'gradient':em.onColorBackground(postermywall.Core.OPEN_MODAL_GRADIENT_BACKGROUND);break;}}},{NAME:'BackgroundTypeModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.ImageTypeModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#image-type-modal'));}},{vo_:null,notificationInterests_:[postermywall.Core.OPEN_MODAL_SELECT_IMAGE_TYPE,postermywall.Core.CLOSE_MODAL_SELECT_IMAGE_TYPE],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.OPEN_MODAL_SELECT_IMAGE_TYPE:this.vo_=note.getBody();this.init();this.openModal();break;case postermywall.Core.CLOSE_MODAL_SELECT_IMAGE_TYPE:this.closeModal();break;}},init:function(){if(!this.init_){this.init_=true;PMW.onClick(this.el_.find('.multimedia-type-list'),'li',this.onImageType.bind(this));}},onImageType:function(e){var em=this.facade.retrieveMediator(postermywall.core.view.EditorMediator.NAME);switch($(e.currentTarget).attr('data-img-type')){case'upload':em.onAddPhotoModal(postermywall.Core.OPEN_MODAL_UPLOAD,this.vo_);break;case'stock':em.onAddStockImageModal(postermywall.Core.OPEN_MODAL_IMAGE_STOCK,this.vo_);break;case'facebook':em.onAddFacebookPhotoModal(postermywall.Core.OPEN_MODAL_FACEBOOK,this.vo_);break;case'google':em.onAddGooglePhoto(postermywall.Core.OPEN_MODAL_GOOGLE_PHOTOS,this.vo_);break;case'dropbox':em.onAddDropboxPhoto(postermywall.Core.OPEN_MODAL_DROPBOX,this.vo_);break;}
this.closeModal();}},{NAME:'ImageTypeModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.DownloadModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#download-modal'));}},{productData_:[],promotion_:null,isWebDownload_:false,NO_WATERMARK_ON_CUSTOM_BREAKPOINT:900,notificationInterests_:[postermywall.Core.OPEN_MODAL_DOWNLOAD,postermywall.Core.DOWNLOAD_MODAL_SHOW_MESSAGE,postermywall.Core.DOWNLOAD_MODAL_RESTORE_STATE,postermywall.Core.AUTHENTICATION_CANCELED],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.OPEN_MODAL_DOWNLOAD:this.init();break;case postermywall.Core.DOWNLOAD_MODAL_SHOW_MESSAGE:this.showMessage(note.getBody());break;case postermywall.Core.DOWNLOAD_MODAL_RESTORE_STATE:this.restoreState();break;case postermywall.Core.AUTHENTICATION_CANCELED:if(this.open_){this.restoreState();}}},init:function(){if(!this.init_){this.init_=true;$('.download-product').on('submit',this.onSubmitDownloadProduct.bind(this));this.el_.find('.sel-download-products').on('change',this.onChangeSelDownloadProducts.bind(this));PMW.onClick($('#btn-free-download'),null,this.onFreeDownload.bind(this));}else{this.restoreState();}
var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME),wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),p=wbp.getPoster();this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'getDownloadProductList'});ap.getDownloadableProductList(p.id,p.isPremium,p.type.name,p.idGalleryTemplate,p.idTemplate,wbp.getUnsavedChanges(),p.isVideo,p.isVideo?p.getNumberOfGettyImagesOnPoster():0).done(this.onGetDownloadableProductListSuccess.bind(this)).fail(this.onGetDownloadableProductListFail.bind(this)).always(this.sendNotification.bind(this,postermywall.Core.HIDE_LOADING,{key:'getDownloadProductList'}));if(this.el_.hasClass('full-screen')){$('#img-basic-quality').attr('src','');this.el_.removeClass('full-screen');}
var mc=this.el_.find('.modal-content.with-message');if(mc.length>0){mc.removeClass('with-message');this.el_.find('.message').hide();}},closeModal:function(cb){postermywall.core.view.modal.ModalMediator.prototype.closeModal.call(this,this.onClose.bind(this,cb));},onClose:function(cb){if(typeof cb==='function'){cb();}
this.el_.find('.download-products').addClass('-compact').children().addClass('-compact').removeClass('in out');this.el_.find('.select-style').addClass('hidden');},onGetDownloadableProductListSuccess:function(r){function sortByPrice(a,b){if(a.productPrice>b.productPrice){return-1;}else if(a.productPrice<b.productPrice){return 1;}
return 0;}
if(r.status=='success'){var i,productCount,product,btnSubmit,status,daysFree,retriesLeft,extraInfo,selHTML='',priceInfo,data=r.data;this.productData_=data.productData.sort(sortByPrice);if(typeof data.discount!=='undefined'){this.promotion_=data.discount;}
var user=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME).getUser();if(user&&user.getPremiumLevel()){if(window.initResponsiveToolTips){initResponsiveToolTips();}}
var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),p=wbp.getPoster();if(p.isVideo){this.el_.find('.download-product.basic-quality').hide();}else{this.el_.find('.download-product.basic-quality').show();}
productCount=this.productData_.length;if(productCount===1){if(p.isVideo){this.el_.find('.modal-content').addClass('-one-product').removeClass('-three-products -two-products');}else{this.el_.find('.modal-content').addClass('-two-products').removeClass('-three-products -one-product');}}else{this.el_.find('.modal-content').addClass('-three-products').removeClass('-two-products -one-product');}
for(i=0;i<productCount;i++){status=this.productData_[i].status;daysFree=this.productData_[i].daysFree;retriesLeft=this.productData_[i].retriesLeft;extraInfo=this.productData_[i].extraInfo;product=this.el_.find('.download-product:nth-child('+(i+1)+')');btnSubmit=product.find('.btn-submit');priceInfo=product.find('.price-info');product.find('.name').text(this.productData_[i].name);product.find('.description').text(this.productData_[i].description);product.attr('data-pid',this.productData_[i].id);product.attr('data-status',status);product.attr('data-orderId',this.productData_[i].orderId);priceInfo.addClass('hidden');if(status=='unpurchased'||(status=='claim-free'&&this.productData_[i].rawPrice>0)||status=='max-retries'){product.removeClass('-free');product.find('.price > .text').text(this.productData_[i].price);product.find('.promo').removeClass('hidden');btnSubmit.text($.t('pm_buy_now')).addClass('btn-secondary').removeClass('btn-primary');}else{product.addClass('-free');product.find('.price > .text').text($.t('pm_free'));product.find('.promo').addClass('hidden');btnSubmit.text($.t('pm_download')).addClass('btn-primary').removeClass('btn-secondary');if(status=='downloadable'&&this.productData_[i].orderFileURLs.length){btnSubmit.attr('data-url',this.productData_[i].orderFileURLs[0]);}}
if(typeof extraInfo!='undefined'&&extraInfo){var j,extraInfoString='';for(j=0;j<extraInfo.length;j++){if(j>0){extraInfoString+='<br/><br/>';}
switch(extraInfo[j]){case'ei-claim-free':extraInfoString+=$.t('pm_premium_claim_free_template');break;case'ei-max-retries':extraInfoString+=$.t('pm_premium_max_retries_message');break;case'ei-edits-left':if(retriesLeft==1){extraInfoString+=$.t('pm_premium_one_edit_remaining')}else if(retriesLeft>0){extraInfoString+=$.t('pm_premium_multiple_edits_remaining',{edits:retriesLeft})}
break;case'ei-no-edits-left':extraInfoString+=$.t('pm_premium_no_edits_remaining');break;case'ei-no-free-days-template':extraInfoString+=$.t('pm_premium_no_free_days_template');break;case'ei-claim-free-getty':extraInfoString+=$.t('pm_premium_claim_free_getty');break;case'ei-getty-user-design':extraInfoString+=$.t('pm_premium_getty_user_design');break;case'ei-added-getty':extraInfoString+=$.t('pm_premium_getty_added');break;case'ei-getty-content':extraInfoString+=$.t('pm_premium_getty_content');break;case'ei-template-purchase':extraInfoString+=$.t('pm_premium_template_purchase',{hashedId:this.productData_[i].galleryTemplateHash});break;case'ei-copy-of-template-purchase':extraInfoString+=$.t('pm_premium_copy_of_template_purchase',{hashedId:this.productData_[i].galleryTemplateHash});break;}}
if(extraInfoString!=''){priceInfo.removeClass('hidden').prop('title',extraInfoString);}}
if(status=='generating'){btnSubmit.prop('disabled',true).text($.t('pm_preparing'));}
selHTML+='<option value="'+this.productData_[i].id+'">'+this.productData_[i].name+'</option>';if(this.productData_[i].id==63){this.isWebDownload_=true;}}
selHTML+='<option value="free">'+$.t('pm_basic_quality_download')+'</option>';this.el_.find('.sel-download-products').html(selHTML);var needAttribution=false;if(p.theme.background.displayAttribution&&p.theme.background.requiresAttribution()){this.el_.find('.download-product:not(.basic-quality) .watermark-info').html($.t('pm_attribution_message',{attributionName:p.theme.background.attributionName}));needAttribution=true;}
if(this.isWebDownload_){this.el_.find('.-download').addClass('hidden');this.el_.find('.-web-download').removeClass('hidden');if(needAttribution){this.el_.find('.download-product.basic-quality .watermark-info').html($.t('pm_attribution_message',{attributionName:p.theme.background.attributionName}));}else{this.el_.find('.download-product.basic-quality .watermark-info').text($.t('pm_no_watermark'));}}else{this.el_.find('.-download').removeClass('hidden');this.el_.find('.-web-download').addClass('hidden');this.el_.find('.download-product.basic-quality .watermark-info').text($.t('pm_large_watermark'));}
if(needAttribution){initResponsiveToolTips();}
this.openModal(this.onModalOpen.bind(this));}else{this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error')});}},onModalOpen:function(){if(!this.el_.find('.collapsible').is(':visible')){PMW.onClick(this.el_.find('.download-products'),'.download-product.-compact',this.onCompactDownloadProduct.bind(this));}},onGetDownloadableProductListFail:function(){this.closeModal();this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_connectivity_error')});},onSubmitDownloadProduct:function(e){e.preventDefault();var frm=$(e.currentTarget),status=frm.attr('data-status'),promocode=frm.find('.inpt-promo-code').val(),btnPurchase=frm.find('.btn-submit'),productId=frm.attr('data-pid'),product=this.getProductData_(productId);if(product){btnPurchase.prop('disabled',true);if(status=='downloadable'&&typeof btnPurchase.attr('data-url')!='undefined'){window.location.href=btnPurchase.attr('data-url');btnPurchase.prop('disabled',false);return;}else if(status=='outdated'){this.facade.sendNotification(postermywall.Core.SAVE,{callback:this.premiumRegen.bind(this,frm.attr('data-orderId')),callbackHasRedirect:true});return;}else if(status=='new-order'||(status=='claim-free'&&product.rawPrice==0)){this.facade.sendNotification(postermywall.Core.SAVE,{callback:this.newPremiumDownload.bind(this,productId),callbackHasRedirect:true});return;}
if(promocode.length>0){btnPurchase.text($.t('pm_verifying'));}
this.purchaseDownload(productId,promocode);}else{this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error')});}},premiumRegen:function(id){$.post(PMW.util.site_url('cart/premiumRegen'),{id:id}).done(this.onPremiumRegenSuccess.bind(this)).fail(this.onPremiumRegenFail.bind(this));},onPremiumRegenSuccess:function(r){if(r.status=='success'){if(typeof r.data!='undefined'&&r.data!=null){var isRealTime=(r.data.isRealTime?1:0);window.location.href=PMW.util.site_url('cart/preparingDownload/'+r.data.type+'/'+r.data.idOrder+'/'+isRealTime)}}else{if(r.code){switch(r.code){case'permission_denied':this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_only_regen_own'),log:false});break;case'purchase_not_found':case'order_not_found':case'param_missing':default:this.sendNotification(postermywall.Core.SHOW_ERROR,{log:false});}}}},onPremiumRegenFail:function(){this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error')});},newPremiumDownload:function(productId){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),p=wbp.getPoster();$.post(PMW.util.site_url('cart/newPremiumDownload'),{id:productId,hid:p.hashedID}).done(this.onNewPremiumDownloadSuccess.bind(this)).fail(this.onNewPremiumDownloadFail.bind(this));},onNewPremiumDownloadSuccess:function(r){if(r.status=='success'){if(typeof r.data!='undefined'&&r.data!=null){var isRealTime=(r.data.isRealTime?1:0);window.location.href=PMW.util.site_url('cart/preparingDownload/'+r.data.type+'/'+r.data.idOrder+'/'+isRealTime)}}else{if(r.code){switch(r.code){case'not_allowed':this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_download_not_allowed'),log:false});break;case'product_not_found':case'poster_not_found':case'param_missing':default:this.sendNotification(postermywall.Core.SHOW_ERROR,{log:false});}}}},onNewPremiumDownloadFail:function(){this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error')});},purchaseDownload:function(idProduct,promocode){var p={promotion:promocode,idProduct:idProduct};this.facade.sendNotification(postermywall.Core.PURCHASE_DOWNLOAD,p);},onFreeDownload:function(e){$(e.currentTarget).blur();var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),img=new Image(),self=this,poster=wbm.getProxy().getPoster();this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'prepBasicQualityDownload',text:$.t('pm_prep_download')});img.onload=function(){var url=postermywall.Core.serverRoot+'?utm_source=freedownload&utm_medium=onlineposting&utm_campaign=refer',up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME),poster=wbm.getProxy().getPoster(),analyticsPosterId='unsaved',userId=up.getUserId();if(userId>0){url+='&'+postermywall.Core.getReferralURIComponent(userId);}
if(((bowser.chrome&&!postermywall.Core.isMobileOS)||bowser.firefox)&&Modernizr.adownload){var name=poster.name.trim().replace(/^-+|[^\w_ ()-]+/g,'');if(name.length>0){$('#download-anchor').prop('download',name+'.jpg');}
var blob=postermywall.Util.dataURLToBlob(img.src),objUrl=window.URL.createObjectURL(blob);$('#download-anchor').attr('href',objUrl).get(0).click();self.closeModal(function(){window.URL.revokeObjectURL(objUrl);});var modal=PMW.openModalDialog('post-free-download-modal',$.t('pm_enjoy_free_download'),{},false,'-flex');modal.find('.content').html('<div class="post-download-msg"><h3>'+$.t('pm_thank_us_tell_friends')+'</h3><div class="addthis-container"><div class="addthis_toolbox_stub" data-url="'+url+'" data-title="'+$.t('pm_addthis_title_to_share')+'" data-count="0" data-compact="0" data-track="0"></div></div><a class="btn-facebook" href="http://www.facebook.com/postermywall" target="_blank"><i class="icon-facebook"></i>'+$.t('pm_btn_become_a_facebook_fan')+'</a></div>');PMW.sharingAfterAction='AfterDownloadShare';PMW.loadAddThisToolbox(modal.find('.addthis_toolbox_stub'));}
else{var wrapper=$('#img-basic-quality-wrapper');this.el_.addClass('full-screen');this.el_.find('.select-style').addClass('hidden');var aspectRatio=img.width/img.height,height=wrapper.height()-wrapper.find('.post-download-msg').height()-wrapper.find('.instructions').outerHeight(true)-5,width=height*aspectRatio;if(width>wrapper.width()){width=wrapper.width();height=width/aspectRatio;}
$('#img-basic-quality').attr('src',img.src).height(height).width(width);if(bowser.mac&&bowser.safari){wrapper.find('.instructions:not(.-macsafari)').addClass('hidden');wrapper.find('.instructions.-macsafari').removeClass('hidden');}
PMW.sharingAfterAction='AfterDownloadShare';PMW.loadAddThisToolbox(wrapper.find('.addthis_toolbox_stub').attr('data-url',url));}
this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'prepBasicQualityDownload'});if(poster.hashedID!==''){analyticsPosterId=poster.hashedID;}else{analyticsPosterId+=poster.getUnsavedId();}
PMW.trackGAEvent(PMW.POSTERBUILDER,'Download',analyticsPosterId,null);if(this.isWebDownload_){PMW.trackGAEvent(PMW.POSTERBUILDER,'WebDownload',analyticsPosterId,null);PMW.trackGAEvent(PMW.POSTERBUILDER,'WebDownloadType',poster.type.name,null);}
var analyticsUserId='unknown';if(userId>0){analyticsUserId=userId;}else{analyticsUserId+=up.getUnsavedId();}
PMW.trackGAEvent(PMW.POSTERBUILDER,'DownloadUser',analyticsUserId,null);if(poster.idTemplate>0){PMW.trackGAEvent(PMW.POSTERBUILDER,'TemplateDownload',poster.idTemplate,null);}
if(poster.id>0&&poster.creator){PMW.incrementPosterView(poster.id,poster.creator.id,[]);}}.bind(this);img.src=wbm.getSnapshot(1,(!this.isWebDownload_||(poster.type.name=='poster-custom'&&(poster.width>this.NO_WATERMARK_ON_CUSTOM_BREAKPOINT||poster.height>this.NO_WATERMARK_ON_CUSTOM_BREAKPOINT))));},showMessage:function(m){var mc=this.el_.find('.modal-content');if(mc.hasClass('with-message')){var msg=mc.find('.message');msg.html(m).addClass('animated flash').one(PMW.util.animationEndEvents,function(){msg.removeClass('animated flash');});}else{mc.addClass('with-message').end().find('.message').html(m).slideDown();}},restoreState:function(){this.el_.find('.btn').prop('disabled',false).filter('.btn-secondary').text($.t('pm_buy_now'));},onChangeSelDownloadProducts:function(e){this.selectDownloadProduct($(e.currentTarget).val());},selectDownloadProduct:function(pid){var goingOut=this.el_.find('.download-product.in'),comingIn=this.el_.find('.download-product[data-pid='+pid+']'),m=this.el_;if(goingOut.length){m.addClass('animating');goingOut.addClass('animated outRight').one(PMW.util.animationEndEvents,function(){goingOut.removeClass('animated outRight');PMW.toggleInOut(goingOut,false);PMW.toggleInOut(comingIn,true);comingIn.addClass('animated fadeInUp').one(PMW.util.animationEndEvents,function(){comingIn.removeClass('animated fadeInUp');m.removeClass('animating');});});}else{PMW.toggleInOut(comingIn,true);m.addClass('animating');comingIn.addClass('animated fadeInUp').one(PMW.util.animationEndEvents,function(){comingIn.removeClass('animated fadeInUp');m.removeClass('animating');});}},onCompactDownloadProduct:function(e){var el=$(e.currentTarget);if(el.find('.collapsible').is(':hidden')){this.el_.find('.download-products').off();var dlp=this.el_.find('.download-products'),sel=this.el_.find('.select-style');this.el_.addClass('animating');dlp.addClass('animated outRight').one(PMW.util.animationEndEvents,function(){dlp.removeClass('animated outRight -compact').children().removeClass('-compact').addClass('out');this.el_.removeClass('animating');sel.removeClass('hidden').addClass('animated fadeInLeft').one(PMW.util.animationEndEvents,function(){sel.removeClass('animated fadeInLeft');}).children('.sel-download-products').val(el.attr('data-pid'));this.selectDownloadProduct(el.attr('data-pid'));}.bind(this));}},getProductData_:function(id){var i,productCount=this.productData_.length;for(i=0;i<productCount;i++){if(this.productData_[i].id==id){return this.productData_[i];}}
return null;}},{NAME:'DownloadModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.PosterPurchasedWarningModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#poster-purchased-modal'));}},{notificationInterests_:[postermywall.Core.POSTER_PURCHASED_WARNING],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.POSTER_PURCHASED_WARNING:this.init();this.openModal();PMW.trackGAEvent(PMW.POSTERBUILDER,'EditingPurchasedPoster');break;}},init:function(){if(!this.init_){this.init_=true;PMW.onClick(this.el_.find('.footer .btn-continue'),null,this.closeModal.bind(this));PMW.onClick(this.el_.find('.footer .btn-issue'),null,this.onBtnIssue);}},onBtnIssue:function(){window.location=PMW.util.site_url('cart/orderhistory');}},{NAME:'PosterPurchasedWarningModalMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.modal.ResizePurchasedPosterWarningModalMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#resize-purchased-poster-modal'));}},{notificationInterests_:[postermywall.Core.OPEN_RESIZE_PURCHASED_POSTER_MODAL],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);switch(note.getName()){case postermywall.Core.OPEN_RESIZE_PURCHASED_POSTER_MODAL:this.init();this.openModal();break;}},init:function(){if(!this.init_){this.init_=true;PMW.onClick(this.el_.find('.btn-cancel'),null,this.closeModal.bind(this));PMW.onClick(this.el_.find('.btn-copy-poster'),null,this.sendNotification.bind(this,postermywall.Core.DUPLICATE_POSTER));}}},{NAME:'ResizePurchasedPosterWarningModalMediator'});
(function(){var rHandle_=0;var loadingKeys_=[];var loading_=$('#loading');var googleOAuthToken_=null;puremvc.define({name:'postermywall.core.view.AppMediator',parent:puremvc.Mediator},{listNotificationInterests:function(){return[postermywall.Core.INIT_UI,postermywall.Core.POSTER_CHANGED,postermywall.Core.POSTER_SAVED,postermywall.Core.USER_SET,postermywall.Core.SHOW_LOADING,postermywall.Core.HIDE_LOADING,postermywall.Core.POSTER_BACKGROUND_LOADED,postermywall.Core.POSTER_GRAPHICITEMS_LOADED];},onRegister:function(){},handleNotification:function(note){var b=note.getBody();switch(note.getName()){case postermywall.Core.INIT_UI:$('#preloader').remove();$('#container').show();this.onResize_();PMW.toggleInOut($('#nav'),true);$(window).resize(this.resizeHandler_.bind(this));this.disableDragDrop_();PMW.onClick($('.icon-close',loading_),null,this.onCloseLoading_.bind(this));if(postermywall.Core.isMobileOS){$('html').addClass('-tablet');}
var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME),user=up.getUser(),userNotified=false;if((i18n.lng()!='en')&&((user!=null&&user.id>0&&!user.preferredLanguage)||(user==null&&PMW.util.readCookie('pmwpl')==null))){this.facade.sendNotification(postermywall.Core.SHOW_LANGUAGE_NOTIFICATION);userNotified=true;}
if(!userNotified&&postermywall.Core.isUnsupportedBrowser){this.facade.sendNotification(postermywall.Core.SHOW_UNSUPPORTED_BROWSER_NOTIFICATION);}
break;case postermywall.Core.SHOW_LOADING:this.onShowLoading(b);break;case postermywall.Core.HIDE_LOADING:this.onHideLoading(b);break;case postermywall.Core.USER_SET:this.onUserSet_();break;case postermywall.Core.USER_UNSET:this.onUserUnset_();break;case postermywall.Core.POSTER_CHANGED:this.updateHeader_(b);this.updateTitle_(b.name);break;case postermywall.Core.POSTER_BACKGROUND_LOADED:this.updateEditor_(b);break;case postermywall.Core.POSTER_SAVED:this.updateURL_(b.poster);this.updateTitle_(b.poster.name);break;case postermywall.Core.POSTER_GRAPHICITEMS_LOADED:var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);ap.getScript(['https://s7.addthis.com/js/300/addthis_widget.js#pubid=jafferhaider&async=1'],true).done(function(){addthis.init();addthis.toolbox(".addthis_toolbox_parent");});break;}},disableDragDrop_:function(){var w=$(window);w.on('dragover',function(e){e.preventDefault();});w.on('drop',function(e){e.preventDefault();});},resizeHandler_:function(){clearTimeout(rHandle_);rHandle_=setTimeout(this.onResize_.bind(this),500);},onResize_:function(){$('#container').height($(window).height()+'px');this.sendNotification(postermywall.Core.VIEWPORT_RESIZED);},updateTitle_:function(text){document.title=text+' | PosterMyWall';},updateURL_:function(p){if(window.history&&window.location&&window.location.pathname&&window.location.pathname.length>0){var path=window.location.pathname.split('/'),c='',m='',i,newPath=[];for(i=0;i<path.length;i++){if(path[i]=='index.php'){if(i+1<path.length){c=path[i+1];}
if(i+2<path.length){m=path[i+2];}
newPath.push(path[i]);break;}
else{newPath.push(path[i]);}}
if(c.length>0&&m!=='load'){newPath.push(c);newPath.push('load');newPath.push(p.hashedID);window.history.replaceState("saved","saved",newPath.join('/'));}}},updateHeader_:function(p){},updateEditor_:function(p){var show=(p!=null);PMW.toggleInOut($('#editor .panel.out:not(#contextual-opts), #zoom.out'),(p!=null));if($(window).width()<=postermywall.core.view.AppMediator.CONTEXTUAL_MENU_BREAKPOINT){this.sendNotification(postermywall.Core.CONTEXTUAL_OPTIONS_HIDDEN);}else{setTimeout(function(){PMW.toggleInOut($('#contextual-opts'),show);},900);}
if(postermywall.Core.isMobileOS){PMW.toggleInOut($('#panning.out'),show);}},onUserSet_:function(){this.setHomeDestination(PMW.util.site_url('posters/mine'),'Go to My Stuff');},onUserUnset_:function(){this.setHomeDestination(PMW.util.site_url(''),'');},setHomeDestination:function(href,title){var links=$('.btn-go-home');for(var i=0;i<links.length;i++){if(links[i].hasAttribute('data-href')){links[i].setAttribute('data-href',href);}
else{links[i].setAttribute('href',href);}
links[i].setAttribute('title',title);}},onShowLoading:function(options){if(options.key){options.priority=options.priority||0;options.text=options.text||$.t('pm_loading');options.prepend=options.prepend||null;options.hideIcon=options.hideIcon||false;var update=false;if(loadingKeys_.length>0){var endIdx=loadingKeys_.length-1;for(var i=endIdx;i>=0;i--){if(options.priority>=loadingKeys_[i].priority){loadingKeys_.splice(i,0,{key:options.key,priority:options.priority,text:options.text,prepend:options.prepend,hideIcon:options.hideIcon});if(i===endIdx){update=true;}
break;}
if(i==0){loadingKeys_[loadingKeys_.length]={key:options.key,priority:options.priority,text:options.text,prepend:options.prepend,hideIcon:options.hideIcon}}}}else{loadingKeys_[0]={key:options.key,priority:options.priority,text:options.text,prepend:options.prepend,hideIcon:options.hideIcon};update=true;}
if(update){PMW.toggleInOut(this.setLoading_(options),true);}}},createGoogleAuthWindow:function(){if(!this.isAuthTokenValid()){var text='https://accounts.google.com/o/oauth2/v2/auth?'+'scope=https://www.googleapis.com/auth/drive.readonly&'+'redirect_uri='+encodeURIComponent(PMW.util.site_url('posterbuilder/googleAuthCallback'))+'&'+'response_type=token&'+'client_id='+postermywall.Core.googleClientId,authWindowDimensions=this.calculateAuthWindowDimensions_(),w=window.open(text,'targetWindow','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,'+'width='+authWindowDimensions.width+',height='+authWindowDimensions.height+',top='+authWindowDimensions.top+',left='+authWindowDimensions.left),self=this;window.getBackLocationHash=function(locationHash){w.close();while(locationHash.charAt(0)==='#'){locationHash=locationHash.substr(1);}
var params={},regex=/([^&=]+)=([^&]*)/g,m;while(m=regex.exec(locationHash)){params[decodeURIComponent(m[1])]=decodeURIComponent(m[2]);}
googleOAuthToken_={token:params.access_token,expiration:(parseInt(params.expires_in)+Math.floor(Date.now()/1000))};self.loadMediator(['postermywall.core.view.GooglePhotoPickerMediator'],postermywall.Core.GOOGLE_AUTH_TOKEN_SET,null);};}},getOAuthToken:function(){return googleOAuthToken_;},onHideLoading:function(options){if(options.key&&loadingKeys_.length>0){var update=false;var endIdx=loadingKeys_.length-1;for(var i=endIdx;i>=0;i--){if(options.key===loadingKeys_[i].key){loadingKeys_.splice(i,1);if(i===endIdx){update=true;}}}
if(loadingKeys_.length===0){this.resetLoading_();}else if(update){loading_.find('.prepended').remove();this.setLoading_({text:loadingKeys_[loadingKeys_.length-1].text,prepend:loadingKeys_[loadingKeys_.length-1].prepend});}}},isAuthTokenValid:function(){if(googleOAuthToken_){if(googleOAuthToken_.expiration>Math.floor(Date.now()/1000)){return true;}}
return false;},calculateAuthWindowDimensions_:function(){var maxHeight=600,maxWidth=600,padding=40,topBarPadding=50,authWindowDimensions={width:(window.innerWidth>maxWidth?maxWidth:window.innerWidth-padding),height:window.innerHeight>maxHeight?maxHeight:window.innerHeight-padding-topBarPadding};authWindowDimensions['left']=((window.innerWidth-authWindowDimensions.width+padding)/2);authWindowDimensions['top']=((window.innerHeight-authWindowDimensions.height+padding)/2);return authWindowDimensions;},onCloseLoading_:function(){loadingKeys_.length=0;this.resetLoading_();},resetLoading_:function(){PMW.toggleInOut(loading_,false);setTimeout(function(){if(loadingKeys_.length===0){loading_.find('.prepended').remove();loading_.find('i').show();}else{if(!loadingKeys_[loadingKeys_.length-1].prepend){loading_.find('.prepended').remove();}
if(!loadingKeys_[loadingKeys_.length-1].hideIcon){loading_.find('i').show();}}},500);},setLoading_:function(options){loading_.find('.prepended').remove();if(options.prepend){loading_.prepend(options.prepend.addClass('prepended'));}
if(options.hideIcon){loading_.find('i').hide();}
return loading_.find('span').html(options.text).end();},showUnableToUploadError:function(){this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_cannot_upload_error_msg')});},loadCropperLibrary:function(cb){if(typeof jQuery().cropper==='undefined'){this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'getCropperLib'});var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);ap.getScript(['vendor/cropper.js']).done(cb.bind(this)).fail(this.sendNotification.bind(this,postermywall.Core.SHOW_ERROR,{message:$.t('pm_connectivity_error'),debug:'AppMediator::loadCropperLibrary Failed to load vendor library cropper.js'})).always(this.sendNotification.bind(this,postermywall.Core.HIDE_LOADING,{key:'getCropperLib'}));}else{cb();}},loadMediator:function(classes,notification,params){var that=this,sa=[],i,modalMediatorClass=classes[classes.length-1];for(i=0;i<classes.length;i++){if(typeof postermywall.core.view.modal=='undefined'||postermywall.Util.isStringAFunction(classes[i])==false){sa[sa.length]=classes[i].replace('postermywall','postermaker').split('.').join('/')+'.js';}}
if(sa.length){var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);this.sendNotification(postermywall.Core.SHOW_LOADING,{key:modalMediatorClass});ap.getScript(sa).done(function(){var modalMediator=postermywall.Util.stringToFunction(modalMediatorClass);that.facade.registerMediator(new modalMediator());that.facade.sendNotification(notification,params);}).fail(function(){that.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_connectivity_error')});}).always(this.sendNotification.bind(this,postermywall.Core.HIDE_LOADING,{key:modalMediatorClass}));}else{that.facade.sendNotification(notification,params);}}},{NAME:'AppMediator',BOTTOM_MENU_BREAKPOINT:768,CONTEXTUAL_MENU_BREAKPOINT:630});})();
(function(){var ZOOM_MAX=(bowser.ios)?2:4;var ZOOM_MIN=0.2;var ZOOM_STEP=0.2;var eventsInitialized_=false;var zoomLabel_=null;var zoomLabelToast_=null;var zoomLabelTimeout_=0;var offsetMultiplier_=0;var FONT_SIZE_MIN=8;var FONT_SIZE_MAX=500;var LEADING_MIN=10;var LEADING_MAX=500;var LETTER_SPACING_MIN=-20;var LETTER_SPACING_MAX=50;var TABS_MIN=2;var TABS_MAX=20;var resizeSelectionScaleFactor_=0.04;var resizeTextFactor_=4;var alphaSlider_=null;var changeBackgroundSelector_=null;var changeBackgroundFilterSelector_=null;var backgroundTypeUserVal_=-1;var gradientTypeSelector_=null;var imageEdgeSelector_=null;var imageShadowSelector_=null;var imageGlowSelector_=null;var imageBorderSelector_=null;var imageFilterSelector_=null;var fancyTextSelector_=null;var fancyTextFontFamilySelector_=null;var fancyTextMorphSelector_=null;var fancyTextShadowSelector_=null;var textFontFamilySelector_=null;var textFontFamilySelector2_=null;var textShadowSelector_=null;var shapeShadowSelector_=null;var nav_=null;var editor_=null;var wbContainer_=null;var dragDropOverlay_=null;var btnUndo_=null;var btnRedo_=null;var btnSave_=null;var btnToggleContextualSidebar_=null;var wm_=null;var fileUploadQueue_=[];var numFilesToUpload_=0;var uploadFileCount_=0;var cachedDims_={};var lastKeyUpAt_=new Date();var objectTranslateDelta_=1;var lastSetTimeOut=new Date();var tglLockMovement_=null;var lblLockMovement_=null;var lblFontSupport_=null;var lblTextEditable_=null;var tglImageTint_=null;var tglImageMultiply_=null;var tglBackgroundTint_=null;var tglBackgroundMultiply_=null;var shapeFillType_=null;var vectorFillType_=null;var textFillType_=null;var textBackgroundSelector_=null;var textPatternSelector_=null;var fontFamilySelector_=null;var fontFamilySelector2_=null;var textRegular_=null;var textForTabs_=null;var tabsSeparatorTypeSelector_=null;var tableBorderSelector_=null;var tableLayoutSelector_=null;var menuLayoutSelector_=null;var textFancy_=null;var btnPanning_=null,btnMoveUp_=null,btnMoveDown_=null,btnMoveLeft_=null,btnMoveRight_=null;var sendToBack_=null,bringToFront_=null;var zoomOpts_=null;var contextualSidebar_=null;var contextualSidebarIn_=true;var contextualSidebarAnimatingTId_=0;var bottomBar_=null;function getCachedDimension_(s,dim){if(cachedDims_[s]){return cachedDims_[s];}
cachedDims_[s]=$(s)[dim]();return cachedDims_[s];}
puremvc.define({name:'postermywall.core.view.EditorMediator',parent:puremvc.Mediator},{bgParams_:null,fontFamilyProp_:'',listNotificationInterests:function(){return[postermywall.Core.INIT_UI,postermywall.Core.POSTER_CHANGED,postermywall.Core.POSTER_NAME_CHANGED,postermywall.Core.POSTER_DESCRIPTION_CHANGED,postermywall.Core.POSTER_BACKGROUND_LOADED,postermywall.Core.POSTER_SAVED,postermywall.Core.REFRESH_BACKGROUND_OPTIONS,postermywall.Core.VIEWPORT_RESIZED,postermywall.Core.SELECTION_CREATED,postermywall.Core.SELECTION_CLEARED,postermywall.Core.UNDO_AVAILABLE,postermywall.Core.UNDO_UNAVAILABLE,postermywall.Core.REDO_AVAILABLE,postermywall.Core.REDO_UNAVAILABLE,postermywall.Core.SAVE_AVAILABLE,postermywall.Core.SAVE_UNAVAILABLE,postermywall.Core.CROP,postermywall.Core.LOAD_IMAGE_AS_BACKGROUND,postermywall.Core.SHOW_REPLACE_SELECTED_IMAGE,postermywall.Core.EDIT_TABLE_CONTENT,postermywall.Core.UPDATE_FONT_FAMILY_SELECTOR,postermywall.Core.GRAPHIC_ITEM_ADDED,postermywall.Core.GRAPHIC_ITEM_REMOVED,postermywall.Core.GRAPHIC_ITEM_TEXT_UPDATED,postermywall.Core.GRAPHIC_ITEM_DOUBLE_CLICK,postermywall.Core.DUPLICATE_POSTER,postermywall.Core.CONTEXTUAL_OPTIONS_HIDDEN,postermywall.Core.SHOW_GRAPHIC_ITEM_OPTIONS,postermywall.Core.EDIT_MENU_ITEM,postermywall.Core.UPDATE_GRAPHIC_ITEMS];},getWhiteboardMediator:function(){if(wm_===null){wm_=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);}
return wm_;},onRegister:function(){nav_=$('#nav');editor_=$('#editor');wbContainer_=$('#whiteboardContainer');dragDropOverlay_=wbContainer_.children('.dragdropoverlay');zoomLabel_=$('.lbl-zoom');zoomLabelToast_=$('#zoom').find('.lbl-zoom');btnUndo_=$('.btn-undo');btnRedo_=$('.btn-redo');btnSave_=$('.btn-save-poster');btnToggleContextualSidebar_=$('.btn-toggle-contextual-sidebar');tglLockMovement_=$('#toggle-item-lock');lblLockMovement_=$('#lbl-lock-movement');lblTextEditable_=$('#lbl-text-editable');lblFontSupport_=$('#lbl-font-support');tglImageTint_=$('#toggle-image-tint');tglImageMultiply_=$('#toggle-image-multiply');tglBackgroundTint_=$('#toggle-background-tint');tglBackgroundMultiply_=$('#toggle-background-multiply');fontFamilySelector_=$('#sel-font-family');fontFamilySelector2_=$('#sel-font-family2');textFancy_=$('#txt-fancy');zoomOpts_=$('#zoom');bottomBar_=$('#bottom-bar');contextualSidebar_=$('#contextual-opts');textForTabs_=$('#txt-for-tabs');sendToBack_=$('.btn-move-to-back');bringToFront_=$('.btn-move-to-front');if(postermywall.Core.isMobileOS){textRegular_=$('#txt-regular');btnPanning_=$('#panning');btnMoveUp_=$('.btn-move-up');btnMoveDown_=$('.btn-move-down');btnMoveLeft_=$('.btn-move-left');btnMoveRight_=$('.btn-move-right');}},handleNotification:function(note){var body=note.getBody();switch(note.getName()){case postermywall.Core.INIT_UI:if(!(window.File&&window.FileList)){PMW.log('UploadLibrary :: UA does not support one of the following, window.File: '+typeof window.File+' window.FileList: '+typeof window.FileList);}
this.initUploads();this.setupKeyboardShortcuts_();break;case postermywall.Core.POSTER_CHANGED:this.updateGoHomeLinks();break;case postermywall.Core.POSTER_NAME_CHANGED:this.setPosterName(body);this.onSelectionCleared();break;case postermywall.Core.POSTER_DESCRIPTION_CHANGED:this.setPosterDescription(body);break;case postermywall.Core.SELECTION_CREATED:this.onSelectionCreated(body);break;case postermywall.Core.GRAPHIC_ITEM_DOUBLE_CLICK:this.onGraphicItemDoubleClick_();break;case postermywall.Core.SELECTION_CLEARED:this.onSelectionCleared();break;case postermywall.Core.SHOW_REPLACE_SELECTED_IMAGE:this.onReplaceImage();break;case postermywall.Core.EDIT_TABLE_CONTENT:this.onEditSchedule();break;case postermywall.Core.EDIT_MENU_ITEM:this.onEditMenuItem();break;case postermywall.Core.UPDATE_FONT_FAMILY_SELECTOR:this.updateFontFamilySelector();break;case postermywall.Core.GRAPHIC_ITEM_ADDED:if(postermywall.core.model.vo.PosterVO.hasEditableText(body.model)){this.updateFontFamilySelector();}
break;case postermywall.Core.GRAPHIC_ITEM_REMOVED:if(postermywall.core.model.vo.PosterVO.hasEditableText(body)){this.updateFontFamilySelector();}
break;case postermywall.Core.GRAPHIC_ITEM_TEXT_UPDATED:this.onTextChanged(body.model,null);break;case postermywall.Core.UPDATE_GRAPHIC_ITEMS:var models=body.models;if(models.length===1){if(models[0].gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE){this.refreshTableCustomSliders(models[0]);}
else if(models[0].gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_MENU){this.refreshMenuCustomSliders(models[0]);}}
break;case postermywall.Core.POSTER_BACKGROUND_LOADED:var poster=body,wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);contextualSidebar_.find('.poster-type').html(wbp.getPosterTypeDisplayName());if(poster.type.name===postermywall.core.model.vo.PosterTypeVO.TYPE_POSTER_CUSTOM){contextualSidebar_.find('.poster-type-description .text').html(poster.userWidth+poster.units+' &times; '+poster.userHeight+poster.units);}else{contextualSidebar_.find('.poster-type-description .text').html(wbp.getPosterTypeDescription());}
if(!eventsInitialized_){wbContainer_.removeClass('loading');this.onResize();var wm=this.getWhiteboardMediator(),self=this;eventjs.add(wm.getViewComponent().upperCanvasEl,'drag',function(e,s){wm.onDrag(e,s);});PMW.onClick(wbContainer_,null,this.onContainerClick_.bind(this));PMW.onClick(zoomOpts_.find('.btn-zoom-in'),null,this.onZoomIn.bind(this));PMW.onClick(zoomOpts_.find('.btn-zoom-out'),null,this.onZoomOut.bind(this));PMW.onClick(zoomOpts_.find('.btn-fit-to-screen'),null,this.fitWhiteboardToScreen.bind(this));PMW.onClick(bottomBar_.find('.opens-menu'),null,this.onToggleMenu);PMW.onClick(bottomBar_.find('.btn-zoom-in'),null,this.onZoomIn.bind(this));PMW.onClick(bottomBar_.find('.btn-zoom-out'),null,this.onZoomOut.bind(this));PMW.onClick(bottomBar_.find('.btn-fit-to-screen'),null,this.fitWhiteboardToScreen.bind(this));PMW.onClick(bottomBar_.find('.btn-toggle-contextual-sidebar'),null,this.toggleContextualSidebar.bind(this));$('#txtPosterName').change(this.onNameChange.bind(this));$('#seek-video').change(this.onSeekVideo.bind(this));$('#txtPosterDescription').change(this.onDescriptionChange.bind(this));changeBackgroundSelector_=new postermywall.core.view.widget.Selector($('#change-background-sel'),this.onBackgroundTypeModified_.bind(this));changeBackgroundFilterSelector_=new postermywall.core.view.widget.Selector($('#change-background-filter'),this.onBackgroundFilterModified_.bind(this));gradientTypeSelector_=new postermywall.core.view.widget.Selector($('#gradient-type-sel'),this.onGradientTypeModified_.bind(this));PMW.onClick($('#btn-replace-background'),null,this.onImageOfBackgroundOptions.bind(this));PMW.onClick($('#btn-crop-background'),null,this.onCropBackground.bind(this,postermywall.Core.CROP_BACKGROUND));if(poster.primaryColor===null){poster.primaryColor='ffffff';}
if(poster.secondaryColor===null){poster.secondaryColor='ffffff';}
this.refreshPosterOptions_();imageEdgeSelector_=new postermywall.core.view.widget.Selector($('#selEdgeEffect'),this.onImageEdgeModified_.bind(this));imageShadowSelector_=new postermywall.core.view.widget.Selector($('#selImageShadow'),this.onImageShadowModified_.bind(this));imageGlowSelector_=new postermywall.core.view.widget.Selector($('#selImageGlow'),this.onImageGlowModified_.bind(this));imageFilterSelector_=new postermywall.core.view.widget.Selector($('#selImageFilters'),this.onImageFilterModified_.bind(this));imageBorderSelector_=new postermywall.core.view.widget.Selector($('#selImageBorders'),this.onImageBorderModified_.bind(this));tglImageTint_.on('change',this.onImageTintModified_.bind(this));tglImageMultiply_.on('change',this.onImageMultiplyModified_.bind(this));tglBackgroundTint_.on('change',this.onBackgroundTintModified_.bind(this));tglBackgroundMultiply_.on('change',this.onBackgroundMultiplyModified_.bind(this));postermywall.Util.attachTypingStoppedHandler(textFancy_,this.onFancyTextChange_.bind(this));fancyTextSelector_=new postermywall.core.view.widget.Selector($('#selFancyText'),this.onFancyTextModified_.bind(this));fancyTextFontFamilySelector_=new postermywall.core.view.widget.Selector($('#selFancyFontFamily'),this.onFancyTextFontModified_.bind(this));fancyTextMorphSelector_=new postermywall.core.view.widget.Selector($('#selFancyTextMorph'),this.onFancyTextMorphModified_.bind(this));fancyTextShadowSelector_=new postermywall.core.view.widget.Selector($('#selFancyTextShadow'),this.onFancyTextShadowModified_.bind(this));textFontFamilySelector_=new postermywall.core.view.widget.Selector(fontFamilySelector_,this.onTextFontFamilyModified_.bind(this,'fontFamily'));textFontFamilySelector2_=new postermywall.core.view.widget.Selector(fontFamilySelector2_,this.onTextFontFamilyModified_.bind(this,'fontFamily2'));textShadowSelector_=new postermywall.core.view.widget.Selector($('#selTextShadow'),this.onTextShadowModified_.bind(this));textFillType_=new postermywall.core.view.widget.Selector($('#selTextFill'),this.onColorFillModified_.bind(this,'#textSolidFill','#textGradientFill','#textPatternFill'));textBackgroundSelector_=new postermywall.core.view.widget.Selector($('#selTextBackground'),this.onTextBackgroundModified_.bind(this));textPatternSelector_=new postermywall.core.view.widget.Selector($('#selTextPatternFill'),this.onPatternFillModified_.bind(this));shapeShadowSelector_=new postermywall.core.view.widget.Selector($('#selShapeShadow'),this.onShapeShadowModified_.bind(this));shapeFillType_=new postermywall.core.view.widget.Selector($('#selShapeFill'),this.onColorFillModified_.bind(this,'#shapeSolidFill','#shapeGradientFill',null));vectorFillType_=new postermywall.core.view.widget.Selector($('#selVectorFill'),this.onColorFillModified_.bind(this,'#shapeSolidFill','#shapeGradientFill',null));postermywall.Util.attachTypingStoppedHandler(textForTabs_,this.onTextChange_.bind(this,textForTabs_));tabsSeparatorTypeSelector_=new postermywall.core.view.widget.Selector($('#selTabsSeparatorType'),this.onTabsSeparatorTypeModified_.bind(this));tableBorderSelector_=new postermywall.core.view.widget.Selector($('#selTableBorders'),this.onTableBorderModified_.bind(this));tableLayoutSelector_=new postermywall.core.view.widget.Selector($('#sel-schedule-layout'),this.onScheduleLayoutChange_.bind(this));menuLayoutSelector_=new postermywall.core.view.widget.Selector($('#sel-menu-layout'),this.onMenuLayoutChange_.bind(this));if(postermywall.Core.isMobileOS){postermywall.Util.attachTypingStoppedHandler(textRegular_,this.onTextChange_.bind(this,textRegular_));btnMoveUp_.on("touchstart",this.onMovePoster.bind(this,0,10));btnMoveDown_.on("touchstart",this.onMovePoster.bind(this,0,-10));btnMoveLeft_.on("touchstart",this.onMovePoster.bind(this,10,0));btnMoveRight_.on("touchstart",this.onMovePoster.bind(this,-10,0));btnMoveUp_.on("touchend",this.onStopMovement.bind(this));btnMoveDown_.on("touchend",this.onStopMovement.bind(this));btnMoveLeft_.on("touchend",this.onStopMovement.bind(this));btnMoveRight_.on("touchend",this.onStopMovement.bind(this));this.getWhiteboardMediator().toggleAlignmentGuides(false);}
var lockHandler=this.onLockMovement.bind(this);tglLockMovement_.on('change',lockHandler);PMW.onClick(lblLockMovement_,'a',lockHandler);PMW.onClick(lblFontSupport_,'.btn-use-recommended-font',this.onUseRecommendedFont_.bind(this));PMW.onClick($('#txt-align .btn'),null,function(){self.onTextAlignModified_(this);});PMW.onClick(btnUndo_,null,this.onUndo.bind(this));PMW.onClick(btnRedo_,null,this.onRedo.bind(this));PMW.onClick($('#btn-stretch-h'),null,this.onStretchToCanvas.bind(this,'horizontal'));PMW.onClick($('#btn-stretch-v'),null,this.onStretchToCanvas.bind(this,'vertical'));PMW.onClick($('.btn-move-to-front'),null,this.onMoveItem.bind(this,'forward'));PMW.onClick($('.btn-move-to-back'),null,this.onMoveItem.bind(this,'backwards'));PMW.onClick($('.btn-duplicate'),null,this.onDuplicateItem.bind(this));PMW.onClick($('.btn-delete'),null,this.onDeleteItem.bind(this));PMW.onClick($('.btn-clear'),null,this.onClearSelection.bind(this));PMW.onClick($('.btn-align-h-l'),null,this.onHorizontalAlignment.bind(this,'left'));PMW.onClick($('.btn-align-h-r'),null,this.onHorizontalAlignment.bind(this,'right'));PMW.onClick($('.btn-align-h-c'),null,this.onHorizontalAlignment.bind(this,'center'));PMW.onClick($('.btn-align-v-t'),null,this.onVerticalAlignment.bind(this,'top'));PMW.onClick($('.btn-align-v-b'),null,this.onVerticalAlignment.bind(this,'bottom'));PMW.onClick($('.btn-align-v-c'),null,this.onVerticalAlignment.bind(this,'center'));PMW.onClick($('.btn-spacing-h'),null,this.onGroupSpacing_.bind(this,'horizontal'));PMW.onClick($('.btn-spacing-v'),null,this.onGroupSpacing_.bind(this,'vertical'));PMW.onClick($('.btn-play-pause'),null,this.onPlayPauseVideo.bind(this));PMW.onClick($('#btn-trim-video'),null,this.onTrimVideo.bind(this,postermywall.Core.OPEN_MODAL_VIDEO_TRIM,null));PMW.onClick($('#btn-replace-video'),null,this.onReplaceVideo.bind(this,postermywall.Core.OPEN_MODAL_SELECT_VIDEO_TYPE,null));PMW.onClick($('#btn-crop-image'),null,this.onCropImage.bind(this,postermywall.Core.OPEN_MODAL_CROPPER,null,false));PMW.onClick($('#btn-replace-image'),null,this.onReplaceImage.bind(this));PMW.onClick($('#btn-mask-image'),null,this.onMaskImage.bind(this,postermywall.Core.OPEN_MODAL_MASKING,null));PMW.onClick($('.btn-edit-schedule'),null,this.onEditTableOrMenu_.bind(this));PMW.onClick($('#toolbar .opens-menu'),null,this.onToggleMenu);var fontSelectors=$('.-supports-custom-fonts');PMW.onClick(fontSelectors,'.btn-manage-fonts',this.onManageFonts.bind(this));PMW.onClick(fontSelectors,'.btn-upload-fonts',this.onUploadFonts.bind(this));PMW.onClick($('#btn-flip-image-x'),null,this.onImageFlipX_.bind(this));PMW.onClick($('#btn-flip-image-y'),null,this.onImageFlipY_.bind(this));PMW.onClick($('.btn-align-c-v'),null,this.onAlignSelection_.bind(this,'vertical'));PMW.onClick($('.btn-align-c-h'),null,this.onAlignSelection_.bind(this,'horizontal'));PMW.onClick($('.btn-align-c'),null,this.onAlignSelection_.bind(this,'center'));PMW.onClick($('.btn-align-left'),null,this.onAlignSelection_.bind(this,'left'));PMW.onClick($('.btn-align-right'),null,this.onAlignSelection_.bind(this,'right'));PMW.onClick($('.btn-align-top'),null,this.onAlignSelection_.bind(this,'top'));PMW.onClick($('.btn-align-bottom'),null,this.onAlignSelection_.bind(this,'bottom'));PMW.onClick($('.btn-add-upload'),null,this.onAddPhotoModal.bind(this,postermywall.Core.OPEN_MODAL_UPLOAD,null));PMW.onClick($('.btn-add-stock-photo'),null,this.onAddStockImageModal.bind(this,postermywall.Core.OPEN_MODAL_IMAGE_STOCK,null));PMW.onClick($('.btn-add-facebook-photo'),null,this.onAddFacebookPhotoModal.bind(this,postermywall.Core.OPEN_MODAL_FACEBOOK,null));PMW.onClick($('.btn-add-google-photo'),null,this.onAddGooglePhoto.bind(this,postermywall.Core.OPEN_MODAL_GOOGLE_PHOTOS,null));PMW.onClick($('.btn-add-dropbox-photo'),null,this.onAddDropboxPhoto.bind(this,postermywall.Core.OPEN_MODAL_DROPBOX,null));PMW.onClick($('.btn-add-upload-video'),null,this.onAddVideoModal.bind(this,postermywall.Core.OPEN_MODAL_VIDEO_UPLOAD,null));PMW.onClick($('.btn-add-stock-video'),null,this.onAddStockVideoModal.bind(this,postermywall.Core.OPEN_MODAL_VIDEO_STOCK,null));PMW.onClick($('.btn-add-text'),null,this.onAddText.bind(this));PMW.onClick($('.btn-add-fancy-text'),null,this.onAddFancyText.bind(this,postermywall.Core.OPEN_MODAL_FANCY_TEXT));PMW.onClick($('.btn-add-tabs'),null,this.onAddTabs.bind(this));PMW.onClick($('.btn-add-schedule'),null,this.openScheduleModal.bind(this,postermywall.Core.OPEN_MODAL_SCHEDULE,null));PMW.onClick($('.btn-add-table'),null,this.openScheduleModal.bind(this,postermywall.Core.OPEN_MODAL_TABLE,null));PMW.onClick($('.btn-add-menu'),null,this.openMenuModal.bind(this,postermywall.Core.OPEN_MODAL_MENU,null));PMW.onClick($('.btn-add-shapes'),null,this.onAddShape.bind(this,postermywall.Core.OPEN_MODAL_SHAPES,false));PMW.onClick($('.btn-add-clipart'),null,this.onAddClipart.bind(this,postermywall.Core.OPEN_MODAL_CLIPART,false));PMW.onClick($('.btn-cb-solid-color'),null,this.onBackgroundTypeModifiedSidebar_.bind(this,'0'));PMW.onClick($('.btn-cb-gradient'),null,this.onBackgroundTypeModifiedSidebar_.bind(this,'1'));PMW.onClick($('.btn-cb-upload'),null,this.onUploadBackground.bind(this));PMW.onClick($('.btn-cb-image'),null,this.onImageBackground.bind(this,postermywall.Core.OPEN_MODAL_IMAGE_BACKGROUND,null));PMW.onClick($('.btn-cb-stock-photo'),null,this.onImageBackground.bind(this,postermywall.Core.OPEN_MODAL_STOCK_BACKGROUND,null));PMW.onClick(nav_.find('.opens-menu'),null,this.onToggleMenu);PMW.onClick(nav_.find('.poster-options .opens-sub-menu'),null,this.onToggleSubMenu);PMW.onClick(nav_.find('.poster-options .sub-menu a'),null,this.onCloseMenu);PMW.onClick($('.btn-download'),null,this.onDownloadPoster_.bind(this));PMW.onClick($('.btn-prints'),null,this.onBuyPrints_.bind(this));PMW.onClick($('#btn-duplicate-poster'),null,this.onDuplicatePoster_.bind(this));var btnSubmitTemplate=$('#btn-submit-template');PMW.onClick(btnSubmitTemplate,null,this.onSubmitAsTemplate_.bind(this));PMW.onClick($('.btn-publish-poster'),null,this.onPublishPoster_.bind(this));PMW.onClick($('#btn-settings'),null,this.openSettingsModal.bind(this,postermywall.Core.OPEN_MODAL_SETTINGS));var btnLanguage=$('#btn-language');btnLanguage.find('.language').text($.t('pm_lang_'+i18n.lng()));PMW.onClick(btnLanguage,null,this.openSettingsModal.bind(this,postermywall.Core.OPEN_MODAL_SETTINGS));PMW.onClick($('.btn-resize-poster'),null,this.onResizePoster_.bind(this,postermywall.Core.OPEN_MODAL_RESIZE_POSTER));if(postermywall.Core.su){var btnGraphicsItem=$('.btn-graphic-item');btnGraphicsItem.removeClass('_hidden');PMW.onClick(btnGraphicsItem,null,this.onGraphicItems_.bind(this,postermywall.Core.OPEN_MODAL_GRAPHIC_ITEM_LIST));var btnAddVideoOrder=$('.btn-add-video-order');btnAddVideoOrder.removeClass('_hidden');PMW.onClick(btnAddVideoOrder,null,this.onAddVideoOrder_.bind(this));var btnCheckTempUID=$('.btn-check-tempUID');btnCheckTempUID.removeClass('_hidden');PMW.onClick(btnCheckTempUID,null,function(){console.log(this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME).getPoster().theme.background.tempUID);}.bind(this));}
PMW.onClick(nav_,'a[data-href]',this.onAnchor_);if(PMConfig.command==='regen'){this.setupRegenerationRequest(PMConfig.idorder);}
else{PMW.onClick(btnSave_,null,this.onSavePoster_.bind(this));}
contextualSidebar_.on(PMW.util.transitionEndEvents,this.onContextualOptionsTransition_);if(!poster.isPosterTemplate()){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);if(up.getUser()&&up.getUser().isDesigner()){btnSubmitTemplate.css('display','block');}}
this.fitWhiteboardToScreen();wbContainer_.addClass('out');setTimeout(function(){wbContainer_.removeClass('out').addClass('in');},1000);eventsInitialized_=true;}
this.toggleHeaderOptions_(true);this.toggleFooterOptions_(true);break;case postermywall.Core.REFRESH_BACKGROUND_OPTIONS:if(eventsInitialized_){this.refreshPosterOptions_();}
break;case postermywall.Core.VIEWPORT_RESIZED:this.onResize();break;case postermywall.Core.UNDO_AVAILABLE:btnUndo_.removeClass('disabled');break;case postermywall.Core.UNDO_UNAVAILABLE:btnUndo_.addClass('disabled');break;case postermywall.Core.REDO_AVAILABLE:btnRedo_.removeClass('disabled');break;case postermywall.Core.REDO_UNAVAILABLE:btnRedo_.addClass('disabled');break;case postermywall.Core.SAVE_AVAILABLE:btnSave_.removeClass('disabled');break;case postermywall.Core.SAVE_UNAVAILABLE:btnSave_.addClass('disabled');break;case postermywall.Core.CROP:this.onCropImage(postermywall.Core.OPEN_MODAL_CROPPER,body,true);break;case postermywall.Core.LOAD_IMAGE_AS_BACKGROUND:var b=body;this.onImageBackground(postermywall.Core.OPEN_MODAL_STOCK_BACKGROUND_WITH_IMAGE,{searchTerm:b.searchTerm,imageId:b.imageId,artist:b.artist,title:b.title,collection:b.collection});break;case postermywall.Core.DUPLICATE_POSTER:this.onDuplicatePoster_();break;case postermywall.Core.CONTEXTUAL_OPTIONS_HIDDEN:contextualSidebarIn_=false;btnToggleContextualSidebar_.removeClass('-active');break;case postermywall.Core.SHOW_GRAPHIC_ITEM_OPTIONS:if(this.getWhiteboardMediator().getSelectedModels().length==1&&!contextualSidebarIn_){this.toggleContextualSidebar();}
break;}},onContainerClick_:function(e){if(e.target==wbContainer_.get(0)){this.onClearSelection();}},onOpenInOldEditor_:function(){PMW.trackGAEvent(PMW.POSTERBUILDER,'OpenOld');var url=window.location.href;if(url.indexOf('posterbuilder/create')==-1){window.location.href=url+(url.indexOf('?')==-1?'?':'&')+'v=1';}
else{window.location.href=PMW.util.site_url('posterbuilder')+'?v=1';}},onContextualOptionsTransition_:function(e){if(e.target.id==='contextual-opts'){var keys=$$.keys();for(var i=0;i<keys.length;i++){if(keys[i].match("Slider$")=='Slider'&&typeof $$.get(keys[i]).reflow==='function'){$$.get(keys[i]).reflow();}}
if(alphaSlider_){alphaSlider_.reflow();}}},setupKeyboardShortcuts_:function(){if(!postermywall.Core.isMobileOS){var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);ap.getScript(['vendor/mousetrap.min.js']).done(this.setupKeyboardShortcutHandlers_.bind(this)).fail(function(){});}},updateKeyUpValue_:function(){lastKeyUpAt_=new Date();},setupKeyboardShortcutHandlers_:function(){Mousetrap.bind('mod+z',this.onUndo.bind(this));Mousetrap.bind('mod+shift+z',this.onRedo.bind(this));Mousetrap.bind('shift+t',this.onAddText.bind(this));Mousetrap.bind('shift+c',this.onAddClipart.bind(this,postermywall.Core.OPEN_MODAL_CLIPART,false));Mousetrap.bind('shift+p',this.onAddPhotoModal.bind(this,postermywall.Core.OPEN_MODAL_UPLOAD,null));Mousetrap.bind(['del','backspace'],this.onDeleteItem.bind(this));Mousetrap.bind('shift+d',this.onDuplicateItem.bind(this));Mousetrap.bind('shift+up',this.onMoveItem.bind(this,'front'));Mousetrap.bind('shift+down',this.onMoveItem.bind(this,'back'));Mousetrap.bind('shift+s',this.onSavePoster_.bind(this));Mousetrap.bind('up',this.onNudgeSelection_.bind(this,'up'));Mousetrap.bind('down',this.onNudgeSelection_.bind(this,'down'));Mousetrap.bind('left',this.onNudgeSelection_.bind(this,'left'));Mousetrap.bind('right',this.onNudgeSelection_.bind(this,'right'));Mousetrap.bind('up',this.updateKeyUpValue_,'keyup');Mousetrap.bind('down',this.updateKeyUpValue_,'keyup');Mousetrap.bind('left',this.updateKeyUpValue_,'keyup');Mousetrap.bind('right',this.updateKeyUpValue_,'keyup');Mousetrap.bind(['+','='],this.onResizeSelection_.bind(this,1));Mousetrap.bind('-',this.onResizeSelection_.bind(this,-1));},toggleHeaderOptions_:function(show){nav_.find('.for-poster').toggleClass('disabled',!show);PMW.toggleInOut(nav_.find('.blocks a.out'),show);},toggleFooterOptions_:function(show){PMW.toggleInOut($('#bottom-bar .blocks a.out'),show);},onToggleMenu:function(){function closeOpenMenus(){var openMenus=$('.opens-menu.selected');PMW.toggleInOut(openMenus.next(),false);openMenus.toggleClass('selected');}
function closeOtherMenus(e){var t=$(e.target);if(t.closest('.opens-sub-menu').length>0){$(document).one(PMW.click,closeOtherMenus);return;}
if(!t.closest('.opens-menu.selected').length){closeOpenMenus();}}
var btn=$(this);if(!btn.hasClass('selected')){closeOpenMenus();}
btn.toggleClass('selected');var isOpened=btn.hasClass('selected'),menu=btn.next();PMW.toggleInOut(menu,isOpened);if(isOpened&&menu.find('.menu-wrapper').length){postermywall.core.view.EditorMediator.updateMenuHeight(menu);}
if(!menu.hasClass('-stay-open')){setTimeout(function(){$(document).one(PMW.click,closeOtherMenus);},100);}},onToggleSubMenu:function(){function doToggle(btn,forceHide){forceHide?btn.toggleClass('open',false):btn.toggleClass('open');PMW.toggleInOut(btn.next(),btn.hasClass('open')&&!forceHide);return btn;}
var btn=doToggle($(this),false);if(btn.hasClass('open')){$.each(btn.parent().siblings(),function(){doToggle($(this).find('.opens-sub-menu'),true);});}
postermywall.core.view.EditorMediator.updateMenuHeight(btn.closest('.menu.in'));},onCloseMenu:function(){var openMenus=$('.opens-menu.selected');PMW.toggleInOut(openMenus.next(),false);openMenus.toggleClass('selected');},onAnchor_:function(e){var el=$(e.currentTarget);if(el.length>0&&typeof el.attr('data-href')==='string'&&el.attr('data-href').length>0){if(typeof el.attr('data-target')!=='undefined'&&el.attr('data-target')==='_blank'){window.open(el.attr('data-href'));}else{window.location=el.attr('data-href');}}},onSavePoster_:function(idOrder){var p={};if(idOrder>0){p.callbackHasRedirect=true;p.callback=this.regenAfterSave_.bind(this,idOrder);}
this.facade.sendNotification(postermywall.Core.SAVE,p);},regenAfterSave_:function(idOrder){window.location.href=PMW.util.site_url('cart/downloadregen/'+idOrder);},onGesture:function(e){if(!e.target&&e.self.fingers===2&&e.self.state==='change'){if(e.self.scale<=ZOOM_MAX&&e.self.scale>=ZOOM_MIN){this.getWhiteboardMediator().scaleWhiteboard(null,e.self.scale);}}},onDownloadPoster_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),poster=wbp.getPoster(),gettyImagesToDelete=poster.getGettyImagesNotOnPoster();if(gettyImagesToDelete){this.facade.sendNotification(postermywall.Core.REMOVE_GRAPHIC_ITEMS,gettyImagesToDelete,postermywall.Core.UNDOABLE_UPDATE);}
this.sendNotification.call(this,postermywall.Core.OPEN_MODAL_DOWNLOAD);},onBuyPrints_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);if(wbp.getHasPrintProduct()){this.facade.sendNotification(postermywall.Core.SAVE,{callback:this.buyPrints_.bind(this),callbackHasRedirect:true});}
else{var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.PrintsUnavailableModalMediator'],postermywall.Core.OPEN_MODAL_PRINT_UNAVAILABLE,wbp.getPosterTypeDisplayName());}},buyPrints_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);window.location.href=PMW.util.site_url('cart/selectproduct/'+wbp.getPoster().hashedID+'/0/prints');},onDuplicatePoster_:function(){this.facade.sendNotification(postermywall.Core.SAVE,{callback:this.duplicatePoster_.bind(this),callbackHasRedirect:true});},duplicatePoster_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);window.location.href=PMW.util.site_url('posterbuilder/copy/'+wbp.getPoster().hashedID);},onSubmitAsTemplate_:function(){this.facade.sendNotification(postermywall.Core.SAVE,{callback:this.submitAsTemplate_.bind(this),callbackHasRedirect:true});},submitAsTemplate_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);window.location.href=PMW.util.site_url('sell/submit/'+wbp.getPoster().hashedID);},onPublishPoster_:function(){this.facade.sendNotification(postermywall.Core.SAVE,{callback:this.publishPoster_.bind(this),callbackHasRedirect:true});},publishPoster_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);var poster=wbp.getPoster();PMW.openPublishDialog(poster.hashedID,up.getUserId());},onDuplicateItem:function(){this.getWhiteboardMediator().duplicateSelection();},onDeleteItem:function(){this.getWhiteboardMediator().deleteSelection();},onClearSelection:function(){this.getWhiteboardMediator().clearSelection();},onHorizontalAlignment:function(type){var group=this.getWhiteboardMediator().getSelectedGroup();if(group!=null){group.horizontalAlignment(type);}},onVerticalAlignment:function(type){var group=this.getWhiteboardMediator().getSelectedGroup();if(group!=null){group.verticalAlignment(type);}},onMoveItem:function(type){this.getWhiteboardMediator().moveSelection(type);this.refreshMoveOptions_();},onLockMovement:function(){var val=!this.getWhiteboardMediator().getSelectedModels()[0].lockMovement;this.getWhiteboardMediator().updateSelection([{lockMovement:val}]);this.refreshLockMovementOptions_(val);},onStretchToCanvas:function(orientation){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var poster=wbp.getPoster();var models=this.getWhiteboardMediator().getSelectedModels();if(models.length===1){var selection=models[0],newScaleX,newScaleY;if(orientation==="horizontal"){newScaleX=(selection.scaleX/(selection.width*selection.scaleX))*poster.width;newScaleY=selection.scaleY+(newScaleX-selection.scaleX);this.getWhiteboardMediator().updateSelection([{x:0,scaleX:newScaleX,scaleY:newScaleY}]);}else if(orientation==="vertical"){newScaleY=(selection.scaleY/(selection.height*selection.scaleY))*poster.height;newScaleX=selection.scaleX+(newScaleY-selection.scaleY);this.getWhiteboardMediator().updateSelection([{y:0,scaleX:newScaleX,scaleY:newScaleY}]);}}},onUseRecommendedFont_:function(){var font=lblFontSupport_.find('.btn-use-recommended-font').attr('data-font');this.onTextFontFamilyModified_('fontFamily',null,font);},onNudgeSelection_:function(direction,e){var models=this.getWhiteboardMediator().getSelectedModels();if(models.length==0||models[0].lockMovement){return;}
if(models.length===1){e.preventDefault();}
var keyDownAt=new Date();if((+keyDownAt-+lastSetTimeOut)>=500){lastSetTimeOut=new Date();setTimeout(function(){if(+keyDownAt>+lastKeyUpAt_)
objectTranslateDelta_=5;else
objectTranslateDelta_=1;},500);}
var dx=0,dy=0;switch(direction){case'up':dy=-1*objectTranslateDelta_;break;case'down':dy=objectTranslateDelta_;break;case'left':dx=-1*objectTranslateDelta_;break;case'right':dx=objectTranslateDelta_;break;}
if(models.length===1){this.getWhiteboardMediator().updateSelection([{x:models[0].x+dx,y:models[0].y+dy}]);}
else if(models.length>1){var group=this.getWhiteboardMediator().getSelectedGroup();this.getWhiteboardMediator().updateGroupSelection({left:group.left+dx,top:group.top+dy});}},onResizeSelection_:function(direction,e){var models=this.getWhiteboardMediator().getSelectedModels();if(models.length==0||models[0].lockMovement){return;}
if(models.length===1){e.preventDefault();}
var scale=resizeSelectionScaleFactor_*direction,textFontSize=resizeTextFactor_*direction;if(models.length===1){if(models[0]instanceof postermywall.core.model.vo.GraphicItemTextVO&&((direction==-1&&models[0].fontSize>FONT_SIZE_MIN)||(direction==1&&models[0].fontSize<FONT_SIZE_MAX))){var newFontSize=models[0].fontSize+textFontSize;if(newFontSize<FONT_SIZE_MIN){newFontSize=FONT_SIZE_MIN}
else if(newFontSize>FONT_SIZE_MAX){newFontSize=FONT_SIZE_MAX;}
this.getWhiteboardMediator().updateSelection([{fontSize:newFontSize,width:models[0].width*(newFontSize/models[0].fontSize)}]);this.setSliderValue_('fontSizeSlider','fontSize',newFontSize,FONT_SIZE_MIN,FONT_SIZE_MAX,true,{});}
else if(!(models[0]instanceof postermywall.core.model.vo.GraphicItemTextVO)&&((models[0].scaleX>resizeSelectionScaleFactor_&&models[0].scaleY>resizeSelectionScaleFactor_)||direction==1)){this.getWhiteboardMediator().updateSelection([{scaleX:models[0].scaleX+scale,scaleY:models[0].scaleY+scale}]);}}
else if(models.length>1){var group=this.getWhiteboardMediator().getSelectedGroup();if((group.scaleX>resizeSelectionScaleFactor_&&group.scaleY>resizeSelectionScaleFactor_)||direction==1){this.getWhiteboardMediator().updateGroupSelection({scaleX:group.scaleX+scale,scaleY:group.scaleY+scale});}}},onSelectionCreated:function(selection){var itemType=selection.length>1?'group':selection[0].gitype,itemClass=itemType;if(selection[0].gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE||selection[0].gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_MENU){itemClass=itemClass+' '+selection[0].layoutStyle}
var nextHeader=$('.layout-heading');if(selection[0].gitype==postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR&&selection[0].isComplexSVG){itemClass=itemClass+' '+'hide-for-vector';nextHeader.addClass('-first');}else{nextHeader.removeClass('-first');}
var itemsOptions=contextualSidebar_.find('.options[data-for="items"]'),switchOptions=itemsOptions.hasClass('inactive'),common=contextualSidebar_.find('.options[data-for="items"] .common');if(switchOptions){contextualSidebar_.find('.options[data-for="poster"]').removeClass('active').addClass('inactive');}
var specificOptions=$('#specific-options'),currentItemOption=specificOptions.children();if(currentItemOption.attr('data-for')!==itemType||itemType==postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE||itemType==postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR){specificOptions.attr('class','specific '+itemClass);currentItemOption.detach().appendTo('#all-options');var dataForOptions=$('#all-options > [data-for]');for(var i=0;i<dataForOptions.length;i++){var arr=$(dataForOptions[i]).attr('data-for').split(',');if($.inArray(itemType,arr)>-1){$(dataForOptions[i]).detach().appendTo('#specific-options')}}}
if(selection.length>1){nav_.find('.for-item').toggleClass('disabled',true);nav_.find('.for-group').toggleClass('disabled',false);common.hide();}
else{common.show();nav_.find('.for-item').toggleClass('disabled',false);this.refreshOptions_(selection[0]);var notTextOrTabs=!((selection[0]instanceof postermywall.core.model.vo.GraphicItemTextVO)||(selection[0]instanceof postermywall.core.model.vo.GraphicItemTabsVO)||(selection[0]instanceof postermywall.core.model.vo.GraphicItemTableVO)||(selection[0]instanceof postermywall.core.model.vo.GraphicItemMenuVO));$('#flip-options').toggle(notTextOrTabs);$('#stretch-options').toggle(notTextOrTabs);if(selection[0]instanceof postermywall.core.model.vo.GraphicItemImageVO&&selection[0].isMasked()){$('#btn-crop-image').addClass('disabled');}else{$('#btn-crop-image').removeClass('disabled');}}
var duplicateEnabled=false,btnDuplicate=$('.btn-duplicate'),wbm=this.getWhiteboardMediator();for(var i=0;i<selection.length;i++){if(wbm.isDuplicateAllowed(selection[i])){duplicateEnabled=true;var text=btnDuplicate.filter('button').attr('data-title');btnDuplicate.removeClass('disabled').filter('button').prop('title',text).end().filter('a').prop('title','');break;}}
if(!duplicateEnabled){btnDuplicate.addClass('disabled').prop('title',$.t('pm_title_copy_disabled'));}
if(switchOptions){itemsOptions.removeClass('inactive').addClass('active');}
this.refreshTabIndices_();},onSelectionCleared:function(){nav_.find('.for-item').toggleClass('disabled',true);this.onSelectionClearedTimeout_();},onSelectionClearedTimeout_:function(){$('#contextual-opts .options[data-for="poster"]').removeClass('inactive').addClass('active').siblings().removeClass('active').addClass('inactive');$('#specific-options').children().detach().appendTo('#all-options');this.refreshTabIndices_();if(eventsInitialized_){this.refreshPosterOptions_();}},refreshTabIndices_:function(){$('#contextual-opts > .active').find('input, textarea, button').removeAttr('tabindex');$('#contextual-opts > .inactive').find('input, textarea, button').attr('tabindex','-1');},refreshOptionsForSelection_:function(){var m=this.getWhiteboardMediator().getSelectedModels();if(m.length>0){this.refreshOptions_(m[0]);}else{this.refreshPosterOptions_();}},refreshOptions_:function(model){this.refreshCommonOptions_(model);var s=$(".common-text");var h=$("#right-header");switch(model.gitype){case postermywall.core.model.vo.GraphicItemVO.TYPE_IMAGE:s.html($.t('pm_image'));h.html($.t('pm_edit_image'));this.refreshImageOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO:s.html($.t('pm_video'));h.html($.t('pm_edit_video'));this.refreshVideoOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TEXT:s.html($.t('pm_text'));h.html($.t('pm_edit_text'));this.refreshTextOptions_(model);this.refreshTextSpecificOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT:s.html($.t('pm_text'));h.html($.t('pm_edit_text'));this.refreshFancyTextOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_SHAPE:s.html($.t('pm_shape'));h.html($.t('pm_edit_shape'));this.refreshShapeOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_VECTOR:s.html($.t('pm_shape'));h.html($.t('pm_edit_shape'));this.refreshVectorOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TAB:s.html($.t('pm_tabs'));h.html($.t('pm_edit_tabs'));this.refreshTextOptions_(model);this.refreshTabsSpecificOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE:if(model.isCustomTableLayout()){s.html($.t('pm_table'));h.html($.t('pm_edit_table'));}
else{s.html($.t('pm_item'));h.html($.t('pm_edit_schedule'));}
this.refreshTextOptions_(model);this.refreshTableSpecificOptions_(model);break;case postermywall.core.model.vo.GraphicItemVO.TYPE_MENU:s.html($.t('pm_menu'));h.html($.t('pm_edit_menu'));this.refreshTextOptions_(model);this.refreshMenuSpecificOptions_(model);break;}},refreshLockMovementOptions_:function(lockMovement){tglLockMovement_.prop('checked',lockMovement);PMW.toggleInOut(lblLockMovement_,lockMovement);},refreshMoveOptions_:function(){var wbm=this.getWhiteboardMediator(),views=wbm.getSelectedViews();if(views.length==1){var objects=wbm.getObjects();if(objects.length-1==objects.indexOf(views[0])){bringToFront_.addClass('disabled');}
else{bringToFront_.removeClass('disabled');}
if(objects.indexOf(views[0])===0){sendToBack_.addClass('disabled');}
else{sendToBack_.removeClass('disabled');}}},refreshCommonOptions_:function(model){this.refreshLockMovementOptions_(model.lockMovement);this.setSliderValue_('alphaSlider','alpha',model.alpha,0,1,false,{},'percentage');this.refreshMoveOptions_();},refreshPosterOptions_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var poster=wbp.getPoster();backgroundTypeUserVal_=poster.backgroundType_;changeBackgroundSelector_.setValue(poster.backgroundType_.toString());this.toggleBackgroundOptions_();},refreshImageOptions_:function(model){imageEdgeSelector_.setValue(model.imageBorderType);this.toggleImageCurvedOptions_(model);this.toggleImageGradientEdgeOptions_(model);imageShadowSelector_.setValue(model.dropShadow);this.toggleShadowOptions_(model);imageGlowSelector_.setValue(model.imageGlowType);this.toggleImageGlowOptions_(model);imageBorderSelector_.setValue(model.solidBorderType);this.toggleImageBorderOptions_(model);imageFilterSelector_.setValue(model.antique);this.setSliderValue_('imageBrightnessSlider','brightness',model.brightness,-100,100,true,{});tglImageTint_.prop('checked',model.tint);this.toggleImageTintOptions_(model);tglImageMultiply_.prop('checked',model.multiply);this.toggleImageMultiplyOptions_(model);},refreshVideoOptions_:function(model){var wm=this.getWhiteboardMediator(),m=wm.getMediatorForModel(model),v=m.getViewComponent(),videoElement=v.getElement(),button=$('.btn-play-pause');if(((!videoElement.paused&&button.hasClass("paused"))||(videoElement.paused&&!button.hasClass("paused")))&&videoElement.networkState===videoElement.HAVE_ENOUGH_DATA){this.togglePlayPauseVideo(videoElement,button);}},refreshTextOptions_:function(model){if(textFontFamilySelector_.getItemCount()===0){var items=this.getAllFonts();textFontFamilySelector_.setItems(items,model.fontFamily);}
else{textFontFamilySelector_.setValue(model.fontFamily);}
this.setGraphicItemPickerValue_('pickerTextColor','color',model.color);this.setSliderValue_('leadingSlider','leading',model.leading,LEADING_MIN,LEADING_MAX,true,{});this.setSliderValue_('letterSpacingSlider','letterSpacing',model.letterSpacing,LETTER_SPACING_MIN,LETTER_SPACING_MAX,true,{});this.setGraphicItemPickerValue_('pickerTextGradientFill1','gradientFillColor1',model.gradientFillColor1);this.setGraphicItemPickerValue_('pickerTextGradientFill2','gradientFillColor2',model.gradientFillColor2);textFillType_.setValue(model.fillType);this.toggleColorFillOptions_(model,'#textSolidFill','#textGradientFill','#textPatternFill');textBackgroundSelector_.setValue(model.backgroundType);this.toggleTextBackgroundOptions_(model);this.toggleTextAlignButtons_(model.textAlign);lblTextEditable_.toggle(!model.editable);this.updateRecommendedFonts(model.script);if(model.script){this.checkFontSupport(model.fontFamily,model.script);this.setRecommendedFont(model.script);textFontFamilySelector_.setScrollStatus(postermywall.core.view.widget.Selector.SCROLL_STATUS_DISABLED);}else{lblFontSupport_.toggle(false);textFontFamilySelector_.setScrollStatus(postermywall.core.view.widget.Selector.SCROLL_STATUS_LAST_HIGHLIGHTED);}
if(postermywall.Core.isMobileOS&&model.gitype=='text'){textRegular_.val(model.text);(model.editable)?textRegular_.removeAttr('readonly'):textRegular_.attr('readonly','');}},refreshTextSpecificOptions_:function(model){this.setSliderValue_('fontSizeSlider','fontSize',model.fontSize,FONT_SIZE_MIN,FONT_SIZE_MAX,true,{});textShadowSelector_.setValue(model.dropShadow);this.toggleShadowOptions_(model);},refreshTabsSpecificOptions_:function(model){this.setGraphicItemPickerValue_('pickerTableTextColor','color',model.color);textForTabs_.val(model.text);this.setSliderValue_('numTabsSlider','numTabs',model.numTabs,TABS_MIN,TABS_MAX,true,{});tabsSeparatorTypeSelector_.setValue(model.separatorType);this.toggleTabsSeparatorOptions_(model);},refreshTableSpecificOptions_:function(model){this.refreshCommonOptionsForMenusAndTables_(model);tableLayoutSelector_.setValue(model.layoutStyle);if(postermywall.core.model.LayoutProxy.isXSpacingAdjustable(model.layoutStyle)){this.setSliderValue_('xSpacingSlider','xSpacing',model.xSpacing,0,250,true,{},'custom',this.getScaleOfSelectedView.bind(this));}
if(model.layoutDataMap.highlight.filter(function(a){return a.value==true}).length>0&&(model.layoutStyle!=postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT||model.layoutStyle!=postermywall.core.model.LayoutProxy.STRAIGHT_SPORTS_LAYOUT)){$('#highlightedItems').show();this.setGraphicItemPickerValue_('pickerHighlightedBackground','highlightedBackgroundColor',model.highlightedBackgroundColor);this.setSliderValue_('highlightedBackgroundSlider','highlightedBackgroundColorAlpha',model.highlightedBackgroundColorAlpha,0,1,false,{},'percentage');this.setGraphicItemPickerValue_('pickerHighlightedText','highlightedTextColor',model.highlightedTextColor);}
else{$('#highlightedItems').hide()}
if(model.layoutStyle==postermywall.core.model.LayoutProxy.SLANTED_SPORTS_LAYOUT||model.layoutStyle==postermywall.core.model.LayoutProxy.STRAIGHT_SPORTS_LAYOUT){this.setGraphicItemPickerValue_('pickerHighlightedBoxColor1','highlightedBackgroundColor',model.highlightedBackgroundColor);this.setSliderValue_('boxOpacitySlider','highlightedBackgroundColorAlpha',model.highlightedBackgroundColorAlpha,0,1,false,{},'percentage');this.setGraphicItemPickerValue_('pickerHighlightedBoxColor2','highlightedTextColor',model.highlightedTextColor);}},refreshCommonOptionsForMenusAndTables_:function(model){if(postermywall.core.model.LayoutProxy.isSecondFontFamilyUsed(model.layoutStyle)){if(textFontFamilySelector2_.getItemCount()===0){var items=this.getAllFonts();textFontFamilySelector2_.setItems(items,model.fontFamily2);}
else{textFontFamilySelector2_.setValue(model.fontFamily2);}}
this.setMenuItemPickerValue_('pickerTableTextColor','color',model.color);this.setSliderValue_('fontSizeSlider','fontSize',model.fontSize,FONT_SIZE_MIN,FONT_SIZE_MAX,true,{},'custom',this.getScaleOfSelectedView.bind(this));tableBorderSelector_.setValue(model.solidBorderType);this.toggleTableBorderOptions_(model);this.setSliderValue_('ySpacingSlider','ySpacing',model.ySpacing,0,250,true,{},'custom',this.getScaleOfSelectedView.bind(this));},getScaleOfSelectedView:function(){return this.getWhiteboardMediator().getScaleOfSelectedItem();},refreshMenuSpecificOptions_:function(model){this.refreshCommonOptionsForMenusAndTables_(model);menuLayoutSelector_.setValue(model.layoutStyle);this.setMenuItemPickerValue_('pickerIconsFillColor','iconsColor',model.iconsColor);this.setSliderValue_('iconsSizeSlider','iconsSize',model.iconsSize,10,100,true,{},'custom',this.getScaleOfSelectedView.bind(this));$('#highlightedItems').hide();this.getWhiteboardMediator().getMediatorForModel(model).takeModelSnapshot();},refreshMenuCustomSliders:function(model){this.setSliderValue_('fontSizeSlider','fontSize',model.fontSize,FONT_SIZE_MIN,FONT_SIZE_MAX,true,{},'custom',this.getScaleOfSelectedView.bind(this));this.setSliderValue_('ySpacingSlider','ySpacing',model.ySpacing,0,250,true,{},'custom',this.getScaleOfSelectedView.bind(this));this.setSliderValue_('iconsSizeSlider','iconsSize',model.iconsSize,10,100,true,{},'custom',this.getScaleOfSelectedView.bind(this));},refreshTableCustomSliders:function(model){this.setSliderValue_('fontSizeSlider','fontSize',model.fontSize,FONT_SIZE_MIN,FONT_SIZE_MAX,true,{},'custom',this.getScaleOfSelectedView.bind(this));this.setSliderValue_('ySpacingSlider','ySpacing',model.ySpacing,0,250,true,{},'custom',this.getScaleOfSelectedView.bind(this));this.setSliderValue_('xSpacingSlider','xSpacing',model.xSpacing,0,250,true,{},'custom',this.getScaleOfSelectedView.bind(this));},setRecommendedFont:function(script){if(script){lblFontSupport_.find('.btn-use-recommended-font').attr({'data-font':postermywall.core.model.AppProxy.getRecommendedFont(script),});}},onTextChanged:function(model,text){var selectedScript=postermywall.core.model.AppProxy.getScriptForText(text!=null?text:model.text);if(selectedScript!==model.script){var changes={script:selectedScript};if(text!=null){changes.text=text;}
this.setRecommendedFont(selectedScript);if(!this.checkFontSupport(model.fontFamily,selectedScript)){this.onTextFontFamilyModified_('fontFamily',null,postermywall.core.model.AppProxy.getRecommendedFont(selectedScript),changes);}else{this.getWhiteboardMediator().updateModels([model],[changes]);}
if(selectedScript==''){lblFontSupport_.toggle(false);}
this.updateRecommendedFonts(selectedScript);}else if(text!=null){this.getWhiteboardMediator().updateModels([model],[{text:text}]);}},checkFontSupport:function(fontFamily,script){var fontSupport=postermywall.core.model.AppProxy.isInternalFont(fontFamily,script);if(fontSupport){lblFontSupport_.toggle(false);return true;}else{lblFontSupport_.toggle(true);return false;}},updateRecommendedFonts:function(script){if(script||textFontFamilySelector_.getValueAt(0)=='recommended_fonts'){var value=textFontFamilySelector_.getValue();textFontFamilySelector_.removeItemsAt(textFontFamilySelector_.getIndexOfItemFromValue('recent_fonts'));textFontFamilySelector_.addItemsAt(this.getRecommendedFonts(script),0);textFontFamilySelector_.setValue(value);}},updateFontFamilySelector:function(){var updatedFontList=this.getRecentAndUserFonts(),value1=textFontFamilySelector_.getValue(),value2=textFontFamilySelector2_.getValue();textFontFamilySelector_.removeItemsAt(textFontFamilySelector_.getIndexOfItemFromValue('pmw_fonts'));textFontFamilySelector_.addItemsAt(updatedFontList,0);textFontFamilySelector_.setValue(value1);textFontFamilySelector2_.removeItemsAt(textFontFamilySelector2_.getIndexOfItemFromValue('pmw_fonts'));textFontFamilySelector2_.addItemsAt(updatedFontList,0);textFontFamilySelector2_.setValue(value2);},getAllFonts:function(){var pmwFonts=postermywall.core.model.AppProxy.FONTS,items=this.getRecentAndUserFonts();items[items.length]={name:$.t('pm_all_fonts'),value:'pmw_fonts',options:'',html:'<h5>'+$.t('pm_all_fonts')+'</h5>',unselectable:true};for(var i=0;i<pmwFonts.length;i++){if(typeof pmwFonts[i].hidden==='undefined'||pmwFonts[i].hidden==false){items[items.length]={name:pmwFonts[i].name,value:pmwFonts[i].fontFamily,options:'',html:'<img src="'+postermywall.Core.serverRoot+'assets/css/webfonts/previews/'+pmwFonts[i].fontFamily+'.png" alt="'+pmwFonts[i].fontFamily+'"/>'};}}
return items;},getRecommendedFonts:function(script){var list=[],items=[];if(script){list=postermywall.core.model.AppProxy.getFontsForScript(script);if(list.length>0){list.sort(postermywall.Util.sortAlphabetically);var name=$.t('pm_recommended_for',{scriptName:postermywall.core.model.AppProxy.getScriptDisplayName(script)});items.push({name:name,value:'recommended_fonts',options:'',html:'<h5>'+name+'</h5>',unselectable:true});for(x=0;x<list.length;x++){items.push({name:list[x].name,value:list[x].fontFamily,options:'',html:'<img src="'+postermywall.Core.getFontPath(list[x].fontFamily,'preview')+'" alt="'+list[x].fontFamily+'"/>'});}}}
return items;},getFontsOnPoster:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),poster=wbp.getPoster(),list=[];for(var i=0;i<poster.graphicItems.length;i++){if(postermywall.core.model.vo.PosterVO.hasEditableText(poster.graphicItems[i])){if($.inArray(poster.graphicItems[i].fontFamily,list)==-1){list[list.length]=poster.graphicItems[i].fontFamily;}}
if(postermywall.core.model.LayoutProxy.isSecondFontFamilyUsed(poster.graphicItems[i].layoutStyle)){if($.inArray(poster.graphicItems[i].fontFamily2,list)==-1){list[list.length]=poster.graphicItems[i].fontFamily2;}}}
list=list.sort();var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME),userFonts=up.getUserFonts(),allAvailableFonts=userFonts.concat(postermywall.core.model.AppProxy.FONTS),newList=[];for(i=0;i<list.length;i++){for(var x=0;x<allAvailableFonts.length;x++){if(list[i]==allAvailableFonts[x].fontFamily&&(typeof allAvailableFonts[x].hidden=='undefined')){newList.push({fontFamily:allAvailableFonts[x].fontFamily,name:allAvailableFonts[x].name});break;}}}
var f=up.getContributorFontsOnPoster();if(f.length>0){for(i=0;i<f.length;i++){if($.inArray(f[i].fontFamily,list)!=-1){newList.push({fontFamily:f[i].fontFamily,name:f[i].name});}}}
return newList.sort(postermywall.Util.sortAlphabetically);},getRecentAndUserFonts:function(){var fontsOnPoster=this.getFontsOnPoster(),up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME),items=[],x=0;if(fontsOnPoster.length>0){items.push({name:$.t('pm_recently_used'),value:'recent_fonts',options:'',html:'<h5>'+$.t('pm_recently_used')+'</h5>',unselectable:true});for(x=0;x<fontsOnPoster.length;x++){items.push({name:fontsOnPoster[x].name,value:fontsOnPoster[x].fontFamily,options:'',html:'<img src="'+postermywall.Core.getFontPath(fontsOnPoster[x].fontFamily,'preview')+'" alt="'+fontsOnPoster[x].fontFamily+'"/>'});}}
if(this.showCustomFontOptions()){var userFonts=up.getUserFonts();items.push({name:$.t('pm_my_fonts'),value:'my_fonts',options:'',html:'<h5>'+$.t('pm_my_fonts')+'</h5>',unselectable:true});items.push({name:$.t('pm_manage_fonts'),value:'upload_fonts',options:'',html:(userFonts.length>0)?'<div class="btn-link btn-manage-fonts">'+$.t('pm_manage_fonts')+'<div/>':'<div class="btn-link btn-upload-fonts">'+$.t('pm_upload_fonts')+'<div/>',unselectable:true});if(userFonts.length>0){userFonts.sort(postermywall.Util.sortAlphabetically);for(x=0;x<userFonts.length;x++){items.push({name:userFonts[x].name,value:userFonts[x].fontFamily,options:'',html:'<img src="'+postermywall.Core.getFontPath(userFonts[x].fontFamily,'preview')+'" alt="'+userFonts[x].fontFamily+'"/>'});}}}
return items;},showCustomFontOptions:function(){var userProxy=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);return(userProxy.getUser()==null||!(userProxy.getUser().isDesigner()))},onManageFonts:function(e){var fontProp=$(e.target).closest('.-supports-custom-fonts').attr('data-property'),up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);this.openManageFontModal(postermywall.Core.OPEN_MODAL_MANAGE_FONTS,up.getUserFonts(),fontProp);},onUploadFonts:function(e,val){if(typeof val=='string'&&val.length>0){this.fontFamilyProp_=val;}
else{this.fontFamilyProp_=$(e.target).closest('.-supports-custom-fonts').attr('data-property');}
var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);if(!PMW.IS_PREMIUM_ENABLED||up.getUser()!=null&&up.getUser().getPremiumLevel()){$('#file-font-upload').click();}else{PMW.showPremiumOnlyFeatureDialog();}},refreshFancyTextOptions_:function(model){var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);textFancy_.val(model.text);if(fancyTextSelector_.getItemCount()===0){ap.getFancyTextEffects().done(this.onFancyTextEffectsLoaded_.bind(this,model,ap)).fail(this.onFancyTextEffectsLoadError_.bind(this));}
else{fancyTextSelector_.setValue(model.idFancyText);ap.getFancyTextEffectById(model.idFancyText,this.toggleFancyTextColorOptions_.bind(this,model));}
if(fancyTextFontFamilySelector_.getItemCount()===0){var fonts=postermywall.core.model.AppProxy.FONTS_FANCYTEXT;var items=[];for(var i=0;i<fonts.length;i++){items[i]={name:fonts[i].fontFamily,value:fonts[i].fontFamily,options:'',html:'<img src="'+postermywall.Core.serverRoot+'assets/css/webfonts/previews/'+fonts[i].preview+'.png" alt="'+fonts[i].fontFamily+'"/>'};}
fancyTextFontFamilySelector_.setItems(items,model.fontFamily);}
else{fancyTextFontFamilySelector_.setValue(model.fontFamily);}
fancyTextMorphSelector_.setValue(model.morphType);this.toggleFancyTextMorphOptions_(model);fancyTextShadowSelector_.setValue(model.dropShadow);this.toggleShadowOptions_(model);},refreshShapeOptions_:function(model){this.setGraphicItemPickerValue_('pickerShapeFill','fillColor',model.fillColor);this.setGraphicItemPickerValue_('pickerShapeLine','strokeColor',model.strokeColor);this.setGraphicItemPickerValue_('pickerShapeGradientFill1','gradientFillColor1',model.gradientFillColor1);this.setGraphicItemPickerValue_('pickerShapeGradientFill2','gradientFillColor2',model.gradientFillColor2);shapeFillType_.setValue(model.fillType);this.toggleColorFillOptions_(model,'#shapeSolidFill','#shapeGradientFill',null);shapeShadowSelector_.setValue(model.dropShadow);this.toggleShadowOptions_(model);this.setSliderValue_('shapeLineSlider','strokeWeight',model.strokeWeight,0,10,true,{});},refreshVectorOptions_:function(model){this.setGraphicItemPickerValue_('pickerVectorFill','fillColor',model.fillColor);this.setGraphicItemPickerValue_('pickerVectorLine','strokeColor',model.strokeColor);this.setGraphicItemPickerValue_('pickerVectorGradientFill1','gradientFillColor1',model.gradientFillColor1);this.setGraphicItemPickerValue_('pickerVectorGradientFill2','gradientFillColor2',model.gradientFillColor2);vectorFillType_.setValue(model.fillType);this.toggleColorFillOptions_(model,'#vectorSolidFill','#vectorGradientFill',null);this.setSliderValue_('vectorLineSlider','strokeWeight',model.strokeWeight,0,10,true,{});$('#vector-stroke-properties').toggle(model.isStrokeCustomisable);},setPatternSelectorValue_:function(model,selector){if(selector.getItemCount()===0){var patterns=postermywall.core.model.AppProxy.PATTERNS;var patternItems=[];for(var x=0;x<patterns.length;x++){patternItems[x]={name:'pattern '+patterns[x],value:patterns[x],options:'',html:'<img src="'+postermywall.Core.patternURL(patterns[x],true)+'" alt="'+patterns[x]+'" class="-hasmargin"/>',url:postermywall.Core.patternURL(patterns[x],true)};}
selector.setItems(patternItems,model.patternFill);}
else{selector.setValue(model.patternFill);}},onTextFontFamilyModified_:function(prop,e,val,moreChanges){if(val.length>0){moreChanges=typeof moreChanges==='undefined'?null:moreChanges;if(this.getWhiteboardMediator().loadFonts([val],this.onTextFontFamilyLoaded_.bind(this,val,this.getWhiteboardMediator().getSelectedModels()[0],moreChanges,prop))){this.facade.sendNotification(postermywall.Core.SHOW_LOADING,{key:'changefont',text:$.t('pm_loading_font')});}}},onTextFontFamilyLoaded_:function(fontFamily,model,moreChanges,prop,success){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'changefont'});if(success){var changes={fontLicense:(postermywall.core.model.AppProxy.isInternalFont(fontFamily))?'':postermywall.core.model.AppProxy.USER_FONT_LICENSE,editable:true};changes[prop]=fontFamily;if(moreChanges){for(var key in moreChanges){if(!moreChanges.hasOwnProperty(key))continue;changes[key]=moreChanges[key];}}
this.getWhiteboardMediator().updateModels([model],[changes]);this.updateFontFamilySelector();}
else{this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_loading_font_error')});}
this.getWhiteboardMediator().refreshSelection();},onTextShadowModified_:function(e,val){var changes=this.getShadowProperties(val);changes.backgroundType=0;this.getWhiteboardMediator().updateSelection([changes]);textBackgroundSelector_.setValue(0);var model=this.getWhiteboardMediator().getSelectedModels()[0];this.toggleShadowOptions_(model);this.toggleTextBackgroundOptions_(model);},onTextBackgroundModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{backgroundType:parseInt(val),dropShadow:0}]);textShadowSelector_.setValue(0);var model=this.getWhiteboardMediator().getSelectedModels()[0];this.toggleTextBackgroundOptions_(model);this.toggleShadowOptions_(model);},onTextAlignModified_:function(btn){var align=btn.getAttribute('data-align');this.toggleTextAlignButtons_(align);this.getWhiteboardMediator().updateSelection([{textAlign:align}]);},toggleTextAlignButtons_:function(align){$('#txt-align .btn').removeClass('active');$('#txt-align .btn[data-align="'+align+'"]').addClass('active');},toggleTextBackgroundOptions_:function(model){switch(model.backgroundType){case 0:this.toggleTray_('#textBackgroundColor',true);this.toggleTray_('#alternateBackgroundColor',true);break;case 1:this.toggleTray_('#alternateBackgroundColor',true);this.toggleTray_('#textBackgroundColor',false);this.setGraphicItemPickerValue_('pickerTextBackgroundColor','backgroundColor',model.backgroundColor);this.setSliderValue_('backgroundColorAlphaSlider','backgroundColorAlpha',model.backgroundColorAlpha,0,1,false,{},'percentage');break;case 2:this.toggleTray_('#textBackgroundColor',true);this.toggleTray_('#alternateBackgroundColor',false);this.setGraphicItemPickerValue_('pickerAlternateColor1','alternateBackgroundColor1',model.alternateBackgroundColor1);this.setSliderValue_('alternateColor1AlphaSlider','alternateColor1Alpha',model.alternateColor1Alpha,0,1,false,{},'percentage');this.setGraphicItemPickerValue_('pickerAlternateColor2','alternateBackgroundColor2',model.alternateBackgroundColor2);this.setSliderValue_('alternateColor2AlphaSlider','alternateColor2Alpha',model.alternateColor2Alpha,0,1,false,{},'percentage');break;}},toggleTabsSeparatorOptions_:function(model){if((this.toggleTray_('#customSeparatorOptions',(model.separatorType==0)))){return;}
this.setGraphicItemPickerValue_('pickerSeparatorColor','separatorColor',model.separatorColor);},onTabsSeparatorTypeModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{separatorType:parseInt(val)}]);var model=this.getWhiteboardMediator().getSelectedModels()[0];this.toggleTabsSeparatorOptions_(model);},onFancyTextEffectsLoaded_:function(model,ap,data){if(data){var items=[];for(var i=0;i<data.length;i++){items[i]={name:data[i].n,value:data[i].id,options:'',html:'<img src="'+postermywall.Core.repoURL('texteffects/small/'+data[i].id+'.jpg',postermywall.Core.readBucket,false)+'"/>'};}
fancyTextSelector_.setItems(items,model.idFancyText);ap.getFancyTextEffectById(model.idFancyText,this.toggleFancyTextColorOptions_.bind(this,model));}
else{this.onFancyTextEffectsLoadError_();}},onFancyTextEffectsLoadError_:function(){this.onClearSelection();this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_loading_fancy_text_effects_error')});},toggleFancyTextColorOptions_:function(model,effect){function refreshColor_(self,model,c,selector,picker,property,delay){if(model.isColorSet(c)){self.toggleTray_(selector,false);self.setGraphicItemPickerValue_(picker,property,model.getColor(c),delay);}
else{self.toggleTray_(selector,true);}}
if(effect){refreshColor_(this,model,model.color1,'#fancyTextColor1','pickerTextFill','color1',500);refreshColor_(this,model,model.color2,'#fancyTextColor2','pickerEffectFill1','color2',500);refreshColor_(this,model,model.color3,'#fancyTextColor3','pickerEffectFill2','color3',500);}
else{this.toggleTray_('#fancyTextColor1',true);this.toggleTray_('#fancyTextColor2',true);this.toggleTray_('#fancyTextColor3',true);}},toggleFancyTextMorphOptions_:function(model){if(!this.toggleTray_('#fancyTextCurveOptions',!model.isMorphCurve())){this.setSliderValue_('fancyTextCurveSlider','morphAmount',model.morphAmount,-350,350,true,{steps:12,snap:true});}
if(!this.toggleTray_('#fancyTextWaveOptions',!model.isMorphWave())){this.setSliderValue_('fancyTextWaveSlider','morphAmount',model.morphAmount,1,3,false,{steps:3,snap:true});}},onFancyTextChange_:function(){var text=textFancy_.val();if($.trim(text).length>0){this.getWhiteboardMediator().updateSelection([{text:text}]);}},onTextChange_:function(el){var models=this.getWhiteboardMediator().getSelectedModels();this.onTextChanged(models[0],el.val());},onFancyTextModified_:function(e,val){var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);ap.getFancyTextEffectById(val,this.doOnFancyTextModified_.bind(this,this.getWhiteboardMediator().getSelectedModels()[0]));},doOnFancyTextModified_:function(model,effect){var changes={idFancyText:effect.id};function setColorChange(effectProp,modelProp){if(effect[effectProp]==-1||effect[effectProp]==null){changes[modelProp]=-1;}
else{changes[modelProp]=postermywall.Util.colorToRGB(parseInt(effect[effectProp],10));}}
setColorChange('c1','color1');setColorChange('c2','color2');setColorChange('c3','color3');this.getWhiteboardMediator().updateSelection([changes]);this.toggleFancyTextColorOptions_(this.getWhiteboardMediator().getSelectedModels()[0],effect);},onFancyTextFontModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{fontFamily:val}]);},onFancyTextMorphModified_:function(e,val){var changes={morphType:val};switch(val){case postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_CURVE_UP:changes.morphAmount=60;break;case postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_CURVE_DOWN:changes.morphAmount=-60;break;case postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_WAVE:changes.morphAmount=1;break;case postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_WEDGE_LEFT:changes.morphAmount=1;break;case postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_WEDGE_RIGHT:changes.morphAmount=-1;break;case postermywall.core.model.vo.GraphicItemFancyTextVO.MORPH_ROOF:changes.morphAmount=1;break;}
this.getWhiteboardMediator().updateSelection([changes]);this.toggleFancyTextMorphOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},onFancyTextShadowModified_:function(e,val){this.getWhiteboardMediator().updateSelection([this.getShadowProperties(val)]);this.toggleShadowOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},onNameChange:function(e){this.getWhiteboardMediator().setName(e.target.value);},onSeekVideo:function(){var valTime=$('#seek-video').val()/1000;var wm=this.getWhiteboardMediator();var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var poster=wbp.getPoster();for(var i=0;i<poster.graphicItems.length;i++){if(poster.graphicItems[i].gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_VIDEO){var m=wm.getMediatorForModel(poster.graphicItems[i]),v=m.getViewComponent();var videoElement=v.getElement();videoElement.currentTime=valTime;break;}}},setPosterName:function(n){document.getElementById('txtPosterName').value=n;},onDescriptionChange:function(e){this.getWhiteboardMediator().setDescription(e.target.value);},setPosterDescription:function(d){document.getElementById('txtPosterDescription').value=d;},setupRegenerationRequest:function(idOrder){var btns=$('.btn-save-poster');btns.find('.shortcut').html('');btns.find('span:not(.shortcut)').addClass('-recreate').html($.t('pm_save_recreate_order'));btns.closest('.menu').css('min-width','221px');PMW.onClick(btns,null,this.onSavePoster_.bind(this,idOrder));nav_.find('.btn-save-poster').parent().siblings().remove();},updateGoHomeLinks:function(){var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME),folder=pp.getFolder();if(folder){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.setHomeDestination(PMW.util.site_url('posters/mine#/designs/'+folder.id),'Open the "'+folder.name+'" folder');}},onResize:function(){cachedDims_={};var ww=$(window).width(),wh=$(window).height(),width,height=wh-postermywall.core.view.EditorMediator.NAV_HEIGHT,contextualOptsWidth;if(ww<=postermywall.core.view.AppMediator.CONTEXTUAL_MENU_BREAKPOINT){if(!contextualSidebarIn_){contextualOptsWidth=0;}else{contextualOptsWidth=contextualSidebar_.width();}}else{contextualOptsWidth=contextualSidebar_.width();if(!contextualSidebarIn_){this.toggleContextualSidebar();}}
if(ww<=postermywall.core.view.AppMediator.BOTTOM_MENU_BREAKPOINT){height-=postermywall.core.view.EditorMediator.BOTTOM_BAR_HEIGHT;width=ww-contextualOptsWidth;postermywall.core.view.EditorMediator.isBottomBarVisible=true;}else{width=ww-wbContainer_.position().left-contextualOptsWidth;postermywall.core.view.EditorMediator.isBottomBarVisible=false;}
if(!wbContainer_.hasClass('loading')){wbContainer_.width(width).height(height);dragDropOverlay_.outerWidth(width).outerHeight(height);editor_.height(height);}
this.centerWhiteboard();contextualSidebar_.height((height)+'px');this.showFitToScreenButton_();nav_.find('.poster-options .menu.in').each(function(){postermywall.core.view.EditorMediator.updateMenuHeight($(this));});},toggleContextualSidebar:function(){var ww=$(window).width(),width,canvasContainer=this.getWhiteboardMediator().viewContainer;if(contextualSidebarAnimatingTId_!=0){clearTimeout(contextualSidebarAnimatingTId_);contextualSidebarAnimatingTId_=0;}
if(contextualSidebarIn_){btnToggleContextualSidebar_.removeClass('-active');width=ww;PMW.toggleInOut(contextualSidebar_,!contextualSidebarIn_);wbContainer_.width(width);canvasContainer.addClass('-animated').one(PMW.util.transitionEndEvents,function(){canvasContainer.removeClass('-animated');});if(canvasContainer.width()<=ww){this.centerWhiteboard();}}else{btnToggleContextualSidebar_.addClass('-active');width=ww-contextualSidebar_.width();wbContainer_.width(width);canvasContainer.addClass('-animated').one(PMW.util.transitionEndEvents,function(){wbContainer_.width(width);canvasContainer.removeClass('-animated');});if(canvasContainer.offset().left>0){this.centerWhiteboard();}
wbContainer_.width(ww);PMW.toggleInOut(contextualSidebar_,!contextualSidebarIn_);}
contextualSidebarIn_=!contextualSidebarIn_;},centerWhiteboard:function(){var wm=this.getWhiteboardMediator();if(wm&&wm.viewContainer){var w=wbContainer_.width();var h=wbContainer_.height();var pw=wm.viewContainer.width();var ph=wm.viewContainer.height();var left=0,top=0,scrollLeft=0,scrollTop=0;if(pw<w){left=(w-pw)/2;}
else{scrollLeft=(pw-w)/2;}
if(ph<h){top=(h-ph)/2;}
else{scrollTop=(ph-h)/2;}
wm.positionWhiteboard(left,top,true);wbContainer_.scrollLeft(scrollLeft).scrollTop(scrollTop);}},getNewZoom_:function(val){if(val<ZOOM_MIN){return ZOOM_MIN;}
if(val>ZOOM_MAX){return ZOOM_MAX;}
var diff=Math.round(Math.abs(val-1+ZOOM_STEP)*100);if(diff>0&&diff<20){return 1;}
return val;},onZoomIn:function(){var wm=this.getWhiteboardMediator(),data=this.getZoomData_(wm),zoomFactor=ZOOM_STEP;if(data.bestFit){zoomFactor=ZOOM_STEP-(data.currentScale%ZOOM_STEP);}
if(data.bestFitScale>data.currentScale&&data.bestFitScale<(data.currentScale+ZOOM_STEP)){this.fitWhiteboardToScreen();}
else{this.setZoom(wm,this.getNewZoom_(data.currentScale+zoomFactor));this.showFitToScreenButton_();}},onZoomOut:function(){var wm=this.getWhiteboardMediator(),data=this.getZoomData_(wm),zoomFactor=ZOOM_STEP;if(data.bestFit){zoomFactor=(data.currentScale%ZOOM_STEP);}
if(data.bestFitScale<data.currentScale&&data.bestFitScale>(data.currentScale-ZOOM_STEP)){this.fitWhiteboardToScreen();}
else{this.setZoom(wm,this.getNewZoom_(data.currentScale-zoomFactor));this.showFitToScreenButton_();}},onMovePoster:function(x,y,e){e.currentTarget.blur();var this_=this,numberOfMovements=0;this_.getWhiteboardMediator().moveWhiteboard(x,y,false);this.__movePosterInterval=setInterval(function(){numberOfMovements++;if(numberOfMovements>100){clearInterval(this.__movePosterInterval);return;}
this_.getWhiteboardMediator().moveWhiteboard(x,y,false);},35);this.showFitToScreenButton_();},onStopMovement:function(){clearInterval(this.__movePosterInterval);},getZoomData_:function(wm){var buffer=50,data={bestFit:false},pw=wm.getProxy().getPoster().width,ph=wm.getProxy().getPoster().height;data.bestFitScale=postermywall.Util.getScaleForFitToScreen(wbContainer_.width()-buffer,wbContainer_.height()-buffer,pw,ph);data.currentScale=Math.round(wm.getScale()*100)/100;if(data.currentScale==data.bestFitScale&&((data.currentScale*100)%(ZOOM_STEP*100))/100!=0){data.bestFit=true;}
return data;},setZoom:function(wm,scale){if(scale===wm.getScale()){return;}
wm.scaleWhiteboard(null,scale);this.centerWhiteboard();this.setZoomUI(wm.getScale());},fitWhiteboardToScreen:function(){var wm=this.getWhiteboardMediator(),buffer=50,pw=wm.getProxy().getPoster().width,ph=wm.getProxy().getPoster().height;wm.scaleWhiteboard(null,postermywall.Util.getScaleForFitToScreen(wbContainer_.width()-buffer,wbContainer_.height()-buffer,pw,ph));this.centerWhiteboard();this.setZoomUI(wm.getScale());zoomOpts_.toggleClass('-has-fit-to-screen',false);},setZoomUI:function(val){PMW.toggleInOut(zoomLabel_.html(Math.round(val*100)+'%'),true);clearTimeout(zoomLabelTimeout_);if(!postermywall.core.view.EditorMediator.isBottomBarVisible){zoomLabelTimeout_=setTimeout(this.hideZoomUI_.bind(this),3000);}},hideZoomUI_:function(){PMW.toggleInOut(zoomLabelToast_,false);},onUndo:function(refresh){if(typeof refresh!=='boolean'){refresh=true;}
var chp=this.facade.retrieveProxy(postermywall.core.model.CommandHistoryProxy.NAME);if(!chp.canUndo()){var vc=this.getWhiteboardMediator().viewContainer;vc.addClass('animated fast shake').one(PMW.util.animationEndEvents,function(e){vc.removeClass('animated fast shake').off();});}
chp.undo();if(refresh){this.refreshOptionsForSelection_();}},onRedo:function(){var chp=this.facade.retrieveProxy(postermywall.core.model.CommandHistoryProxy.NAME);chp.redo();this.refreshOptionsForSelection_();},onBackgroundTypeModifiedSidebar_:function(bgType){this.getWhiteboardMediator().clearSelection();this.onBackgroundTypeModified_(null,bgType);},onBackgroundFilterModified_:function(e,val){changeBackgroundFilterSelector_.setValue(val);var p=this.getWhiteboardMediator().getProxy().getPoster(),changes={};if(p.backgroundModification.filterType!=val){switch(val){case 0:changes['filterType']=postermywall.core.model.vo.BackgroundModificationVO.FILTER_TYPE_NONE;break;case 1:changes['filterType']=postermywall.core.model.vo.BackgroundModificationVO.FILTER_TYPE_BLACK_AND_WHITE;break;case 2:changes['filterType']=postermywall.core.model.vo.BackgroundModificationVO.FILTER_TYPE_SEPIA;break;}
this.facade.sendNotification(postermywall.Core.MODIFY_BACKGROUND,changes,postermywall.Core.UNDOABLE_UPDATE);}},onBackgroundMultiplyModified_:function(){var p=this.getWhiteboardMediator().getProxy().getPoster(),multiplyVal=!p.backgroundModification.multiply;this.modifyBackground_({multiply:multiplyVal});this.toggleBackgroundMultiplyOptions_(p,multiplyVal);},toggleBackgroundMultiplyOptions_:function(poster,multiply){if(!this.toggleTray_('#background-multiply-options',!multiply)){this.setBackgroundModificationPickerValue_('pickerBackgroundMultiply','multiplyColor',poster.backgroundModification.multiplyColor);}},onBackgroundTintModified_:function(){var p=this.getWhiteboardMediator().getProxy().getPoster(),tintVal=!p.backgroundModification.tint;this.modifyBackground_({tint:tintVal});this.toggleBackgroundTintOptions_(p,tintVal);},toggleBackgroundTintOptions_:function(poster,tint){if(!this.toggleTray_('#background-tint-options',!tint)){this.setBackgroundModificationPickerValue_('pickerBackgroundTint','tintColor',poster.backgroundModification.tintColor);this.setBackgroundSliderValue_('backgroundTintAlphaSlider','tintOpacity',poster.backgroundModification.tintOpacity,0,1,false,{},'percentage');}},modifyBackground_:function(changes,undoable){if(typeof undoable==='undefined'){undoable=true;}
setTimeout(function(){this.facade.sendNotification(postermywall.Core.MODIFY_BACKGROUND,changes,undoable?postermywall.Core.UNDOABLE_UPDATE:postermywall.Core.NON_UNDOABLE_UPDATE);}.bind(this),200);},onBackgroundTypeModified_:function(e,val){changeBackgroundSelector_.setValue(backgroundTypeUserVal_.toString());backgroundTypeUserVal_=parseInt(val,10);switch(backgroundTypeUserVal_){case 0:this.onColorBackground(postermywall.Core.OPEN_MODAL_SOLID_COLOR_BACKGROUND);break;case 1:this.onColorBackground(postermywall.Core.OPEN_MODAL_GRADIENT_BACKGROUND);break;case 2:$('#file-bg-upload').click();break;case 3:$('#toolbar').find('.btn-cb-image').trigger(PMW.click);break;case 4:$('#toolbar').find('.btn-cb-stock-photo').trigger(PMW.click);break;}},onGradientTypeModified_:function(e,val){var changes={'gradient':val};this.getWhiteboardMediator().updatePoster(changes);},toggleBackgroundOptions_:function(t){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var p=typeof t==='undefined'?wbp.getPoster():t;var bgOpts=$('#background-options');switch(p.backgroundType_){case postermywall.core.model.vo.PosterVO.BG_TYPE_SOLID_COLOR:this.setPosterPickerValue_('picker-bg-color-1','primaryColor',$.colpick.hexToRgb(p.primaryColor));bgOpts.find('.sub-options > li:not(.bg-color-1)').not('.bg-resize-opts').slideUp();bgOpts.find('.bg-image').slideUp();bgOpts.find('.bg-color-1').find('label').text($.t('pm_color')).end().slideDown();break;case postermywall.core.model.vo.PosterVO.BG_TYPE_GRADIENT:this.setPosterPickerValue_('picker-bg-color-1','primaryColor',$.colpick.hexToRgb(p.primaryColor));this.setPosterPickerValue_('picker-bg-color-2','secondaryColor',$.colpick.hexToRgb(p.secondaryColor));gradientTypeSelector_.setValue(p.gradient);bgOpts.find('.bg-image').slideUp();bgOpts.find('.bg-color-1').find('label').text($.t('pm_color_1')).end().slideDown();bgOpts.find('.bg-color-2').slideDown();bgOpts.find('.bg-gradient-type').slideDown();break;case postermywall.core.model.vo.PosterVO.BG_TYPE_UPLOAD:case postermywall.core.model.vo.PosterVO.BG_TYPE_PMW_IMAGE:case postermywall.core.model.vo.PosterVO.BG_TYPE_STOCK:if(p.theme.background.fillType===postermywall.core.model.vo.BackgroundVO.FILLTYPE_COLLAGE){$('#btn-crop-background').addClass('disabled').prop('title',$.t('pm_crop_background_disabled'));}else{$('#btn-crop-background').removeClass('disabled').prop('title','');}
bgOpts.find('.sub-options > li:not(.bg-image)').not('.bg-resize-opts').slideUp();bgOpts.find('.bg-image').slideDown();changeBackgroundFilterSelector_.setValue(p.backgroundModification.filterType.toString());tglBackgroundTint_.prop('checked',p.backgroundModification.tint);this.toggleBackgroundTintOptions_(p,p.backgroundModification.tint);tglBackgroundMultiply_.prop('checked',p.backgroundModification.multiply);this.toggleBackgroundMultiplyOptions_(p,p.backgroundModification.multiply);this.setBackgroundSliderValue_('backgroundBrightnessSlider','brightness',p.backgroundModification.brightness,-100,100,true,{});this.setBackgroundSliderValue_('backgroundContrastSlider','contrast',p.backgroundModification.contrast,-100,100,true,{});this.setBackgroundSliderValue_('backgroundSaturationSlider','saturation',p.backgroundModification.saturation,-100,100,true,{});break;}},onImageEdgeModified_:function(e,val){var changes={imageBorderType:parseInt(val)};if(changes.imageBorderType==3){changes.imageBorderThickness=postermywall.core.model.vo.GraphicItemImageVO.CURVED_EDGE_THICKNESS;}
else if(changes.imageBorderType==8){changes.imageBorderThickness=postermywall.core.model.vo.GraphicItemImageVO.GRADIENT_EDGE_THRESHOLD;}
this.getWhiteboardMediator().updateSelection([changes]);var m=this.getWhiteboardMediator().getSelectedModels()[0];this.toggleImageCurvedOptions_(m);this.toggleImageGradientEdgeOptions_(m);},showFitToScreenButton_:function(){zoomOpts_.toggleClass('-has-fit-to-screen',true);},toggleTray_:function(traySelector,close){var tray=$$.get(traySelector);if(!tray){tray=$(traySelector);$$.set(traySelector,tray);}
tray.toggleClass('closed',close);return close;},toggleImageCurvedOptions_:function(model){if(this.toggleTray_('#curvedOptions',(model==null||(model!=null&&model.imageBorderType!=3)))){return;}
this.setSliderValue_('curvedSlider','imageBorderThickness',model.imageBorderThickness,7,28,false,{steps:22,snap:true});},toggleImageGradientEdgeOptions_:function(model){if(this.toggleTray_('#gradientEdgeOptions',(model==null||(model!=null&&model.imageBorderType!=8)))){return;}
this.setSliderValue_('gradientEdgeSlider','imageBorderThickness',model.imageBorderThickness,1,250,true,{});},onImageShadowModified_:function(e,val){val=parseInt(val);var changes=this.getShadowProperties(val);changes.imageGlowType=0;this.getWhiteboardMediator().updateSelection([changes]);imageGlowSelector_.setValue(0);var model=this.getWhiteboardMediator().getSelectedModels()[0];this.toggleShadowOptions_(model);this.toggleImageGlowOptions_(model)},toggleShadowOptions_:function(model){var type=model.gitype;if(model.gitype===postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT){type='fancyText';}
var capitalizedType=type[0].toUpperCase()+type.substr(1);if(this.toggleTray_('#'+type+'ShadowCustom',(model==null||(model!=null&&model.dropShadow!=3)))){return;}
this.setGraphicItemPickerValue_('picker'+capitalizedType+'Shadow','dropShadowColor',model.dropShadowColor);this.setSliderValue_(type+'ShadowAlphaSlider','dropShadowAlpha',model.dropShadowAlpha,0,1,false,{},'percentage');this.setSliderValue_(type+'ShadowAngleSlider','dropShadowAngle',model.dropShadowAngle,0,360,true,{});},onImageGlowModified_:function(e,val){var changes={imageGlowType:parseInt(val),dropShadow:0};this.getWhiteboardMediator().updateSelection([changes]);imageShadowSelector_.setValue(0);var model=this.getWhiteboardMediator().getSelectedModels()[0];this.toggleImageGlowOptions_(model);this.toggleShadowOptions_(model);},toggleImageGlowOptions_:function(model){if(this.toggleTray_('#imageGlowCustom',(model==null||(model!=null&&model.imageGlowType==0)))){return;}
this.setGraphicItemPickerValue_('pickerImageGlow','imageGlowColor',model.imageGlowColor);},onImageFilterModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{antique:parseInt(val)}]);},onImageTintModified_:function(){this.getWhiteboardMediator().updateSelection([{tint:!this.getWhiteboardMediator().getSelectedModels()[0].tint}]);this.toggleImageTintOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},toggleImageTintOptions_:function(model){if(!this.toggleTray_('#image-tint-options',!model.tint)){this.setGraphicItemPickerValue_('pickerImageTint','tintColor',model.tintColor);this.setSliderValue_('imageTintAlphaSlider','tintOpacity',model.tintOpacity,0,1,false,{},'percentage');}},onImageMultiplyModified_:function(){this.getWhiteboardMediator().updateSelection([{multiply:!this.getWhiteboardMediator().getSelectedModels()[0].multiply}]);this.toggleImageMultiplyOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},toggleImageMultiplyOptions_:function(model){if(!this.toggleTray_('#image-multiply-options',!model.multiply)){this.setGraphicItemPickerValue_('pickerImageMultiply','multiplyColor',model.multiplyColor);}},onImageBorderModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{solidBorderType:parseInt(val)}]);this.toggleImageBorderOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},toggleImageBorderOptions_:function(model){var tray=$$.get('#imageBorderCustom');if(!tray){tray=$('#imageBorderCustom');$$.set('#imageBorderCustom',tray);}
if(model==null||(model!=null&&model.solidBorderType==0)){tray.addClass('closed');return;}
tray.removeClass('closed');this.setGraphicItemPickerValue_('pickerImageBorder','solidBorderColor',model.solidBorderColor);this.setSliderValue_('imageBorderSlider','solidBorderThickness',model.solidBorderThickness,4,28,false,{steps:25,snap:true});},onImageFlipX_:function(){this.getWhiteboardMediator().updateSelection([{flipX:!this.getWhiteboardMediator().getSelectedModels()[0].flipX}]);},onImageFlipY_:function(){this.getWhiteboardMediator().updateSelection([{flipY:!this.getWhiteboardMediator().getSelectedModels()[0].flipY}]);},onTableBorderModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{solidBorderType:parseInt(val)}]);this.toggleTableBorderOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},toggleTableBorderOptions_:function(model){var tray=$$.get('#tableBorderCustom');if(!tray){tray=$('#tableBorderCustom');$$.set('#tableBorderCustom',tray);}
if(model==null||(model!=null&&model.solidBorderType==0)){tray.addClass('closed');return;}
tray.removeClass('closed');this.setGraphicItemPickerValue_('pickerTableBorder','solidBorderColor',model.solidBorderColor);this.setSliderValue_('tableBorderSlider','solidBorderThickness',model.solidBorderThickness,1,10,true,{});},onScheduleLayoutChange_:function(e,val){var wm=this.getWhiteboardMediator(),model=wm.getSelectedModels()[0],updatedData=model.getDataForLayout(val),changes={columns:postermywall.core.model.LayoutProxy.getColumnCountForLayout(val),layoutStyle:val,layoutDataMap:updatedData.layoutDataMap,unusedData:updatedData.unusedData};if(val!=postermywall.core.model.LayoutProxy.TABLE_LAYOUT&&(model.backgroundType===2)){changes.backgroundType=1;}
wm.updateSelection([changes]);wm.refreshSelection();},onMenuLayoutChange_:function(e,val){var wm=this.getWhiteboardMediator(),model=wm.getSelectedModels()[0],changes={columns:postermywall.core.model.LayoutProxy.getColumnCountForLayout(val),layoutStyle:val};if(val==postermywall.core.model.LayoutProxy.MENU_LAYOUT_4&&model.solidBorderType==0){changes.solidBorderType=1;}else{changes.solidBorderType=0;}
wm.updateSelection([changes]);wm.refreshSelection();},onAlignSelection_:function(type){this.getWhiteboardMediator().alignSelection(type);},onGroupSpacing_:function(type){this.getWhiteboardMediator().setGroupSpacing(type);},onShapeShadowModified_:function(e,val){this.getWhiteboardMediator().updateSelection([this.getShadowProperties(val)]);this.toggleShadowOptions_(this.getWhiteboardMediator().getSelectedModels()[0]);},getShadowProperties:function(shadowType){shadowType=parseInt(shadowType);return{dropShadow:shadowType,dropShadowAlpha:postermywall.core.view.GraphicItemMediator.getAlphaForShadow(shadowType)}},onColorFillModified_:function(solidFillSel,gradientFillSel,patternFillSel,e,val){this.getWhiteboardMediator().updateSelection([{fillType:parseInt(val)}]);this.toggleColorFillOptions_(this.getWhiteboardMediator().getSelectedModels()[0],solidFillSel,gradientFillSel,patternFillSel);},toggleColorFillOptions_:function(model,solidFillSel,gradientFillSel,patternFillSel){this.toggleTray_(solidFillSel,!(model.fillType==postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_SOLID));this.toggleTray_(gradientFillSel,!(model.fillType==postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_LINEAR_GRADIENT||model.fillType==postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_RADIAL_GRADIENT));if(patternFillSel!=null){this.toggleTray_(patternFillSel,!(model.fillType==postermywall.core.model.vo.GraphicItemVO.FILL_TYPE_PATTERN));}},onPatternFillModified_:function(e,val){this.getWhiteboardMediator().updateSelection([{patternFill:parseInt(val)}]);},setBackgroundModificationPickerValue_:function(id,property,color,delay){if(typeof delay==='undefined'){delay=0;}
this.setPickerValue_(id,property,color,delay,this.onBeforeBackgroundModificationColorChanging_,this.onBackgroundModificationColorChanging_,this.onBackgroundModificationColorChanged_);},setPosterPickerValue_:function(id,property,color,delay){if(typeof delay==='undefined'){delay=0;}
this.setPickerValue_(id,property,color,delay,this.onBeforePosterBGColorChanging_,this.onPosterBGColorChanging_,this.onPosterBGColorChanged_);},setGraphicItemPickerValue_:function(id,property,color,delay){if(typeof delay==='undefined'){delay=0;}
this.setPickerValue_(id,property,color,delay,this.onBeforeGraphicItemColorChanging_,this.onGraphicItemColorChanging_,this.onGraphicItemColorChanged_);},setMenuItemPickerValue_:function(id,property,color,delay){if(typeof delay==='undefined'){delay=0;}
this.setPickerValue_(id,property,color,delay,this.onBeforeGraphicItemColorChanging_,this.onMenuItemColorChanging_,this.onMenuItemColorChanged_);},setPickerValue_:function(id,property,color,delay,onShow,onChange,onHide){var el=$$.get(id);var cache=!el;if(cache){el=$('#'+id);el.colpick({layout:'hex',onBeforeShow:this.preparePickerCache_,onShow:onShow.bind(this,id),onChange:this.onPickerValueChanging_.bind(this,property,id,delay,onChange),onHide:this.onPickerValueChanged_.bind(this,property,id,onHide),onPickFromPoster:this.onPickFromPoster.bind(this,el)});if(postermywall.Core.isTouchSupported){el.colpickHidePickFromDesign();}}
if(el){if(typeof color[0]==='undefined'){el.css('background-color','#'+postermywall.Util.rgbToHex([color.r,color.g,color.b]));el.colpickSetColorWithoutCallback({r:color.r,g:color.g,b:color.b});}else{el.css('background-color','#'+postermywall.Util.rgbToHex(color));el.colpickSetColorWithoutCallback({r:color[0],g:color[1],b:color[2]});}
if(cache){$$.set(id,el);}}},preparePickerCache_:function(){var id=this.id,colorRaw=this.style.backgroundColor.split('(')[1].split(')')[0],color;colorRaw=colorRaw.split(',');color={r:parseInt(colorRaw[0]),g:parseInt(colorRaw[1]),b:parseInt(colorRaw[2])};$$.set(id+':start',color);$$.set(id+':end',color);$$.clear(id);},onPickerValueChanging_:function(prop,id,delay,callback,hsb,hex,rgb,el,bySetColor){$('#'+id).css('background-color','#'+hex);if(bySetColor){return;}
$$.set(id+':end',rgb);if(delay>0){if(this.colorChangingDelay__){clearTimeout(this.colorChangingDelay__);}
this.colorChangingDelay__=setTimeout(callback.bind(this,prop,rgb),delay);}
else{callback.call(this,prop,rgb);}},onPickerValueChanged_:function(prop,id,callback){this.onUndo(false);var startColor=$$.get(id+':start');var finalColor=$$.get(id+':end');if(!finalColor||!startColor||(startColor.r==finalColor.r&&startColor.g==finalColor.g&&startColor.b==finalColor.b)){return;}
callback.call(this,id,prop,finalColor);$$.clear(id);},onPickFromPoster:function(el,isEnabled){if(typeof isEnabled=='undefined'){isEnabled=false;}
if(isEnabled){this.getWhiteboardMediator().enableColorPickMode(el);}
else{this.getWhiteboardMediator().disableColorPickMode();}},setColorPalette:function(id){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),poster=wbp.getPoster();$('#'+id).colpickSetColorPalette(poster.getColorsOnPoster());},onBeforeGraphicItemColorChanging_:function(id){var models=this.getWhiteboardMediator().getSelectedModels();if(models.length>0){document.getElementById(id).setAttribute('data-uid',models[0].uid);this.getWhiteboardMediator().updateSelection([{}]);}
this.setColorPalette(id);},onGraphicItemColorChanging_:function(prop,rgb){var changes={};changes[prop]=[rgb.r,rgb.g,rgb.b];this.getWhiteboardMediator().updateSelection([changes],false);},onGraphicItemColorChanged_:function(id,prop,newColor){var changes={};changes[prop]=[newColor.r,newColor.g,newColor.b];this.getWhiteboardMediator().updateModelByUID(document.getElementById(id).getAttribute('data-uid'),[changes]);},onMenuItemColorChanging_:function(prop,rgb){var changes={};changes[prop]=[rgb.r,rgb.g,rgb.b];if(prop=='color'){changes['iconsColor']=changes[prop];this.setGraphicItemPickerValue_('pickerIconsFillColor','iconsColor',changes['iconsColor']);}
this.getWhiteboardMediator().updateSelection([changes],false);},onMenuItemColorChanged_:function(id,prop,newColor){var changes={};changes[prop]=[newColor.r,newColor.g,newColor.b];if(prop=='color'){changes['iconsColor']=changes[prop];}
this.getWhiteboardMediator().updateModelByUID(document.getElementById(id).getAttribute('data-uid'),[changes]);},onBeforePosterBGColorChanging_:function(id){this.setColorPalette(id);this.getWhiteboardMediator().updatePoster([]);},onBeforeBackgroundModificationColorChanging_:function(id){this.setColorPalette(id);this.facade.sendNotification(postermywall.Core.MODIFY_BACKGROUND,[],postermywall.Core.UNDOABLE_UPDATE);},onPosterBGColorChanging_:function(prop,rgb){var changes={};changes[prop]=postermywall.Util.rgbToHex([rgb.r,rgb.g,rgb.b]);this.getWhiteboardMediator().updatePoster(changes,false);},onPosterBGColorChanged_:function(id,prop,newColor){var changes={};changes[prop]=postermywall.Util.rgbToHex([newColor.r,newColor.g,newColor.b]);this.getWhiteboardMediator().updatePoster(changes);},onBackgroundModificationColorChanging_:function(prop,rgb){var changes={};changes[prop]=[rgb.r,rgb.g,rgb.b];this.facade.sendNotification(postermywall.Core.MODIFY_BACKGROUND,changes,postermywall.Core.NON_UNDOABLE_UPDATE);},onBackgroundModificationColorChanged_:function(id,prop,newColor){var changes={};changes[prop]=[newColor.r,newColor.g,newColor.b];this.facade.sendNotification(postermywall.Core.MODIFY_BACKGROUND,changes,postermywall.Core.UNDOABLE_UPDATE);},setBackgroundSliderValue_:function(id,property,value,inputStart,inputEnd,round,options,transformInput){this.initializeSlider_(id,this.onBackgroundSliderValueChanged,property,value,inputStart,inputEnd,round,options,transformInput)},onBackgroundSliderValueChanged:function(property,value){var changes={};changes[property]=value;this.facade.sendNotification(postermywall.Core.MODIFY_BACKGROUND,changes,postermywall.Core.UNDOABLE_UPDATE);},setSliderValue_:function(id,property,value,inputStart,inputEnd,round,options,transformInput,customTransformFunc){this.initializeSlider_(id,this.onSliderValueChanged,property,value,inputStart,inputEnd,round,options,transformInput,customTransformFunc)},initializeSlider_:function(id,onChange,property,value,inputStart,inputEnd,round,options,transformInput,customTransformFunc){var el=$$.get(id);if(!el){el=new postermywall.core.view.widget.Slider(id,onChange.bind(this,property),inputStart,inputEnd,round,options,transformInput,customTransformFunc);$$.set(id,el);}
el.setValue(el.calculateSliderValue(value),(typeof customTransformFunc=='function'));},onSliderValueChanged:function(property,value){var changes={};changes[property]=value;this.getWhiteboardMediator().updateSelection([changes]);},onAddVideoOrder_:function(){var wm=this.getWhiteboardMediator(),poster=wm.getProxy().getPoster(),up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME),user=up.getUser();if(user.name==='Hamza Wain'||user.id=='66'||user.id=='2149945'){if(poster.isVideo){var p={promotion:'PMWVIDEO',idProduct:64};this.facade.sendNotification(postermywall.Core.PURCHASE_DOWNLOAD,p);}else{this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:'Add video order error',text:'You must have only one video on the poster.',icon:true});}}else{this.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:'Add video order error',text:'Only the Hamza, Sidra or Jaffer can use this due to reasons.',icon:true});}},onGraphicItems_:function(o,gi){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var poster=wbp.getPoster();console.log(poster.graphicItems);var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.widget.GraphicItemListGrid','postermywall.core.view.modal.GraphicItemListModalMediator'],o,gi);},onGraphicItemDoubleClick_:function(){var selection=this.getWhiteboardMediator().getSelectedModels();if(selection.length===1){switch(selection[0].gitype){case postermywall.core.model.vo.GraphicItemVO.TYPE_FANCYTEXT:textFancy_.select();break;case postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE:this.onEditSchedule();break;case postermywall.core.model.vo.GraphicItemVO.TYPE_MENU:this.onEditMenuItem();break;}}},onEditTableOrMenu_:function(){var selection=this.getWhiteboardMediator().getSelectedModels();if(selection.length===1){switch(selection[0].gitype){case postermywall.core.model.vo.GraphicItemVO.TYPE_TABLE:this.onEditSchedule();break;case postermywall.core.model.vo.GraphicItemVO.TYPE_MENU:this.onEditMenuItem();break;default:}}},onResizePoster_:function(o){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.ResizePosterModalMediator'],o);},onAddPhotoModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.widget.AddMultiMediaItemGrid','postermywall.core.view.AddMultiMediaMediator','postermywall.core.view.modal.AddImageModalMediator'],o,vo);},onAddVideoModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.widget.AddMultiMediaItemGrid','postermywall.core.view.AddMultiMediaMediator','postermywall.core.view.modal.AddVideoModalMediator'],o,vo);},onAddStockImageModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.AddStockMultiMediaModalMediator','postermywall.core.view.modal.AddStockPhotoModalMediator'],o,{vo:vo});},onAddStockVideoModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.AddStockMultiMediaModalMediator','postermywall.core.view.modal.AddStockVideoModalMediator'],o,{vo:vo});},onAddFacebookPhotoModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.modal.AddFacebookPhotoModalMediator'],o,vo);},onAddGooglePhoto:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.GooglePhotoPickerMediator'],o,vo);am.createGoogleAuthWindow();},onAddDropboxPhoto:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.DropboxPhotoChooserMediator'],o,vo);},onAddFancyText:function(o){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.AddFancyTextModalMediator'],o);},getCoordinatesForNewItem:function(){var coords={},wm=this.getWhiteboardMediator(),poster=wm.getProxy().getPoster();coords.x=(wbContainer_.scrollLeft()+(poster.width/10))/Math.max(wm.getScale(),1)+15*offsetMultiplier_;coords.y=(wbContainer_.scrollTop()+(poster.height/8))/Math.max(wm.getScale(),1)+15*offsetMultiplier_;if(++offsetMultiplier_>2){offsetMultiplier_=0;}
return coords;},getInitialScale:function(x,y,w,h){var wm=this.getWhiteboardMediator(),poster=wm.getProxy().getPoster(),pw=poster.width,ph=poster.height,nw=w,nh=h,canvasWidth=wm.getViewComponent().lowerCanvasEl.width,canvasHeight=wm.getViewComponent().lowerCanvasEl.height,containerWidth=wbContainer_.width(),containerHeight=wbContainer_.height(),currentScale=wm.getScale();if((canvasWidth>containerWidth)&&(w>(containerWidth/currentScale))){nw=((containerWidth-(pw/3))/currentScale);}
else if(w>(pw-(pw/6))){nw=((canvasWidth-(pw/3))/currentScale);}
nh=((nw*h)/w);if((canvasHeight>containerHeight)&&(nh>(containerHeight/currentScale))){nh=((containerHeight-(ph/4.5))/currentScale);}
else if(nh>(ph-(ph/4.5))){nh=((canvasHeight-(ph/4.5))/currentScale);}
return Math.min(nw/w,nh/h);},onAddText:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),p=wbp.getPoster(),vo=new postermywall.core.model.vo.GraphicItemTextVO(),offset=this.getCoordinatesForNewItem();vo.text=$.t('pm_add_text');vo.x=offset.x;vo.y=offset.y;var fontSizeMagicNumber=15,fontSizeLowerLimit=(p.width>p.height?((p.width/fontSizeMagicNumber)/2):((p.height/fontSizeMagicNumber)/2));vo.fontSize=Math.max((p.width<p.height?p.width/fontSizeMagicNumber:p.height/fontSizeMagicNumber),fontSizeLowerLimit);vo.width=(p.width<=350)?Math.floor(p.width*0.6667):(vo.fontSize*(vo.text.length/2));vo.height=100;vo.color=p.theme.fontColor;vo.fontFamily=p.theme.fontFamily;vo.fontWeight='normal';vo.fontStyle='normal';if(this.getWhiteboardMediator().loadFonts([vo.fontFamily],this.addTextFontLoaded_.bind(this,vo))>0){this.facade.sendNotification(postermywall.Core.SHOW_LOADING,{key:'addtext',text:$.t('pm_loading_font')});}},addTextFontLoaded_:function(vo,success){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'addtext'});if(!success){this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_loading_font_error')});}
this.facade.sendNotification(postermywall.Core.ADD_GRAPHIC_ITEM,[vo],postermywall.Core.UNDOABLE_UPDATE);},onAddTabs:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),p=wbp.getPoster(),vo=new postermywall.core.model.vo.GraphicItemTabsVO(),fontSizeMagicNumber=15,fontSizeLowerLimit=(p.width>p.height?((p.width/fontSizeMagicNumber)/2):((p.height/fontSizeMagicNumber)/2)),initialTextLineHeight=Math.max((p.width<p.height?p.width/fontSizeMagicNumber:p.height/fontSizeMagicNumber),fontSizeLowerLimit),padding=this.getWhiteboardMediator().alignmentPadding;vo.text=$.t('pm_default_text_for_tabs');vo.x=p.width-padding/2;vo.y=p.height;vo.numTabs=Math.round(p.width/((initialTextLineHeight*2)*0.75));vo.height=p.height/4;vo.color=[0,0,0];vo.fontFamily='OpenSansRegular';vo.backgroundType=1;vo.backgroundColor=[255,255,255];vo.backgroundColorAlpha=0.75;vo.fontWeight='normal';vo.fontStyle='normal';vo.width=p.width-(padding);vo.rotation=180;vo.textAlign='right';vo.separatorType=postermywall.core.model.vo.GraphicItemTabsVO.SEPARATOR_TYPE_DASHED;vo.separatorColor=[100,100,100];if(this.getWhiteboardMediator().loadFonts([vo.fontFamily],this.addTabsFontLoaded_.bind(this,vo))>0){this.facade.sendNotification(postermywall.Core.SHOW_LOADING,{key:'addtabs',text:$.t('pm_loading_font')});}
PMW.trackGAEvent(PMW.POSTERBUILDER,'AddedTab',null);},addTabsFontLoaded_:function(vo,success){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'addtabs'});if(!success){this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_loading_font_error')});}
this.fitWhiteboardToScreen();this.facade.sendNotification(postermywall.Core.ADD_GRAPHIC_ITEM,[vo],postermywall.Core.UNDOABLE_UPDATE);this.getWhiteboardMediator().alignSelection('bottom',false);},openScheduleModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'datepickerLibrary'});PMW.getScriptAndCSS('vendor/datepicker.js','vendor/datepicker-customized.css',(function(){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'datepickerLibrary'});am.loadMediator(['postermaker.core.view.widget.TableLayoutThumbnail','postermywall.core.view.modal.AddTableModalMediator'],o,{model:vo});}).bind(this));},openMenuModal:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'SortableLibrary'});PMW.getScriptAndCSS('vendor/Sortable.min.js','',(function(){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'SortableLibrary'});am.loadMediator(['postermywall.core.view.modal.AddMenuModalMediator'],o,{model:vo});}).bind(this));},onEditSchedule:function(){var vo=this.getWhiteboardMediator().getSelectedModels()[0],o;if(vo.isCustomTableLayout()){o=postermywall.Core.OPEN_MODAL_TABLE;}
else{o=postermywall.Core.OPEN_MODAL_SCHEDULE;}
this.openScheduleModal(o,vo);},onEditMenuItem:function(){var vo=this.getWhiteboardMediator().getSelectedModels()[0];this.openMenuModal(postermywall.Core.OPEN_MODAL_MENU,vo);},onAddShape:function(o,c){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.modal.AddShapeModalMediator'],o,c);},onAddClipart:function(o,c){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.modal.AddClipartModalMediator'],o,c);},onImageOfBackgroundOptions:function(){switch(parseInt(changeBackgroundSelector_.getValue())){case 2:this.onUploadBackground();break;case 3:this.onImageBackground(postermywall.Core.OPEN_MODAL_IMAGE_BACKGROUND,null);break;case 4:this.onImageBackground(postermywall.Core.OPEN_MODAL_STOCK_BACKGROUND,null);break;}},onCropBackground:function(o){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME),wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),poster=wbp.getPoster(),sa=[];if(typeof jQuery().cropper==='undefined'){sa[sa.length]='vendor.cropper';}
sa[sa.length]='postermywall.core.view.modal.CropperModalMediator';am.loadMediator(sa,o,{vo:poster});},onColorBackground:function(o,c){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);if(typeof c==='undefined'){c=true;}
am.loadMediator(['postermywall.core.view.modal.ColorBackgroundModalMediator'],o,c);},onUploadBackground:function(){$('#file-bg-upload').click();},onUploadBackgroundFileUpload:function(files){this.openUploadBackgroundModal(postermywall.Core.OPEN_MODAL_UPLOAD_BACKGROUND,{files:files});},onUploadFontFileUploaded:function(files){var validFiles=[];for(var i=0,file;file=files[i];i++){var sFileName=file.name,sFileExtension=sFileName.split('.')[sFileName.split('.').length-1].toLowerCase();if(sFileExtension==="ttf"||sFileExtension==="otf"){validFiles.push(file);}
else{this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_invalid_font_file_error')});}}
if(validFiles.length>0){this.openUploadFontModal(postermywall.Core.OPEN_MODAL_UPLOAD_FONTS,{files:validFiles,fontProp:this.fontFamilyProp_},null);}},openUploadBackgroundModal:function(o,p){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.UploadBackgroundModalMediator'],o,p);},openUploadFontModal:function(o,f,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);if(typeof vo=='undefined'||vo===null){vo=this.getWhiteboardMediator().getSelectedModels()[0];}
am.loadMediator(['postermywall.core.view.modal.UploadFontsModalMediator'],o,{model:vo,file:f});},openManageFontModal:function(o,uf,fontProp){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.ManageFontsModalMediator'],o,{userFonts:uf,fontProp:fontProp});},onImageBackground:function(o,p){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.StockLibraryMediator','postermywall.core.view.modal.ImageBackgroundModalMediator'],o,p);},openSettingsModal:function(o){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.SettingsModalMediator'],o);},initUploads:function(){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);postermywall.core.library.UploadLibrary.initUpload('',this.uploadUserMultiMediaItem.bind(this),am.showUnableToUploadError.bind(this),'#whiteboardContainer',$.t('pm_drag_drop_message'));postermywall.core.library.UploadLibrary.initUpload('#file-bg-upload',this.onUploadBackgroundFileUpload.bind(this),am.showUnableToUploadError.bind(this));postermywall.core.library.UploadLibrary.initUpload('#file-font-upload',this.onUploadFontFileUploaded.bind(this),am.showUnableToUploadError.bind(this))},uploadUserMultiMediaItem:function(files){var videoFiles=[],nonVideoFiles=[];for(var i=0;i<files.length;i++){nonVideoFiles.push(files[i]);}
if(nonVideoFiles.length>0){this.onAddPhotoModal(postermywall.Core.UPLOAD_USER_IMAGES,nonVideoFiles);}
if(videoFiles.length>0){this.onAddVideoModal(postermywall.Core.UPLOAD_USER_VIDEOS,videoFiles);}},onPlayPauseVideo:function(e){var button=$(e.target).closest('.btn-play-pause');var wm=this.getWhiteboardMediator(),vo=wm.getSelectedModels()[0],m=wm.getMediatorForModel(vo),v=m.getViewComponent(),videoElement=v.getElement();this.togglePlayPauseVideo(videoElement,button);},togglePlayPauseVideo:function(videoElement,button){var wm=this.getWhiteboardMediator();$(button).toggleClass("paused");if($(button).hasClass("paused")){wm.videoPlaying=false;button.find('.v-align').html($.t('pm_play'));videoElement.pause();}else{wm.videoPlaying=true;button.find('.v-align').html($.t('pm_pause'));videoElement.play();}},onTrimVideo:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);if(typeof vo==='undefined'||vo===null){vo=this.getWhiteboardMediator().getSelectedModels()[0];}
am.loadMediator(['postermywall.core.view.modal.TrimVideoModalMediator'],o,{model:vo});},onCropImage:function(o,vo,replaceMode){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME),sa=[];if(typeof vo==='undefined'||vo===null){vo=this.getWhiteboardMediator().getSelectedModels()[0];}
if(typeof replaceMode==='undefined'){replaceMode=false;}
if(typeof jQuery().cropper==='undefined'){sa[sa.length]='vendor.cropper';}
sa[sa.length]='postermywall.core.view.modal.CropperModalMediator';am.loadMediator(sa,o,{vo:vo,r:replaceMode});},onReplaceVideo:function(o,graphicItem){graphicItem=graphicItem?graphicItem:this.getWhiteboardMediator().getSelectedModels()[0];var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.VideoTypeModalMediator'],o,graphicItem);},onReplaceImage:function(){this.facade.sendNotification(postermywall.Core.OPEN_MODAL_SELECT_IMAGE_TYPE,this.getWhiteboardMediator().getSelectedModels()[0]);},onMaskImage:function(o,vo){var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);if(typeof vo==='undefined'||vo===null){vo=this.getWhiteboardMediator().getSelectedModels()[0];}
am.loadMediator(['postermaker/core/view/widget/PointMask','postermywall.core.view.modal.MaskingModalMediator'],o,{model:vo});}},{NAME:'EditorMediator',updateMenuHeight:function(menu){var menuItems=menu.find('.menu-wrapper > li'),firstItem=menuItems.first(),lastItem=menuItems.last(),menuHeight=-firstItem.position().top+lastItem.position().top+lastItem.height(),wh=$(window).height();if(postermywall.core.view.EditorMediator.NAV_HEIGHT+menuHeight>wh){menu.height(wh-postermywall.core.view.EditorMediator.NAV_HEIGHT);}else{menu.height(menuHeight);}},NAV_HEIGHT:60,BOTTOM_BAR_HEIGHT:60,isBottomBarVisible:false});})();
(function(){puremvc.define({name:'postermywall.core.view.AuthenticateMediator',parent:postermywall.core.view.modal.ModalMediator,constructor:function(){postermywall.core.view.modal.ModalMediator.call(this,$('#auth-modal'));PMW.onClick(this.el_.find('.btn-facebook-login'),null,this.onFacebookConnect_.bind(this));PMW.onClick(this.el_.find('.btn-sign-up'),null,this.onSignUp_.bind(this));PMW.onClick(this.el_.find('.btn-student'),null,this.onStudent_.bind(this));$('#frm-auth-login',this.el_).on('submit',this.onLoginSubmit_.bind(this));$('#frm-auth-signup',this.el_).on('submit',this.onSignupSubmit_.bind(this));$('#frm-auth-classroom',this.el_).on('submit',this.onClassroomSubmit_.bind(this));}},{up_:null,callback_:null,facebookPerms_:'',notificationInterests_:[postermywall.Core.AUTHENTICATE_USER,postermywall.Core.AUTHENTICATE_FACEBOOK_USER,postermywall.Core.LOG_OUT_USER],onRegister:function(){postermywall.core.view.modal.ModalMediator.prototype.onRegister.call(this);this.up_=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);},handleNotification:function(note){postermywall.core.view.modal.ModalMediator.prototype.handleNotification.call(this,note);var params=note.getBody();if(typeof params!=='undefined'){this.callback_=$.isFunction(params.callback)?params.callback:$.noop();this.facebookPerms_=(typeof params.permissions!=='string')?PMW.FB_PERMISSIONS:params.permissions;}
switch(note.getName()){case postermywall.Core.AUTHENTICATE_USER:this.onAuthUser_();break;case postermywall.Core.AUTHENTICATE_FACEBOOK_USER:this.onFacebookConnect_();break;case postermywall.Core.LOG_OUT_USER:this.logOutUser_();break;}},showSection_:function(section){var current=$('ul.sections > li.in',this.el_),btn=$('.header .close',this.el_),sectionEl=null;if(!current.hasClass(section)){PMW.toggleInOut(current,false);sectionEl=current.siblings('.'+section);PMW.toggleInOut(sectionEl,true);}
else{sectionEl=current;}
PMW.toggleInOut(sectionEl.find('.message'),false);if(section==='default'){btn.html($.t('pm_close')).attr('data-action','close').removeAttr('data-backto');}
else{btn.html('<i class="icon-caret-left"></i>'+$.t('pm_back')).attr('data-action','back').attr('data-backto',current.attr('data-name'));}
$('.title > h2',this.el_).html(sectionEl.attr('data-title'));},onSignUp_:function(){this.showSection_('signup');},onStudent_:function(){this.showSection_('classroom');},onAuthUser_:function(){if(this.up_.getUser()!=null){this.callback_();}
else{this.openModal();PMW.google.loadApi(this.onGoogleSignInDone_.bind(this));this.showSection_('default');}},onFacebookConnect_:function(){this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'facebookConnect'});PMW.fb.login(this.onFBLogin_.bind(this),{scope:this.facebookPerms_});},onGoogleSignInDone_:function(data){this.onLoginResponse_(data);},onFBLogin_:function(response){if(response.authResponse){PMW.fb.connect(this.onFacebookConnectDone_.bind(this));}else{alert('Please login via Facebook to proceed');}},onFacebookConnectDone_:function(data){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'facebookConnect'});this.onLoginResponse_(data);},onLoginSubmit_:function(e){e.preventDefault();document.activeElement.blur();if($.trim($('#email-login').val()).length>0&&$.trim($('#password-login').val()).length){PMW.toggleInOut($('#frm-auth-login .error'),false);var form=$(e.target);$.post(form.attr('action'),form.serialize(),this.onLoginResponse_.bind(this));}
else{PMW.toggleInOut($('#frm-auth-login .error'),true);}
return false;},onLoginResponse_:function(userId){if(isNaN(parseInt(userId))){PMW.toggleInOut($('#frm-auth-login .error'),true);}
else{this.up_.loadUser().done(this.onAuthenticationDone_.bind(this));}},onSignupSubmit_:function(e){e.preventDefault();document.activeElement.blur();var error=$('#frm-auth-signup .error');PMW.toggleInOut(error,false);var pwd=$.trim($('#password-signup').val()),pwd2=$.trim($('#password2-signup').val());if($.trim($('#email-signup').val()).length===0||pwd.length===0||pwd2.length===0){PMW.toggleInOut(error.html($.t('pm_all_fields_required')),true);return false;}
if(pwd!==pwd2){PMW.toggleInOut(error.html($.t('pm_password_mismatch')),true);return false;}
var form=$(e.target);$.post(form.attr('action'),form.serialize(),this.onSignupResponse_.bind(this));return false;},onSignupResponse_:function(r){if(r.status=='success'){this.up_.loadUser().done(this.onAuthenticationDone_.bind(this));}else if(r.status=='fail'&&r.data){if(r.data.password=='length'){PMW.toggleInOut($('#frm-auth-signup .error').html($.t('pm_password_length_error')),true);}else if(r.data.email=='exists'){PMW.toggleInOut($('#frm-auth-signup .error').html($.t('pm_email_exists')),true);}else if(r.data.email=='invalid'){PMW.toggleInOut($('#frm-auth-signup .error').html($.t('pm_invalid_email_address')),true);}else if(r.data.params=='missing'){PMW.toggleInOut($('#frm-auth-signup .error').html($.t('pm_all_fields_required')),true);}}else{PMW.toggleInOut($('#frm-auth-signup .error').html($.t('pm_unknown_error')),true);}},onClassroomSubmit_:function(e){e.preventDefault();if($.trim($('#name-classroom').val()).length>0){PMW.toggleInOut($('#frm-auth-classroom .error'),false);var form=$(e.target);$.post(form.attr('action'),form.serialize(),this.onClassroomResponse_.bind(this));}
else{PMW.toggleInOut($('#frm-auth-classroom .error').html($.t('pm_project_name_required')),true);}
return false;},onClassroomResponse_:function(userId){if(userId==='notfound'){PMW.toggleInOut($('#frm-auth-classroom .error').html($.t('pm_project_not_found')),true);}
else if(userId==='empty'){PMW.toggleInOut($('#frm-auth-classroom .error').html($.t('pm_project_name_required')),true);}
else if(isNaN(parseInt(userId))){PMW.toggleInOut($('#frm-auth-classroom .error').html($.t('pm_unknown_error')),true);}
else{this.up_.loadUser().done(this.onAuthenticationDone_.bind(this));}},onAuthenticationDone_:function(){this.callback_();postermywall.core.view.modal.ModalMediator.prototype.closeModal.call(this);},logOutUser_:function(){this.up_.logOutUser().done(this.onLogOutUserDone_.bind(this));},onLogOutUserDone_:function(){this.callback_();},closeModal:function(){this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'facebookConnect'});var btn=$('.header .close',this.el_),action=btn.attr('data-action'),section=btn.attr('data-backto');if(action==='close'||!section){this.sendNotification(postermywall.Core.AUTHENTICATION_CANCELED);postermywall.core.view.modal.ModalMediator.prototype.closeModal.call(this);}
else{this.showSection_(section);}}},{NAME:'AuthenticateMediator'});})();
"use strict";puremvc.define({name:'postermywall.core.view.notification.NotificationMediator',parent:puremvc.Mediator,constructor:function(){puremvc.Mediator.call(this);this.container_=$('#notification-container');if(this.container_.length==0){$(document.body).append('<div id="notification-container"></div>');this.container_=$('#notification-container');PMW.onClick(this.container_,'.close',this.closeNotification.bind(this));}
this.init_=false;}},{init_:false,container_:null,notificationInterests_:[],listNotificationInterests:function(){return this.notificationInterests_;},handleNotification:function(note){},showNotification:function(){this.container_.addClass('-in').removeClass('-out');},closeNotification:function(){this.container_.removeClass('-in').addClass('-out');}},{NAME:'NotificationMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.notification.SaveReminderMediator',parent:postermywall.core.view.notification.NotificationMediator},{notificationInterval_:0,saveButton_:'',notificationText_:'',isInitialized_:false,notificationInterests_:[postermywall.Core.POSTER_CHANGED,postermywall.Core.POSTER_SAVED],handleNotification:function(note){switch(note.getName()){case postermywall.Core.POSTER_CHANGED:if(!this.isInitialized_){var sdr=PMW.util.readCookie('pmwsdr');if(!sdr){sdr=1;}
this.init(sdr);}
break;case postermywall.Core.POSTER_SAVED:if(this.notificationInterval_){this.closeNotification();clearInterval(this.notificationInterval_);this.notificationInterval_=this.setNotificationInterval_();}
break;}},setNotificationInterval_:function(){var self=this;self.notificationInterval_=setInterval(function(){PMW.ui.notification.createNotificationContainer.call(self,self.saveButton_,self.notificationText_);setTimeout(function(){self.showNotification();},100);},postermywall.core.view.notification.SaveReminderMediator.NOTIFICATION_INTERVAL);},showNotification:function(){if(this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME).getUnsavedChanges()){this.container_.addClass('-in').removeClass('-out');}},onSave:function(){this.facade.sendNotification(postermywall.Core.SAVE,{});this.closeNotification();},init:function(showNotification){if(showNotification!=0){this.isInitialized_=true;this.saveButton_='<button class="btn btn-primary save-button">'+$.t('pm_save_now')+'</button><div class="subtle-option"><input type="checkbox" id="chk-hide-save-reminder" /><label for="chk-hide-save-reminder">'+$.t("pm_hide_notification")+'</label></div>';this.notificationText_=$.t('pm_save_reminder');PMW.onClick(this.container_,'.save-button',this.onSave.bind(this));var self=this;this.container_.on('change','#chk-hide-save-reminder',function(){var preference=$(this).is(":checked")?'0':'1';PMW.util.setCookie('pmwsdr',preference,300);clearInterval(self.notificationInterval_);self.notificationInterval_=-1;});this.setNotificationInterval_();}}},{NAME:'SaveReminderMediator',NOTIFICATION_INTERVAL:1500000});
"use strict";puremvc.define({name:'postermywall.core.view.notification.LanguageNotificationMediator',parent:postermywall.core.view.notification.NotificationMediator,constructor:function(){postermywall.core.view.notification.NotificationMediator.call(this);}},{notificationInterests_:[postermywall.Core.SHOW_LANGUAGE_NOTIFICATION],handleNotification:function(note){switch(note.getName()){case postermywall.Core.SHOW_LANGUAGE_NOTIFICATION:this.init();this.showNotification();break;}},init:function(){if(!this.init_){this.init_=true;PMW.ui.notification.createNotificationContainer('<button class="btn btn-primary btn-switch-to-english">View in English</button>','This page is in '+$.t('pm_this_language_in_english')+'.','');PMW.onClick(this.container_,'.btn-switch-to-english',this.onBtnSwitchToEnglish.bind(this));PMW.onClick(this.container_,'.close',this.onClose.bind(this));}},onClose:function(){this.setUserPreferredLanguage(i18n.lng(),false);},onBtnSwitchToEnglish:function(){this.setUserPreferredLanguage('en',true);},setUserPreferredLanguage:function(lang,reload){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);up.setUserLanguage(lang).done(this.onSetUserPreferredLanguageSuccess.bind(this,reload)).fail(this.onSetUserPreferredLanguageFail.bind(this,lang));},onSetUserPreferredLanguageSuccess:function(reload){if(reload){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);wbp.setUnsavedChanges(false,true);window.location.reload(true);}},onSetUserPreferredLanguageFail:function(lang){var user=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME).getUser(),userId;if(user==null){userId='anon';}else{userId=user.id;}
this.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_general_ajax_error'),debug:'LanguageNotificationMediator :: failed to set user preferred language, userId: '+userId+' lang: '+lang});}},{NAME:'LanguageNotificationMediator'});
"use strict";puremvc.define({name:'postermywall.core.view.notification.UnsupportedNotificationMediator',parent:postermywall.core.view.notification.NotificationMediator,constructor:function(){postermywall.core.view.notification.NotificationMediator.call(this);}},{notificationInterests_:[postermywall.Core.SHOW_UNSUPPORTED_BROWSER_NOTIFICATION],handleNotification:function(note){switch(note.getName()){case postermywall.Core.SHOW_UNSUPPORTED_BROWSER_NOTIFICATION:this.init();this.showNotification();break;}},init:function(){if(!this.init_){this.init_=true;PMW.ui.notification.createNotificationContainer('<a class="btn btn-primary" href="http://outdatedbrowser.com" target="_blank">'+$.t('pm_unsupported_browser_btn')+'</a>',$.t('pm_unsupported_browser_text',{browser:bowser.name}));PMW.trackGAEvent(PMW.POSTERBUILDER,'UnsupportedBrowser',bowser.name,null);}}},{NAME:'UnsupportedNotificationMediator'});
puremvc.define({name:'postermywall.core.controller.PrepModelCommand',parent:puremvc.SimpleCommand},{execute:function(){this.facade.registerProxy(new postermywall.core.model.AppProxy());this.facade.registerProxy(new postermywall.core.model.CommandHistoryProxy());this.facade.registerProxy(new postermywall.core.model.UserProxy());this.facade.registerProxy(new postermywall.core.model.PosterProxy());this.facade.registerProxy(new postermywall.core.model.ImageProxy());this.facade.registerProxy(new postermywall.core.model.StockGraphicProxy());this.facade.registerProxy(new postermywall.core.model.BackgroundProxy());this.facade.registerProxy(new postermywall.core.model.WhiteboardProxy());this.facade.registerProxy(new postermywall.core.model.LayoutProxy());}});
puremvc.define({name:'postermywall.core.controller.BaseInitCommand',parent:puremvc.SimpleCommand},{execute:function(note){var c=note.body;this.customConfig(c);this.essentialConfig(c);this.initializeUI(c);},essentialConfig:function(c){},customConfig:function(c){},initializeUI:function(c){}});
puremvc.define({name:'postermywall.core.controller.InitCommand',parent:postermywall.core.controller.BaseInitCommand},{essentialConfig:function(c){postermywall.Core.initializeConfig();postermywall.Core.setConfig(c,'fancyTextRoot',null);postermywall.Core.setConfig(c,'readBucket',null);postermywall.Core.setConfig(c,'writeBucket',null);if(typeof c.su!='undefined'&&c.su=='1'){postermywall.Core.setConfig(c,'su',0);}},initializeUI:function(c){var ap=this.facade.retrieveProxy(postermywall.core.model.AppProxy.NAME);ap.initializeCache(c.version);var self=this;var i18nSuccess=true;i18n.init({useLocalStorage:false,fallbackLng:'en',lng:c.lang,ns:'postermakerjs',customLoad:function(lng,ns,opts,callback){ap.getLanguage(lng,ns).done(function(data){if(data===false){i18nSuccess=false;callback('error');}
else{callback(null,data);}}).fail(function(){i18nSuccess=false;callback('error');});}}).done(function(){if(i18nSuccess){self.onLanguageReady(c);}
else{self.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:'Could not load the poster maker. Please try again after a few minutes.'});}});},onLanguageReady:function(c){var wbp;if(typeof c.user!=='undefined'){var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);up.setUser(c.user);}
if(typeof c.minDesignSide!=='undefined'){postermywall.core.model.vo.PosterVO.MIN_DESIGN_SIDE=parseInt(c.minDesignSide,10);}
if(typeof c.maxDesignSide!=='undefined'){postermywall.core.model.vo.PosterVO.MAX_DESIGN_SIDE=parseInt(c.maxDesignSide,10);}
if(typeof c.minInchSide!=='undefined'){postermywall.core.model.vo.PosterVO.MIN_INCH_SIDE=parseInt(c.minInchSide,10);}
if(typeof c.maxInchSide!=='undefined'){postermywall.core.model.vo.PosterVO.MAX_INCH_SIDE=parseInt(c.maxInchSide,10);}
if(typeof c.minMMSide!=='undefined'){postermywall.core.model.vo.PosterVO.MIN_MM_SIDE=parseInt(c.minMMSide,10);}
if(typeof c.maxMMSide!=='undefined'){postermywall.core.model.vo.PosterVO.MAX_MM_SIDE=parseInt(c.maxMMSide,10);}
if(typeof c.ppiInch!=='undefined'){postermywall.core.model.vo.PosterVO.PPI_INCH=parseInt(c.ppiInch,10);}
if(typeof c.ppiMM!=='undefined'){postermywall.core.model.vo.PosterVO.PPI_MM=parseInt(c.ppiMM,10);}
if(typeof c.unsupportedBrowser!=='undefined'&&c.unsupportedBrowser==1){postermywall.Core.isUnsupportedBrowser=true;}
if(typeof c.dropboxAppKey!=='undefined'){postermywall.Core.dropboxAppKey=c.dropboxAppKey;}
if(typeof c.googleAPIKey!=='undefined'){postermywall.Core.googleAPIKey=c.googleAPIKey;}
if(typeof c.googleClientId!=='undefined'){postermywall.Core.googleClientId=c.googleClientId;}
if('string'===typeof c.command&&c.command==='create'){this.onLoadingComplete();if(c.pt==null||c.pt.name==''){PMW.log('PosterType Bug: c: '+JSON.stringify(c)+'\n'+window.location.href);}
wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);wbp.setTempPoster(c.pt,c.w,c.h,c.uw,c.uh,c.u);this.facade.sendNotification(postermywall.Core.OPEN_MODAL_SELECT_BACKGROUND);}
else if('string'===typeof c.imageid){this.onLoadingComplete();if(c.pt==null||c.pt.name==''){PMW.log('PosterType Bug: c: '+JSON.stringify(c)+'\n'+window.location.href);}
wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);wbp.setTempPoster(c.pt,c.w,c.h,c.uw,c.uh,c.u);this.facade.sendNotification(postermywall.Core.LOAD_IMAGE_AS_BACKGROUND,{searchTerm:c.searchterm,imageId:c.imageid,artist:c.artist,title:c.title,collection:c.collection});}
else if('string'===typeof c.posterHash){var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);pp.loadPosterByHash(c.posterHash,this.onPosterLoadDone.bind(this,c)).fail(this.onPosterLoadFail.bind(this));}
else{this.welcomeUser();}
if(typeof c.folder!=='undefined'){var folder=c.folder,posterProxy=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);posterProxy.setFolderToSaveIn(folder);}},onPosterLoadDone:function(c,poster){this.onLoadingComplete();var wp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);if(c.mode==='edit'){wp.setPoster(poster);}
else if('string'===typeof c.command&&c.command==='resizeto'&&'string'===typeof c.pt&&'string'===typeof c.w&&!isNaN(c.w)&&'string'===typeof c.h&&!isNaN(c.h)){this.sendNotification(postermywall.Core.RESIZE_POSTER,{p:poster,pt:c.pt,tw:parseInt(c.w,10),th:parseInt(c.h,10)},postermywall.Core.NON_UNDOABLE_UPDATE);}
else{var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);wp.setPoster(pp.newFromTemplate(poster));}},onPosterLoadFail:function(){this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_load_poster_error')});this.welcomeUser();},welcomeUser:function(){window.location.href=PMW.util.site_url('posterbuilder');},onLoadingComplete:function(){this.facade.sendNotification(postermywall.Core.INIT_UI);}});
puremvc.define({name:'postermywall.core.controller.editor.SaveCommand',parent:puremvc.SimpleCommand},{wbp_:null,pp_:null,callback_:null,callbackHasRedirect_:false,ignoreConflict_:false,execute:function(note){if(this.wbp_==null){this.wbp_=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);}
if(this.pp_==null){this.pp_=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);}
var params=note.getBody();this.callback_=(typeof params.callback==='function')?params.callback:null;this.ignoreConflict_=(typeof params.ignoreConflict==='boolean')?params.ignoreConflict:false;this.callbackHasRedirect_=(typeof params.callbackHasRedirect==='boolean')?params.callbackHasRedirect:false;if(this.wbp_.getUnsavedChanges()){this.facade.sendNotification(postermywall.Core.AUTHENTICATE_USER,{callback:this.performSave_.bind(this)});}else{this.onSaveComplete_();}},performSave_:function(){this.facade.sendNotification(postermywall.Core.SHOW_LOADING,{key:'save',text:'Saving...'});var poster=this.wbp_.getPoster(),items=[],itemsToDelete=[],i,item;for(i=0;i<poster.graphicItems.length;i++){item=poster.graphicItems[i];if(item.visible&&item.width>0&&item.height>0&&poster.isGraphicItemOnPoster(item)){items.push(item);}else{itemsToDelete.push(item);}}
if(itemsToDelete.length>0){this.facade.sendNotification(postermywall.Core.REMOVE_GRAPHIC_ITEMS,itemsToDelete,postermywall.Core.UNDOABLE_UPDATE);}
this.wbp_.updatePosterIsPremium(null);this.wbp_.updatePosterIsVideo();var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),zIndices={},views=wbm.getViewComponent().getObjects(),uid;for(i=0;i<views.length;i++){uid=postermywall.core.view.GraphicItemMediator.getViewComponentUID(views[i]);if(typeof uid==='string'){zIndices[uid]=i;}}
for(i=0;i<items.length;i++){if(typeof zIndices[items[i].uid]!=='undefined'){items[i].zIndex=zIndices[items[i].uid];}}
for(i=0;i<items.length;i++){if(items[i]instanceof postermywall.core.model.vo.GraphicItemTextVO){items[i].wrappedLines=wbm.getWrappedLinesForModel(items[i]);}
if(items[i]instanceof postermywall.core.model.vo.GraphicItemMenuVO){items[i].wrappingInfo=wbm.getWrappedLinesForModel(items[i]);}}
var up=this.facade.retrieveProxy(postermywall.core.model.UserProxy.NAME);poster.idLastModifier=up.getUser().id;if(!poster.creator){poster.creator=up.getUser();}
poster.graphicItems=items;poster.version=postermywall.core.model.vo.PosterVO.DEFAULT_VERSION;this.pp_.savePoster(poster,this.ignoreConflict_).done(this.onSaveResponse_.bind(this)).fail(this.onSaveError_.bind(this));},onSaveError_:function(){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'save'});this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_save_poster_error')});},onSaveResponse_:function(r){if(r.status=='success'){if(r.data&&r.data.poster){this.onSaved_(new postermywall.core.model.vo.PosterVO(r.data.poster));return;}}else if(r.status=='fail'){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'save'});if(r.data){switch(r.data.user){case'cannot-edit-poster':var title,text;if(r.data.creatorName!=''){title=$.t('pm_design_belongs_to_another_user_title');text=$.t('pm_design_belongs_to_another_user',{displayName:r.data.creatorName});}
else{title=$.t('pm_logged_out_title');text=$.t('pm_logged_out_message');}
this.facade.sendNotification(postermywall.Core.LOG_OUT_USER,{callback:this.handleLoggedOutUser_.bind(this,title,text)});return;case'not-logged-in':this.facade.sendNotification(postermywall.Core.LOG_OUT_USER,{callback:this.handleLoggedOutUser_.bind(this,$.t('pm_logged_out_title'),$.t('pm_logged_out_message'))});return;case'save-conflict':if(r.data.conflictUser){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'save'});var am=this.facade.retrieveMediator(postermywall.core.view.AppMediator.NAME);am.loadMediator(['postermywall.core.view.modal.SaveConflictModalMediator'],postermywall.Core.SAVE_CONFLICT,r.data.conflictUser);return;}
break;}}}
this.onSaveError_();},onSaved_:function(savedPoster){this.wbp_.setUnsavedChanges(false);this.wbp_.getPoster().id=savedPoster.id;this.wbp_.setPoster(savedPoster);var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),image=wbm.getSnapshot(postermywall.core.model.vo.PosterVO.SCREEN_LARGER_DIMENSION/(savedPoster.width>savedPoster.height?savedPoster.width:savedPoster.height));this.pp_.savePosterPreview(savedPoster.hashedID,image).done(this.onPreviewSaved_.bind(this)).fail(this.onSaveError_.bind(this));PMW.trackGAEvent(PMW.POSTERBUILDER,'SavePoster',savedPoster.id);},onPreviewSaved_:function(){this.facade.sendNotification(postermywall.Core.HIDE_LOADING,{key:'save'});this.facade.sendNotification(postermywall.Core.POSTER_SAVED,{poster:this.wbp_.getPoster(),callbackHasRedirect:this.callbackHasRedirect_});this.onSaveComplete_();},onSaveComplete_:function(){if(typeof this.callback_==='function'){this.callback_();}},handleLoggedOutUser_:function(title,text){this.facade.sendNotification(postermywall.Core.SHOW_MESSAGE,{title:title,text:text,onClose:this.sendNotification.bind(this,postermywall.Core.AUTHENTICATE_USER,{callback:this.performSave_.bind(this)})});}});
puremvc.define({name:'postermywall.core.controller.editor.PurchaseDownloadsCommand',parent:postermywall.core.controller.editor.SaveCommand},{idProduct_:-1,promotionCode_:'',execute:function(note){this.idProduct_=note.getBody().idProduct;this.promotionCode_=note.getBody().promotion;postermywall.core.controller.editor.SaveCommand.prototype.execute.call(this,note);},onSaveComplete_:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);if(this.idProduct_>0&&wbp.getPoster()!==null){var text='';if(this.promotionCode_.length){text=$.t('pm_verifying_promo');}
this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'checkoutDownload',text:text});pp.checkoutDownload({idposter:wbp.getPoster().hashedID,idproduct:this.idProduct_,promotion:this.promotionCode_}).done(this.onCheckoutDownloadResponse_.bind(this)).fail(this.onCheckoutDownloadError_.bind(this)).always(this.onCheckoutDownloadComplete_.bind(this));}},onCheckoutDownloadResponse_:function(response){if(response===null){this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_checkout_download_error')});}else{if(response.orderRegen){PMW.freeEditDialog(response);return;}
if(response.message){if(response.premium>0){PMW.premiumContentBlockMessage();}
else{this.facade.sendNotification(postermywall.Core.DOWNLOAD_MODAL_SHOW_MESSAGE,response.message);}}else if(response.url){window.location.href=response.url;}else if(response.checkout){PMW.checkout.showCheckoutDialog(PMW.checkout.MODE_DOWNLOAD,response.checkout,this.facade);}else{this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_checkout_download_error')});}}},onCheckoutDownloadError_:function(){this.facade.sendNotification(postermywall.Core.SHOW_ERROR,{message:$.t('pm_checkout_download_error')});},onCheckoutDownloadComplete_:function(){this.sendNotification(postermywall.Core.DOWNLOAD_MODAL_RESTORE_STATE);this.sendNotification(postermywall.Core.HIDE_LOADING,{key:'checkoutDownload'})}});
puremvc.define({name:'postermywall.core.controller.editor.UndoableCommand',parent:puremvc.SimpleCommand},{noteRedo_:null,noteUndo_:null,isRedo_:false,execute:function(note){if(note.getType()===postermywall.Core.UNDOABLE_UPDATE){this.noteRedo_=note;this.noteUndo_=new puremvc.Notification();if(!this.isRedo_){var p=this.facade.retrieveProxy(postermywall.core.model.CommandHistoryProxy.NAME);p.add(this);}
this.undoableExecute(note);}
else{this.nonUndoableExecute(note);}},undoableExecute:function(note){},nonUndoableExecute:function(note){},undo:function(){},redo:function(){this.isRedo_=true;this.execute(this.noteRedo_);this.isRedo_=false;}});
puremvc.define({name:'postermywall.core.controller.editor.AddItemCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),b=note.getBody();if(b.length){for(var i=0;i<b.length;i++){wbp.addItem(b[i]);}
if(b.length>1){wbm.selectDuplicatedGraphicItems();}}
this.noteUndo_.setBody(b);},undo:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),b=this.noteUndo_.getBody();if(b.length){for(var i=0;i<b.length;i++){wbp.removeItem(b[i]);}
if(b.length>1){wbm.clearSelection();}}}});
puremvc.define({name:'postermywall.core.controller.editor.UpdateItemCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var snapshot=[];var models=note.getBody().models;var changes=note.getBody().changes;for(var i=0;i<models.length;i++){snapshot[snapshot.length]=postermywall.Util.cloneVO(models[i]);}
this.applyChanges_(models,changes);this.noteUndo_.setBody({models:snapshot,changes:changes});},nonUndoableExecute:function(note){var models=note.getBody().models;var changes=note.getBody().changes;this.applyChanges_(models,changes);},undo:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);var views=wbm.getSelectedViews();if(views.length>1){wbm.discardActiveGroup();wbp.updateGraphicItems(this.noteUndo_.getBody().models);wbm.setObjectsAsActiveGroup(views);}else{wbp.updateGraphicItems(this.noteUndo_.getBody().models);}},applyChanges_:function(models,changes){var setActiveGroup=false;if(this.isRedo_){var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),views=wbm.getSelectedViews();if(views.length>1){setActiveGroup=true;wbm.discardActiveGroup();}}
var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),changedModels=[];for(var i=0;i<models.length;i++){var changedModel=postermywall.Util.cloneVO(models[i]);for(var p in changes[i]){changedModel[p]=changes[i][p];}
changedModels[changedModels.length]=changedModel;}
wbp.updateGraphicItems(changedModels);if(setActiveGroup){wbm.setObjectsAsActiveGroup(views);}}});
puremvc.define({name:'postermywall.core.controller.editor.MoveItemCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var move=note.getBody().move;var view=note.getBody().view;var wm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);var objects=wm.getViewComponent().getObjects();var oldIndex=objects.length-1;for(var j=0;j<objects.length;j++){if(objects[j]===view){oldIndex=j;break;}}
switch(move){case'front':wm.getViewComponent().bringToFront(view);break;case'forward':wm.getViewComponent().bringForward(view);break;case'backwards':wm.getViewComponent().sendBackwards(view);break;case'back':wm.getViewComponent().sendToBack(view);break;}
note.getBody().oldIndex=oldIndex;this.noteUndo_.setBody(note.getBody());},undo:function(){var wm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);wm.getViewComponent().moveTo(this.noteUndo_.getBody().view,this.noteUndo_.getBody().oldIndex);}});
puremvc.define({name:'postermywall.core.controller.editor.RemoveItemsCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var models=note.getBody();var indexMap={};var wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME);var objects=wbm.getViewComponent().getObjects();for(var i=0;i<objects.length;i++){for(var j=0;j<models.length;j++){if(postermywall.core.view.GraphicItemMediator.getViewComponentUID(objects[i])===models[j].uid){indexMap[i]=models[j];break;}}}
var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);for(var p in indexMap){wbp.removeItem(indexMap[p]);}
this.noteUndo_.setBody(indexMap);},undo:function(){var indexMap=this.noteUndo_.getBody();var indices=[];for(var index in indexMap){indices[indices.length]=index;}
indices.sort(function compareNumbers(a,b){return a-b;});var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);for(var i=0;i<indices.length;i++){wbp.addItem(indexMap[indices[i]],indices[i]);}}});
puremvc.define({name:'postermywall.core.controller.editor.ReplaceGraphicItemCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){this.noteUndo_.setBody(this.applyChanges_(note.getBody().o,note.getBody().n,note.getBody().copyVisuals));},nonUndoableExecute:function(note){this.applyChanges_(note.getBody().o,note.getBody().n,note.getBody().copyVisuals);},undo:function(){var indexMap=this.noteUndo_.getBody(),indices=[],i,wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);for(var index in indexMap){i=indices.length;indices[indices.length]=index;}
indices.sort(function compareNumbers(a,b){return a-b;});for(i=0;i<indices.length;i++){wbp.addItem(indexMap[indices[i]].o,indices[i]);wbp.removeItem(indexMap[indices[i]].n);}},applyChanges_:function(oldVO,newVO,copyVisuals){if(typeof copyVisuals=='undefined'){copyVisuals=true;}
var indexMap={},wbm=this.facade.retrieveMediator(postermywall.core.view.WhiteboardMediator.NAME),objects=wbm.getViewComponent().getObjects(),wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);if(copyVisuals){newVO.copyVisuals(oldVO);}
if(newVO.width>newVO.height){newVO.scaleY=newVO.scaleX=(oldVO.width*oldVO.scaleX)/newVO.width;}else if(newVO.width<newVO.height){newVO.scaleY=newVO.scaleX=(oldVO.height*oldVO.scaleY)/newVO.height;}
else{if(oldVO.width>=oldVO.height){newVO.scaleY=newVO.scaleX=(oldVO.width*oldVO.scaleX)/newVO.width;}else{newVO.scaleY=newVO.scaleX=(oldVO.height*oldVO.scaleY)/newVO.height;}}
for(var i=0;i<objects.length;i++){if(postermywall.core.view.GraphicItemMediator.getViewComponentUID(objects[i])===oldVO.uid){indexMap[i]={};indexMap[i].o=oldVO;indexMap[i].n=newVO;break;}}
for(var p in indexMap){wbp.removeItem(indexMap[p].o);wbp.addItem(newVO,p);}
return indexMap;}});
puremvc.define({name:'postermywall.core.controller.editor.ResizePosterCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var b=note.getBody();this.noteUndo_.setBody(this.applyChanges_(b.p,b.ptn,b.tw,b.th,b.uw,b.uh,b.u,b.sc));},nonUndoableExecute:function(note){var b=note.getBody();this.applyChanges_(b.p,b.ptn,b.tw,b.th,b.uw,b.uh,b.u,b.sc);},undo:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),b=this.noteUndo_.getBody(),oldPoster=b.oldPoster,poster=wbp.getPoster();wbp.setResizeReference(b.resizeReference);poster.width=oldPoster.width;poster.height=oldPoster.height;poster.type=oldPoster.type;poster.backgroundModification=postermywall.Util.cloneVO(oldPoster.backgroundModification);if(poster.type.name==postermywall.core.model.vo.PosterTypeVO.TYPE_POSTER_CUSTOM){poster.userWidth=oldPoster.userWidth;poster.userHeight=oldPoster.userHeight;poster.units=oldPoster.units;}
for(var i=0;i<poster.graphicItems.length;i++){poster.graphicItems[i]=postermywall.Util.cloneVO(oldPoster.graphicItems[i]);}
this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'resizePoster',text:$.t('pm_undo_resizing_poster'),priority:11});this.sendNotification(postermywall.Core.POSTER_RESIZED,{vo:poster,type:poster.type});},applyChanges_:function(poster,posterTypeName,targetWidth,targetHeight,userWidth,userHeight,units,showConfirmation){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),oldPoster=postermywall.Util.cloneVO(wbp.getPoster());var resizeReference=postermywall.Util.cloneVO(wbp.getResizeReference());this.sendNotification(postermywall.Core.SHOW_LOADING,{key:'resizePoster',text:$.t('pm_resizing_poster'),priority:11});if(posterTypeName==postermywall.core.model.vo.PosterTypeVO.TYPE_POSTER_CUSTOM){poster.userWidth=userWidth;poster.userHeight=userHeight;poster.units=units;}
showConfirmation=typeof showConfirmation==='undefined'?false:showConfirmation;wbp.resizePoster(poster,posterTypeName,targetWidth,targetHeight,showConfirmation);return{oldPoster:oldPoster,resizeReference:resizeReference};}});
puremvc.define({name:'postermywall.core.controller.editor.ChangePosterThemeCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var template=note.getBody();var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);var snapshot,changedPoster;snapshot=postermywall.Util.cloneVO(wbp.getPoster());changedPoster=postermywall.Util.cloneVO(wbp.getPoster());if(template.theme.background.isCustomizable()){changedPoster.primaryColor=template.primaryColor;changedPoster.secondaryColor=template.backgroundType_===0?template.primaryColor:template.secondaryColor;changedPoster.gradient=template.gradient;}
changedPoster.theme=postermywall.Util.cloneVO(template.theme);changedPoster.backgroundModification=typeof template.backgroundModification!=='undefined'?postermywall.Util.cloneVO(template.backgroundModification):new postermywall.core.model.vo.BackgroundModificationVO();changedPoster.backgroundModification.copyEffects(snapshot.backgroundModification);changedPoster.backgroundType_=template.backgroundType_;this.noteUndo_.setBody(snapshot);wbp.changeTheme(changedPoster);},nonUndoableExecute:function(note){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME);wbp.changeTheme(note.getBody());},undo:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),refresh=wbp.getUnsavedChanges()?true:false;wbp.changeTheme(this.noteUndo_.getBody(),refresh);}});
puremvc.define({name:'postermywall.core.controller.editor.ModifyBackgroundCommand',parent:postermywall.core.controller.editor.UndoableCommand},{undoableExecute:function(note){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),p=wbp.getPoster(),snapshot=postermywall.Util.cloneVO(p.backgroundModification);this.applyChanges_(note.getBody());this.noteUndo_.setBody(snapshot);},nonUndoableExecute:function(note){this.applyChanges_(note.getBody());},undo:function(){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),b=this.noteUndo_.getBody();wbp.modifyBackground(b);},applyChanges_:function(changes){var wbp=this.facade.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME),poster=wbp.getPoster(),changedBackgroundModification=postermywall.Util.cloneVO(poster.backgroundModification);for(var p in changes){if(changes.hasOwnProperty(p)){changedBackgroundModification[p]=changes[p];}}
wbp.modifyBackground(changedBackgroundModification);}});
puremvc.define({name:'postermywall.core.controller.PrepControllerCommand',parent:puremvc.SimpleCommand},{execute:function(note){this.facade.registerCommand(postermywall.Core.IS_POSTER_PURCHASED,postermywall.core.controller.CheckPosterIsPurchasedCommand);this.facade.registerCommand(postermywall.Core.ADD_GRAPHIC_ITEM,postermywall.core.controller.editor.AddItemCommand);this.facade.registerCommand(postermywall.Core.UPDATE_GRAPHIC_ITEMS,postermywall.core.controller.editor.UpdateItemCommand);this.facade.registerCommand(postermywall.Core.MOVE_GRAPHIC_ITEM,postermywall.core.controller.editor.MoveItemCommand);this.facade.registerCommand(postermywall.Core.REMOVE_GRAPHIC_ITEMS,postermywall.core.controller.editor.RemoveItemsCommand);this.facade.registerCommand(postermywall.Core.REPLACE_GRAPHIC_IMAGE,postermywall.core.controller.editor.ReplaceGraphicItemCommand);this.facade.registerCommand(postermywall.Core.RESIZE_POSTER,postermywall.core.controller.editor.ResizePosterCommand);this.facade.registerCommand(postermywall.Core.CHANGE_THEME,postermywall.core.controller.editor.ChangePosterThemeCommand);this.facade.registerCommand(postermywall.Core.MODIFY_BACKGROUND,postermywall.core.controller.editor.ModifyBackgroundCommand);this.facade.registerCommand(postermywall.Core.SAVE,postermywall.core.controller.editor.SaveCommand);this.facade.registerCommand(postermywall.Core.PURCHASE_DOWNLOAD,postermywall.core.controller.editor.PurchaseDownloadsCommand);}});
puremvc.define({name:'postermywall.core.controller.PrepViewCommand',parent:puremvc.SimpleCommand},{execute:function(note){this.facade.registerMediator(new postermywall.core.view.AppMediator());this.facade.registerMediator(new postermywall.core.view.EditorMediator());this.facade.registerMediator(new postermywall.core.view.WhiteboardMediator());this.facade.registerMediator(new postermywall.core.view.AuthenticateMediator());this.facade.registerMediator(new postermywall.core.view.notification.NotificationMediator());this.facade.registerMediator(new postermywall.core.view.notification.SaveReminderMediator());this.facade.registerMediator(new postermywall.core.view.notification.LanguageNotificationMediator());this.facade.registerMediator(new postermywall.core.view.notification.UnsupportedNotificationMediator());this.facade.registerMediator(new postermywall.core.view.modal.ModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.MessageModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.ErrorModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.SaveConfirmationModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.BackgroundTypeModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.ImageTypeModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.DownloadModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.PosterPurchasedWarningModalMediator());this.facade.registerMediator(new postermywall.core.view.modal.ResizePurchasedPosterWarningModalMediator());}});
puremvc.define({name:'postermywall.core.controller.StartupCommand',parent:puremvc.MacroCommand},{initializeMacroCommand:function(){this.addSubCommand(postermywall.core.controller.PrepControllerCommand);this.addSubCommand(postermywall.core.controller.PrepModelCommand);this.addSubCommand(postermywall.core.controller.PrepViewCommand);this.addSubCommand(postermywall.core.controller.InitCommand);}});
puremvc.define({name:'postermywall.core.controller.CheckPosterIsPurchasedCommand',parent:puremvc.SimpleCommand},{execute:function(note){if(note.getBody()!==null){var id=parseInt(note.getBody().id,10);if(!isNaN(id)&&id>0){var pp=this.facade.retrieveProxy(postermywall.core.model.PosterProxy.NAME);pp.isPosterPurchased(id).done(this.onIsPosterPurchasedSuccess.bind(this));}}},onIsPosterPurchasedSuccess:function(data){if(data==='yes'){this.facade.sendNotification(postermywall.Core.POSTER_PURCHASED_WARNING);}}});
"use strict";puremvc.define({name:'postermywall.core.library.UploadLibrary'},{},{initUpload:function(iid,uf,ecb,eid,msg){var fs=$(iid);if(window.File&&window.FileList){var el=$(eid);var ddo=el.find('.dragdropoverlay');if(fs.length){fs.on('change',this.onFileSelectHandler.bind(this,uf,ddo));}
if(typeof eid!=='undefined'){var xhr=new XMLHttpRequest();if(xhr.upload){el.on('dragover',this.onFileDragHover.bind(this,ddo)).on('drop',this.onFileSelectHandler.bind(this,uf,ddo));ddo.on('dragleave',this.onFileDragHover.bind(this,ddo)).find('.message').html(msg);}}}else{if(fs.length){fs.on('click',function(e){e.preventDefault();ecb();})}}},onFileDragHover:function(ddo,e){e.stopPropagation();e.preventDefault();if(e.type==='dragover'){ddo.show();}else{ddo.hide();}},onFileSelectHandler:function(uf,ddo,e){if(ddo.length){this.onFileDragHover(ddo,e);}
var dt=e.dataTransfer||(e.originalEvent&&e.originalEvent.dataTransfer);var fileList=e.target.files||(dt&&dt.files);var files=[];$.each(fileList,function(key,file){files.push(file);});var input=$(e.currentTarget);input.wrap('<form>').closest('form').get(0).reset();input.unwrap();uf(files);},uploadXhrCallback:function(pb){var myXhr=$.ajaxSettings.xhr();if(myXhr.upload){myXhr.upload.addEventListener('progress',this.progressHandler.bind(this,pb),false);}
return myXhr;},progressHandler:function(pb,e){if(e.lengthComputable){pb.width(((e.loaded/(e.total*1.1))*100)+'%');}else{pb.width('90%');}},createThumb:function(file,imageUrl){var img=document.createElement("img");if(file.type=='image/svg+xml'){img.src=imageUrl;return img;}
img.onload=(function(){return function(){img.onload=null;var temp=document.createElement("img"),canvas,ctx,resizeInfo,_ref,_ref1,_ref2,_ref3;temp.src=img.src;file.width=temp.width;file.height=temp.height;resizeInfo=this.resize(file);if(resizeInfo.trgWidth==null){resizeInfo.trgWidth=resizeInfo.optWidth;}
if(resizeInfo.trgHeight==null){resizeInfo.trgHeight=resizeInfo.optHeight;}
canvas=document.createElement("canvas");ctx=canvas.getContext("2d");canvas.width=resizeInfo.trgWidth;canvas.height=resizeInfo.trgHeight;this.drawImageIOSFix(ctx,img,(_ref=resizeInfo.srcX)!=null?_ref:0,(_ref1=resizeInfo.srcY)!=null?_ref1:0,resizeInfo.srcWidth,resizeInfo.srcHeight,(_ref2=resizeInfo.trgX)!=null?_ref2:0,(_ref3=resizeInfo.trgY)!=null?_ref3:0,resizeInfo.trgWidth,resizeInfo.trgHeight);img.src=canvas.toDataURL("image/png");}.bind(this);}.bind(this))(this);img.src=imageUrl;return img;},detectVerticalSquash:function(img){var alpha,canvas,ctx,data,ey,ih,iw,py,ratio,sy;iw=img.naturalWidth;ih=img.naturalHeight;canvas=document.createElement("canvas");canvas.width=1;canvas.height=ih;ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);data=ctx.getImageData(0,0,1,ih).data;sy=0;ey=ih;py=ih;while(py>sy){alpha=data[(py-1)*4+3];if(alpha===0){ey=py;}else{sy=py;}
py=(ey+sy)>>1;}
ratio=py/ih;if(ratio===0){return 1;}else{return ratio;}},drawImageIOSFix:function(ctx,img,sx,sy,sw,sh,dx,dy,dw,dh){var vertSquashRatio;vertSquashRatio=this.detectVerticalSquash(img);return ctx.drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh/vertSquashRatio);},resize:function(file){var info,srcRatio,ms;info={srcX:0,srcY:0,srcWidth:file.width,srcHeight:file.height};ms=this.MAX_THUMB_SIDE;srcRatio=file.width/file.height;info.optWidth=ms;info.optHeight=ms/srcRatio;if(info.optHeight>ms){info.optHeight=ms;info.optWidth=ms*srcRatio;}
return info;},NAME:'UploadLibrary',MAX_FILE_SIZE:52428800,MAX_THUMB_SIDE:150});
(function(window){var init_=true;puremvc.define({name:'postermywall.PosterMaker',constructor:function(c){if(init_===false){throw new Exception('postermywall.PosterMaker constructor called twice!');}
init_=false;if('undefined'===typeof c&&'undefined'!==typeof window.PMConfig){c=window.PMConfig;}
if('undefined'===typeof c){c={};}
this.facade.registerCommand(postermywall.Core.STARTUP,postermywall.core.controller.StartupCommand);this.facade.sendNotification(postermywall.Core.STARTUP,c);}},{STARTUP:'startup',facade:puremvc.Facade.getInstance(postermywall.Core.CORE_NAME)});})(window);$(function(){if(window.isCanvasSupported&&!isCanvasSupported()){return;}
if(navigator.platform.indexOf('Win')!==-1){document.getElementsByTagName('html')[0].className+=' windows';}
else if(navigator.platform==='iPad'){document.getElementsByTagName('html')[0].className+=' ios';}
new postermywall.PosterMaker();});
